var Localization=function(){this.test_mode=false;this.language=null;this.non_english=null;this.init=function(){if(typeof BF_STATIC!="undefined"){localize.language=localize.returnLang();localize.non_english=localize.nonEnglish();localize.test_mode=localize.inTestMode()}};this.returnLang=function(){if(typeof BF_STATIC.language!="undefined"){return BF_STATIC.language}else{return null}};this.nonEnglish=function(){if(typeof BF_STATIC.non_english!="undefined"&&BF_STATIC.non_english){return true}else{return false}};this.inTestMode=function(){if(typeof BF_STATIC.translation_debug!="undefined"&&BF_STATIC.translation_debug&&localize.non_english&&localize.language){return true}else{return false}};this.dictionary=function(){if(!localize.language){return null}try{return eval(localize.language+"_dictionary")}catch(e){return null}};this.testMode=function(str){return(str+" ("+localize.language+")")};this.translate=function(string,args){if(!string||typeof string!="string"){return null}var translation,start_space=string.charAt(0)==" "?true:false,end_space=string.charAt(string.length-1)==" "?true:false;string=localize.strip_spaces(string);translation=localize.dictionary()&&localize.dictionary()[string]?localize.dictionary()[string]:string;if(translation&&args&&args.variables){translation=localize.var_replace(translation,args.variables)}if(start_space){translation=" "+translation}if(end_space){translation=translation+" "}if(localize.test_mode){translation=localize.testMode(translation)}return translation};this.strip_spaces=function(string){if(string.charAt(0)==" "){string=string.slice(1,string.length-1)}if(string.charAt(string.length-1)==" "){string=string.slice(0,string.length-2)}return string};this.var_replace=function(string,vars){var variable,counter,subString,split=string.split("#{"),length=split.length;for(counter=0;counter<length;counter++){subString=split[counter];if(subString){subString=subString.split("}")[0];variable=(vars.hasOwnProperty(subString)?vars[subString].toString():null);if(variable){variable=localize.translate(variable);string=string.replace("#{"+subString+"}",variable)}}}return string}};var localize=new Localization();localize.init();var local=localize;local.t=local.translate;var BF_SiteSpeedUpload=function(){this._start_track_time={};this.opt_sampleRate=1;this.filter_empty_time=true;this.dom_time_spent=function(c){if(bf_start_site_time=="undefined"){return false}var b=new Date().getTime();var f=b-bf_start_site_time;var a=(BF_STATIC.tt_page?BF_STATIC.tt_page:"NA")+":DOM";if((bf_site_speed.filter_empty_time&&f)||!bf_site_speed.filter_empty_time){gtrack.track_timing(a,c,f)}};this.start_track=function(a){bf_site_speed._start_track_time[a]=new Date().getTime()};this.end_track=function(b,a,g){var f=new Date().getTime();var c=bf_site_speed._start_track_time[b]?f-bf_site_speed._start_track_time[b]:0;delete (bf_site_speed._start_track_time[b]);if((bf_site_speed.filter_empty_time&&c)||!bf_site_speed.filter_empty_time){gtrack.track_timing(b,a,c,g,bf_site_speed.opt_sampleRate)}}};var bf_site_speed=new BF_SiteSpeedUpload();Event.observe(window,"load",function(){bf_site_speed.dom_time_spent("Window Load")});BF_js_version="1.0.0";BF_XSS={request:function(b){var f=BF_server+b.script;f+="?version="+BF_js_version;for(name in b.params){f+="&";var c=b.params[name];f+=escape(name)+"="+escape(c)}var a=document.createElement("script");a.src=f;document.getElementsByTagName("body")[0].appendChild(a)},swift_injection:function(b){if(b=="http://platform.twitter.com/widgets.js"&&BF_STATIC.bf_test_mode&&document.cookie.match("sel2_superposter_add_as_tweet")===null){return true}var a=document.createElement("script");a.src=b;document.getElementsByTagName("head")[0].appendChild(a)},badge:function(args){if(BF_XSS.__open_badge){BF_XSS.__open_badge.style.display="none"}if(args.close==true){BF_XSS.__close_badge=true;return}if(BF_XSS.__close_badge){BF_XSS.__close_badge=false;return false}var target=args.target;var json_data=unescape(target.getAttribute("rel:bf_data"));this.obj=eval("("+json_data+")");var div_id=this.obj.buzz_id+"_"+this.obj.badge_type;if(!document.getElementById(div_id)){var div=document.createElement("div");div.id=div_id;div.className="badge-tip badge-"+this.obj.badge_type;args.target.appendChild(div);var spinner=document.createElement("div");spinner.className="spinner";spinner.innerText=" ";div.appendChild(spinner)}if(BF_XSS.__open_badge&&BF_XSS.__open_badge.id==div_id){BF_XSS.__open_badge=null;return true}BF_XSS.__open_badge=document.getElementById(div_id);BF_XSS.__open_badge.style.display="block";BF_XSS.request({script:"_badge",params:{element_id:div_id,json:json_data}});return false},stats_response:function(k,h){if(typeof h=="undefined"){h=BF_XSS.buzz_id}var l=document.getElementById(h+"_top_linking_sites");if(l){for(var g=0;g<k.domains.length;g++){if(k.domains[g]){var b=document.createElement("li");var c=document.createElement("a");c.setAttribute("href","http://"+k.domains[g]["domain"]);c.appendChild(document.createTextNode(k.domains[g]["domain"]));b.appendChild(c);l.appendChild(b)}}}l=document.getElementById(h+"_total_views");if(k.impressions&&k.impressions.length>0){var f=k.impressions[0]["total"]+"";f=f.replace(/(\d)(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})$/,"$1,$2,$3,$4,$5,$6,$7");f=f.replace(/,{2,}/,",");if(l){l.appendChild(document.createTextNode(f))}}if(k.pie){BF_XSS.update_chart(k.pie,h+"_chart")}},update_chart:function(f,h){var h=document.getElementById(h);var c=h.getAttribute("width");if(!c){c=50}var a=h.getAttribute("height");if(!a){a=40}var b=document.createElement("img");var g="http://chart.apis.google.com/chart?chs="+c+"x"+a+"&chd=t:"+f+","+(100-f)+"&cht=p3&chco=0077ee,ee3322&chf=bg,s,0d0d0d";b.src=g;h.appendChild(b);h.className="chart"}};function EventManagerBase(){this.EVENTS={}}EventManagerBase.prototype={constructor:EventManagerBase,observe:function(b,a){if(!this.EVENTS[b]){this.EVENTS[b]={listeners:[],one_time_listeners:[]}}if(this.EVENTS[b].listeners.indexOf(a)==-1){this.EVENTS[b].listeners.push(a)}},observe_once:function(b,a){if(!this.EVENTS[b]){this.EVENTS[b]={listeners:[],one_time_listeners:[]}}if(this.EVENTS[b].one_time_listeners.indexOf(a)==-1){this.EVENTS[b].one_time_listeners.push(a)}},stop_observing:function(c,b){if(this.EVENTS[c]){var a=this.EVENTS[c].listeners.indexOf(b);if(a>-1){this.EVENTS[c].listeners.splice(a,1)}else{return false}return true}else{return false}},fire:function(f,g,h){if(BF_STATIC&&BF_STATIC.bf_env&&BF_STATIC.bf_env=="dev"){console.log("Firing: "+f);if(BF_STATIC.bf_test_mode){if(!this.eventStack){this.eventStack={}}if(!this.eventStack[f]){this.eventStack[f]=[]}this.eventStack[f].push({ev:f,data:g,target:h});if(this.eventListeners&&this.eventListeners[f]){this.eventListeners[f].map(function(k){if(!k.fulfilled){k.fulfilled=true;k.data=g;k.target=h}})}}}window[f]=true;if(typeof g=="undefined"){g={}}if(this.EVENTS[f]){var c=this.EVENTS[f].listeners;for(var a=0;a<c.length;a++){this._single_fire(c[a],g,h)}for(var b;b=this.EVENTS[f].one_time_listeners.pop();){this._single_fire(b,g,h)}}},_single_fire:function(a,c,f){try{a(c,f)}catch(b){console.dir(b)}}};if(BF_STATIC&&BF_STATIC.bf_env&&BF_STATIC.bf_env=="dev"&&BF_STATIC.bf_test_mode){EventManagerBase.prototype.eventStack={};EventManagerBase.prototype.findEventInStack=function(a){if(this.eventStack[a]){return this.eventStack[a].pop()}else{return null}};EventManagerBase.prototype.clearEventStack=function(a){if(this.eventStack[a]){this.eventStack[a]=[]}};EventManagerBase.prototype.eventListeners={};EventManagerBase.prototype.addEventListener=function(a){if(!this.eventListeners[a]){this.eventListeners[a]=[]}var b={id:(new Date().getTime()+Math.random().toString().substr(2,3)),fulfilled:false};this.eventListeners[a].push(b);return b.id};EventManagerBase.prototype.acceptEventOrAddEventListener=function(b){if(!this.eventListeners[b]){this.eventListeners[b]=[]}var a=this.findEventInStack(b);var c={id:(new Date().getTime()+Math.random().toString().substr(2,3)),fulfilled:false};if(a){c.fulfilled=true;c.data=a.data;c.target=a.target}this.eventListeners[b].push(c);return c.id};EventManagerBase.prototype.getEventListener=function(f,b){try{var a=null;if(this.eventListeners[b]){a=this.eventListeners[b].find(function(g){if(g.id==f){return true}else{return false}})}return a}catch(c){console.error(c)}}}var EventManager=new EventManagerBase();var BuzzLoader=function(){var b=false;var a={p1:[],p2:[],p3:[],p4:[],p5:[],p6:[],p7:[],p8:[],p9:[],p10:[],user:[]};var c=function(){var f;for(f=1;f<=10;f++){a["p"+f].each(function(h){try{h()}catch(g){if(typeof window.BF_STATIC!="undefined"&&BF_STATIC.bf_env=="dev"){console.dir(g.message);console.log(h)}}})}b=true;a.user.each(function(g){g()})};return{waitForDOM:function(){if(Prototype.Browser.IE){if(!$("buzz-body")){setTimeout("BuzzLoader.waitForDOM();",100)}else{c()}}else{document.observe("dom:loaded",c)}},callLoaded:function(f){if(b){f()}else{a.user.push(f)}},register:function(g,f){if(b){g()}if(f>10||f<1){return 0}a["p"+f].push(g);return 1},register_injection:function(f,g){return BuzzLoader.register(function(){setTimeout(function(){BF_XSS.swift_injection(f)},1)},g)}}}();BuzzLoader.waitForDOM();BFW_COOKIE="bf2-b";BFW_INFO_COOKIE="bf2-b_info";DEFAULT_USER="default_user";var BF_User=function(){this.bools=["p_allow_raw_html","p_disable_quickpost","p_disable_comment","p_disable_reaction","p_admin","p_access_stats","p_alias","p_dashboard","p_partner_admin","public_dashboard","p_boost_buzz","p_developer_admin","p_editor_admin","p_other_admin","show_account_settings","is_facebook_user","terminal_user","f_partner","f_ad","is_microsite","f_self_serve","is_subchannel","is_channel"];this.isLoggedIn=function(){if(BFW_Util.getCookie(BFW_COOKIE)){return true}else{return false}};this.getSessionKey=function(){return BFW_Util.getCookie(BFW_COOKIE)};this.logout=function(a){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER);if(!a){BF_Request.location({reload_track:true,reload_track_no_delay:true})}};this.getUserInfo=function(){var a=BFW_Util.getCookie(BFW_INFO_COOKIE);var f=BFW_Util.getParameters({str:a,escape:true});var c=BFW_Util.getCookie(DEFAULT_USER);if(f&&c){f.default_user=BFW_Util.getParameters({str:c,escape:true})}if(("localStorage" in window)&&window.localStorage!==null){var b=localStorage.getItem("earned_reactions");if(f&&b){f.earned_reactions=b}}if(typeof f!="undefined"){this.bools.each(function(g){if(typeof f[g]=="undefined"){f[g]="false"}if(typeof f.default_user=="undefined"){f.default_user={b:"false"}}else{if(typeof f.default_user[g]=="undefined"||f.default_user[g]=="undefined"){f.default_user[g]="false"}}});f.isa=f.p_admin}return f||{}};this.load_user_settings=function(){if(this.isLoggedIn()&&(!this.getUserInfo().username||this.getUserInfo().username!=this.getUsernameFromSession())){try{if(window.user_nav){user_nav.signout()}}catch(b){console.error(b)}}else{if(this.isLoggedIn()&&bf_username==this.getUserInfo().username&&!document.location.href.match(/\/submissions\//)){var a=document.createElement("script");a.src=bf_sr+"/js/public/contribute/user_settings.js?"+BF_STATIC.version;document.getElementsByTagName("body")[0].appendChild(a);var a=document.createElement("script");a.src=bf_sr+"/js/public/contribute/user_post.js?"+BF_STATIC.version;document.getElementsByTagName("body")[0].appendChild(a)}}};this.getUsernameFromSession=function(){var a=BFW_Util.getCookie(BFW_COOKIE);b="";if(a){var b=a.substring(64,a.length)}return b}};var BFW_Util={getCookie:function(a){var b=document.cookie.match(new RegExp("(^|;)\\s*"+encodeURIComponent(a)+"=([^;\\s]*)"));return(b?decodeURIComponent(b[2]):null)},deleteCookie:function(c,f){var g=new Date();g.setTime(g.getTime()-1000000000);var b="; expires="+g.toGMTString();var a=decodeURIComponent(c)+"="+b+"; path=/";if(f){a+="; domain=."+f}else{a+="; domain=.buzzfeed.com"}document.cookie=a},setCookie:function(c){if(BF_STATIC.bf_env=="dev"&&c.name=="country"&&typeof c.clem_valid=="undefined"){alert("Make sure you talk to Clem before making updates to the country cookie!!")}var h=1000*60*60*24*365;if(c.seconds||c.seconds==0){h=c.seconds*1000}var g=new Date();g.setTime(g.getTime()+h);var b="";if(h>0){b="; expires="+g.toGMTString()}var f=c.no_encode?c.value:encodeURIComponent(c.value);var a=encodeURIComponent(c.name)+"="+f+b+"; path=/";if(c.host){a+="; domain=."+c.host}else{a+="; domain=.buzzfeed.com"}document.cookie=a;if(typeof c.callback!="undefined"){c.callback()}},setInfoCookie:function(a){var b=a.value;if(b.f_index){b.f_index="true"}if(b.earned_reactions){if(("localStorage" in window)&&window.localStorage!==null){localStorage.setItem("earned_reactions",Object.toJSON(b.earned_reactions))}else{console.warn("earned reactions not supported (no local storage)")}delete b.earned_reactions}if(BFW_Util.getCookie(DEFAULT_USER)==null){if(b.user_switching){b.user_switching="true"}else{delete b.user_switching}var c={name:DEFAULT_USER,value:$H({display_name:encodeURIComponent(b.display_name),userid:b.userid,id:b.userid,p_boost_buzz:b.p_boost_buzz==1,username:encodeURIComponent(b.username),session_key:b.session_key,p_alias:b.p_alias,p_admin:b.p_admin,p_partner_admin:b.p_partner_admin,image:encodeURIComponent(b.image),f_ad:b.f_ad,f_partner:b.f_partner,p_editor_admin:b.p_editor_admin,p_developer_admin:b.p_developer_admin,p_other_admin:b.p_other_admin}).toQueryString()};BFW_Util.setCookie(c)}BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:$H(b).toQueryString()})},updateInfoCookie:function(g){var a=(new BF_User()).getUserInfo();if(g.earned_reactions){if(("localStorage" in window)&&window.localStorage!==null){localStorage.setItem("earned_reactions",g.earned_reactions)}else{console.warn("earned reactions not supported (no local storage)")}}for(var c in a){if(typeof g[c]!="undefined"){a[c]=g[c]}}var b=["msg_count","msg_count_updated"];b.each(function(h){if(typeof g[h]!="undefined"){a[h]=g[h]}});delete g.earned_reactions;delete a.earned_reactions;for(var f in a){if(a[f]=="false"){delete a[f]}}BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:$H(a).toQueryString()})},getParameters:function(a){var b={};var f=null;if(a&&a.str){f=a.str}if(!f){f=window.location.toString();if(f.indexOf("?")>-1){f=(f.split("?"))[1]}else{f=null}}if(!f||f==null){return}f=f.replace(/&amp;/g,"&");var c=f.split("&");c.each(function(h){h=h.split("=");if(a&&a.escape){h[1]=unescape(h[1])}if(b[h[0]]){if(typeof(b[h[0]])=="string"){var g=new Array();g[0]=b[h[0]];g[1]=h[1];b[h[0]]=g}else{b[h[0]].push(h[1])}}else{b[h[0]]=h[1]}});return b}};var BF_Pager={current_page:1,disabled:false,more:function(a){var b=a.el;if(BF_Pager.disabled){return false}BF_Pager.current_page++;b.addClassName("loading");BF_Pager.disabled=true;new Ajax.Request(a.paging_url+(/\?/.test(a.paging_url)?"&":"?")+"p="+BF_Pager.current_page+(typeof a.unlimited!="undefined"?"&r="+a.unlimited:""),{method:"get",onSuccess:function(g){try{b.removeClassName("loading");BF_Pager.disabled=false;if(g.responseText.match("<!--PAGING_OVER-->")){b.hide()}$("post_list").innerHTML+=g.responseText;var c=document.write;document.write=function(h){$("post_list").innerHTML+=h};g.responseText.evalScripts();g.responseText.scan(/id."(post-\d+)"/m,function(h){if(h.length==2){universal_dom.update(h[1])}});document.write=c;if(typeof BF_TWITTER2!=="undefined"){BF_TWITTER2.init()}bf_editor.init();bf_post_tools.init();picks_controller.init();if(typeof queue!=="undefined"){queue.assign_handlers()}}catch(f){console.error(f)}}});return false}};var showModeratedUser=function(){if("universal_dom" in window){universal_dom.assign_handler({bucket:"show_for_moderated_user",handler:function(c,b){var a=new BF_User();if(a.isLoggedIn()&&a.getUserInfo().moderated=="1"){c.removeClassName("hidden")}else{if(typeof signin!="undefined"&&signin.callbacks){signin.callbacks.onLogin.push(function(){universal_dom.refresh_immediate_bucket("show_for_moderated_user")})}}}})}else{setTimeout(showModeratedUser,250)}};var showIndexUser=function(){if("universal_dom" in window){universal_dom.assign_handler({bucket:"show_for_index_user",handler:function(c,b){var a=new BF_User();if(a.isLoggedIn()&&a.getUserInfo().f_index=="true"){c.removeClassName("hidden")}else{if(typeof signin!="undefined"&&signin.callbacks){signin.callbacks.onLogin.push(function(){universal_dom.refresh_immediate_bucket("show_for_index_user")})}}}})}else{setTimeout(showIndexUser,250)}};var showPEditorAdminUser=function(){if("universal_dom" in window){universal_dom.assign_handler({bucket:"show_for_p_editor_admin_user",handler:function(c,b){var a=new BF_User();var f=a.getUserInfo().default_user;if(a.isLoggedIn()&&(a.getUserInfo().p_editor_admin=="true"||a.getUserInfo().p_admin=="true")){c.removeClassName("hidden")}if(a.isLoggedIn()&&(f.p_editor_admin=="true"||f.p_admin=="true")){c.removeClassName("hidden")}}})}else{setTimeout(showPEditorAdminUser,250)}};showModeratedUser();showIndexUser();showPEditorAdminUser();function Tracker(){this.entries=[];this.registered=new Array();this.url=window.location.toString();this.url=this.url.replace(/#H\w+$/i,"");this.url=encodeURIComponent(this.url);if(typeof window.HASH_REFER!="undefined"){this.referrer=window.HASH_REFER}else{this.referrer=document.referrer.toString()}this.referrer=encodeURIComponent(this.referrer);this.network_cookie=BFW_Util.getCookie("BUZZ_WIDGET");if((this.network_cookie&&window.location.href.match(this.network_cookie))||window.IS_HASH_WIDGET_CLICK){if(this.url.indexOf(encodeURIComponent("?"))>0){this.url+=encodeURIComponent("&w=1")}else{this.url+=encodeURIComponent("?w=1")}BFW_Util.deleteCookie("BUZZ_WIDGET");if(Tracker.DEBUG){console.debug("Tracking this page as a widget referrer %s",decodeURIComponent(this.url))}}this.defaults={c:"",u:"",type:"",user:"",buzz:"",query:"",url:this.url,referrer:this.referrer};this.cloud=Cloud.servers[Math.floor(Math.random()*Cloud.servers.length)];this.source="http://"+this.cloud+"/small.gif?type="}Tracker.gClick=function(a){return};Tracker.video=function(a){return};Tracker.browser=function(a){return};Tracker.prototype={setDefaults:function(a){for(key in a){this.defaults[key]=a[key]}},add:function(a,b){valid=true;entry={};for(key in this.defaults){entry[key]=this.defaults[key]}for(key in a){entry[key]=a[key]}if(b){valid=false;if(BFW_Util.getCookie("BF-U")){BFW_Util.deleteCookie("BF-U")}}if(valid){this.entries.push(entry)}},run:function(h){if(this.entries.length){var b=this.entries.find(function(k){return k.type==100});if(b&&b.query){this.entries.unshift({buzz:b.user,user:b.user,c:b.u,u:b.u,type:this.types.VXN_CLICK_IN,types:[this.types.VXN_CLICK_IN],domain:"",query:"",url:""});this.entries.unshift({buzz:"buzz",user:"buzz",c:"7BA7",u:"7BA7",type:this.types.VXN_CLICK_OUT,types:[this.types.VXN_CLICK_OUT],domain:"",query:"",url:""})}if(this.DEBUG){console.log("Tracking "+this.entries.length+" entry positions");this.entries.each(function(l){var k={};["buzz","query","type","user"].each(function(m){if(l[m]){k[m]=l[m]+"";k[m]=k[m].split(",").first()}});if(k.type==30||k.type==35&&k.query){console.log([k.user,k.buzz,tracker.positions[k.query]])}else{if(l.type==""){console.log([k.user,k.buzz,"Primary page impression"])}else{if(l.type=="12"){console.log([k.user,k.buzz,"Unique page impression"])}else{console.log([k.user,k.buzz,l.type])}}}})}list=this.entries.shift();if(list.type!=""){list.referrer=""}different={};last=Object.clone(list);multiple=false;while(this.entries.length){multiple=true;entry=this.entries.shift();if(entry.type!=""){entry.referrer=""}for(key in list){list[key]+=","+entry[key];if(!different[key]&&last[key]!=entry[key]){different[key]=1}}}if(multiple){for(key in list){if(!different[key]&&key!="type"){list[key]=list[key].replace(/,.*$/,"")}}}var a=new Image;var g=list.type+"&user="+list.user+"&buzz="+list.buzz+"&url="+list.url+"&query="+list.query+"&referrer="+list.referrer+"&c="+list.c+"&u="+list.u+"&z="+(new Date).getTime();a.src=this.source+g;if(Tracker.DEBUG){console.log("Pixel: ",list,(this.source+g))}try{if(Cloud.staging.sample>0&&(Math.random()<=Cloud.staging.sample)){var c="http://"+Cloud.staging.server+"/small.gif?type=";(new Image()).src=c+g}}catch(f){console.error(f)}this.pixels.push(a)}},track:function(){var reg_tracker=this.tracker.registered[this.index];var reg_event=reg_tracker.events[this.event];if(!reg_tracker.data_obj){reg_tracker.data_obj=reg_tracker.data.length==0?{}:eval("("+reg_tracker.data+")")}if(!reg_event.data_obj){reg_event.data_obj=eval("("+reg_event.data+")")}$H(reg_event.data_obj).each(function(pair){if(pair.key=="callback"){try{eval(pair.value+"("+reg_tracker.data+");")}catch(e){console.error(e)}return true}if(!Object.isArray(pair.value)){pair.value=[pair.value]}pair.value.each(function(query){data=Object.clone(reg_tracker.data_obj);data.type=this.tracker.types[pair.key];data.query=query;this.tracker.add(data)}.bind(this))}.bind(this));if(this.run){this.tracker.run()}},trackSiteClick:function(e){var external_click=false;var ignore_click=false;el=e.element();if(e.srcElement){el=e.srcElement}else{if(e.currentTarget){el=e.currentTarget}}if(!el.hasAttribute("track")||(el.tagName&&el.tagName.toLowerCase()=="img")){if(el.parentNode&&el.parentNode.tagName.toLowerCase()=="a"){el=el.parentNode}}if(el.getAttribute("track")==""){return}track_data=eval("("+el.getAttribute("track")+")");if(el.hasAttribute("rel:gt_act")&&el.getAttribute("rel:gt_act").match("share/")){ignore_click=true}if(!track_data){ignore_click=true}if(ignore_click){return true}if(!el.href.match(/buzzfeed.com/)){external_click=true;track_data.referrer=encodeURIComponent(el.href)}if(BF_STATIC.tt_page=="Buzz"||BF_STATIC.tt_page=="User"){if(BF_STATIC.tt_page=="User"){track_data=tracker.defaults}if(typeof(hashtrack)!="undefined"&&typeof(hashtrack.tracked_hash_tag)!="undefined"){track_data.types=["101"]}else{track_data.types=["100"]}}ctracker=new Tracker();for(i=0;i<track_data.types.length;i++){track_data.type=track_data.types[i];if(typeof track_data.queries!="undefined"&&track_data.queries[i]){track_data.query=track_data.queries[i]}else{if(external_click){track_data.query=encodeURIComponent(el.href)}else{track_data.query=""}}ctracker.add(track_data)}ctracker.run()},attach:function(){if(arguments&&arguments.length>0){base_el=$(arguments[0])}else{base_el=document}var a=function(f){if(f.hasClassName("flex_ab")){var h=f.id.match(/-(\d+)/);if(h&&BF_SELECTED_PROMOS[h[1]]){var c=BF_SELECTED_PROMOS[h[1]];f.setAttribute("track_load",'{"FLEX_PRO_IMP": '+c.promo_id+"}");f.setAttribute("track_mousedown",'{"FLEX_PRO_CLICK": '+c.promo_id+"}")}}var k=f.getAttribute("track");var b={data:k,events:{}};this.registered.push(b);this.events.each(function(m){if(!k){return false}try{b.events[m]={};var l=f.readAttribute("track_"+m);if(l){b.events[m].data=l;if(m=="load"){this.track.bind({tracker:this,event:m,index:(this.registered.length-1)})()}else{Event.observe(f,m,this.track.bind({tracker:this,event:m,index:(this.registered.length-1),run:true}))}}}catch(n){console.error(n)}},this);var g;if((BF_STATIC.tt_page=="Buzz"&&objExists(buzzDetails)&&buzzDetails.ad=="1")||BF_STATIC.tt_page=="User"){g=$$(".PageContent a")}else{if(BF_STATIC.tt_page=="Buzz"){g=[]}else{g=$A(f.getElementsByTagName("A"))}}g.each(function(l){l.setAttribute("track",k);Event.observe(l,"mousedown",Tracker.prototype.trackSiteClick);if(f.getAttribute("rel:ext_track_pixel")){l.setAttribute("rel:ext_track_pixel",f.getAttribute("rel:ext_track_pixel"));Event.observe(l,"mousedown",function(n){var m=new Image();m.src=l.getAttribute("rel:ext_track_pixel");if(Tracker.DEBUG){console.debug("External click tracking call made to %s",m.src)}})}});f.removeClassName("track")}.bind(this);universal_dom.assign_handler({bucket:"track",handler:a});this.run()},registered:[],pixels:[],events:["load","mousedown","mouseover","submit"],positions:["","Header","Homepage Flow","B-Page Viral Alert","Index Sidebar","B-Page Sidebar","C-Page Sidebar","Non-ad Flow","Non-ad Header","Non-ad Sidebar Partner","Non-ad Sidebar Raw","Non-ad Sidebar Badge","Non-ad Permalink Flow","Non-ad Clickable Sidebar","Non-ad Related Buzz","Non-ad Viral Related Unit","Viral Related Unit","Bottom-Of-Page Promo","Multi Homepage Flow","Valley of The Nerds","AOL Related Promo","Targeted-B","Targeted-C","Targeted-A"],types:{REFERRER_DIRECT:0,REFERRER_INTERNAL:1,REFERRER_LINK:2,REFERRER_SEARCH:3,REFERRER_NETWORK:4,SHARE_EMAIL:5,SHARE_FACEBOOK:6,SHARE_STUMBLE:7,SHARE_DELICIOUS:8,SHARE_DIGG:9,SHARE_REDDIT:10,SHARE_MIXX:11,SHARE_TWITTER:15,SHARE_FARK:16,SHARE_MYSPACE:17,SHARE_REBUZZ:18,SHARE_RESERVED4:19,SHARE_RESERVED5:20,UNIQUE_VISIT:12,WIDGET_IMPRESSION:13,WIDGET_CLICK:14,BUZZBOX_IMPRESSION:21,BUZZBOX_CLICK:22,VXN_CLICK_OUT:23,VXN_CLICK_IN:24,BUZZBOX_RES4:25,BUZZBOX_RES5:26,BUZZBOX_RES6:27,BUZZBOX_RES7:28,BUZZBOX_RES8:29,PROMO_IMPRESSION:30,PROMO_AD_IMP:31,BOOST_IMPRESSION:32,FLEX_PRO_IMP:33,PROMO_IMP_RES4:34,PROMO_CLICK:35,PROMO_AD_CLICK:36,BOOST_CLICK:37,FLEX_PRO_CLICK:38,PROMO_CLICK_RES4:39,SITE_CLICK:100,HASH_CLICK:101}};Tracker.DEBUG=document.location.search.match(/tracker=true/)?true:false;function track_gplusone(a,b){b=(typeof(b)!="undefined"&&b)?b:"";if(a.state=="on"){gtrack.track_events(b,"share/googleplus/plus-one","");(new BF_Targetting_Pixel()).add("google_plus")}else{if(a.state=="off"){gtrack.track_events(b,"share/googleplus/minus-one","")}}}function track_gplusone_sbm(a){track_gplusone(a,"Buzz:sharing-bottom-more")}function track_gplus_share_open(a){event_type=(typeof(event_type)!="undefined"&&event_type)?event_type:"";gtrack.track_events(event_type,"share/googleplus/plus-share-start","",null,true)}function track_gplus_share(a){event_type=(typeof(event_type)!="undefined"&&event_type)?event_type:"";gtrack.track_events(event_type,"share/googleplus/plus-one","",null,true)}QuantcastCounter=0;Tracker.Quantcast=function(){if(typeof(_qevents)=="undefined"&&QuantcastCounter<20){QuantcastCounter++;setTimeout("Tracker.Quantcast()",250);return false}_qevents.push({qacct:"p-3aud4J6uA4Z6Y"})};function Referrer(){this.track_subdomains=true;this.referrer=false;this.goal=false;this.cookies={session:{name:"rvt2_sess",expires:0},persist:{name:"rvt2_persist",expires:31536000000}};this._cookies={};this._goals=[];this.cookies_cancel="cancel";this.returns={default_bucket:">2m",buckets:{"1h":60,"3h":180,"6h":320,"12h":720,"24h":1440,"48h":2880,"1w":10080,"2w":20160,"1m":43200,"2m":86400}};this.track=function(){this._set_cookie("rvt_sess","",-1000);this._set_cookie("rvt_persist","",-1000);this.referrer=this._parse_referrer();if(this._is_returning()){this.track_return()}else{if(this._is_initial()){this.track_initial()}else{if(this._is_candidate()){this.start_initial()}}}};this.track_referrer=function(c){if(this._is_returning()){var g="",f="initial",c=this._parse_referrer(),b=(this._get_cookie(this.cookies.session.name)||"{}").evalJSON(),a=(this._get_cookie(this.cookies.persist.name)||"{}").evalJSON();if(!c){c="direct"}if(!a.d){return this.cancel_track()}if(this._is_returning()){f="return/"+b.bkt}if(a.h){g="/"+a.h}}};this.track_goal=function(b){if(this._is_returning()||this._is_initial()){var g="",f="initial",c=(this._get_cookie(this.cookies.session.name)||"{}").evalJSON(),a=(this._get_cookie(this.cookies.persist.name)||"{}").evalJSON();if(!a.d){return this.cancel_track()}if(this._is_returning()){f="return/"+c.bkt}if(a.h){g="/"+a.h}this._goals.push(b)}};this.track_return=function(){var c="",b=1,k="",h={},a=false,g=(this._get_cookie(this.cookies.session.name)||"{}").evalJSON(),f=(this._get_cookie(this.cookies.persist.name)||"{}").evalJSON();if(!f.d){return this.cancel_track()}if(!f.t){f.t=Math.floor(d.getTime()/1000)}if(f.h){k="/"+f.h}if(!this._has_cookie(this.cookies.session.name)||!g.bkt){c=this._determine_time_bucket(f.t);if(f[c]){b=parseInt(f[c])+1}h={t:f.t,d:f.d};if(f.h){h.h=f.h}h[c]=b;this._set_cookie(this.cookies.persist.name,Object.toJSON(h),this.cookies.persist.expires);this._track("impression/"+f.d+"/return/"+c+"/"+b+k);a=true}else{c=g.bkt}if(!g.session){g.session=0}this._set_cookie(this.cookies.session.name,Object.toJSON({bkt:c,session:(g.session+1)}),this.cookies.session.expires);this._track("view/"+f.d+"/return/"+c+k);if(a){this.track_referrer()}};this.track_initial=function(){var b=(this._get_cookie(this.cookies.session.name)||"{}").evalJSON(),a=(this._get_cookie(this.cookies.persist.name)||"{}").evalJSON(),c="";if(!a.d){return this.cancel_track()}if(a.h){c="/"+a.h}if(!b.initial){b.initial=0}this._set_cookie(this.cookies.session.name,Object.toJSON({initial:(b.initial+1)}),this.cookies.session.expires);this._track("view/"+a.d+"/initial"+c)};this.start_initial=function(){var f=new Date(),a=location.href.replace(/^(http|https)(\:\/\/)(.*\@.*\:)?([A-Z0-9\-\.]+\.[A-Z]+)([0-9\:]+)?(\/.*)$/i,"$6"),c="",b={};b={d:this.referrer,t:Math.floor(f.getTime()/1000)};if(this._has_hashtrack()){b.h=this._get_hashtrack();c="/"+b.h}this._set_cookie(this.cookies.persist.name,Object.toJSON(b),this.cookies.persist.expires);this._track("impression/"+this.referrer+"/initial"+c);this.track_initial()};this.cancel_track=function(){this._set_cookie(this.cookies.session.name,this.cookies_cancel,-1000);this._set_cookie(this.cookies.persist.name,this.cookies_cancel,this.cookies.persist.expires);return false};this._track=function(b,a){return};this._has_hashtrack=function(){return(window.location.href.indexOf("#H")!=-1)};this._get_hashtrack=function(){return(this._has_hashtrack()?window.location.href.replace(/^(.*\#)(H[A-Z0-9]+)(.*)?$/,"$2"):"")};this._is_trackable=function(){return(this.referrer&&this.referrer!=""&&!(/buzzfeed\.com$/i).exec(this.referrer))};this._is_returning=function(){return(this._has_cookie(this.cookies.persist.name)&&(!this._has_cookie(this.cookies.session.name)||this._has_cookie(this.cookies.session.name,"session")))};this._is_initial=function(){return(this._has_cookie(this.cookies.persist.name)&&this._has_cookie(this.cookies.session.name,"initial"))};this._is_candidate=function(){return(this._is_trackable()&&!this._has_any_cookies())};this._get_cookie=function(b){if(typeof(this._cookies[b])!="undefined"&&this._cookies[b]!=""){return this._cookies[b]}else{if(this._has_cookie(b)){var a=document.cookie.match("(^|;) ?"+b+"=([^;]*)(;|$)");return unescape(a[2])}else{return false}}};this._has_cookie=function(c,a){var b=document.cookie.match("(^|;) ?"+c+"=([^;]*)(;|$)");if(a&&typeof(a)=="string"){a=RegExp(RegExp.escape(a))}return(b?(a&&a!=""?unescape(b[2]).match(a):(b[2]!=this.cookies_cancel)):false)};this._has_any_cookies=function(){return(document.cookie&&document.cookie.match(/[\w\d]+/mg))};this._set_cookie=function(m,b,g,f){var c=31536000000,a="",l="";if(g||g==0){c=parseInt(g)}if(c&&c!=0){var k=new Date();k.setTime(k.getTime()+c);a="; expires="+k.toGMTString()}l=escape(m)+"="+escape(b)+a+"; path=/; domain=."+(f?escape(f):"buzzfeed.com");document.cookie=l;this._cookies[m]=b};this._determine_time_bucket=function(f){var b=this.returns.default_bucket,a=0,g=new Date();a=Math.floor((Math.floor(g.getTime()/1000)-f)/60);for(var c in this.returns.buckets){if(a<=this.returns.buckets[c]){b=c;break}}return b};this._parse_referrer=function(){var a=document.referrer.toLowerCase();a=a.replace(/^(http|https)(\:\/\/)(.*\@.*\:)?([A-Z0-9\-\.]+\.[A-Z]+)(.*)$/i,"$4");a=a.replace(/^www\./i,"");if(!this.track_subdomains){a=a.replace(/^(.*\.)?([A-Z0-9\-\.]+\.[A-Z]+)$/i,"$2")}return a}}try{var return_tracker=new Referrer();return_tracker.track()}catch(e){}POLLER_CALLBACK_LOOKUP=new Object();function poller_call_back(b,a){var c=POLLER_CALLBACK_LOOKUP[b];var f=c.callback;if(!c||!c.callback){console.error("no poller callback function defined with key: %s",b);return}else{c.poller.stop_polling();c.callback(a)}}function set_poller_trigger(){var f=5000;var c=new Date();c.setTime(c.getTime()+f);var b="";b="; expires="+c.toGMTString();var a="BUZZ_POLLER_COOKIE=true"+b+"; domain=.buzzfeed.com; path=/static/js/poller";document.cookie=a}cookie_poller=function(){this.active=false;this.count=0;this.start=function(a){this.active=true;this.count=0;cookie_poller_active=true;if(!a||!a.callback_string||!a.poll_url||!a.pollid){this.usage();return}this.callback_string=a.callback_string;this.callback_arguments=a.arguments;this.poll_url=a.poll_url;this.pollid=a.pollid;this.poll()};this.add_poller_callback=function(a,c,b){POLLER_CALLBACK_LOOKUP[a]={callback:c,poller:this}};this.poll=function(h){this.count++;if((this.count*500)>(1000*10*60)){this.active=false}if(this.active==true){var g=this.poll_url;g+="?version="+(new Date()).getTime();g+="&callback="+escape(this.callback_string);g+="&pollid="+this.pollid;if(this.callback_arguments){var f=escape(Object.toJSON(this.callback_arguments));g+="&args="+f}var c=document.createElement("script");c.src=g;var a=document.getElementsByTagName("body")[0];if(a){a.appendChild(c)}var b=function(){this.poll()}.bind(this);setTimeout(b,500)}};this.stop_polling=function(){this.active=false;this.count=0};this.usage=function(){var a="usage: cookie_poller.poll( {callback_string: 'afunction', poll_url: 'http://example/js/poll.js, pollid: 'a_unique_id', [ arguemnts: {} ] } )";console.error(a);console.error("cookie_poller.poll() needs a callback_string, a XSS poller url, a unique id and an optional arguments hash")}};var TT_Filters={round:function(a){return Math.round(a)},floor:function(a){return Math.floor(a)},ceil:function(a){return Math.ceil(a)},add_commas:function(a){a+="";a=a.replace(/(\d)(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})$/,"$1,$2,$3,$4,$5,$6,$7");a=a.replace(/,{2,}/,",");return a},upper:function(a){return a.toUpperCase()},lower:function(a){return a.toLowerCase()},ucfirst:function(a){return a.toString().substring(0,1).toUpperCase()+a.substring(1,a.length)},lcfirst:function(a){return a.toString().substring(0,1).toLowerCase()+a.substring(1,a.length)},titleCase:function(f){if(!f||f==""){return""}var b=f;var c=b.split(" ");var a=new Array("and","the","to","for","is","in","a","at","an","from","by","if","of");for(i=0;i<c.length;i++){if(i==0){c[i]=(c[i].substring(0,1)).toUpperCase()+c[i].substring(1)}else{if(a.indexOf(c[i])<0){c[i]=(c[i].substring(0,1)).toUpperCase()+c[i].substring(1)}}}retval=c.join(" ");return retval},quoteCase:function(b){if(!b||b==""){return""}var a=b.toLowerCase();a=a.replace(/^("*)/,"");a=a.replace(/("*)$/,"");return'"'+this.ucfirst(a)+'"'},trim:function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")},collapse:function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ")},html:function(a){if(a){return a.toString().replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}},boost_preview:function(c){if(c){c=c.toString().replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;");ents=new Array("b","strong","i","em");for(i=0;i<ents.length;i++){var b=new RegExp("&lt;"+ents[i]+"&gt;","gi");var a=new RegExp("&lt;/"+ents[i]+"&gt;","gi");c=c.replace(b,"<"+ents[i]+">");c=c.replace(a,"</"+ents[i]+">")}c=c.replace(/&lt;a href="http:\/\/(.*?)"&gt;/gi,'<a href="http://$1">');c=c.replace(/&lt;\/a&gt;/ig,"</a>");return c}},link:function(a){if(a){return a.toString().replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/"/g,"").replace(/\s/g,"%20")}},js:function(a){if(a){return a.toString().replace(/'/g,"").replace(/\n|\r/g,"")}},html_entity:function(a){return"HTML_ENTITY: not implemented.  see http://www.w3.org/TR/REC-html40/sgml/entities.html"},html_para:function(a){return a.toString().replace(/\n+/g,"<p>")},html_break:function(a){return a.toString().replace(/\n+/g,"<br><br>")},html_line_break:function(a){return a.toString().replace(/\n/g,"<br>")},uri:function(a){return escape(a)},unescape_uri:function(a){a=a.replace(/\+/g," ");return unescape(a)},indent:function(g,f){if(!f){f="    "}var a=g.split(/\n/);var b="";for(var c=0;c<a.length;c++){a[c]=a[c].toString().replace(/^/g,f)}return a.join("\n")},truncate:function(b,a){if(b){if(!a){a=32}if(b.length<=a){return b}return b.toString().substring(0,a-3)+"..."}},repeat:function(f,c){if(!c){c=1}var a=f;for(var b=c-1;b>0;b--){a+=f}return a},remove:function(c,a){if(!a){return c}var b=new RegExp(a,"g");return c.toString().replace(b,"")},replace:function(f,a,b){if(f){if(!a){return f}if(!b){b=""}var c=new RegExp(a,"g");f=f.toString().replace(c,b)}return f},strftime:function(g,a){var b=new Date();var f=g;if(g<10000000000){f=g+"000"}b.setTime(f);for(var c in TT_strftime_funks){if(c.length==1){a=a.replace("%"+c,TT_strftime_funks[c](b))}}return a},alert:function(a){alert(a);return""},clean_entities:function(a){if(a){return TT_cleanEntities(a)}},html_noentities:function(a){if(a){return a.toString().replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/"/g,"&quot;")}},html_entities:function(a){return TT_cleanEntities(a).toString().replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}};TT_strftime_funks={zeropad:function(a){return a>9?a:"0"+a},a:function(a){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a.getDay()]},A:function(a){return["Sunday","Monday","Tuedsay","Wednesday","Thursday","Friday","Saturday"][a.getDay()]},b:function(a){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()]},B:function(a){return["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]},c:function(a){return a.toString()},d:function(a){return this.zeropad(a.getDate())},H:function(a){return this.zeropad(a.getHours())},I:function(a){return(a.getHours()==12||a.getHours()==0)?12:this.zeropad((a.getHours()+12)%12)},i:function(a){return(a.getHours()==12||a.getHours()==0)?12:(a.getHours()+12)%12},m:function(a){return this.zeropad(a.getMonth()+1)},M:function(a){return this.zeropad(a.getMinutes())},p:function(a){return this.H(a)<12?"am":"pm"},S:function(a){return this.zeropad(a.getSeconds())},w:function(a){return a.getDay()},y:function(a){return this.zeropad(this.Y(a)%100)},Y:function(a){return a.getFullYear()},"%":function(a){return"%"}};function TT_cleanEntities(f){var c={160:"nbsp",161:"iexcl",164:"curren",162:"cent",163:"pound",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",8482:"trade",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",215:"times",247:"divide",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8230:"hellip",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"};var b=f.split("");var g="";for(i=0;i<b.length;i++){var a=b[i].charCodeAt(0);if(c[a]){g+="&"+c[a]+";"}else{if(a>127){g+="&#"+a+";"}else{g+=b[i]}}}return g}var effect_callbacks={};var BF_Effect={OpenMenu:function(c,f,b){if(!b){b={}}b.top=(objExists(b.top)?b.top:0);b.left=(objExists(b.left)?b.left:0);var g=$(c);var a=g.positionedOffset();var c={el:g,offSetTop:Number(a[1])+Number(g.getHeight()),offSetLeft:Number(a[0])};$(c.el).insert(f);$(f).setStyle({top:c.offSetTop+b.top+"px",left:c.offSetLeft+b.left+"px",position:"absolute"}).show()},EffectCallbacks:function(a){if(objExists(effect_callbacks[a])){effect_callbacks[a].each(function(b){b()})}},EffectCallbacksAdd:function(a,b){effect_callbacks[a]=[];effect_callbacks[a].push(b)},MarqueeOn:function(c,b){if(!c){return}if(!b){b=250}if(!$(c).hasClassName("marquee")){$(c).addClassName("marquee");$(c).setAttribute("rel:mtext",$(c).innerHTML.replace("&nbsp;"," ").toString());$(c).setAttribute("rel:mstatus","on");$(c).setAttribute("rel:mpos",0)}if($(c).hasClassName("marquee")&&$(c).getAttribute("rel:mstatus")=="on"){var f=Number($(c).getAttribute("rel:mpos"));var a=$(c).getAttribute("rel:mtext").toString();$(c).innerHTML=a.substr(a.length-f,a.length);$(c).setAttribute("rel:mpos",f+1)}setTimeout(function(){BF_Effect.MarqueeOn(c,b)},b)},ScrollIntoView:function(k,g){if(!$(k)||$(k).viewportOffset().top==0||(window.BF_STATIC&&BF_STATIC.bf_test_mode)){return}var c=false;Event.observe(window,"mousewheel",a);if(typeof(g)=="undefined"){g=0.5}var b=document.viewport.getHeight();var f=$(k).getHeight();var n=document.viewport.getScrollOffsets().top+$(k).viewportOffset().top;var l=Math.ceil($(k).viewportOffset().top/g/100);if($(k).viewportOffset().top>0){if(b>=f){var m=(b-f)/2;n-=m;l=Math.ceil(($(k).viewportOffset().top-m)/g/100)}}function a(){c=true}function h(q,p){if(c){Event.stopObserving(window,"mousewheel",a);return}var o=document.viewport.getScrollOffsets().top;if(Math.abs(q-o)<Math.abs(p)){p=q-o}window.scrollTo(0,(o+p));if(o==document.viewport.getScrollOffsets().top){Event.stopObserving(window,"mousewheel",a);return}if((o+p)!=q){setTimeout(function(){h(q,p)},1)}else{Event.stopObserving(window,"mousewheel",a);return}}h(n,l)},FadeOut:function(b,a,c,f){if(f){BF_Effect.EffectCallbacksAdd("FadeOut",f)}if(!c){c=50}if(!a){$(b).setOpacity(1).show();a=100-2;setTimeout(function(){BF_Effect.FadeOut(b,a,c)},c)}else{a=a-10;if(a>0){$(b).setOpacity(a/100);setTimeout(function(){BF_Effect.FadeOut(b,a,c)},c)}else{$(b).hide();BF_Effect.EffectCallbacks("FadeOut")}}},FadeIn:function(b,a,c,g){try{if(g){BF_Effect.EffectCallbacksAdd("FadeIn",g)}if(!c){c=5}if(!a){$(b).setOpacity(0.01);$(b).show();a=1;setTimeout(function(){BF_Effect.FadeIn(b,a,c)},c)}else{a=a+10;if(a<100){$(b).setOpacity(a/100);setTimeout(function(){BF_Effect.FadeIn(b,a,c)},c)}else{$(b).setOpacity(1);BF_Effect.EffectCallbacks("FadeIn")}}}catch(f){console.error(f)}},SlideDown:function(a,b){try{if(!$(a)){return}if(!b){b=20}if(isIE7()||isIE8()||(window.BF_STATIC&&BF_STATIC.bf_test_mode)){$(a).setStyle({height:"auto"}).show();return}if(!$(a).hasClassName("SlideDown")){$(a).addClassName("SlideDown");$(a).setStyle({height:"auto",overflow:"hidden"});$(a).setAttribute("rel:SlideGoal",$(a).getHeight());$(a).setAttribute("rel:Step",Math.max(1,Math.round($(a).getHeight()/20)));$(a).setStyle({height:"0px"});$(a).show()}else{if($(a).getHeight()>=(parseInt($(a).getAttribute("rel:SlideGoal")))){$(a).setStyle({height:"auto",overflow:"visible"});$(a).removeClassName("SlideDown");return}}if(BF_STATIC.bf_env!="live"){console.log("SlideDown",$(a).cleanHeight())}$(a).setStyle({height:(Number($(a).getHeight())+Number($(a).getAttribute("rel:Step")))+"px"});setTimeout(function(){BF_Effect.SlideDown(a,b)},b)}catch(c){console.error(c)}},SlideUp:function(a,b){try{if(!$(a)){return}if(!b){b=20}if(isIE7()||isIE8()||(window.BF_STATIC&&BF_STATIC.bf_test_mode)){$(a).hide();return}if(!$(a).hasClassName("SlideUp")){$(a).addClassName("SlideUp");$(a).setAttribute("rel:Step",Math.max(1,Math.round($(a).getHeight()/20)));$(a).setStyle({overflow:"hidden"});$(a).show()}else{if($(a).cleanHeight()<=(Number($(a).getAttribute("rel:Step"))*2)){$(a).removeClassName("SlideUp");$(a).hide();return}}$(a).setStyle({height:(Number($(a).cleanHeight())-Number($(a).getAttribute("rel:Step")))+"px"});setTimeout(function(){BF_Effect.SlideUp(a,b)},b)}catch(c){console.error(c)}}};Object.extend(Element.Methods,{showOnScreen:function(a,b){a.show();BF_Effect.ScrollIntoView(a,b)}});Object.extend(Element.Methods,{BFOnAttributeChange:function(b,c,a){if(typeof b.observers=="undefined"){b.observers={}}if(typeof b.observers[c]=="undefined"){b.observers[c]=[]}b.observers[c].push(a)}});Object.extend(Element.Methods,{BFSetAttribute:function(b,c,f){var a=b.getAttribute(c);b.setAttribute(c,f);if(typeof b.observers!="undefined"&&typeof b.observers[c]!="undefined"){b.observers[c].each(function(g){g({element:b,old_value:a,new_value:f})})}}});Element.addMethods();var BF_PrototypeExtend={getTextDescendants:function(c,b){var a=[];function f(g){var h=g.firstChild;while(h){if(Node.TEXT_NODE==h.nodeType){if(!b||(!!b&&!h.nodeValue.match(/^([\s\n\t\r]+)$/))){a.push(h)}}if(Object.isElement(h)&&["script","style","iframe","embed","object","head"].indexOf(h.tagName.toLowerCase())==-1){f(h)}h=h.nextSibling}}f(c);return a}};Element.addMethods(BF_PrototypeExtend);try{var bf_pugk=[],bf_pugc="38,38,40,40,37,39,37,39,66,65";document.observe("keydown",function(g){try{bf_pugk.push(g.keyCode);if(bf_pugk.toString().indexOf(bf_pugc)>=0){bf_pugk=[];var a=0,f=["/web05/2012/1/10/14/the-6-best-quotes-from-justin-biebers-v-magazine--14644-1326223058-68.jpg","/web05/2012/1/17/10/justin-bieber-gets-a-new-side-part-hair-color-and-13960-1326814098-6.jpg","/web05/2012/1/14/2/justin-bieber-please-explain-this-1981-1326525108-18.jpg","/terminal05/2012/1/5/15/justin-bieber-got-a-tattoo-of-jesus-23021-1325794363-82.jpg","/web04/2011/11/2/16/the-worst-of-the-justin-bieber-paternity-suit-2173-1320264096-14.jpg","/web05/2011/11/9/11/justin-bieber-santa-claus-is-coming-to-town-anima-5296-1320854950-40.jpg"];$$(".thumb img, img.bf-image, img.thumb, .thumb-unit img, .thumbbb img").each(function(b){b.src="http://s3-ak.buzzfed.com/static/campaign_images"+f[a%f.length];a++});$$("body").first().setStyle({"background-color":"#6235ac"});$$(".page_header h1 a, .page_header .nav ul.utils li.social_icon a, .page_header .nav ul.feeds li a, .search_bar button#search_submit, .HotNav .arrow, .HotNav .arrow a").each(function(b){b.setStyle({"background-image":"url(//buzzfeed-media.s3.amazonaws.com/dev-testing/biebfeed_v5.png?v=201405061522) !important"})});$$(".page_header").each(function(b){b.setStyle({"border-bottom-color":"#6235ac"})});$$(".page_sub_header.skinny").each(function(b){b.insert('<img src="//buzzfeed-media.s3.amazonaws.com/dev-testing/bieber_badge.png" width="65" height="65" style="position: absolute; display: block; top: -16px; left: 7px; border: none;" alt="" />')});var c=$$("body").first().getTextDescendants(true);if(c.length>0){c.each(function(m){var k=0,h="",b=0,n=m.nodeValue.length;while(n>b){h+=(k%2==0?"Justin":"Bieber")+" ";b=h.length;k++}h=h.substr(0,n);m.nodeValue=h})}}}catch(g){}})}catch(e){}var BF_UI={init:function(){universal_dom.assign_handler({bucket:"toggle_bf_dropdown",event:"click",handler:BF_UI.openDropdownEventHandler});UI.dateFormat.process();universal_dom.assign_handler({bucket:"animatedgifs",event:"click",handler:function(){var p=arguments[0].target;var o=0;var l,c,b,q;if($(p).up(".sub_buzz_content")){var m=$(p).up(".sub_buzz_content").down("img");if(m.getAttribute("rel:fake_photorow")){o=1;l=parseInt(m.getStyle("left"))*-1;c=parseInt(m.getStyle("top"))*-1;b=parseInt(m.getStyle("width"));q=parseInt(m.getStyle("height"))}}else{if($(p).up(".grid_cell_image_wrapper")){var m=$(p).up(".grid_cell_image_wrapper").down("img");o=1;l=parseInt(m.getStyle("left"))*-1;c=parseInt(m.getStyle("top"))*-1;b=parseInt(m.up().getStyle("width"));q=parseInt(m.up().getStyle("height"))}else{return false}}if(m){var k=m.getAttribute("src");var g=k.substr(0,k.indexOf("static")-1);var h=m.getAttribute("rel:bf_image_src");var a=m.getAttribute("width");var n=m.getAttribute("height");var f=m.getAttribute("rel:version");$(p).hide();m.insert({after:"<iframe src='"+g+"/static/js/public/rubbable/loader.html?v="+f+"&gif="+h+"&width="+a+"&height="+n+(o?"&vp_l="+l+"&vp_t="+c+"&vp_w="+b+"&vp_h="+q+"&c_w="+a+"&c_h="+n:"&vp_w="+a+"&vp_h="+n+"&vp_l=0&vp_t=0")+"' width='"+a+"' height='"+n+"' border='0' frameborder='0' scrolling='no'"+(o?" style='left: "+(l*-1)+"px; top: "+(c*-1)+"px; position: relative;'":"")+"></iframe>"});m.addClassName("hidden")}}})},closeDialog:function(k,c){if(!c){c={}}var f=$(k);f.hide();if(typeof picks_controller!="undefined"){picks_controller.stop_spinner()}if(typeof user_post!="undefined"&&user_post.show_video_preview){$("video-form-preview").show()}var a=$(k).getElementsByTagName("IFRAME")[0];var b=a;if(a){a=(a.contentWindow)?a.contentWindow:(a.contentDocument.document)?a.contentDocument.document:a.contentDocument}try{if(c.loadDefaultDiv){if(a&&a.document){if(a.document.getElementById(c.loadDefaultDiv)){a.document.getElementById(c.loadDefaultDiv).style.display="block"}}}else{if($("user_post_preview_iframe")){var h=$("user_post_preview_iframe").contentWindow.document.getElementById("preview_div");if(typeof h!="undefined"&&h!=null){h.innerHTML='<img src="'+BF_STATIC.image_root+'/static/images/public/spinners/loading.gif" alt="spinner">'}}else{if(b){b.src=BF_STATIC.image_root+"/static/images/public/spinners/loading.gif"}}}if(a&&typeof a.minimizeEventHandler=="function"){a.minimizeEventHandler()}}catch(g){console.error(g)}if(c.onComplete){c.onComplete()}if(c.id=="user-image-edit"){BF_UI.closeDialog("super-image-edit")}f.fire("bf_ui:closeDialog")},create_or_show_dialog:function(f){var k=35;if(!f.width){f.width=800}if(!f.height){f.height=465}if(!f.scrolling){f.scrolling="no"}if(!$(f.id)){if(!f.title){f.title="Dialog"}if(!f.url.match(/^https?:\/\//)){f.url=f.url}f.m_height=f.height+k;var l=new Template(' 				<div class="bf_overlay_mask"></div> 				<div class="bf_dialog" style="width: #{width}px; height: #{m_height}px !important;"> 					<div class="bf_dialog_header"><span class="title">#{title}</span> <a href="javascript:;" onclick="BF_UI.closeDialog(\'#{id}\',{loadDefaultDiv:\'#{url}\'});return false;" class="close">&times;</a></div> 					<div class="bf_dialog_content" style="width: #{width}px; height: #{height}px !important;"> 						<iframe id="#{id}_iframe" src="#{url}" name="#{id}_iframe" frameborder="0" scrolling="#{scrolling}" allowTransparency="true" style="width: 100%; height: 100% !important"></iframe> 					</div> 				</div> 			');var g=l.evaluate(f);var a=document.createElement("div");a.id=f.id;a.style.display="none";a.className="bf_canvas";a.innerHTML=g;document.getElementsByTagName("BODY")[0].appendChild(a)}else{var b=$$("#"+f.id+" .bf_dialog").first(),m=$$("#"+f.id+" .bf_dialog_content").first();if(b){b.setStyle({height:(f.height+k)+"px !important",width:f.width+"px"})}if(m){m.setStyle({height:f.height+"px !important",width:f.width+"px"})}}var c=$(f.id+"_iframe");if(c&&!escape(c.src).match(new RegExp(escape(f.url)))){c.up(0).update('<iframe id="'+f.id+'_iframe" src="'+f.url+'" name="'+f.id+'_iframe" frameborder="0" scrolling="'+f.scrolling+'" allowTransparency="true" style="width: 100%; height: 100% !important"></iframe>')}BF_UI.showDialog(f.id,f.title);if(f.onload){try{c.observe("load",function(){f.onload.each(function(n){n()})})}catch(h){}}},showDialog:function(k,f){try{if(typeof user_post!="undefined"&&$("video-form-preview")&&$("video-form-preview").visible()){$("video-form-preview").hide();user_post.show_video_preview=true}else{if(typeof user_post!="undefined"){user_post.show_video_preview=false}}}catch(c){user_post.show_video_preview=false}var b=$(k);var h="Crop Image";if(arguments.length>1){h=arguments[1]}b.show();if(typeof f!="undefined"&&f&&$(f)){$(f).insert({top:b})}var g=b.select(".title");if(g&&g.length>0){g.first().update(h)}var a=b.select(".bf_dialog").first();if(a){a.style.top=Math.floor(Math.max(document.viewport.getScrollOffsets().top,document.viewport.getScrollOffsets().top+(document.viewport.getHeight()/2)-($(a).getHeight()/2)))+"px"}},showBarChart:function(v){var n=v.getAttribute("rel:chart_data");var b=n.evalJSON?n.evalJSON():jQuery.parseJSON(n);var c=0,h=0;if(window.Prototype){$H(b).each(function(z){if(z.key.match(/baseline/)){c++}else{if(z.key.match(/column_.*\.0/)){h++}}})}else{jQuery.each(b,function(z){if(z.match(/baseline/)){c++}else{if(z.match(/column_.*\.0/)){h++}}})}if(c>h-1){var w=function(A){if(!window.Prototype){A.key=A}var B=A.key.split(".")[0];var z=A.key.split(".")[1];if(B=="baseline"){if(typeof b[B+"."+(parseInt(z)+1)]!="undefined"){b[A.key]=b[B+"."+(parseInt(z)+1)]}else{delete b[A.key]}}};if(window.Prototype){$H(b).each(w)}else{jQuery.each(b,w)}}var l=[];var m;var r;var o=[];var a=[];var k=[];var q;var p;var f=0;var t=[];for(item in b){if(item.split("_")[0]=="column"){var g=item.split(".")[1];t.push(g)}switch(item.split(".")[0]){case"x_axis":m=b[item];o[f]=b[item];f++;break;case"y_axis":r=b[item];break;case"baseline":o[f]=b[item];f++;break;case"barchart_color":k.push(b[item]);break}}if(window.Prototype){t=t.uniq()}else{t=jQuery.unique(t)}s();function s(){for(var D=0;D<t.length;D++){for(item in b){if(item.split("_")[0]=="column"){var B=item.split(".")[0];var A=item.split(".")[1];if(B=="column_one"){if(D==A){a[D]=[String(b[B+"."+D])]}}else{if(B=="column_two"||B=="column_three"||B=="column_four"||B=="column_five"||B=="column_six"){if(D==A){a[D].push(parseInt(b[B+"."+D]))}}}}}}a.splice(0,0,o);var F=google.visualization.arrayToDataTable(a);var z={hAxis:{title:m},vAxis:{title:r},colors:k,chartArea:{width:"75%",height:"75%"},legend:{position:"top"}};var E=new google.visualization.ColumnChart(v);E.draw(F,z)}},showPieChart:function(k){var c=[];var b=[];var a=k.getAttribute("rel:chart_data");var g=a.evalJSON?a.evalJSON():jQuery.parseJSON(a);for(item in g){if(item.match("chart_caption")){if(!c[item.split(".")[1]]){c[item.split(".")[1]]=[]}c[item.split(".")[1]][0]=g[item]}else{if(item.match("chart_value")){if(!c[item.split(".")[1]]){c[item.split(".")[1]]=[]}c[item.split(".")[1]][1]=parseInt(g[item])}else{if(item.match("chart_color")){b[item.split(".")[1]]=g[item]}}}}c.splice(0,0,["title","value"]);var h=google.visualization.arrayToDataTable(c);var f={colors:b,chartArea:{width:"85%",height:"65%"},legend:{position:"top"}};var g=new google.visualization.PieChart(k);g.draw(h,f)},json2vennchart:function(h){var b=[],l=[],f=[];var a=function(o){var n={};if(!window.Prototype){n.key=o;n.value=h[o]}else{n=o}var p=n.key.split(".")[0];var m=n.key.split(".")[1];if(typeof b[m]=="undefined"&&p!="vennchart_intersection"){b[m]={}}if(p=="vennchart_color"){b[m]["color"]=n.value}else{if(p=="vennchart_title"){b[m]["title"]=n.value}else{if(p=="vennchart_value"){b[m]["value"]=n.value}else{if(p=="vennchart_intersection"){l[m]=n.value}else{if(p=="vennchart_metadata"){f=n.value.evalJSON?n.value.evalJSON():jQuery.parseJSON(n.value)}}}}}};if(window.Prototype){$H(h).each(a)}else{jQuery.each(h,a)}var k=0;for(var g=0;g<b.length-1;g++){b[g]["intersections"]=[];for(var c=0;c<b.length-1-g;c++){b[g]["intersections"].push(l[k]);k++}}return{areas:b,conf:f}},showVennChart:function(m,k){k=k||false;var f=m.getAttribute("rel:chart_data");var n=f.evalJSON?f.evalJSON():jQuery.parseJSON(f);var h=BF_UI.json2vennchart(n);areas=h.areas;var o=[],l=[],b=[];for(var g=0;g<areas.length;g++){o[g]=areas[g].value||0;l[g]=areas[g].title;b[g]=areas[g].color}size=m.getDimensions?m.getDimensions():window.jQuery?{width:$(m).width(),height:$(m).height()}:{width:0,height:0};if(!k){var a=Raphael(m);venn=a.vennchart(0,0,size.width||559,size.height||345,{values:o},{colors:b,titles:l,conf:h.conf,positionrecalc:true,fallback:k});if(window.jQuery!="undefined"){$(a.canvas).mousemove(venn.mousemove)}else{$(a.canvas).onmousemove=venn.mousemove}}else{var c=document.createElement("canvas");c.width=size.width||300;c.height=size.height||250;$(m).append(c);Raphael.fn.vennchart(0,0,c.width,c.height,{values:o},{colors:b,titles:l,conf:h.conf,positionrecalc:true,fallback:k,fallbackelem:c})}},renderEntities:function(b){var f="BF_RENDER_ENTITIES_DIV_73625";var a=$(f);if(!a){var c=document.getElementsByTagName("body")[0];a=document.createElement("DIV");a.setAttribute("id",f);a.id=f;a.style.display="none";c.appendChild(a)}a.innerHTML=b;b=a.innerHTML;b=b.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");return b},initialize_simple_color_picker:function(a){var c=$(a.field);if(!c){return}c.disabled=true;c.addClassName("hidden");var m=function(p){var o=$(p.target.parentNode.current);var n=$(p.target.parentNode.select);if(p.forceOff){BF_Effect.SlideUp(n);o.removeClassName("hidden");n.addClassName("hidden")}else{if(n.hasClassName("hidden")){n.removeClassName("hidden");BF_Effect.SlideDown(n)}else{n.addClassName("hidden")}}};var g=function(s){if(!s.match("^#")){s="#"+s}if(s.length==4){s=s.substring(0,4)+s.substring(1,4)}if(s.length!=7){return}var q=parseInt((o(s)).substring(0,2),16);var p=parseInt((o(s)).substring(2,4),16);var n=parseInt((o(s)).substring(4,6),16);function o(r){return(r.charAt(0)=="#")?r.substring(1,7):r}if((q+p+n)>400){return"black"}else{return"white"}};c.BFOnAttributeChange("value",function(o){if(!o.new_value){return}var n=g(o.new_value);o.element.setStyle({backgroundColor:o.new_value,color:n});m({forceOff:true,target:{parentNode:o.element.picker}});o.element.picker.current.setStyle({backgroundColor:o.new_value,color:n});o.element.picker.current.update(o.new_value)});var b=document.createElement("div");b.addClassName("simple_color_picker");var h=document.createElement("div");h.addClassName("holder");var l=document.createElement("div");l.addClassName("select");l.setAttribute("style","float:left;");l.addClassName("hidden");var f=document.createElement("div");f.addClassName("current");f.addClassName("preview");f.appendChild(document.createTextNode("None"));f.observe("click",m);h.appendChild(f);h.appendChild(l);b.appendChild(h);a.colors.each(function(p){if(!p.match("^#")&&!p.match("Transparent")){p="#"+p}var o=g(p);var n=document.createElement("div");n.addClassName("preview");n.setStyle({backgroundColor:p,color:o});n.appendChild(document.createTextNode(p));n.observe("click",function(){c.BFSetAttribute("value",p)});l.appendChild(n)});if(a.allow_custom){var k=document.createElement("input");k.addClassName("preview");k.addClassName("input");k.setAttribute("placeholder","Custom");k.observe("blur",function(o){var n=o.target.value;if(!n.match("^#")&&!n.match("Transparent")){n="#"+n}if(n.match("^#[0-9A-Fa-f]{3}")||n.match("^#[0-9A-Fa-f]{6}")){c.BFSetAttribute("value",n.toUpperCase());o.target.value=n}});l.appendChild(k)}h.current=f;h.select=l;c.picker=h;$(c.parentNode).appendChild(b);if(objExists(a.default_color)){defColor=a.default_color;if(!defColor.match("^#")&&!defColor.match("Transparent")){defColor="#"+defColor}c.BFSetAttribute("value",defColor)}},closeDropdowns:function(){$$(".bf_dropdown.open").each(function(a){a.removeClassName("open")});$$("body")[0].stopObserving("click",BF_UI.dropdownClickHandler);EventManager.fire("bf_ui:close_dropdowns")},dropdownClickHandler:function(a){var b=a.findElement(".bf_dropdown");if(!b){BF_UI.closeDropdowns()}},openDropdownEventHandler:function(b){b.stop();BF_UI.closeDropdowns();var f=(b.dropdown_id)?$(b.dropdown_id):b.findElement(".bf_dropdown");if(f.hasClassName("open")){return BF_UI.closeDropdowns()}f.addClassName("open");var c=$(f).down(".bf_dropdown_menu");var a={top:0,left:0};if($(f).hasClassName("bf_unpositioned_dropdown")){c.show()}else{BF_Effect.OpenMenu(f,c,a)}$$("body")[0].observe("click",BF_UI.dropdownClickHandler);EventManager.fire("bf_ui:open_dropdowns",{},f)}};if(typeof window.BuzzLoader!="undefined"){BuzzLoader.register(BF_UI.init,5)}var BFJS=function(){this.selector=(typeof window.jQuery!="undefined")?"find":"select";this.observer=(typeof window.jQuery!="undefined")?"on":"observe";this.read_attr=(typeof window.jQuery!="undefined")?"attr":"getAttribute";this.write_attr=(typeof window.jQuery!="undefined")?"attr":"setAttribute";this.stop_observing=(typeof window.jQuery!="undefined")?"unbind":"stopObserving";this.remove_class=(typeof window.jQuery!="undefined")?"removeClass":"removeClassName";this.add_class=(typeof window.jQuery!="undefined")?"addClass":"addClassName";this.has_class=(typeof window.jQuery!="undefined")?"hasClass":"hasClassName";this.update_html=(typeof window.jQuery!="undefined")?"html":"update";this.get_height=(typeof window.jQuery!="undefined")?"height":"getHeight";this.up=(typeof window.jQuery!="undefined")?"parents":"up";this.gtrack_cat=(typeof window.jQuery!="undefined")?"data-category":"rel:gt_cat";this.gtrack_act=(typeof window.jQuery!="undefined")?"data-action":"rel:gt_act";this.gtrack_label=(typeof window.jQuery!="undefined")?"data-label":"rel:gt_label";this.datetime=(typeof window.jQuery!="undefined")?"data-datetime":"rel:datetime";this.dateformat=(typeof window.jQuery!="undefined")?"data-dateformat":"rel:date_format";this.read_cookie=function(a){if(bfjs.isMobile()){return readCookie(a)}else{return BFW_Util.getCookie(a)}};this.write_cookie=function(a,b){if(bfjs.isMobile()){createCookie(a,b,9999)}else{BFW_Util.setCookie({name:a,value:b})}};this.eventFindEl=function(b,a){if(bfjs.isMobile()){return $(b.currentTarget).closest(a)[0]}else{return b.findElement(a)}};this.windowEvent=function(b,a){if(bfjs.isMobile()){$(window).on(b,a)}else{Event.observe(window,b,a)}};this.getFirstEl=function(a){return(bfjs.isMobile()&&a.jquery)?a[0]:a};this.getElsByAttr=function(a){if(bfjs.isMobile()){return $(a)}else{return $$(a)}};this.getElementFromEvent=function(a){if(bfjs.isMobile()){return a.target}else{return a.element()}};this.getOffset=function(a){if(bfjs.isMobile()){var c=$(a).offset().top,b=$(a).offset().left;return[b,c]}else{return $(a).cumulativeOffset()}};this.setStyle=function(a,b){if(bfjs.isMobile()){for(key in b){$(a).css(key,b[key])}}else{a.setStyle(b)}};this.universal_each=function(b,a){if(bfjs.isMobile()){$.each(b,function(f,c){a(c,f)})}else{b.each(function(f,c){a(f,c)})}};this.universal_compare_els=function(a,b){if(bfjs.isMobile()){return a.is(b)}else{return a==b}};this.isMobile=function(){if(typeof window.jQuery!="undefined"&&/^mobile/i.test(BF_STATIC.tt_page)){return true}else{return false}};this.onPageLoad=function(a){if(bfjs.isMobile()){$(document).ready(a)}else{BuzzLoader.register(a,1)}};this.toggleClass=function(c,b,f){f=(typeof f==="undefined")?false:f;var a=$(bfjs.getFirstEl(c));if(!f&&a[bfjs.has_class](b)){a[bfjs.remove_class](b)}else{if(f){a[bfjs.add_class](b)}}};this.indexOf=function(b,a){if(bfjs.isMobile()){return $.inArray(b,a)}else{return a.indexOf(b)}}};var bfjs=new BFJS();String.prototype.replaceAll=function(b,a){return this.split(b).join(a)};String.prototype.capitalize=function(){return this.replace(/\w+/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})};String.prototype.commafy=function(){return this.replace(/\B(?=(\d{3})+(?!\d))/g,",")};if(typeof(String.prototype.trim)!="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}Array.prototype.remove=function(){var g,c=arguments,b=c.length,f;while(b&&this.length){g=c[--b];while((f=this.indexOf(g))!==-1){this.splice(f,1)}}return this};function IsNumeric(a){return !isNaN(parseFloat(a))&&isFinite(a)}function BF_cumulativeScrollOffset(b){var a=0,c=0;do{if(b===document.body){var f=document.documentElement||document.body.parentNode||document.body;a+=!Object.isUndefined(window.pageYOffset)?window.pageYOffset:f.scrollTop||0;c+=!Object.isUndefined(window.pageXOffset)?window.pageXOffset:f.scrollLeft||0;break}else{a+=b.scrollTop||0;c+=b.scrollLeft||0;b=b.parentNode}}while(b);return new Element.Offset(c,a)}var $s=function(a){var b=$$(a);if(b.length==0){if(/dev\./.test(window.location.href)){console.error("No "+a+" in document!");console.trace()}return new Element("div")}else{return b[0]}};function isHTMLElement(a){if(typeof(HTMLElement)=="object"||typeof(HTMLElement)=="function"){return(a&&(a instanceof HTMLElement))}else{return(a&&typeof(a)=="object"&&a!==null&&a.nodeType===1&&typeof(a.nodeName)=="string")}}function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)}function clearTimer(a){if(objExists(a)){clearTimeout(a)}}function notEmptyStr(a){return"string"===typeof a&&0<a.length?!0:!1}function truncateStr(f,a){var c,b;if("string"!==typeof f){return""}c=f.split("");if(c.length>a){for(b=c.length-1;b>-1;--b){if(b>a){c.length=b}else{if(" "===c[b]){c.length=b;break}}}c.push("...")}return c.join("")}function hasLocalStorage(){var a;a=("localStorage" in window)&&window.localStorage!==null?true:false;if(a){try{localStorage.setItem("__test","data")}catch(b){a=false}}return a}function findMatchesExec(f,g){if(!(f instanceof RegExp)){if(BF_STATIC.env!="live"){throw new Error("Error: findMatchesExec() : pattern is not RegExp object")}return false}var c=(f.global)?true:false;var b=[];var a;f.lastIndex=0;while((a=f.exec(g))!=null){b.push(a);if(!c){break}}return(b.length)?b:null}function win8AdCall(){try{if(document.location.search.match(/win8me/)){return"os=win8;"}if(typeof navigator.appVersion!="undefined"){if(navigator.appVersion.toLowerCase().indexOf(/windows nt 6.2/)!=-1){return"os=win8;"}else{return""}}else{return""}}catch(a){return""}}function isIE7(){var a=false;if(navigator.appVersion.indexOf("MSIE")!=-1&&parseFloat(navigator.appVersion.split("MSIE")[1])<8){a=true}return a}function isIE8(){var a=false;if(navigator.appVersion.indexOf("MSIE")!=-1&&parseFloat(navigator.appVersion.split("MSIE")[1])==8){a=true}return a}function isIE9(){var a=false;if(navigator.appVersion.indexOf("MSIE")!=-1&&parseFloat(navigator.appVersion.split("MSIE")[1])==9){a=true}return a}function isIE10(){if(uagent.match("msie 10")){return true}}function isIE11(){return !!(navigator.userAgent.match(/Trident/)&&!navigator.userAgent.match(/MSIE/))}function isMSIE(){return(navigator.appVersion.indexOf("MSIE")!=-1)||isIE11()}function isFirefox(){return(navigator.userAgent.toLowerCase().indexOf("firefox")!=-1)}function isMac(){return(navigator.platform.toLowerCase().indexOf("mac")!=-1)}function isSafari5(){if((uagent.match("safari")&&!uagent.match("chrome"))&&!(uagent.match(/Version\/[6-9](?:\.[0-9])* Safari/i)||uagent.match(/Version\/[5-9](?:\.\d+)*\.\d+ Mobile\/\S*\sSafari/i))){return true}}function getUrlVars(){var b={};var a=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,f,g){b[f]=g});return b}function is_touch(){var a;if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch){a=true}else{a=false}return a}function is_mobile(){var a=navigator.userAgent.toLowerCase();if(a.match(/iphone|ipod|android|ipad/)){return true}else{return false}}function BFWebPath(){var a=BF_STATIC.bf_env=="dev"?"dev.":BF_STATIC.bf_env=="stage"?"stage.":"www.";return a+"buzzfeed.com"+BF_STATIC.web_root}function getWidth(a){return $(a).getWidth()}function objExists(b){try{if(typeof(b)!="undefined"){return true}else{return false}}catch(a){return false}}function removeAllCssClasses(a){$w($(a).className).each(function(b){$(a).removeClassName(b)})}function trackPixel(a){var c=new Image();var b=(Math.random()*100000000000000000);a=a.replace("[timestamp]",b);if(BF_STATIC.bf_env=="dev"||BF_STATIC.bf_test_mode){console.log("Pixel Tracked: ",a)}else{c.src=a}}function ukBackground(){if(BF_STATIC.country=="uk"&&(acl.user_can("homepage_edit")||acl.user_can("uk_homepage_edit"))){$$("body")[0].addClassName("uk_edit")}}function fbSharePixel(){var a={};a.pixel_id="6009136439565";a.value="0.00";if(BF_STATIC.bf_env=="dev"||BF_STATIC.bf_test_mode){console.log("FB Share Pixel")}else{BF_UTIL.createScript({url:"//connect.facebook.net/en_US/fp.js"})}}function toggleGraphicImage(c,g){if(!isSafari5()&&!isIE10()){var h=c.getOffsetParent(),f=h.select(".graphic_image")[0],b=h.select(".graphic_image_warning")[0],a=h.select("reblur")[0];if(!g){if(f){f.removeClassName("graphic_image")}if(b){b.addClassName("hidden")}h.addClassName("no_blur")}else{if(g){f=h.select("img")[0];if(f){f.addClassName("graphic_image")}if(b){b.removeClassName("hidden")}h.removeClassName("no_blur")}}}}function gplusCallback(a){gplus.callback(a)}Element.addMethods({cleanHeight:function(c){var g=Number(c.getStyle("padding-top").slice(0,-2))+Number(c.getStyle("padding-bottom").slice(0,-2));var f=Number(c.getStyle("margin-top").slice(0,-2))+Number(c.getStyle("margin-bottom").slice(0,-2));var b=Number(c.getStyle("border-top").slice(0,-2))+Number(c.getStyle("border-bottom").slice(0,-2));var a=Number(c.getHeight());if(isNaN(g)){g=0}if(isNaN(f)){f=0}if(isNaN(b)){b=0}if(isNaN(a)){a=0}var h=a-(g+f+b);return h},findParent:function(b,a){try{while(b!=document){var c=$(b).up(a);if(c!="undefined"){return c}else{b=c}}return null}catch(f){return null}},getSelectedOption:function(b){if(!(b=$(b))){return}var a=b.selectedIndex;return a>=0?b.options[a]:undefined}});function shuffleArray(f){for(var b,a,c=f.length;c;b=parseInt(Math.random()*c),a=f[--c],f[c]=f[b],f[b]=a){}return f}var BF_UTIL=(function(){var p,h,k=document,m=window,g=k.body,f=k.documentElement,o={},a=function(s){if(typeof s.url==="undefined"){return console.error("BF_UTIL.createScript(): No url provided")}if(!window.BF_STATIC||!BF_STATIC.bf_test_mode){var q=document.createElement("script");q.async=typeof s.async!=="undefined"?s.async:true;q.src=s.url;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(q,r)}else{console.info("disable load",s.url,"for test mode")}},n=function(t,q,r){var v;return function s(){var A=this,z=arguments;function w(){if(!r){t.apply(A,z)}v=null}if(v){clearTimeout(v)}else{if(r){t.apply(A,z)}}v=setTimeout(w,q||100)}},b=function(q){if(BF_STATIC.env=="live"||typeof console!=="object"||typeof console.log!=="function"){return}console.log(q)},c={dimensions:{width:function(){var q=0;if(typeof(m.innerWidth)=="number"){q=m.innerWidth}else{if(k.documentElement&&k.documentElement.clientWidth){q=k.documentElement.clientWidth}else{if(k.body&&k.body.clientWidth){q=k.body.clientWidth}}}return q},height:function(){var q=0;if(typeof(m.innerHeight)=="number"){q=m.innerHeight}else{if(k.documentElement&&k.documentElement.clientHeight){q=k.documentElement.clientHeight}else{if(k.body&&k.body.clientHeight){q=k.body.clientHeight}}}return q}},position:{top:function(){return typeof(m.screenY)=="number"?m.screenY:m.screenTop},left:function(){return typeof(m.screenX)=="number"?m.screenX:m.screenLeft}}},l={height:function(){var q=k.body,r=k.documentElement;if(typeof p==="undefined"){p=Math.max(q.scrollHeight,q.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight)}return p},width:function(){var q=k.body,r=k.documentElement;if(typeof h==="undefined"){h=Math.max(q.scrollWidth,q.offsetWidth,r.clientWidth,r.scrollWidth,r.offsetWidth)}return h}};o.browser=c;o.document=l;o.debounce=n;o.log=b;o.createScript=a;return o}());var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,f=/[^-+\dA-Z]/g,c=function(h,g){h=String(h);g=g||2;while(h.length<g){h="0"+h}return h};return function(n,E,w){var k=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(n)=="[object String]"&&!/\d/.test(n)){E=n;n=undefined}n=n?new Date(n):new Date;if(isNaN(n)){throw SyntaxError("invalid date")}E=String(k.masks[E]||E||k.masks["default"]);if(E.slice(0,4)=="UTC:"){E=E.slice(4);w=true}var A=w?"getUTC":"get",r=n[A+"Date"](),g=n[A+"Day"](),p=n[A+"Month"](),v=n[A+"FullYear"](),z=n[A+"Hours"](),q=n[A+"Minutes"](),B=n[A+"Seconds"](),t=n[A+"Milliseconds"](),h=w?0:n.getTimezoneOffset(),l={d:r,dd:c(r),ddd:k.i18n.dayNames[g],dddd:k.i18n.dayNames[g+7],m:p+1,mm:c(p+1),mmm:k.i18n.monthNames[p],mmmm:k.i18n.monthNames[p+12],yy:String(v).slice(2),yyyy:v,h:z%12||12,hh:c(z%12||12),H:z,HH:c(z),M:q,MM:c(q),s:B,ss:c(B),l:c(t,3),L:c(t>99?Math.round(t/10):t),t:z<12?"a":"p",tt:z<12?"am":"pm",T:z<12?"A":"P",TT:z<12?"AM":"PM",Z:w?"UTC":(String(n).match(b)||[""]).pop().replace(f,""),o:(h>0?"-":"+")+c(Math.floor(Math.abs(h)/60)*100+Math.abs(h)%60,4),S:["th","st","nd","rd"][r%10>3?0:(r%100-r%10!=10)*r%10]};return E.replace(a,function(m){return m in l?l[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){try{return dateFormat(this,a,b)}catch(c){console.error(c.message+": date_format.js line 159");return null}};function inject_rando_code(a){var b="/random";if(typeof a!="undefined"){b+="/"+a;$("random_"+a+"_button").hide();$("random_"+a+"_button_spinner").show()}else{$("random_button").hide();$("random_button_spinner").show()}b+=".js";BF_XSS.swift_injection(BF_STATIC.web_root+b)}Persist=(function(){var g="0.1.0",f,k,a,h,c,b;b=(function(){var s="Thu, 01-Jan-1970 00:00:01 GMT",m=1000*60*60*24,t=["expires","path","domain"],o=escape,n=unescape,r=document,p;var v=function(){var w=new Date();w.setTime(w.getTime());return w};var l=function(B,F){var A,z,E,D=[],w=(arguments.length>2)?arguments[2]:{};D.push(o(B)+"="+o(F));for(A=0;A<t.length;A++){z=t[A];if(E=w[z]){D.push(z+"="+E)}}if(w.secure){D.push("secure")}return D.join("; ")};var q=function(){var z="__EC_TEST__",w=new Date();w=w.toGMTString();this.set(z,w);this.enabled=(this.remove(z)==w);return this.enabled};p={set:function(D,G){var B=(arguments.length>2)?arguments[2]:{},A=v(),z,w={};if(B.expires){B.expires*=m;w.expires=new Date(A.getTime()+B.expires);w.expires=w.expires.toGMTString()}var F=["path","domain","secure"];for(i=0;i<F.length;i++){if(B[F[i]]){w[F[i]]=B[F[i]]}}var E=l(D,G,w);r.cookie=E;return G},has:function(z){z=o(z);var D=r.cookie,B=D.indexOf(z+"="),w=B+z.length+1,A=D.substring(0,z.length);return((!B&&z!=A)||B<0)?false:true},get:function(A){A=o(A);var E=r.cookie,D=E.indexOf(A+"="),w=D+A.length+1,B=E.substring(0,A.length),z;if((!D&&A!=B)||D<0){return null}z=E.indexOf(";",w);if(z<0){z=E.length}return n(E.substring(w,z))},remove:function(w){var A=p.get(w),z={expires:s};r.cookie=l(w,"",z);return A},keys:function(){var D=r.cookie,B=D.split("; "),w,A,z=[];for(w=0;w<B.length;w++){A=B[w].split("=");z.push(n(A[0]))}return z},all:function(){var D=r.cookie,B=D.split("; "),w,A,z=[];for(w=0;w<B.length;w++){A=B[w].split("=");z.push([n(A[0]),n(A[1])])}return z},version:"0.2.1",enabled:false};p.enabled=q.call(p);return p}());c=function(){};a=function(l){return"PS"+l.replace(/_/g,"__").replace(/ /g,"_s")};C={search_order:["localstorage","whatwg_db","globalstorage","ie","cookie"],name_re:/^[a-z][a-z0-9_ -]+$/i,methods:["init","get","set","remove","load","save"],sql:{version:"1",create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?"}};k={whatwg_db:{size:200*1024,test:function(){var l="PersistJS Test",m="Persistent database test.";if(!window.openDatabase){return false}if(!window.openDatabase(l,C.sql.version,m,k.whatwg_db.size)){return false}return true},methods:{transaction:function(l){if(!this.db_created){var m=C.sql.create;this.db.transaction(function(n){n.executeSql(m,[],function(){this.db_created=true})},c)}this.db.transaction(l)},init:function(){var m,l;m=this.o.about||"Persistent storage for "+this.name;l=this.o.size||k.whatwg_db.size;this.db=openDatabase(this.name,C.sql.version,m,l)},get:function(l,n,m){var o=C.sql.get;if(!n){return}m=m||this;this.transaction(function(p){p.executeSql(o,[l],function(q,s){if(s.rows.length>0){n.call(m,true,s.rows.item(0)["v"])}else{n.call(m,false,null)}})})},set:function(m,q,o,n){var l=C.sql.remove,p=C.sql.set;this.transaction(function(r){r.executeSql(l,[m],function(){r.executeSql(p,[m,q],function(s,v){if(o){o.call(n||this,true,q)}})})});return q},remove:function(l,n,m){var o=C.sql.get;sql=C.sql.remove;this.transaction(function(p){if(n){p.executeSql(o,[l],function(q,s){if(s.rows.length>0){var v=s.rows.item(0)["v"];q.executeSql(sql,[l],function(w,z){n.call(m||this,true,v)})}else{n.call(m||this,false,null)}})}else{p.executeSql(sql,[l])}})}}},globalstorage:{size:5*1024*1024,test:function(){return window.globalStorage?true:false},methods:{key:function(l){return a(this.name)+a(l)},init:function(){this.store=globalStorage[this.o.domain]},get:function(l,n,m){l=this.key(l);if(n){n.call(m||this,true,this.store.getItem(l))}},set:function(l,o,n,m){l=this.key(l);this.store.setItem(l,o);if(n){n.call(m||this,true,o)}},remove:function(l,n,m){var o;l=this.key(l);o=this.store[l];this.store.removeItem(l);if(n){n.call(m||this,(o!==null),o)}}}},localstorage:{size:-1,test:function(){return window.localStorage?true:false},methods:{key:function(l){return a(this.name)+a(l)},init:function(){this.store=localStorage},get:function(l,n,m){l=this.key(l);if(n){n.call(m||this,true,this.store.getItem(l))}},set:function(l,o,n,m){l=this.key(l);this.store.setItem(l,o);if(n){n.call(m||this,true,o)}},remove:function(l,n,m){var o;l=this.key(l);o=this.store.getItem(l);this.store.removeItem(l);if(n){n.call(m||this,(o!==null),o)}}}},ie:{prefix:"_persist_data-",size:64*1024,test:function(){return window.ActiveXObject?true:false},make_userdata:function(m){var l=document.createElement("div");l.id=m;l.style.display="none";l.addBehavior("#default#userData");document.body.appendChild(l);return l},methods:{init:function(){var l=k.ie.prefix+a(this.name);this.el=k.ie.make_userdata(l);if(this.o.defer){this.load()}},get:function(l,n,m){var o;l=a(l);if(!this.o.defer){this.load()}o=this.el.getAttribute(l);if(n){n.call(m||this,o?true:false,o)}},set:function(l,o,n,m){l=a(l);this.el.setAttribute(l,o);if(!this.o.defer){this.save()}if(n){n.call(m||this,true,o)}},load:function(){this.el.load(a(this.name))},save:function(){this.el.save(a(this.name))}}},cookie:{delim:":",size:4000,test:function(){return f.Cookie.enabled?true:false},methods:{key:function(l){return this.name+k.cookie.delim+l},get:function(l,o,n,m){l=this.key(l);o=b.get(l);if(n){n.call(m||this,o!=null,o)}},set:function(l,o,n,m){l=this.key(l);b.set(l,o,this.o);if(n){n.call(m||this,true,o)}},remove:function(l,o,n,m){var o;l=this.key(l);o=b.remove(l);if(n){n.call(m||this,o!=null,o)}}}}};var h=function(){var q,n,m,p,o=C.methods,r=C.search_order;for(q=0,n=o.length;q<n;q++){f.Store.prototype[o[q]]=c}f.type=null;f.size=-1;for(q=0,n=r.length;!f.type&&q<n;q++){m=k[r[q]];if(m.test()){f.type=r[q];f.size=m.size;for(p in m.methods){f.Store.prototype[p]=m.methods[p]}}}f._init=true};f={VERSION:g,type:null,size:0,add:function(l){k[l.id]=l;C.search_order=[l.id].concat(C.search_order);h()},remove:function(m){var l=C.search_order.indexOf(m);if(l<0){return}C.search_order.splice(l,1);delete k[m];h()},Cookie:b,Store:function(l,m){if(!C.name_re.exec(l)){throw new Error("Invalid name")}if(!f.type){throw new Error("No suitable storage found")}m=m||{};this.name=l;m.domain=m.domain||location.hostname||"localhost.localdomain";this.o=m;m.expires=m.expires||365*2;m.path=m.path||"/";this.init()}};h();return f})();var WhoDat=function(){var g="bf_whodat_bucket";var c=false;var h=function(){var v=b(g);var l=Math.round(new Date().getTime()/1000);if(document.location.search.match("whodat_bucket")){c=true}var s=false;var q={};if(typeof v!="undefined"&&v){var n=v.split(",");for(var o=0;o<n.length;o++){var k=n[o].match("([^:]+):(.+)");if(k){q[k[1]]=k[2]}}if(c){var w=document.location.search.match("whodat_bucket_last_visit=([^&]+)");if(w){console.log("last_visit set to: "+w[1]);q.last_visit=w[1]}}if(q.last_visit&&q.freq&&(l-q.last_visit)>(45*60)){var m=l-q.last_visit;if(m>48*60*60){q.freq="weekly"}else{if(m>8*60*60){q.freq="daily"}else{q.freq="hourly"}}q.last_visit=l;s=true}}if(!q.freq){q.freq="new";q.last_visit=l;s=true}if(c){var w=document.location.search.match("whodat_bucket=([^&]+)");if(w&&w[1]){if(w[1]=="new"||w[1]=="weekly"||w[1]=="daily"||w[1]=="hourly"){console.log("Override whodat cookie and set bucket to: "+w[1]);q.freq=w[1];q.last_visit=l;s=true}else{console.log("It looks like you're trying to override whodat with an invalid cookie: "+w[1]+" (valid buckets: new, weekly, daily, hourly)")}}}var p="freq:"+q.freq+",last_visit:"+q.last_visit;if(s){if(c){console.log("Set new bf_whodat_bucket cookie: "+p)}a(g,p,(15*24*60*60*1000))}else{if(c){console.log("bf_whodat_bucket cookie is up-to-date: "+p)}}};var b=function(l){if(f(l)){var k=document.cookie.match("(^|;) ?"+l+"=([^;]*)(;|$)");return unescape(k[2])}else{return false}};var f=function(m,k){var l=document.cookie.match("(^|;) ?"+m+"=([^;]*)(;|$)");if(k&&typeof(k)=="string"){k=RegExp(RegExp.escape(k))}return(l?(k&&k!=""?unescape(l[2]).match(k):(l[2]!=this.cookies_cancel)):false)};var a=function(r,l,o){var m=1296000000,k="",q="";if(o||o==0){m=parseInt(o)}if(m!=0){var p=new Date();p.setTime(p.getTime()+m);k="; expires="+p.toGMTString()}q=escape(r)+"="+escape(l)+k+"; path=/; domain=.buzzfeed.com";document.cookie=q;if(c){console.log("Escaped whodat cookie: "+q)}};return{init:function(){try{h()}catch(k){console.error(k)}}}}();if(typeof BuzzLoader!="undefined"){BuzzLoader.register(WhoDat.init,5)}else{WhoDat.init()}function createCookie(c,g,h,f){if(h){var b=new Date();b.setTime(b.getTime()+(h*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+g+a+"; path=/; domain=.buzzfeed.com"}function readCookie(b){var g=b+"=";var a=document.cookie.split(";");for(var f=0;f<a.length;f++){var h=a[f];while(h.charAt(0)==" "){h=h.substring(1,h.length)}if(h.indexOf(g)==0){return h.substring(g.length,h.length)}}return null}function eraseCookie(a,b){document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain=.buzzfeed.com";if(typeof b!="undefined"){b()}}BF_Request=function(){this.id=(new Date().getTime()+Math.random().toString().substr(2,3));this.ajax=null;this.aborted=false;this._redirect=function(url){document.location.href=url};this.static_request=function(url,args){if(args.parameters){if(!args.delimiter){args.delimiter="-"}var key_vals=[];for(var each in args.parameters){key_vals.push(each+args.delimiter+args.parameters[each])}delete args.parameters;url+="/"+key_vals.join("/")}this.request(url,args)};this.request=function(url,args){var success=args.onSuccess;var resp=function(resp){try{var json=resp.getResponseHeader("X-json");var obj=null;if(json&&resp.responseText){obj=eval("("+resp.responseText+")");if(obj&&obj.error&&obj.error=="blacklist"){(new BF_Request()).alert(local.t("An error has occurred. If it keeps happening contact error@buzzfeed.com."));return false}}var ajax_redir=resp.getHeader("X-ajaxlocation");if(ajax_redir){if(!ajax_redir.match(/https?:\/\//)&&!ajax_redir.match(/^\/buzzfeed\//)){ajax_redir=BF_STATIC.web_root+ajax_redir}document.location.href=ajax_redir}else{if(typeof success==="function"){success(resp,obj)}}}catch(err){console.error(err)}}.bind(this);args.onSuccess=resp;var on406=args.on406||function(a,b){};var onCatcha=args.onCatcha||function(a,b){};args.on406=function(a,b){try{var obj=eval("("+a.responseText+")");if(typeof obj.service!="undefined"){if(typeof bf_catcha=="undefined"){console.warn("bf_catcha not available but request responded with catcha requirement; make sure the catcha template is in the form.")}else{bf_catcha.draw_catcha(obj.service)}}}catch(e){console.warn("Cant handle 406 response");console.dir({e:e})}onCatcha(a,b);on406(a,b)};if(!args.on401){args.on401=function(){var user=new BF_User();user.logout({noreload:true})}}if(!args.onFailure){args.onFailure=function(resp){(new BF_Request()).alert(local.t("Sorry, there was a problem processing your request. If it persists please contact support at http://www.buzzfeed.com/about/contact"))}}if(args.bf_auth&&!(args.parameters&&args.parameters.session_key)){args.parameters.session_key=BFW_Util.getCookie(BFW_COOKIE)}if(args.while_processing){if(args.while_processing.show){args.while_processing.show=$(args.while_processing.show)}if(args.while_processing.hide){args.while_processing.hide=$(args.while_processing.hide)}if(args.while_processing.show){args.while_processing.show.show();args.while_processing.show.removeClassName("hidden")}if(args.while_processing.hide){args.while_processing.hide.hide();args.while_processing.hide.addClassName("hidden")}var _onSuccess=args.onSuccess;args.onSuccess=function(a,b){if(args.while_processing.show){args.while_processing.show.hide();args.while_processing.show.addClassName("hidden")}if(args.while_processing.hide){args.while_processing.hide.show();args.while_processing.hide.removeClassName("hidden")}_onSuccess(a,b)};var _onFailure=args.onFailure;args.onFailure=function(a,b){if(args.while_processing.show){args.while_processing.show.hide();args.while_processing.show.addClassName("hidden")}if(args.while_processing.hide){args.while_processing.hide.show();args.while_processing.hide.removeClassName("hidden")}_onFailure(a,b)};var _on401=args.on401;args.on401=function(a,b){if(args.while_processing.show){args.while_processing.show.hide();args.while_processing.show.addClassName("hidden")}if(args.while_processing.hide){args.while_processing.hide.show();args.while_processing.hide.removeClassName("hidden")}_on401(a,b)}}if($("profile_session")){args.parameters.profile_session=$("profile_session").innerHTML}if(typeof BF_STATIC!=="undefined"&&typeof BF_STATIC.country!=="undefined"&&typeof args.parameters!=="undefined"){args.parameters.country=BF_STATIC.country}if(typeof bf_catcha!="undefined"&&bf_catcha.catcha_answer!=""){args.parameters.catcha_answer=bf_catcha.catcha_answer}try{if(BF_STATIC&&BF_STATIC.bf_env&&BF_STATIC.bf_env=="dev"&&BF_STATIC.bf_test_mode){BF_Request.request_stack.push(this);var that=this;$H(BF_Request.requestModifiers).each(function(pair){var queue=[];BF_Request.requestModifiers[pair.key].each(function(el,ind){if(el.filter(url,args)){queue.push(el);if(pair.key.match(/Once$/)){BF_Request.requestModifiers[pair.key].splice(ind,1)}}});if(args[pair.key]){queue.push({filter:function(){return true},fn:args[pair.key]})}args[pair.key]=function(){var request=this;return function(resp){(queue.shift()).fn(resp,queue,request)}}.call(that)})}}catch(e){console.error(e)}if(args.needsToken){if(typeof args.parameters.user_token!=undefined&&args.parameters.user_token){this.ajax=new Ajax.Request(url,args)}else{var params={method:"post",parameters:{action:"get_token",cb:(new Date).getMilliseconds()},onSuccess:function(resp){var json=resp.getResponseHeader("X-json");var obj=null;if(json){obj=eval("("+resp.responseText+")")}if(typeof obj!="undefined"&&typeof obj.success!="undefined"&&obj.success!=0&&typeof obj.token!="undefined"){args.parameters.user_token=obj.token;this.ajax=new Ajax.Request(url,args)}else{args.onFailure()}},onFailure:args.onFailure};this.ajax=new Ajax.Request("/buzzfeed/_admin_user",params)}}else{this.ajax=new Ajax.Request(url,args)}};this.abort=function(){if(this.ajax){this.aborted=true;this.ajax.transport.abort()}};this.alert=function(msg){try{var div=$("bf_request_err");if(!div){div=document.createElement("div");div.id="bf_request_err";div.addClassName("default-alert");document.getElementsByTagName("BODY")[0].appendChild(div)}else{div.removeClassName("hidden")}var template=new Template('<div class="default-alert--header"><a onclick="$(\'bf_request_err\').addClassName(\'hidden\');return false;" href="javascript:return false;">&times;</a></div> 			<div class="default-alert--inner">#{msg}</div> 		');div.update(template.evaluate({msg:msg}));var vpHeight=$(document).viewport.getHeight();var height=div.getLayout().get("margin-box-height");var scrollTop=$(document).viewport.getScrollOffsets().top;var avTop=(vpHeight/2)-(height/2)+scrollTop;if(avTop<=10){avTop=10}div.style.top=avTop+"px"}catch(e){if("console" in window){console.dir({e:e})}}}};BF_Request.statsd=function(){return{increment:function(a){if(Object.isArray(a)){a=a.join(",")}(new Image()).src="/buzzfeed/statsd_pixel?increment="+encodeURIComponent(a)}}}();BF_Request.location=function(a){if(!a){a={}}if(window.BF_LOCATION_DEBUG&&!a.debugged&&!a.reload_track){a.debugged=true;url=a.location;if(!url){url="window.location.href"}console.log("BF_Request: rediecting to "+url+" in "+window.BF_LOCATION_DEBUG+" seconds");console.log(a);setTimeout(function(){BF_Request.location(a)},window.BF_LOCATION_DEBUG);return}if(a.reload_track){BF_Request.statsd.increment("window.reload");window.location.reload();return}if(!a.location){BF_Request.location({reload_track:true})}else{if(a.new_tab){window.open(a.location,"_blank")}else{if(a.replace){window.location.replace(a.location)}else{window.location.href=a.location}}}};try{if(BF_STATIC&&BF_STATIC.bf_env&&BF_STATIC.bf_env=="dev"&&BF_STATIC.bf_test_mode){BF_RequestStack=function(){this.stack=[]};BF_RequestStack.prototype.push=function(a){this.stack.push(a)};BF_RequestStack.prototype.pop=function(){return this.stack.pop()};BF_RequestStack.prototype.peek=function(){return this.stack[this.stack.length-1]};BF_RequestStack.prototype.getRequest=function(c){try{var a=null;a=this.stack.find(function(f){if(f.id==c){return true}else{return false}});return a}catch(b){console.error(b)}};BF_Request.request_stack=new BF_RequestStack();var listeners=["onLoading","onLoaded","onInteractive","onSuccess","onFailure","onComplete"];BF_Request.requestModifiers={};for(var i=0;i<listeners.length;i++){BF_Request.requestModifiers[listeners[i]]=[{name:listeners[i],filter:function(b,a){return true},fn:function(c,a,b){if(a.length){(a.shift()).fn(c,a,b)}}}];BF_Request.requestModifiers[listeners[i]+"Once"]=[]}BF_Request.requestListeners={};for(var i=0;i<listeners.length;i++){BF_Request.requestListeners[listeners[i]]=[]}BF_Request.addRequestListener=function(b){var a={id:(new Date().getTime()+Math.random().toString().substr(2,3)),request:null,fulfilled:false,filter:b.filter?b.filter:function(){return true}};BF_Request.requestListeners[b.ev].push(a);BF_Request.requestModifiers[b.ev].push({name:b.ev,filter:b.filter,fn:function(){var c=a;return function(h,f,g){c.fulfilled=true;c.request=g;if(f.length){(f.shift()).fn(h,f,g)}}}()});return a.id};BF_Request.getRequestListener=function(c){try{var a=null;$H(BF_Request.requestListeners).each(function(h){var g=BF_Request.requestListeners[h.key].find(function(k){if(k.fulfilled&&k.id==c){return true}else{return false}});if(g){try{a={id:g.request.id,aborted:g.request.aborted,fulfilled:true,parameters:g.request.ajax.parameters,response:g.request.ajax.transport.response};try{a.responseJSON=a.response.evalJSON()}catch(f){}}catch(f){console.error(f)}}});return a}catch(b){console.error(b)}}}}catch(e){console.error(e)}BF_Login=function(){this.AUTH_RETURN_PAGE_COOKE="auth_return_page_cookie";this.LOGIN_ERR=local.t("Please enter a username and a password");this.AUTH_ERR=local.t("Please enter a valid username and a password");this.ERR=local.t("Sorry, we&rsquo;re unable to process your request at this time.");this.PASSWORD_ERR=local.t("Please enter your email address");this.PASSWORD_SUCCESS=local.t("We&rsquo;ve sent you an email with a reset password link.");this.PASSWORD_SERVER_ERROR=local.t("There was a problem contacting the server and we were unable to reset your password. Please try again later.");this.NEED_VALIDATION_ERROR=local.t("Your account needs to be validated. Please check your email for a validation link.");this.initialized=false;this.initialization=false;this.init=function(args){if(bf_login.initialized){return false}if(bf_login.initialization){setTimeout(this.init.bind(this,args),300);return false}bf_login.initialization=true;try{this.already_sent=false;bf_login.ajax=new BF_Request();bf_register=new BF_Register();gplus=new BF_GplusSignin();var user=new BF_User();var logged_in_elements=$$(".logged-in");var logged_out_elements=$$(".not-logged-in");if(user.isLoggedIn()){logged_in_elements.each(function(el){el.show()});logged_out_elements.each(function(el){el.hide()});if(typeof(localStorage)!="undefined"&&localStorage.getItem("bf_login.delayedLoggedInCallbacks")){try{var storedCallbacks=localStorage.getItem("bf_login.delayedLoggedInCallbacks").evalJSON();for(var i=0;i<storedCallbacks.length;i++){if(!Object.isArray(storedCallbacks[i].params)){storedCallbacks[i].params=[storedCallbacks[i].params]}if(typeof window[storedCallbacks[i].obj]!="undefined"){window[storedCallbacks[i].obj][storedCallbacks[i].fn].apply(window[storedCallbacks[i].obj],storedCallbacks[i].params)}else{new PeriodicalExecuter(function(cb){return function(pe){if(typeof window[cb.obj]!="undefined"){pe.stop();window[cb.obj][cb.fn].apply(window[cb.obj],cb.params)}}}(storedCallbacks[i]),0.5)}}localStorage.removeItem("bf_login.delayedLoggedInCallbacks")}catch(e){console.log(e)}}}else{logged_in_elements.each(function(el){el.hide()});logged_out_elements.each(function(el){el.show()})}if(BF_STATIC.facebook_enabled){$$(".hide-unless-facebook-enabled").each(function(el){el.show()})}var si_user=new BF_User();if(document.location.pathname.toString().match(/\/(signin|signin\/)$/)&&si_user.isLoggedIn()&&document.location.search.indexOf("microsite")==-1){var si_user_info=si_user.getUserInfo();var userpage=BF_STATIC.web_root+"/"+si_user_info.username;document.location.href=userpage;return}if(!si_user.isLoggedIn()&&document.location.search.indexOf("microsite")!=-1){window.location.href=document.location.pathname}if(args){this.args=args}var forgot_password_form=$("forgot-password-form");if(forgot_password_form){forgot_password_form.observe("submit",function(event){event.stop();bf_login.reset_password()}.bind(this))}var login_form;if(signin.signin_page&&signin.wrap){login_form=signin.wrap.select("#login-form")[0]}else{login_form=$("login-form")}if(login_form){login_form.observe("submit",function(event){event.stop();bf_login.login()}.bind(this))}var link_accounts_form=$("link-accounts-form");if(link_accounts_form){link_accounts_form.observe("submit",function(e){e.stop();bf_login.link_accounts()}.bind(this))}var forgot_password_link=$("forgot-password-link");if(forgot_password_link){forgot_password_link.observe("click",function(event){event.stop();$("login-form").hide();$("forgot-password-form").show()}.bind(this))}var registration_form=$("regsitration-form");if(registration_form&&$("switch_to_register")){$("switch_to_register").observe("click",function(e){e.stop();$("login-form").hide();$("regsitration-form").showOnScreen()})}else{if($("switch_to_register")){$("switch_to_register").observe("click",function(e){e.stop();window.location.href=BF_STATIC.web_root+"/signup"})}}var switch_to_login=$("switch_to_login");if(switch_to_login){switch_to_login.observe("click",function(event){event.stop();bf_login.switch_registration_to_login()}.bind(this))}var forgot_password_cancel=$("forgot-password-cancel");if(forgot_password_cancel){forgot_password_cancel.observe("click",function(event){event.stop();bf_login.cancel_reset_password()}.bind(this))}if(document.location.search.indexOf("badauth=true")>-1){$("bad-cookie-message").show()}if(BF_STATIC&&BF_STATIC.facebook_enabled==true){if($("facebook-login")){$("login-form").addClassName("facebook-enabled");$("facebook-login").show()}}if(document.location.pathname.toString().match(/\/(signin|signin\/)$/)){facebook.auto_register_enabled=false;facebook.link_accounts_enabled=true}bf_login.initialized=true}catch(e){console.error(e);bf_login.initialization=false}};this.switch_login_to_alias_registration=function(){$("login-form").hide();$("regsitration-form").hide();$("alias-registration-form").show();$("user_signin_message").hide();$("create_site_message").show()};this.switch_login_to_registration=function(){facebook.auto_register_enabled=false;facebook.observe("user_logged_in",function(){var su_page=BF_STATIC.tt_page=="Signup"?true:false;var submit_button=su_page?"fb-register-button":"submit-button";var email="get_from_facebook@buzzfeed.com";var initial_registration_fieldset=$("initial-registration-fieldset");var facebook_connected_div=$("facebook-connected-div");var facebook_button_div=$("facebook-registration-fieldset");var temp_pw="";var character='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_!@#$%^&*(){}[]:";<>,./?|';try{email=facebook.user_data.email}catch(e){}if(facebook_button_div){facebook_button_div.hide()}if(initial_registration_fieldset){initial_registration_fieldset.hide()}if(facebook_connected_div){facebook_connected_div.show()}for(var i=0;i<10;i++){temp_pw+=character[Math.round(Math.random()*character.length-1)]}event_handler.HANDLERS.map_into({target:{value:temp_pw}},{target:submit_button,field:"register.pw2"});event_handler.HANDLERS.map_into({target:{value:temp_pw}},{target:submit_button,field:"register.pw"});event_handler.HANDLERS.map_into({target:{value:facebook.session.userID}},{target:submit_button,field:"register.facebook_uid"});event_handler.HANDLERS.map_into({target:{value:email}},{target:submit_button,field:"register.email"});if(su_page){signup_page.openDialog("fb")}});if($("login-form")){$("login-form").hide()}if($("regsitration-form")){$("regsitration-form").show()}if($("alias-registration-form")){$("alias-registration-form").hide()}if($("new-registration-form")){$("new-registration-form").show()}BF_UserSwitcher.count_aliases(function(obj){if($("alias-sites-left")&&obj.success){var user_info=new BF_User().getUserInfo();var remaining=parseInt(user_info.max_aliases)-parseInt(obj.count);$("alias-sites-left").update(remaining);if(remaining==1){$("alias-sites-left-plural").hide()}if(obj.unlimited==1){$("alias-count-message").hide()}else{$("alias-count-message").show()}if(remaining<=0&&user_info.max_aliases!=0){$("alias-registration-fieldset").hide();$("alias-registration-hit-limit").show()}}})};this.switch_to_link_accounts=function(){if($("login-form")){$("login-form").hide()}if($("regsitration-form")){$("regsitration-form").hide()}if($("link-accounts-form")){$("link-accounts-form").show()}if($("alias-registration-form")){$("alias-registration-form").hide()}};this.switch_registration_to_login=function(){if($("link-accounts-form")){$("link-accounts-form").hide()}$("login-form").show();$("regsitration-form").hide();if($("alias-registration-form")){$("alias-registration-form").hide()}};this.cancel_reset_password=function(){$("login-form").show();$("forgot-password-form").hide();$("alias-registration-form").hide()};this.reset_password=function(){if(this.already_sent){return}this.already_sent=true;if(!signin.signin_page){$("forgot-password-cancel").hide();var reset_password_status=$("resetting-password-status");if(reset_password_status){reset_password_status.show()}$("forgot-password-message").hide()}var email;if(signin.signin_page&&signin.wrap){email=signin.wrap.select("#login-email")[0].value}else{email=$F("login-email")}if(email==local.t("Email address")&&signin.signin_page){email=""}if(!email){if(signin.signin_page){signin.register_errors("email",local.t("Please provide a valid email address."));this.setError(this.PASSWORD_ERR,"forgot-password")}else{this.setError(this.PASSWORD_ERR,local.t("forgot-password"));if(reset_password_status){reset_password_status.hide()}if($("forgot-password-cancel")){$("forgot-password-cancel").show()}}this.already_sent=false}else{$("forgot-password-submit").disabled=true;var lr=function(resp){this.passwordSent(resp)}.bindAsEventListener(this);var er=function(resp){if($("forgot-password-cancel")){$("forgot-password-cancel").show()}this.err(resp,"forgot-password")}.bindAsEventListener(this);var params={email:email};bf_login.ajax.request("/buzzfeed/_forgot_password",{method:"get",parameters:params,onSuccess:lr,onFailure:er})}};this.link_accounts=function(){try{if($("link-accounts-status")){$("link-accounts-status").show()}$("link-accounts-message").hide();var username=$F("link-accounts-username");var password=$F("link-accounts-password");if(!username||!password){if($("link-accounts-status")){$("link-accounts-status").hide()}this.setError(this.LOGIN_ERR,"link-accounts")}else{$("link-accounts-submit").disabled=true;var lr=function(resp){this.loggedIn(resp,{link_accounts:1})}.bindAsEventListener(this);var er=function(resp){$("link-accounts-status").hide();$("link-accounts-submit").enable();$("link-accounts-message").update(this.LOGIN_ERR)}.bindAsEventListener(this);var params={username:username,password:password,contribute:1};bf_login.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:lr,onFailure:er})}}catch(e){console.error(e)}};this.login=function(){try{if($("bad-cookie-message")){$("bad-cookie-message").hide()}if($("logging-in-status")){$("logging-in-status").show()}if($("login-message")){$("login-message").hide()}var username;var password;try{if(signin.signin_page&&signin.wrap){username=signin.wrap.select("#login-username")[0].value;password=signin.wrap.select("#login-password")[0].value}else{username=$F("login-username");password=$F("login-password")}}catch(e){}if(typeof arguments[0]!="undefined"&&typeof arguments[0]["username"]!="undefined"&&typeof arguments[0]["password"]!="undefined"){username=arguments[0]["username"];password=arguments[0]["password"]}if(!username||!password){if($("logging-in-status")){$("logging-in-status").hide()}this.setError(this.LOGIN_ERR)}else{if($("login-submit")){$("login-submit").disabled=true}var lr=function(loginResp){bf_login.loggedIn(loginResp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);var params={username:username,password:password,contribute:1};bf_login.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:lr,onFailure:er})}}catch(e){console.error(e)}};this.cookieLogin=function(){var lr=function(resp){this.loggedIn(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);var params={session_key:BFW_Util.getCookie(BFW_COOKIE)};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:lr,onFailure:er})};this.passwordSent=function(resp){if(signin.signin_page){signin.pw_response(resp)}if($("forgot-password-cancel")){$("forgot-password-cancel").show()}var reset_password_status=$("resetting-password-status");try{obj=eval("("+resp.responseText+")");if(typeof obj.updated!="undefined"&&obj.updated=="true"){this.setError(this.PASSWORD_SUCCESS,"login");$("login-message").className="message success";if(reset_password_status){reset_password_status.hide()}$("login-form").show();$("forgot-password-form").hide()}else{if("User needs validation"==obj.error){this.setError(this.NEED_VALIDATION_ERROR,local.t("forgot-password"));if(reset_password_status){reset_password_status.hide()}}else{this.setError(obj.error,local.t("forgot-password"));this.already_sent=false;if(reset_password_status){reset_password_status.hide()}}}}catch(e){console.dir({e:e});if(reset_password_status){reset_password_status.hide()}}};this.loggedInCallbacks=[];this.delayedLoggedInCallbacks=[];this.loggedIn=function(resp,args){if(!args){this.args?args=this.args:args={}}if(document.location.search.indexOf("contribution=false")!=-1&&!this.args){this.args={action:"badge_vote"}}obj=resp.responseText?eval("("+resp.responseText+")"):resp;obj.login=obj.login==true||obj.login=="true";if(obj.login==false&&signin.signin_page&&!signin.is_gplus){signin.register_errors("username",local.t("Please provide a valid username and password."))}try{if($("login-submit")){$("login-submit").disabled=false}if($("link-accounts-submit")){$("link-accounts-submit").disabled=false}if(obj.login){if(typeof args=="undefined"||typeof args.no_reload=="undefined"){signin.close_enabled=false}else{signin.close_enabled=args.no_reload}if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("signin")}var w=args.current_page=="signin_anywhere"?window:window.parent;w.BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});try{w.BFW_Util.setInfoCookie({value:obj})}catch(e){console.error(e)}if(!!window.facebook){facebook.link_accounts()}if(!!window.fb_app&&args.link_accounts){fb_app.link_accounts()}if(typeof prepopulated_quickpost_manager!="undefined"&&prepopulated_quickpost_manager.onLogin){prepopulated_quickpost_manager.onLogin()}if(typeof contest_manager!="undefined"&&contest_manager.onLogin){contest_manager.onLogin()}if(typeof picks_controller!="undefined"&&picks_controller!=null&&picks_controller.onLogin){picks_controller.onLogin()}if(args&&args.current_page=="home"&&!obj.test_mode&&window.location.href.indexOf("testmode=on")==-1){var url=BFW_Util.getCookie(this.AUTH_RETURN_PAGE_COOKE);if(url){BFW_Util.deleteCookie(this.AUTH_RETURN_PAGE_COOKE);window.location.href=url}else{var destination=document.referrer.indexOf("/dashboard")<0?escape(obj.username):"dashboard";var newloc=BF_STATIC.web_root+"/"+destination;BF_Request.location({location:newloc})}}else{if(args&&args.action=="vote"&&vote_manager.contribution_id){vote_manager._vote(null,vote_manager.contribution_id);if($("registration-div")){$("login-message").show();$("login-message").className="message success";$("login-message").update(local.t("Login Successful"));if($("logging-in-status")){$("logging-in-status").hide()}$("login-fieldset").hide();setTimeout(function(){fadeOut("registration-div",100)},2000)}}else{if(args&&args.action=="userdata"){var user_nav=new BF_UserNav();user_nav.init()}else{if(args&&args.action=="bookmarklet"){bf_bm.showForm()}else{if(args&&args.action=="badge_vote"){$("registration-div").hide();if($("contribute-preview")){$("contribute-preview").hide()}}else{if(args&&args.current_page=="self-serve"){$("self-serve-registration-div").hide();$("self-serve-buttons").show();if($("contribute-preview")){$("contribute-preview").hide()}bf_register.self_serve_submit_handler()}}}}}}if(args.current_page=="signin_anywhere"){if(window.parent.$("usernav-signin")){window.parent.$("usernav-signin").hide()}if(window.parent.$("usernav-signup")){window.parent.$("usernav-signup").hide()}var user_nav=new window.parent.BF_UserNav();user_nav.init();if(window.parent.bf_login.loggedInCallbacks){window.parent.bf_login.loggedInCallbacks.each(function(fn){fn()})}}else{if($("usernav-signin")){$("usernav-signin").hide()}if($("usernav-signup")){$("usernav-signup").hide()}var user_nav=new BF_UserNav();user_nav.init();if(this.loggedInCallbacks){this.loggedInCallbacks.each(function(fn){fn()})}}if(typeof(localStorage)!="undefined"){localStorage.setItem("bf_login.delayedLoggedInCallbacks",Object.toJSON(bf_login.delayedLoggedInCallbacks))}var si_user=new BF_User();if(document.location.pathname.toString().match(/\/(signin|signin\/)$/)&&si_user.isLoggedIn()&&document.location.search.indexOf("microsite")==-1){var si_user_info=si_user.getUserInfo();var userpage=BF_STATIC.web_root+"/"+si_user_info.username;document.location.href=userpage;return}else{if(document.location.pathname.toString().match(/forgot_pass/)){return true}else{if(typeof signin!="undefined"&&signin.modal_mode&&signin.modal_mode=="badges"){signin.close_enabled=true;if(!signin.social_register){signin.close()}return true}else{var isUserSwitchingPassed=(!args||(typeof args.no_reload!="undefined"&&args.no_reload==true));if(isUserSwitchingPassed){return false}BF_Request.location({reload_track:true});return true}}}}else{bf_login.clear_invalid_session(resp);if(obj.requires_oauth){try{signin.register_errors("username","Logging in with oauth; make sure you do not block the popup.")}catch(e){this.setError("Logging in with oauth; make sure you don't block the popup.")}window.open("/buzzfeed/oauth_signin?username="+obj.username,"OAuth","width=500,height=500")}else{if(args.link_accounts){this.setError(this.AUTH_ERR,"link-accounts")}else{this.setError(this.AUTH_ERR)}}if($("logging-in-status")){$("logging-in-status").hide()}if($("link-accounts-status")){$("link-accounts-status").hide()}}}catch(e){console.dir({e:e})}};this.clear_invalid_session=function(resp){if(!resp){resp={}}if((new BF_User()).isLoggedIn()&&resp.status!=0){if(!"user_nav" in window){setTimeout(bf_login.clear_invalid_session,250)}if(!!window.facebook){facebook.logout(user_nav.signout)}else{user_nav.signout()}}};this.err=function(resp,target){bf_login.clear_invalid_session();this.setError(this.ERR,target);if($("logging-in-status")){$("logging-in-status").hide()}if($("resetting-password-status")){$("resetting-password-status").hide()}};this.setError=function(err,target){if(!target){target="login"}try{$(target+"-message").update(err)}catch(e){if($(target+"-message")){$(target+"-message").innerText=err}}if(!signin.signin_page){$(target+"-message").className="message error";$(target+"-message").show()}$(target+"-submit").disabled=false}};bf_login=new BF_Login();BuzzLoader.register(bf_login.init,1);var fadeOut=function(b,a){$(b).setOpacity(a/100);if(a>0){setTimeout("fadeOut('"+b+"',"+(a-2)+")",5)}else{$(b).hide()}};var BF_UserSwitcher={controller:"/buzzfeed/_switch",template:'<li><a href="" onclick="return false" class="switch-to-user" rel:id="#{id}"><img src="#{root}#{image}"/>#{display_name}</a></li>',template_bottom_div:'<li class="#{hl}"><a href="" onclick="return false" rel:username="#{username}"><span class="list-username" rel:username="#{username}">#{username}</span> #{display_name}</a><span class="hl chosen"></span></li>',latest_switch_list:[],latest_switch_list_loaded:false,switcher:null,bottom_warning_div:null,bottom_warning_select:null,is_user_switcher:false,selected_user:null,init:function(b){try{if(!acl.user_can("general_admin")){return false}if(b!=null){BF_UserSwitcher.selected_user=b}if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.apply_visibility();return false}BF_UserSwitcher.switcher=$("quickpost-user-switcher");if(BF_UserSwitcher.switcher){BF_UserSwitcher.is_user_switcher=true}BF_UserSwitcher.apply_visibility();if(acl.user_can("general_admin")){BF_UserSwitcher._switch_list_ui([""],"bottom");universal_dom.get_bucket_elements("switch_users").each(function(f){var c=BF_UserSwitcher.switcher.select(".switch_user_list")[0];f.observe("click",function(){if(c.style.display=="block"){return false}c.style.display="block";universal_dom.get_bucket_elements("switch_user_dialog").each(function(g){g.update("Loading...")});BF_UserSwitcher.getSwitchList(BF_UserSwitcher._switch_list_ui,"bottom",true)});Event.observe(window,"click",function(g){if(!$(g.target).childOf||!$(g.target).childOf(BF_UserSwitcher.switcher)){c.style.display="none"}})})}}catch(a){console.error(a)}},apply_visibility:function(){try{if(!BF_UserSwitcher.is_user_switcher){return false}var a=(new BF_User()).getUserInfo();if(BF_UserSwitcher.selected_user==null){if(typeof edit_post!="undefined"){BF_UserSwitcher.selected_user=edit_post.buzz.username}else{BF_UserSwitcher.selected_user=a.username;$$(".switched-display_name").each(function(f){if(f.hasClassName("bottom_display_name")){f.update(a.display_name)}})}}if(acl.user_can("general_admin")){var b;if(typeof edit_post!="undefined"){b=edit_post.buzz.username}else{b=a.default_user.username}}else{BF_UserSwitcher.switcher.style.display="none"}}catch(c){console.error(c)}},sw_bottom_div:function(b){try{b.stop();var a=BF_UserSwitcher.switcher.select(".switch_user_list")[0];a.select("li a").each(function(c){if(b.target==c||b.target.parentNode==c){BF_UserSwitcher.selected_user=c.getAttribute("rel:username");c.parentNode.addClassName("hl");superlist_bylines.set_add_bylines(BF_UserSwitcher.selected_user,true);universal_dom.get_bucket_elements("switch_user_dialog")[0].hide()}else{c.parentNode.removeClassName("hl")}});BF_UserSwitcher.apply_visibility()}catch(b){console.error(b)}},fill_switch_div:function(f){try{if(!BF_UserSwitcher.is_user_switcher){return false}var c=new Template(BF_UserSwitcher.template_bottom_div);var b="<ul>";var a=(new BF_User()).getUserInfo();u=a.default_user;f.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:u.image,userid:u.userid});if(typeof edit_post!="undefined"){f.unshift({display_name:decodeURIComponent(edit_post.buzz.user_displayname.unescapeHTML()),not_user:true,username:edit_post.buzz.username,image:edit_post.buzz.user_image,userid:edit_post.buzz.userid})}f.each(function(k){if(k.p_disable_quickpost=="1"){return false}if(typeof edit_post!="undefined"&&k.username==edit_post.buzz.username&&!k.not_user){return false}var h=(BF_UserSwitcher.selected_user==k.username)?true:false;b+=c.evaluate({display_name:k.display_name,username:k.username,hl:(h?"hl":"")})});var f=BF_UserSwitcher.switcher.select(".switch_user_list")[0];f.update(b+"</ul>");f.select("ul a").each(function(h){h.observe("click",BF_UserSwitcher.sw_bottom_div)})}catch(g){console.error(g)}},switch_callback:function(){try{var a=(new BF_User()).getUserInfo();if(typeof edit_post=="undefined"){if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.selected_user=a.username}$$(".switched-display_name").each(function(f){f.update(a.display_name)})}else{$$(".switched-display_name").each(function(f){if(!f.hasClassName("bottom_display_name")){f.update(a.display_name)}})}if(a.p_disable_quickpost=="true"){BF_Request.location({reload_track:true});return false}if(BF_UserSwitcher.is_user_switcher){var b=BF_UserSwitcher.switcher.select(".switch_user_list")[0];b.style.display="none";BF_UserSwitcher.apply_visibility()}}catch(c){console.error(c)}},swfunction:function(a){try{a.stop();var b=a.target.getAttribute("rel:id");BF_UserSwitcher.switchTo(b,BF_UserSwitcher.switch_callback)}catch(a){console.error(a)}},switch_list_ui:function(a){try{a.stop();if($("switch-list-spinner")){$("switch-list-spinner").show()}this.getSwitchList(BF_UserSwitcher._switch_list_ui,"top")}catch(a){console.error(a)}},_switch_list_ui:function(f,a,m){if(!$("usernav-switch-list")){return}try{if(m&&BF_UserSwitcher.is_user_switcher){var k=f.slice(0);BF_UserSwitcher.fill_switch_div(k)}var h=(new BF_User()).getUserInfo();var l=new Template(BF_UserSwitcher.template);var b='<a class="close_switch_list_ui" href="javascript:;" onclick="BF_UserSwitcher.hide_switch_list_ui();return false;"><img src="'+BF_STATIC.static_root+'/images/public/video-lightbox/closebox.png" alt="Close"/></a><ul>';var g=(typeof h.default_user.image=="undefined"||h.default_user_image==null)?"":h.default_user.image;if(g==null||g==""){g="/static/images/public/defaults/user.jpg"}f.unshift({image:decodeURIComponent(g.unescapeHTML()),display_name:decodeURIComponent(h.default_user.display_name.unescapeHTML()),userid:h.default_user.userid});f.each(function(n){if(typeof n.image=="undefined"||n.image==""||n.image==null){n.image="/static/images/public/defaults/user.jpg"}b+=l.evaluate({image:n.image,display_name:n.display_name,id:n.userid,root:BF_STATIC.image_root})});if(h.p_alias=="true"||(typeof h.default_user!="undefined"&&h.default_user.p_alias=="true")){b+='<li><a href="'+BF_STATIC.web_root+'/signup"><img src="'+BF_STATIC.static_root+'/images/public/icons/new-microsite.png" alt="" width="25" height="25" /><i>Create Another BuzzFeed</i></a></li>'}$("usernav-switch-list").update(b+"</ul>");if(a=="top"){$("usernav-switch-list").show();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}$$(".switch-to-user").each(function(n){n.observe("click",BF_UserSwitcher.swfunction)});$$(".switched-display_name").each(function(n){if(!n.hasClassName("bottom_display_name")){n.update(h.display_name)}});BF_UserSwitcher.apply_visibility()}catch(c){console.error(c)}},hide_switch_list_ui:function(){$("usernav-switch-list").hide()},switchTo:function(h,g){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){if(a.userid==h){$("usernav-switch-list").hide();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}else{$("usernav-switch-list").hide();if($("switch-list-spinner")){$("switch-list-spinner").show()}var c=new BF_Request();c.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch",default_username:a.default_user.username,default_session_key:a.default_user.session_key,switch_id:h},onSuccess:function(k){BF_UserSwitcher._switchTo(k,g)}})}}}}catch(f){console.error(f)}},_switchTo:function(b,f){try{var a={};if(window.location.href.match("/signup")){a={no_reload:true}}bf_login.loggedIn(b,a);f();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}catch(c){console.error(c)}},getSwitchListFor:function(f,c){try{if(!acl.user_can("edit_user_accounts")){return}var a=new BF_Request();a.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list_for",username:f},onSuccess:function(g){BF_UserSwitcher._getSwitchList(g.responseText,c)}})}catch(b){console.error(b)}},getSwitchList:function(k,f,a){try{if(typeof a=="undefined"){a=false}var c=new BF_User();if(c.isLoggedIn()){var b=c.getUserInfo();if(typeof b.default_user!="undefined"){var g=new BF_Request();g.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list",default_username:b.default_user.username,default_session_key:b.default_user.session_key},onSuccess:function(l){BF_UserSwitcher._getSwitchList(l.responseText,k,f,a)},on401:function(){console.warn("Insufficient Permissions")}})}}}catch(h){console.error(h)}},_getSwitchList:function(responseText,callback,cbparam,withSelect){try{if(callback==undefined){return false}var obj=eval("("+responseText+")");if(obj.success=="1"){BF_UserSwitcher.latest_switch_list=obj.switch_list.slice(0);var user_info=(new BF_User()).getUserInfo();u=user_info.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:decodeURIComponent(u.image.unescapeHTML()),userid:u.userid});BF_UserSwitcher.latest_switch_list_loaded=true;callback(obj.switch_list,cbparam,withSelect)}}catch(e){console.error(e)}},show_warning:function(){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(!window.location.pathname.match("/dashboard$")&&typeof a.default_user!="undefined"&&a.default_user.username!=a.username){$$(".switched-display_name").each(function(f){f.update(a.display_name)});$$(".switch-warning").each(function(f){f.show()})}else{$$(".switch-warning").each(function(f){f.hide()})}}}catch(c){console.error(c)}},_getSwitchList:function(responseText,callback,cbparam,withSelect){if(callback==undefined){return false}var obj=eval("("+responseText+")");if(obj.success=="1"){if(typeof obj.switch_list.users!=="undefined"){BF_UserSwitcher.latest_switch_list=obj.switch_list.users.slice(0)}else{BF_UserSwitcher.latest_switch_list=obj.switch_list.slice(0)}var user_info=(new BF_User()).getUserInfo();u=user_info.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:unescape(u.display_name),username:unescape(u.username),userid:unescape(u.userid)});BF_UserSwitcher.latest_switch_list_loaded=true;callback(obj.switch_list,cbparam,withSelect)}},disable_private_fields:function(){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"&&a.default_user.username!=a.username){var f=["user-settings-button"];f.each(function(g){if($(g)){$(g).style.display="none"}})}}}catch(c){console.error(c)}},create_alias_for:function(a,b){if(typeof a.username=="undefined"||typeof a.alias_username=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},b);return}if(!acl.user_can("edit_user_accounts")){return}(new BF_Request()).request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias_for",username:a.username,alias_username:a.alias_username},onSuccess:function(c){BF_UserSwitcher._create_alias(c,b)},onFailure:function(c){BF_UserSwitcher._create_alias(c,b)}})},create_alias:function(c,g){if(typeof c.username=="undefined"||typeof c.display_name=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},g);return}var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){var f=new BF_Request();if(c.self_serve==1){f.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:c.username,display_name:c.display_name,default_username:a.default_user.username,default_session_key:a.default_user.session_key,self_serve:1},onSuccess:function(h){BF_UserSwitcher._create_alias(h,c.username,g)},onFailure:function(h){BF_UserSwitcher._create_alias(h,c.username,g)}})}else{f.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:c.username,display_name:c.display_name,default_username:a.default_user.username,default_session_key:a.default_user.session_key},onSuccess:function(h){BF_UserSwitcher._create_alias(h,g)},onFailure:function(h){BF_UserSwitcher._create_alias(h,g)}})}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Insufficient privileges"})},g)}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"User not logged in"})},g)}},_create_alias:function(r,callback){var obj=eval("("+r.responseText+")");obj.status=r.status;callback(obj)},count_aliases:function(f){var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){var c=new BF_Request();c.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"count_aliases",default_username:a.default_user.username,default_session_key:a.default_user.session_key},onComplete:function(g){BF_UserSwitcher._count_aliases(g,f)}})}}},_count_aliases:function(r,callback){var obj=eval("("+r.responseText+")");obj.status=r.status;callback(obj)}};if(typeof edit_post=="undefined"){BuzzLoader.register(BF_UserSwitcher.init,1)}BF_UserNav=function(){this.init=function(){universal_dom.assign_handler({bucket:"insert_url",handler:user_nav.insert_url});this.update_session();if(typeof report_manager=="undefined"){var inject=document.createElement("script");inject.src=BF_STATIC.static_root+"/js/public/report/report.js?v="+BF_STATIC.version;document.getElementsByTagName("body")[0].appendChild(inject)}if($("nav-signin")){var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();if(!user_info||!user_info.username||user_info.username!=user.getUsernameFromSession()){BF_Request.statsd.increment("logout.bad_user_info");this.signout()}else{try{picks_controller=null;if(typeof(BF_PicksController)!="undefined"){picks_controller=new BF_PicksController();picks_controller.init()}if($("usernav-notifications")&&acl.user_can("general_admin")){$("usernav-notifications").removeClassName("hidden")}}catch(e){console.dir(e)}if(user_info.image&&user_info.image!=null&&user_info.image!="null"){try{$("usernav-image").childElements()[0].src=BF_STATIC.image_root+user_info.image}catch(e){console.error(e)}}if($("usernav-image")){$("usernav-image").show()}if($("usernav-profile")){$("usernav-profile").show()}universal_dom.get_bucket_elements("usernav-profile-link").invoke("setAttribute","href",BF_STATIC.web_root+"/"+user_info.username);$("usernav-signout").observe("click",function(e){e.stop();BF_Request.statsd.increment("logout.button");if(!!window.facebook){facebook.logout(user_nav.signout)}else{this.signout()}}.bindAsEventListener(this));if($("usernav-signout")){$("usernav-signout").show()}if($("usernav-settings")){$("usernav-settings").show()}if($("usernav-sites")){$("usernav-sites").show()}if($("guide_promo")){$("guide_promo").show()}if(typeof user_info.default_user!="undefined"){if($("usernav-switch")){$("usernav-switch").show()}$$("#usernav-switch-link").each(function(el){$(el).stopObserving("click");$(el).observe("click",function(e){BF_UserSwitcher.switch_list_ui(e)})});BF_UserSwitcher.show_warning();BF_UserSwitcher.disable_private_fields();var on_my_page=new RegExp("/"+user.getUserInfo().username+"#?$");if($("site-blank-slate")&&window.location.href.match(on_my_page)){$("site-blank-slate").show()}}else{$("usernav-switch").hide()}if(user_info.p_dashboard=="true"){if($("usernav-dashboard")){$("usernav-dashboard").removeClassName("hidden")}}else{if($("usernav-dashboard")){$("usernav-dashboard").addClassName("hidden")}}}}else{if($("usernav-signin")){$("usernav-signin").show()}if($("usernav-signup")){$("usernav-signup").show()}if($("usernav-settings")){$("usernav-settings").hide()}if($("signup_promo")){$("signup_promo").show()}}if($("usernav-ul")){$("usernav-ul").show()}}if($("signup_promo-profile_page")&&user.isLoggedIn()){var user=new BF_User();var user_info=user.getUserInfo();if(!user_info||!user_info.username||user_info.username!=user.getUsernameFromSession()){BF_Request.statsd.increment("logout.bad_user_info");this.signout()}else{var obj=$("signup_promo-profile_page");obj.href="/"+user_info.username}}};this.update_session=function(){var REFRESH_LOGIN_AFTER_N_SECONDS=6*60*60;var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();var loginCookieVersion=user_info.login_cookie_version||0;var currentCookieVersion=BF_STATIC.login_cookie_version||loginCookieVersion;if(loginCookieVersion!=currentCookieVersion){if(!BFW_Util.getCookie("session_reload_count")){BFW_Util.setCookie({name:"session_reload_count",value:1,seconds:60});new Ajax.Request("/buzzfeed/_user_session_update",{method:"get",parameters:{action:"update"},onSuccess:function(r){bf_login.loggedIn(r,{no_reload:true})},onFailure:bf_login.err})}}else{var cookie_age_in_seconds=parseInt((new Date()).getTime()/1000-(new BF_User()).getUserInfo().last_active);if(cookie_age_in_seconds>REFRESH_LOGIN_AFTER_N_SECONDS&&!(BFW_Util.getCookie("session_reload_count"))){BFW_Util.setCookie({name:"session_reload_count",value:1,seconds:60});new Ajax.Request("/buzzfeed/_user_session_update",{method:"get",parameters:{action:"update"},onSuccess:function(r){bf_login.loggedIn(r,{no_reload:true})},onFailure:bf_login.err})}}}};this.update_message_count=function(force_update){var UPDATE_MSG_COUNT_EVERY_N_MINUTES=240;var user_info=(new BF_User()).getUserInfo();var now=(new Date()).getTime();var lastUpdated=user_info.msg_count_updated;if(!lastUpdated){lastUpdated=now-(1000*60*UPDATE_MSG_COUNT_EVERY_N_MINUTES);BFW_Util.updateInfoCookie({msg_count_updated:lastUpdated})}var update_msg_count=function(){var msg_count=(new BF_User()).getUserInfo().msg_count;universal_dom.get_bucket_elements("new_msg_count").each(function(el){el.update(msg_count);if(msg_count==0){if(el.hasClassName("new-messages-top")){el.addClassName("hidden")}el.addClassName("greyed")}else{if(el.hasClassName("new-messages-top")&&acl.user_can("general_admin")){el.removeClassName("hidden")}el.removeClassName("greyed")}})};var update_counter=function(r){var obj=eval("("+r.responseText+")");if(obj.success==1){BFW_Util.updateInfoCookie({msg_count_updated:(new Date()).getTime(),msg_count:obj.count})}update_msg_count()};if(force_update||now-parseInt(lastUpdated)>=1000*60*UPDATE_MSG_COUNT_EVERY_N_MINUTES){(new BF_Request()).request("/buzzfeed/_messages",{method:"get",parameters:{action:"get_message_count"},onSuccess:update_counter,onFailure:function(){}})}else{update_msg_count()}};this.signout=function(args){if(typeof args=="undefined"){args={}}user_nav.logging_out_cnt=0;user_nav.logging_out();var lo=function(){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER);BFW_Util.deleteCookie("extensive_user_data");if(typeof(gpai)!=undefined&&typeof(gapi.auth)!=undefined){gapi.auth.signOut()}try{if(typeof gtrack=="object"){gtrack.loggedInStatus()}}catch(err){console.error(e)}if(!args.no_reload&&!window.location.href.match(/\/settings/)){BF_Request.location({reload_track:true})}else{if(window.location.href.match(/\/settings/)){window.location.href=BF_STATIC.web_root+"/signin"}}};setTimeout(lo,500)};this.logging_out=function(){if(user_nav.logging_out_cnt<5){user_nav.logging_out_cnt++}else{user_nav.logging_out_cnt=0}var periods="";for(i=0;i<user_nav.logging_out_cnt;i++){periods+="."}setTimeout(function(){user_nav.logging_out()},300)};this.populate_data=function(fields,opts){var data=BFW_Util.getCookie("extensive_user_data");if(!data){var params={method:"get",parameters:{action:"settings"},onSuccess:function(r){BFW_Util.setCookie({name:"extensive_user_data",value:r.responseText,seconds:0});user_nav._populate_data(fields,opts)},while_processing:{}};if(opts.spinner){params.while_processing.show=opts.spinner}if(opts.hide){params.while_processing.hide=opts.hide}new Ajax.Request("/buzzfeed/_admin_user",params)}else{user_nav._populate_data(fields,opts)}};this._populate_data=function(fields,opts){var data=BFW_Util.getCookie("extensive_user_data");var obj=eval("("+data+")");fields.each(function(field){if(field=="email"&&!obj.user.email){if(typeof facebook!="undefined"&&typeof facebook.user_data!="undefined"&&facebook.user_data.email){obj.user.email=facebook.user_data.email}}universal_dom.get_bucket_elements("populate-"+field).each(function(el){if(el.tagName.toLowerCase()=="input"){el.value=obj.user[field]||""}})});if(opts.callback){opts.callback()}};this.insert_url=function(obj,data){for(x in data){try{d=data[x];if(d.url&&d.where){var regex=new RegExp(d.where);var text=obj.innerHTML;text=text.replace(regex,'<a href="'+d.url+'">$1</a>');obj.update(text)}}catch(e){console.dir({e:e})}}}};var user_nav=new BF_UserNav();BuzzLoader.register(function(){user_nav.init()},1);var bf_event_handler=function(){this.CLASS=".behavior";this.ACTION_ATTRIBUTE="rel:actions";this.DATA_ATTRIBUTE="rel:data";this.HANDLERS={call:function(e,data){var fn=eval(data.fn);fn(data.data?data.data:data)},vote:function(e,data){badge_vote_manager.flow_vote(e,data)},share_email:function(e,data){var target,targetEl=e.toElement?e.toElement:(e.relatedTarget||e.target);target=targetEl.findParent(".shareBtn");if(!target){target=targetEl}shareEmail.locate_form_and_share_email(target,data.buzz_id,data.no_scroll)},register:function(e,data){var user=new BF_User();if(user.isLoggedIn()&&!(data.create_advertiser_account||data.create_contributor_account)){bf_register.register_alias(data)}else{bf_register.new_register(data)}},map_into:function(e,data){var target=e.target;var update_el=$(data.target);var value=target.value;if(data.value){value=data.value(target)}if(update_el){var json=eval("("+update_el.getAttribute("rel:data")+")");var field=data.field.split(".");var obj=json;var end_field=field.pop();while(field.length){var f=field.shift();if(typeof obj[f]!="undefined"){obj=obj[f]}else{obj[f]={}}}if(data.append){obj[end_field]=(typeof obj[end_field]=="undefined"?"":obj[end_field]+data.append)+value}else{obj[end_field]=value}update_el.setAttribute("rel:data",Object.toJSON(json));if(data.hide&&$(data.hide)){$(data.hide).hide()}}},clear_default_field:function(e,data){var target=e.target;var remove_class=(typeof data!="undefined"&&typeof data.remove_class!="undefined")?data.remove_class:"initial-field-state";var set_value=(typeof data!="undefined"&&typeof data.set_value!="undefined")?data.set_value:"";var default_value=target.getAttribute("defaultValue")||"";if(default_value.length==0){target.setAttribute("defaultValue",target.value)}if(target.className.match(new RegExp(remove_class))){target.removeClassName(remove_class);target.value=set_value;if(typeof data!="undefined"&&data.set_type){try{target.setAttribute("type",data.set_type)}catch(e){var new_field=target.cloneNode(true);if(!isIE8()){new_field.setAttribute("type",data.set_type)}target.parentNode.replaceChild(new_field,target)}}}},restore_default_field:function(ev){var el=ev.target;if(el.value.length>0){return}el.type="text";el.value=el.getAttribute("defaultValue");el.addClassName("initial-field-state")},filter_chars:function(e,data){if(e.keyCode==37||e.keyCode==39){return}var regex=data.disallow;var target=e.target;var newValue=target.value.replace(regex,"");if(target.value!=newValue){target.value=newValue}},upload_image:function(e,data){this.upload_image_type=data.upload_image_type;BF_UI.showDialog("user-image-edit");event_handler.get_image_settings=function(){return data};$("user-image-edit-iframe").innerHTML="";var user_image=new BF_SETTINGS_CROPPER({container:$("user-image-edit-iframe"),controller:"/bfcgi/_edit_user_image",origin:data.iframe_src.match("action=(.*)_imageform")[1],callbacks:{save_image_callback:data.save_image_callback}})},show:function(e,data){if($(data.id)){$(data.id).removeClassName("hidden")}},hide:function(e,data){if($(data.id)){$(data.id).addClassName("hidden")}}};this.init_called=0;this.generic_handler=function(e){event_handler._event_handler(e)};this.init=function(){if(++event_handler.init_called>1){console.error("event_handler.init should not be called explicitly; use universal_dom.update(element) instead: "+console.trace())}else{universal_dom.assign_handler({bucket:"event_handler",handler:event_handler._assign_handlers})}};this._assign_handlers=function(el){var ACTION=0;var HANDLER=1;var actions=el.getAttribute(event_handler.ACTION_ATTRIBUTE);if(actions){var action_list=actions.split(" ");action_list.each(function(action){var pieces=action.split(":");el.stopObserving(pieces[ACTION],event_handler.generic_handler);el.observe(pieces[ACTION],event_handler.generic_handler)})}};this._event_handler=function(e){e.stop();var ACTION=0,HANDLER=1,event_type=e.type,ActAtt=event_handler.ACTION_ATTRIBUTE,target;if(e.target.hasAttribute(ActAtt)){target=e.target}else{e.target.ancestors().each(function(el){if(el.hasAttribute(ActAtt)){target=el}});if(!target){return}}var actions=target.getAttribute(ActAtt),action_list=actions.split(" ");action_list.each(function(action){var pieces=action.split(":");if(pieces[ACTION]==event_type){target.handler=pieces[HANDLER]}});if(typeof target.handler!="undefined"){var data={};var json=target.getAttribute(event_handler.DATA_ATTRIBUTE);if(json){data=eval("("+json+")")}data=typeof data[target.handler]!="undefined"?data[target.handler]:data;if(typeof event_handler.HANDLERS[target.handler]!="undefined"){var fn=event_handler.HANDLERS[target.handler];if(fn){fn(e,data)}}else{var fn=eval(target.handler);data.event=e;fn(data)}}}};var event_handler=new bf_event_handler();BuzzLoader.register(event_handler.init,1);var Facebook=function(){this.login_ok=false;this.FB_KEYWORDS_CONTROLLER="/buzzfeed/_facebook";this.fb_ad_kw_terms={};this.FACEBOOK_KW_SUGGESTION=new Template(" 		<li><a href=\"javascript:;\" onclick=\"facebook.updateKeywords('#{id}','#{keyword}',false);facebook.close_kw_dialog('#{id}');return false;\">#{keyword}</a></li> 	");this.FACEBOOK_KW_ITEM=new Template('		<li id="#{dom_id}">#{keyword} <a href="javascript:;" class="close" onclick="facebook.removeKeyword(\'#{id}\',\'#{dom_id}\', \'#{keyword}\');return false;">x</a> 	');this.FACEBOOK_BUZZ_AD=new Template(' 		<input type="hidden" name="image_file" value="http://s-ak.buzzfed.com/#{image}" /> 		<input type="hidden" name="buzz_id" value="#{campaignid}" /> 		<input type="hidden" name="interests-#{unique_id}" value="" /> 		<p class="error-message" id="error-message-#{unique_id}" style="display:none;"></p> 		<div class="c"> 			<div class="photo"><img src="http://s-ak.buzzfed.com/#{image}" /></div> 			<div class="info"> 				<fieldset> 					<input maxlength="35" type="text" name="title" value="#{name}" onkeyup="facebook.updateMaxLength(\'#{unique_id}\', \'title\', this.value);" /> 					<p class="note maxlength" id="keylength-title-#{unique_id}">25 characters</p> 				</fieldset> 				<fieldset> 					<textarea name="body" rows="2" onkeyup="facebook.updateMaxLength(\'#{unique_id}\', \'blurb\', this.value);">#{blurb}</textarea> 					<p class="note maxlength" id="keylength-blurb-#{unique_id}">25 characters</p> 				</fieldset> 				<fieldset><input type="text" name="link_url" value="#{link}" /></fieldset> 			</div> 			<div class="interests"> 				<div class="interest_field"> 					<label>Interests</label> 					<input class="keyword" onkeyup="facebook.updateKeywords(\'#{unique_id}\',this.value,true)" type="text" id="kw-#{unique_id}" /> 					<input id="search-#{unique_id}" onclick="var kw_val = $(\'kw-#{unique_id}\').value; if (kw_val && kw_val.strip() != \'\') {facebook.lookup_keywords(this.parentNode,$(\'kw-#{unique_id}\').value, \'#{unique_id}\');}" type="button" value="+" /> 					<img id="lookup-loading-#{unique_id}" style="display:none;" src="#{static_root}/images/public/spinners/small_on_white.gif" /> 					<p style="display:none;" id="users-reach-#{unique_id}">Keyword Reach: <span id="users-#{unique_id}">&hellip;</span></p> 				</div> 				<div style="display: none;" id="keywords-#{unique_id}" onmouseover="clearTimeout(this.hide_timeout);" onmouseout="facebook.keyword_suggest_mouseout(\'#{unique_id}\');" class="keywords_list"></div> 				<ul class="keywords" id="terms-#{unique_id}"></ul> 			</div> 		</div> 		<div class="reach" id="post-reach-#{unique_id}" style="display:none;"><strong>Estimated Reach:</strong> <span id="post-#{unique_id}">&hellip;</span></div> 		<a class="abs remove" title="Remove this Post" onclick="facebook.remove_ad_unit(\'#{uri}\'); return false;" href="javascript:;"></a> 	');this.SIGNIN_FOR_EXTRA_FEATURES=new Template('<div class="facebook-like-login-pane"> 		<h3>Add Your Reactions to BuzzFeed!</h3> 		<fb:login-button scope="publish_stream,email" length="long" autologoutlink="false"></fb:login-button> 		<a href="javascript:;" onclick="return false" class="bf_dom no-thanks" rel:bf_bucket="event_handler" rel:actions="click:facebook.squelch_extra_features_prompt">No Thanks</a> 		<a href="javascript:;" onclick="return false" class="bf_dom have-account" rel:bf_bucket="event_handler" rel:actions="click:facebook.show_signin_tab" rel:data="{buzz_id:#{buzz_id}}">More Sign In Options</a>	</div>');this.social_element_key="facebook";this.auto_register_enabled=true;this.auto_register_enabled=true;this.link_accounts_enabled=false;this.cache={};this.liked_hrefs=[];this.unliked_hrefs=[];this.cancel_dialog=false;this.apiInit=false;this.languages={en:"en_US",es:"es_LA",zh:"zh_CN"};this.quiz_result=function(obj){if(facebook.is_logged_in()&&facebook.has_perms("publish_stream")){facebook.publish_quiz_result(obj)}else{bf_login.loggedInCallbacks.push(function(){facebook.publish_quiz_result(obj)});facebook.FB_login("publish_stream")}};this.quickpost=function(obj){if(obj.draft){return}var fb_post=$("facebook_post_contribution_checkbox");if(fb_post&&fb_post.checked){if(facebook.is_logged_in()&&facebook.has_perms("publish_stream")){facebook.publish_quickpost(obj)}else{bf_login.loggedInCallbacks.push(function(){facebook.publish_quickpost(obj)});facebook.FB_login("publish_stream")}}};this.contribute=function(obj){var post_checkbox=$("facebook_post_contribution_checkbox");if(post_checkbox&&post_checkbox.checked==false){return}if(facebook.is_logged_in()){facebook.publish_contribution(obj)}};this.publish_quiz_result=function(obj){FB.ui({method:"stream.publish",message:"I got "+unescape(obj.result),attachment:{name:"took the "+unescape(obj.quiz_name)+" quiz on BuzzFeed and got "+unescape(obj.result),caption:"",description:(obj.quiz_description),href:obj.uri},action_links:[{text:"Take The Quiz!",href:obj.uri}],user_prompt_message:"What's on your mind"},function(response){if(response&&response.post_id){}else{}})};this._get_quickpost_base_data=function(obj){if(!obj.thumb&&obj.image_src){obj.thumb=obj.image_src}if(obj.thumb){if(!obj.thumb.match(/http:\/\//)){obj.thumb=obj.image_src}obj.images=new Array({src:obj.thumb,href:"http://buzzfeed.com/"+obj.username+"/"+obj.uri});obj.images.each(function(el){el.src=el.src.replace("http://dev.buzzfeed.com","http://facebook-dev.buzzfeed.com:8080");el.type="image"})}var base_data={message:"just posted "+obj.title+" to BuzzFeed!",attachment:{name:obj.title,caption:obj.text,media:obj.images,href:"http://buzzfeed.com/"+obj.username+"/"+obj.uri},action_links:[{text:"Respond",href:"http://buzzfeed.com/"+obj.username+"/"+obj.uri}]};return base_data};this.publish_quickpost=function(obj){if(obj.draft){return}var base_data=facebook._get_quickpost_base_data(obj);base_data.method="stream.publish";base_data.user_prompt_message="(Promote Your Post)";FB.ui(base_data,function(response){if(response&&response.post_id){}else{}})};this._publish_to_fan_page=function(data){var obj={};for(var each in data){obj[each]=data[each]}delete obj.action_links;obj.attachment=FB.JSON.stringify(obj.attachment);obj.uid=facebook.cache.user_page_id;obj.action="like_publish";if(!obj.uid){facebook.cache_data=obj;facebook._get_user_page_id()}else{facebook.request("/buzzfeed/_facebook",{method:"get",parameters:obj,onComplete:function(){}})}};this.publish_to_stream=function(args,callback){var publish=function(args,callback){FB.api("/me/feed","post",args,function(response){if(callback&&typeof callback=="function"){callback()}if(!response||response.error){}else{}})};if(facebook.is_logged_in()&&facebook.has_perms("publish_stream")){publish(args,callback)}else{bf_login.loggedInCallbacks.push(function(){publish(args,callback)});facebook.FB_login("email,publish_stream")}};this._get_user_page_id=function(){var user_info=(new BF_User()).getUserInfo();var url="http://www.buzzfeed.com/"+user_info.username;facebook.user_page_id_handler=function(result){var obj=eval(result);if(typeof obj!="undefined"&&obj.length>0){facebook.cache.user_page_id=(obj.shift()).id;facebook._publish_to_fan_page(facebook.cache_data)}else{}};facebook.request("https://api.facebook.com/method/fql.query",{inject:true,method:"get",parameters:{query:"SELECT id FROM object_url WHERE url='"+url+"'",format:"JSON",callback:"facebook.user_page_id_handler"}})};this.publish_contribution=function(obj){var user_info=(new BF_User()).getUserInfo();var username=user_info.username;if(obj.image_src){if(!obj.image_src.match(/http:\/\//)){obj.image_src=obj.image_src}obj.images=new Array({src:obj.image_src,href:obj.username?"http://buzzfeed.com/"+username+"/"+obj.uri:"http://buzzfeed.com/"+obj.uri});obj.images.each(function(el){el.src=el.src.replace("http://dev.buzzfeed.com","http://facebook-dev.buzzfeed.com:8080");el.type="image"})}FB.ui({method:"stream.publish",message:obj.text,attachment:{name:obj.parent_title,caption:"",description:(obj.parent_blurb),media:obj.images,href:"http://www.buzzfeed.com/"+obj.buzz_username+"/"+obj.buzz_uri+"?comment="+obj.id},action_links:[{text:"Respond",href:"http://www.buzzfeed.com/"+obj.buzz_username+"/"+obj.buzz_uri+"?comment="+obj.id}],user_prompt_message:""},function(response){if(response&&response.post_id){}else{}})};this.has_liked=function(href){var liked=facebook.liked_hrefs.indexOf(href);if(liked!=-1){return true}facebook.liked_hrefs.push(href);return false};this.has_unliked=function(href){var unliked=facebook.unliked_hrefs.indexOf(href);if(unliked!=-1){return true}facebook.unliked_hrefs.push(href);return false};this.liked_something=function(href,widget){if(!facebook.has_liked(href)){var where=typeof widget.dom!="undefined"?facebook.gtrack_name(widget.dom):gtrack.tt_page;var user=new BF_User();var buzz_id=typeof widget.dom!="undefined"?widget.dom.getAttribute("rel:buzz_id"):widget.getAttribute("rel:buzz_id");var like_type=typeof widget.dom!="undefined"?widget.dom.getAttribute("rel:fb_like"):widget.getAttribute("rel:fb_like");var uri=typeof widget.dom!="undefined"?widget.dom.getAttribute("href"):(widget.getAttribute("href")?widget.getAttribute("href"):widget.getAttribute("data-href"));var idx=uri.lastIndexOf("/",uri.lastIndexOf("/")-1);var what=like_type!=null?"follow/facebook/like":"share/facebook/like";uri=uri.substring(idx);(new BF_Targetting_Pixel()).add("facebook");facebook._track(where,what);if(user.isLoggedIn()){if(buzz_id){badge_vote_manager.simple_love_vote(uri,buzz_id)}}}if(typeof requestLike!="undefined"){requestLike.sayThankYou()}if(href=="http://www.facebook.com/buzzfeed"){localStorage.setItem("fb_like_fbbuzzfeed",1)}};this.unliked_something=function(href,widget){if(!facebook.has_unliked(href)){var where=typeof widget.dom!="undefined"?facebook.gtrack_name(widget.dom):gtrack.tt_page;var like_type=typeof widget.dom!="undefined"?widget.dom.getAttribute("rel:fb_like"):widget.getAttribute("rel:fb_like");var what=like_type!=null?"follow/facebook/unlike":"share/facebook/unlike";facebook._track(where,what)}};this.comment=function(response){var cat=gtrack.tt_page+":contribute/facebook";facebook._track(cat,"share/facebook/comment","")};this.track_like_ab_test=function(el,a){if(!a||a==""){a="click"}try{var gtrack_id=el.getAttribute("rel:gtrack_id");if(gtrack_id){var ab_el=$(el).ancestors().reject(function(n){return(!n.getAttribute("rel:bf_bucket")||n.getAttribute("rel:bf_bucket")!="gtrack")}).first();if(ab_el){var unit=ab_el.getAttribute("rel:unit"),clses=ab_el.getAttribute("rel:classes").split(" "),cls="";for(var i=0;i<clses.length;i++){var cn=clses[i].replace(/(\(\d+\))/m,"");if(ab_el.hasClassName(cn)){cls=cn}}}}}catch(e){}};this.gtrack_name=function(el){try{var a,b;while(el!=document){b=$(el).readAttribute("rel:bf_bucket");if(b&&b.match(/gtrack/)){a=$(el).readAttribute("rel:gt_cat");if(a&&a!=""){return a}}el=$(el).parentNode}return null}catch(e){return null}},this._track=function(where,action){var cat=where?where:gtrack.tt_page;var action=action?action:"share/facebook";if(action.match("like")){gtrack.trackShares(20,"numSharesFacebook")}gtrack.track_events(cat,action,"")};this.squelch_extra_features_prompt=function(){createCookie("squelch_fb_features_prompt","true",30);facebook.squelch_extra_features_promo=true};this.show_signin_tab=function(args){var el=$("tab1-signin_special-"+args.buzz_id);if(el){el.addClassName("hidden")}el=$("tab2-signin_special-"+args.buzz_id);if(el){el.removeClassName("hidden")}$("login-submit").value="Sign In";$("register-submit").value="Register";if($("preview-again-from-registration")){$("preview-again-from-registration").hide()}if($("preview-again-from-login")){$("preview-again-from-login").hide()}bf_login.args={action:"fb_like"};var reg=new BF_Register();reg.register_handler(false,{action:"fb_like"});reg.fb_register_handler(false,{action:"fb_like"});$("registration-div").show();el.parentNode.appendChild($("registered-success").cloneNode(true))};this.signin_for_extra_features_box=function(args){if(facebook.squelch_extra_features_promo){return}var id="signin_special-"+(args.buzz_id||(new Date()).getTime());var uri=args.uri||"/";var el=args.append_to||document.getElementsByTagName("BODY")[0];if($(id)){var obj=$(id);$(id).parentNode.removeChild($(id));el.appendChild(obj);obj.removeClassName("hidden");tab1.removeClassName("hidden");tab2.addClassName("hidden")}else{var div=document.createElement("div");div.id=id;div.addClassName("signin_special");var tab1=document.createElement("div");tab1.id="tab1-"+id;var tab2=document.createElement("div");tab2.id="tab2-"+id;tab1.removeClassName("hidden");tab2.addClassName("hidden");div.appendChild(tab1);div.appendChild(tab2);tab1.innerHTML=facebook.SIGNIN_FOR_EXTRA_FEATURES.evaluate({buzz_id:args.buzz_id});var registration_div=$("registration-div");if(registration_div){registration_div.parentNode.removeChild(registration_div);tab2.appendChild(registration_div)}el.appendChild(div);FB.XFBML.parse(el);universal_dom.update(el);if(args.buzz_id){bf_login.loggedInCallbacks.push(function(){try{$(id).addClassName("hidden")}catch(e){}badge_vote_manager.simple_love_vote(uri,args.buzz_id)})}}};this.load_friends=function(){if(facebook.access_token){if($("not-logged-in")){$("not-logged-in").addClassName("hidden")}facebook.request("https://graph.facebook.com/me/friends",{inject:true,method:"get",parameters:{access_token:facebook.access_token,callback:"facebook._load_friends",format:"JSON"}})}else{if($("not-logged-in")){$("not-logged-in").removeClassName("hidden")}}};this._load_friends=function(r){var fb_friend_ids=[];r.data.each(function(obj){fb_friend_ids.push(obj.id)});facebook.request("/buzzfeed/_facebook",{method:"post",parameters:{action:"follow_page",friends:fb_friend_ids.join(",")},onSuccess:facebook._load_friends_ok})};this._load_friends_ok=function(r){$("content").update(r.responseText)};this.keyword_suggest_mouseout=function(id){var el=$("keywords-"+id);clearTimeout(el.hide_timeout);el.hide_timeout=setTimeout(function(){el.hide()},500)};this.removeKeyword=function(id,d_id,value){var el=$(d_id);if(el){var pos=facebook.fb_ad_kw_terms[id].indexOf(value);if(pos>=0){facebook.fb_ad_kw_terms[id].splice(pos,1)}el.remove();facebook.updateKeywordStats(id,facebook.fb_ad_kw_terms[id],true)}};this.updateKeywords=function(id,value,delayed){if(facebook.keyword_update_ps){window.clearTimeout(facebook.keyword_update_ps)}var timeout=50;if(delayed){timeout=1000}facebook.keyword_update_ps=window.setTimeout(function(){if(!delayed){var arr=facebook.fb_ad_kw_terms[id]||[];if(value&&value!=""){arr.push(value)}facebook.updateKeywordStats(id,arr,true);facebook.fb_ad_kw_terms[id]=arr;var k=value.replace(" ","_"),kw_id="keyword_"+id+"_"+k;$("terms-"+id).innerHTML+=facebook.FACEBOOK_KW_ITEM.evaluate({id:id,dom_id:kw_id,keyword:value});$("kw-"+id).value=""}else{if(value&&value.strip()!=""){facebook.updateKeywordStats(id,[value])}}}.bind(id,value),timeout)};this.updateKeywordStats=function(id,arr,global){if(arr.length==0){$(global?("post-reach-"+id):("users-reach-"+id)).hide();return false}if(global){var reach=$("post-"+id);$("post-reach-"+id).show()}else{var reach=$("users-"+id);$("users-reach-"+id).show()}reach.update("Calculating&hellip;");facebook.request(facebook.FB_KEYWORDS_CONTROLLER,{method:"get",parameters:{action:"targeting_stats",keywords:arr},onSuccess:function(r){var obj=eval("("+r.responseText+")");if(obj.stats.users){var str_users=new String(obj.stats.users);reach.innerHTML=facebook.add_commas(str_users)+" "+(obj.stats.users==1?"person":"people")}else{reach.innerHTML="Server too slow..."}},onFailure:function(){reach.innerHTML="Server too slow&hellip;"}})};this.add_commas=function(users){var regex=new RegExp("^([0-9]*)([0-9]{3,})(,?[0-9,?]*)$");while(users.match(regex)){users=users.replace(regex,"$1,$2$3")}if(users.substring(0,1)==","){users=users.substring(1)}return users};this.lookup_keywords=function(el,query_string,input_id){$("search-"+input_id).hide();$("lookup-loading-"+input_id).show();if(query_string.strip().length>0){facebook.request(facebook.FB_KEYWORDS_CONTROLLER,{method:"get",parameters:{action:"autocomplete_interests",query_string:query_string},onSuccess:function(r){facebook._lookup_keywords(r,el,input_id,query_string)},onFailure:function(){alert("Sorry, but an error has occurred. Please try again.");$("search-"+input_id).show();$("lookup-loading-"+input_id).hide()}})}};this._lookup_keywords=function(r,el,input_id,keyword){$("lookup-loading-"+input_id).hide();$("search-"+input_id).show();var obj=eval("("+r.responseText+")");if(obj.keywords.length>0){var html="";if(obj.keywords.indexOf(keyword)==-1){obj.keywords.unshift(keyword)}obj.keywords.each(function(kw){html+=facebook.FACEBOOK_KW_SUGGESTION.evaluate({keyword:kw,id:input_id})});var t=($("search-"+input_id).positionedOffset()[1]+$("search-"+input_id).getHeight())+"px";$("keywords-"+input_id).setStyle({top:t}).update("<ul>"+html+"</ul>").show()}else{facebook.updateKeywords(input_id,keyword,false);facebook.close_kw_dialog(input_id)}};this.updateMaxLength=function(input_id,kind,value){var maxlen=(kind=="title"?25:135),len=maxlen-value.length;if($("keylength-"+kind+"-"+input_id)){$("keylength-"+kind+"-"+input_id).update('<span class="'+(len<=5?"warning":"")+'">'+len+"</span> character"+(len==1?"":"s")+" remaining")}};this.close_kw_dialog=function(input_id){if($("keywords-"+input_id)){$("keywords-"+input_id).hide()}$("kw-"+input_id).value="";$("users-reach-"+input_id).hide()};this.remove_ad_unit=function(uri){$(uri).parentNode.removeChild($(uri));if($("buzzes")){var ct=$("buzzes").childElements().length;if(ct>0){if($("username_search_posts_length")){$("username_search_posts_length").update(ct+" post"+(ct!=1?"s":""))}}else{this.new_user_posts_search()}}};this.new_user_posts_search=function(){$("success-message").hide();$("error-message").hide();if($("username_search_posts")){$("username_search_posts").hide()}if($("do-it")){$("do-it").hide()}if($("username_search_box")){$("username_search_box").show()}if($("username_search_input")){$("username_search_input").focus()}};this.create_ad=function(frm){$("success-message").hide();$("error-message").hide();var errs=[];if(!frm.elements.campaign_name||frm.elements.campaign_name.value.strip()==""){errs.push("Please add a campaign name.")}if(!frm.elements.budget_in_dollars||frm.elements.budget_in_dollars.value.strip()==""){errs.push("Please insert a budget amount (USD).")}if($$(".fb_ad").length<1){errs.push("Please include at least one buzz to advertise.")}if(errs.length>0){$("error-message").update("There were a few errors: <ul><li>"+errs.join("</li><li>")+"</li></ul>").show();try{window.scrollTo(0,0)}catch(e){}return false}$("do-it-spinner").show();$("do-it-submit").addClassName("disable");frm.setAttribute("action","/buzzfeed/_facebook");var date_elements=["start","stop"];date_elements.each(function(prefix){var d=new Date();var date=frm.elements[prefix+"_date"].value.split("-");d.setYear(date[2]);d.setMonth(date[0]-1);d.setDate(date[1]);var hour=frm.elements[prefix+"_time"].value;if(hour){hour=hour.split(":");d.setHours(hour[0]);d.setMinutes(hour[1])}frm.elements["time_"+prefix].value=Math.round(d.getTime()/1000)});for(var each in facebook.fb_ad_kw_terms){frm.elements["interests-"+each].value=facebook.fb_ad_kw_terms[each].join(",")}frm.request({timeout:12000,onSuccess:facebook._create_ad,onFailure:function(){$("error-message").update("Unknown error, please try again.").show();try{window.scrollTo(0,0)}catch(e){}$("do-it-spinner").hide();$("do-it-submit").removeClassName("disable")}});return false};this._create_ad=function(r){try{var obj=eval("("+r.responseText+")");if(obj.success==1){var buzz_ads=$$(".fb_ad"),indv_errs=0;for(var i=0;i<obj.ad_groups.length;i++){if(obj.ad_groups[i].updated_adgroups.length==1){buzz_ads[i].remove()}else{indv_errs++;$("error-message-"+i.unique_id).update(obj.ad_groups[i].failed_adgroups[0].errors[0]||"An unknown error occured.").show()}}if(indv_errs==0){facebook.new_user_posts_search()}$("success-message").update("Successfully created Facebook ad campaign "+("however there "+(indv_errs>1?"were problems":"was a problem"))+" with the "+(indv_errs>1?"ads":"ad")+' below.<br /><a href="javascript:;" onclick="facebook.new_user_posts_search(); return false;">Click here</a>to search for more buzzes to advertise.').show()}else{$("error-message").update(obj.message||"An unknown error occurred; please try again later.").show()}}catch(e){$("error-message").update("An unknown error occurred; please try again later.").show()}try{window.scrollTo(0,0)}catch(e){}$("do-it-spinner").hide();$("do-it-submit").removeClassName("disable")};this.get_buzzes=function(users){$("success-message").hide();$("error-message").hide();if(!users||users.strip()==""){$("error-message").update("Please enter a username to search.").show();if($("username_search_input")){$("username_search_input").focus()}return}$("error-message").hide();if($("username_search_loading")){$("username_search_loading").show()}if($("username_search_box")){$("username_search_box").hide()}new Ajax.Request("/buzzfeed/_public_admin",{method:"get",parameters:{action:"recent_buzz",usernames:users},onSuccess:function(r){var buzzes=$("buzzes");buzzes.update("");var obj=eval("("+r.responseText+")");if(obj.buzzes.length>0){if($("do-it")){$("do-it").show()}if($("username_search_posts_length")){$("username_search_posts_length").update(obj.buzzes.length+" post"+(obj.buzzes.length!=1?"s":""))}if($("username_search_posts_query")){$("username_search_posts_query").update(users)}if($("username_search_posts")){$("username_search_posts").show()}}else{if($("do-it")){$("do-it").hide()}if($("error-message")){$("error-message").update("No posts were found for your search. Please try again.").show()}if($("username_search_box")){$("username_search_box").show()}if($("username_search_input")){$("username_search_input").focus()}}var regex=new RegExp("(.*buzzfeed.com/)([^#|?]*)");obj.buzzes.each(function(buzz){buzz.name=buzz.name.replace(/(<([^>]+)>)/ig,"");buzz.blurb=buzz.blurb.replace(/(<([^>]+)>)/ig,"");if(buzz.name.length>24){buzz.name=buzz.name.substring(0,24)}if(buzz.blurb.length>134){buzz.blurb=buzz.blurb.substring(0,134)}buzz.link=buzz.link_buzz?buzz.link_buzz:"http://www.buzzfeed.com/"+buzz.username+"/"+buzz.uri;var parts=buzz.link.match(regex);if(parts){buzz.link=buzz.link.replace(regex,parts[1]+"ht/"+parts[2]+"/HFAA1")}buzz.unique_id=buzz.campaignid;buzz.static_root=BF_STATIC.static_root;var html=facebook.FACEBOOK_BUZZ_AD.evaluate(buzz);var li=document.createElement("li");li.id=buzz.uri;li.unique_id=buzz.unique_id;li.addClassName("fb_ad").addClassName("rel").addClassName("targeting");li.update(html);buzzes.appendChild(li);facebook.updateMaxLength(buzz.campaignid,"title",buzz.name);facebook.updateMaxLength(buzz.campaignid,"blurb",buzz.blurb)});if($("username_search_loading")){$("username_search_loading").hide()}}})};this.init=function(){FB.init({appId:BF_STATIC.fb_app_id,xfbml:false,cookie:true,status:true,oauth:true});FB.getLoginStatus(facebook.handle_session_change);FB.Event.subscribe("auth.authResponseChange",facebook.handle_session_change);FB.Event.subscribe("edge.create",facebook.liked_something);FB.Event.subscribe("edge.remove",facebook.unliked_something);FB.Event.subscribe("comment.create",facebook.comment);FB.Event.subscribe("xfbml.render",facebook.loadedLike);social.observe("contribute",facebook.contribute);social.observe("quickpost",facebook.quickpost);social.observe("quiz_result",facebook.quiz_result);facebook.squelch_extra_features_promo=readCookie("squelch_fb_features_prompt")=="true";if(typeof FB.Content!="undefined"){origPostTarget=FB.Content.postTarget}else{FB.Content={}}facebook.apiInit=true;FB.XFBML.parse(document.body);FB.Content.postTarget=function(opts){opts.params.action_links=FB.JSON.stringify(opts.params.action_links);opts.params.attachment=FB.JSON.stringify(opts.params.attachment);origPostTarget(opts)};universal_dom.assign_handler({bucket:"create_ad",event:"click",handler:function(e){facebook.create_ad(e.target.form)}});universal_dom.assign_handler({bucket:"get_buzzes",event:"click",handler:function(e){facebook.get_buzzes(e.target.form.elements.usernames.value)}});var user=new BF_User();if(window.location.href.match(/boost\/facebook/)){if(!user.isLoggedIn()||user.getUserInfo().p_admin!="true"){window.location.href="/boost"}else{$("page_container").show()}}};this.is_logged_in=function(){return typeof facebook.session!="undefined"};this.logout=function(fn){facebook.logged_out();if(facebook.is_logged_in()){FB.logout(fn)}else{fn()}};this.logged_out=function(){facebook.hide_ui_elements("logged-in");facebook.show_ui_elements("logged-out")};this.logged_in=function(){facebook.show_ui_elements("logged-in");facebook.hide_ui_elements("logged-out");facebook.update_ui_elements();var user=new BF_User();if(!user.isLoggedIn()){facebook.auto_log_into_buzzfeed()}facebook.fire_event("user_logged_in")};this.handle_session_change=function(response,callback){if(response.authResponse){facebook.session=response.authResponse;facebook.access_token=response.authResponse.accessToken;FB.api("/me",function(r){facebook.user_data=r;facebook.logged_in();FB.api("/me/permissions",function(perm_r){facebook.permissions=typeof perm_r.data!="undefined"?perm_r.data["0"]:"";if(typeof callback!="undefined"){try{callback.each(function(fn){fn()})}catch(err){}}})})}else{delete facebook.session;facebook.logged_out()}};this.buzzfeed_login=function(resp){if(resp.authResponse){var session=resp.authResponse;var params={method:"post",parameters:{access_token:session.accessToken,facebook_uid:session.userID,fb_username:facebook.user_data.name},onSuccess:function(r){console.log("Facebook login succeeded");if(document.location.search.match(/fbtest=true/)){return}var obj=eval("("+r.responseText+")");if(signin.social_register){signin.register_settings(obj)}if(obj.login&&obj.login!="false"){if(facebook.tried_to_register){bf_login.loggedIn(r,{no_reload:true});signin.email=facebook.user_data.email}else{bf_login.loggedIn(r)}facebook.block_login=false;if(!obj.facebook_uid){facebook.link_accounts_enabled=true;facebook.link_accounts()}}else{if(obj.requires_oauth==1){window.open("/buzzfeed/oauth_signin?username="+obj.username,"OAuth","width=500,height=500")}else{if(obj.facebook_deleted!=1){if(!facebook.tried_to_register){facebook.auto_register(obj)}}}}},onFailure:function(){}};console.log("Facebook login started");if(facebook.user_data.email){params.parameters.email=facebook.user_data.email}facebook.request("/bfcgi/_www_login?cb="+(new Date()).getTime(),params)}};this.auto_log_into_buzzfeed=function(){if(!facebook.login_ok){return}if(!facebook.is_logged_in()||facebook.block_login){return}facebook.block_login=true;if("session" in facebook){facebook.buzzfeed_login({authResponse:facebook.session})}else{FB.getLoginStatus(function(response){if(response.authResponse){facebook.buzzfeed_login(response)}else{facebook.FB_login("email")}})}};this.FB_login=function(perms){facebook.login_ok=true;var my_perms=perms?perms:"email";FB.login(function(response){if(perms=="user_photos"){fbphotos.load_response(response)}if(signin.signin_page&&!response.authResponse){signin.fb_dialog_cancel()}var storageID="fb_perms_"+my_perms;localStorage.setItem(storageID,new Date());if(typeof response!="undefined"&&response.authResponse!=null){var user=new BF_User();if(user.isLoggedIn()){var info=user.getUserInfo();if(!info.facebook_uid){facebook.link_accounts_enabled=true;facebook.link_accounts(response.authResponse.userID)}facebook.handle_session_change(response,bf_login.loggedInCallbacks)}else{facebook.handle_session_change(response,[facebook.buzzfeed_login])}}},{scope:my_perms})};this.has_perms=function(permission){try{if(facebook.permissions[permission]==1){return true}else{return false}}catch(err){return false}};this.perms_were_asked_recently=function(checkPerms){var storageId="fb_perms_"+checkPerms;if(localStorage.getItem(storageId)===null){return false}else{var last_time=new Date(localStorage.getItem(storageId));var today=new Date();days=Math.round((last_time-today)/(1000*60*60*24));if(days<=5){return true}else{localStorage.removeItem(storageId);return false}}};this.link_accounts=function(fb_uid){if(!facebook.link_accounts_enabled){return}var facebook_uid;if(typeof fb_uid!="undefined"){facebook_uid=fb_uid}else{if(typeof facebook.session!="undefined"){facebook_uid=facebook.session.userID}else{return}}try{new Ajax.Request("/buzzfeed/_edit_user",{method:"get",asynchronous:false,parameters:{action:"link_facebook_account",facebook_uid:facebook.session.userID,onSuccess:function(r){},onFailure:function(r){}}})}catch(e){}};this.__events={};this.observe=function(ev,fn){var listeners=facebook.__events[ev]||[];listeners.push(fn);facebook.__events[ev]=listeners};this.fire_event=function(ev){if(typeof facebook.__events[ev]!="undefined"){facebook.__events[ev].each(function(fn){fn()})}};this.auto_register=function(obj){if(signin.signin_page){signin.social_register=true}if(!facebook.auto_register_enabled){return}var email="get_from_facebook@buzzfeed.com";try{email=facebook.user_data.email}catch(e){}if(typeof email=="undefined"||email.length==0){email="get_from_facebook@buzzfeed.com"}var params={name:obj.username,username:obj.username,pw:obj.password,email:email,contribute:1,allow_email_updates:1,facebook_uid:facebook.session.userID,import_fb_profile:"true",language:BF_STATIC.language||"en"};facebook.request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:function(e){gtrack.track_events("","social/facebook","registered");facebook.block_login=false;facebook.tried_to_register=true;try{var obj=eval("("+e.responseText+")");if(obj.status=="failed"&&obj.message=="duplicate email"){facebook.fire_event("registration:duplicate_email")}}catch(err){console.dir({err:err})}facebook.auto_log_into_buzzfeed()},onFailure:function(e){facebook.block_login=false}})};this.request=function(url,params){if(params.inject){var e=document.createElement("script");e.src=url;e.async=true;if(params.parameters){var list_params=[];for(var p in params.parameters){list_params.push(p+"="+escape(params.parameters[p]))}e.src+="?"+list_params.join("&")}document.getElementById("fb-root").appendChild(e)}else{var ajax=new BF_Request();ajax.request(url,params)}};this._add_fb_root=function(){if(!$("fb-root")){var div=document.createElement("div");div.id="fb-root";document.getElementsByTagName("BODY")[0].appendChild(div)}};this.get_ui_elements=function(type,opts){return social._get_ui_elements(this.social_element_key,type,opts)};this.hide_ui_elements=function(type){this.get_ui_elements(type).each(function(el){el.addClassName("hidden")})};this.show_ui_elements=function(type){this.get_ui_elements(type).each(function(el){el.removeClassName("hidden")})};this.update_ui_elements=function(){this.get_ui_elements("update",{with_data:true}).each(function(el){el.element.update(eval(el.data.value))})};this.ensure_init=function(callback,i){if(!facebook.apiInit&&i<100){i++;setTimeout(function(){facebook.ensure_init(callback)},50)}else{if(i>=100){return false}else{if(callback){callback()}}}}};var facebook=new Facebook();window.fbAsyncInit=facebook.init;if(typeof BuzzLoader!="undefined"){BuzzLoader.register(function(){if(!window.BF_STATIC||!BF_STATIC.bf_test_mode){facebook._add_fb_root();var a="en_US";if(typeof BF_STATIC.language!="undefined"&&typeof countryLangLookup[BF_STATIC.language]!="undefined"){a=countryLangLookup[BF_STATIC.language]}if("FB" in window){FB=null}var b=document.createElement("script");b.src=document.location.protocol+"//connect.facebook.net/"+a+"/all.js";b.async=true;if(!window.BF_STATIC||BF_STATIC.facebook_enabled&&BF_STATIC.facebook_enabled!=false){document.getElementById("fb-root").appendChild(b)}}else{console.info("disable load connect.facebook.net/en_US/all.js for test mode(facebook2.js)")}},2)}document.observe("dom:loaded",function(){$$(".facebook-share-button").each(function(a){$(a).observe("click",function(){gtrack.trackShares(20,"numSharesFacebook")})})});var FBTL=function(){var f;var c={};var b=false;var g;var a="publish_actions,email";this.init=function(){try{universal_dom.assign_handler({bucket:"add_to_timeline",event:"click",handler:fbtl_session.add_to_timeline_handler})}catch(h){console.error(h)}};this.add_to_timeline_handler=function(r){var m=$(r.target.getAttribute("id"));m.addClassName("grey");if(!r.action||!r.sb_id||!$("date-dropdown-"+r.sb_id)){if(BF_STATIC.bf_env!="live"){console.error("action, date or sub_buzz_id missing!")}return}var s=r.action;var n=r.sb_id;var t=$("date-dropdown-"+n).getValue();var l=new Date();l.setFullYear(parseInt(t),0,1);var q=parseInt(l.getTime()/1000);var p=new Date();p.setFullYear(parseInt(t),11,31);var k=parseInt(p.getTime()/1000);var h=typeof sub_links!="undefined"&&typeof r.link_id!="undefined"?sub_links.get_url(r.link_id):document.URL.include("?")?document.URL.split("?")[0]:document.URL;h+=(h.include("?")?"&":"?")+"fbtl="+n;if(BF_STATIC.bf_env!="live"){h=h.replace(/\/\/(stage(\d+)?|dev)\./i,"//www.").replace("/bf2/","/")}var o={start_time:q,end_time:k,product:h,message:"Everyone's talkin' about the good old days..."};g=r.target;badge_vote_manager.reset_sharing_box();fbtl_session.trigger(s,o,true)};this.trigger=function(h,o,n){f=h;c=o;b=typeof n!="undefined"&&n?true:false;var l="fb_perms_"+a;if(document.location.search.match(/fbperms=show/)){var m=localStorage.getItem(l);console.log("localStorage canceled perms: "+l+" --> "+m)}if(document.location.search.match(/fbperms=clear/)){console.log("localStorage cleared: "+l);localStorage.removeItem(l)}if(facebook.is_logged_in()&&facebook.has_perms("publish_actions")){fbtl_session.post()}else{if(!b){if(facebook.perms_were_asked_recently(a)){if(BF_STATIC.bf_env!="live"){console.log("FBTL trigger failed. Canceled perms on "+localStorage.getItem(l))}return}var k=(new BF_User()).getUserInfo();if(typeof k.facebook_uid=="undefined"||!k.facebook_uid||k.facebook_uid==""){return}}bf_login.loggedInCallbacks.push(fbtl_session.post);facebook.FB_login(a)}};this.nameSpace=function(){var h="";if(BF_STATIC.fb_app_id=="45075597673"){h="buzzfeed"}else{if(BF_STATIC.fb_app_id=="212374995460808"){h="buzzfeedstage"}else{if(BF_STATIC.fb_app_id=="54820841344"){h="buzzfeed-dev"}}}return h};this.post=function(){var k="/me/"+fbtl_session.nameSpace()+":"+f;if(BF_STATIC.bf_env!="live"){console.log("POST REQUEST TO FACEBOOK: "+k);console.log(c)}if(typeof c.badge!="undefined"){var h=" '"+c.badge.replace("http://www.buzzfeed.com/badge/","")+"' "}else{h=""}FB.api(k,"post",c,function(l){if(!l||l.error){if(BF_STATIC.bf_env!="live"){console.error("Couldn't post to timeline!!!")}var m=$(g.getAttribute("id"));m.removeClassName("grey")}else{if(b){badge_vote_manager.show_sharing_box(g,"fbtl")}if(BF_STATIC.bf_env!="live"){console.log("Post was successful!: Action ID : "+l.id)}fbtl_session.action_id=l.id;if($("share-reaction-box")){$("share-reaction-content-wrapper").insert({top:'					<div id="sharing-timeline-message">						<div class="success_icon"></div>						Your '+h+' reaction was added to your Timeline.						<a href="javascript:;" id="undo_timeline_action" gt_act="facebook-timeline/undo">undo</a>					</div>'})}if($("undo_timeline_action")){$("undo_timeline_action").observe("click",fbtl_session.delete_action)}}})};this.delete_action=function(){if(typeof fbtl_session.action_id=="undefined"){if(BF_STATIC.bf_env!="live"){console.error("No action to delete")}return}$("undo_timeline_action").update("...");FB.api("/"+fbtl_session.action_id,"delete",function(h){if(typeof h!="undefined"&&h==true){$("undo_timeline_action").update("deleted")}else{if(BF_STATIC.bf_env!="live"){console.error("Something went wrong deleting the action from Facebook.")}}});if(b){$("social-sharing-box").hide()}gtrack.track_events("Buzz:social-share-box","facebook-timeline/undo","")};this.add_message=function(){$("sharing-box-submit").stopObserving("click",fbtl_session.add_message);$("sharing-box-submit").value="Adding";if(typeof fbtl_session.action_id=="undefined"){if(BF_STATIC.bf_env!="live"){console.error("No action id")}return}if($("sharing-message")&&$("sharing-message").value!=""){var h=$("sharing-message").value;FB.api("/"+fbtl_session.action_id,"post",{message:h},function(k){if(typeof k!="undefined"&&k==true){$("sharing-box-submit").value="Added"}else{if(BF_STATIC.bf_env!="live"){console.error("Something went wrong adding the message to Facebook: "+k)}}});gtrack.track_events("Buzz:timeline-box","facebook-timeline/add-message","")}$("sharing-box-submit").value="Added"}};var fbtl_session=new FBTL();BuzzLoader.register(fbtl_session.init,5);var Social=function(){this.quickpost=function(a){};this.contribute=function(a){};this.vote=function(a){};this.quiz_result=function(a){};this._init=function(){var a=new RegExp("^_");for(var b in this){if(typeof this[b]=="function"&&b!="observe"&&!b.match(a)){this["_"+b]=this[b];this[b]=Function("obj","social._"+b+'(obj);social._fire_event("'+b+'",obj);')}}};this.observe=function(c,b){if(typeof this[c]=="function"){var f=typeof this._observers[c]=="undefined"?[]:this._observers[c];var a=true;f.each(function(g){if(b==g){a=false}});if(a){f.push(b);this._observers[c]=f}}};this._fire_event=function(b,a){var c=typeof this._observers[b]=="undefined"?[]:this._observers[b];c.each(function(f){try{f(a)}catch(g){console.warn(g)}})};this._observers={};this._get_ui_elements=function(b,a,c){if(!c){c={}}var f=[];if(typeof universal_dom!="undefined"&&typeof universal_dom._bucket[b+"-"+a]!="undefined"){universal_dom._bucket[b+"-"+a].elements.each(function(g){if(c.with_data){f.push(g)}else{f.push(g.element)}})}return f}};var social;if(typeof BuzzLoader!="undefined"){BuzzLoader.register(function(){social=new Social();social._init()},1)}bf_badge_vote_manager=function(){this.VOTE_CONTROLLER="/buzzfeed/_badge_vote";this.VOTE_DEFINITIONS={badge:{onSuccess:function(r){badge_vote_manager.badgeResponse(r)},onSuccess_flow:function(r,data){badge_vote_manager.flow_badgeResponse(r,data)},parameters:{badge_id:function(t){if(t.className.match(/bf_dom/)){var json=eval("("+t.getAttribute("rel:data")+")");return json.vote.badge_id}else{return t.getAttribute("rel:badge_id")}}},success_template:'<a href="/#{username}"><strong>#{display_name}</strong></a> '+local.t('thinks #{title} is <a class="badgeword">#{badge}</a>')+'. <span class="ago">'+local.t("just now")+"</span>"},love_or_hate:{onSuccess:function(r){badge_vote_manager.loveHateResponse(r)},onSuccess_flow:function(r,data){badge_vote_manager.flow_loveHateResponse(r,data)},parameters:{value:function(t){if(t.className.match(/bf_dom/)){var json=eval("("+t.getAttribute("rel:data")+")");return json.vote.value=="loves"?1:0}else{return t.getAttribute("rel:value")=="loves"?1:0}}},success_template:'<a href="/#{username}"><strong>#{display_name}</strong></a> <span class="feed-#{loves}">&nbsp;</span> #{title}. <span class="ago">'+local.t("just now")+"</span>"}};this.SHARE_TEMPLATE=new Template('    <div class="social-message-share section" style="float:left;width:100%;"> 			<h5 style="margin-bottom:10px;">'+local.t("Share this post and help it go viral")+':</h5>			<div style="float:left;width:60px;margin-right:15px"> 				<a name="fb_share" type="box_count" share_url="http://www.buzzfeed.com/#{buzz_uri}"></a> 			</div> 			<div style="float:left;position:relative;height:55px;width:55px;margin-right:15px">        <a href="http://twitter.com/share" id="tweet-button-#{buzz_id}" class="twitter-share-button" data-count="vertical" data-related="BuzzFeed">Tweet</a> 			</div> 			<div id="div_subadge" style="float:left;width:52px;margin-right:15px"> 			  <iframe src="http://www.stumbleupon.com/badge/embed/5/?url=http%3A//www.buzzfeed.com/#{buzz_uri}" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height: 18px;" allowTransparency="true"></iframe> 			</div> 			<div style="float:left;width:52px;margin-right:15px"> 			  <iframe src="http://digg.com/tools/diggthis.php?u=http%3A//www.buzzfeed.com/#{buzz_uri}&amp;t=#{buzz_name}" frameborder="0" height="80" scrolling="no" width="52"></iframe> 			</div> 			<div style="float:left;width:69px;margin-right:25px"> 			  <iframe scrolling="no" height="70" frameborder="0" width="69" src="http://www.reddit.com/static/button/button2.html?t=3&amp;width=69&amp;url=http%3A%2F%2Fwww.buzzfeed.com%2F#{buzz_uri}"></iframe> 			</div> 		</div> 	');this.SHARE_THE_LOVE_TEMPLATE=new Template('    <div class="social-message-share section">     	<div class="social-message-share-inner"> 	    	<div class="social-message-share-facebook-box"> 					<h5>'+local.t("Share this post and help it go viral")+':</h5> 					<div class="social-message-share-facebook"> 					<fb:like send="true" rel:buzz_id="#{buzz_id}" href="http://www.buzzfeed.com/#{fb_uri}" show_faces="true" width="280"></fb:like> 					</div> 				</div> 				<div class="social-message-share-buttons"> 					<div> 						<a name="fb_share" type="box_count" share_url="http://www.buzzfeed.com/#{fb_uri}"></a> 					</div> 					<div style="float:left;position:relative;height:55px;width:55px" class="preload-twitter-vcount social-message-share-retweet social-message-share-button" rel:share_placement="badged" rel:share_url="http://www.buzzfeed.com/#{fb_uri}"> 					 <a href="http://twitter.com/share" id="tweet-button-#{buzz_id}" class="twitter-share-button" #{via} data-count="vertical" data-related="BuzzFeed">Tweet</a> 					</div> 					<div class="social-message-share-stumble social-message-share-button" id="div_subadge"> 					  <iframe src="http://www.stumbleupon.com/badge/embed/5/?url=http%3A//www.buzzfeed.com/#{fb_uri}" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height: 80px;" allowTransparency="true"></iframe> 					</div> 					<div class="social-message-share-digg social-message-share-button" style="width:52px"> 					  <a class="DiggThisButton DiggMedium" href="http://digg.com/submit?url=http%3A//www.buzzfeed.com/#{fb_uri}&amp;title=#{buzz_name}"></a> 					</div> 					<div class="social-message-share-reddit social-message-share-button"> 					  <iframe scrolling="no" height="70" frameborder="0" width="69" src="http://www.reddit.com/static/button/button2.html?t=3&amp;width=69&amp;url=http%3A%2F%2Fwww.buzzfeed.com%2F#{fb_uri}"></iframe> 					</div> 				</div> 				<div class="clear"></div> 			</div> 		</div> 	');this.initialized=false;this.initialization=false;this.badgeResponse=function(r){var json=eval("("+r.responseText+")");if($("spinner-badge")){$("spinner-badge").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success){BFW_Util.updateInfoCookie({last_active:json.last_active});if(!!window.fb_app){fb_app.badge_vote_success(json)}else{var target=$(json.element_id);var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}Event.stopObserving(target,"click",badge_vote_manager.vote);target.removeAttribute("href");$(target).up("li").addClassName("voted");if($("social-actions")){$("social-actions").fire("set:reaction")}if(json.already_voted){if(BF_STATIC.tt_page!="Video"){return badge_vote_manager._already_voted(json)}}if(BF_STATIC.tt_page!="Video"){badge_vote_manager.show_reaction_share_box(target.getAttribute("rel:badge_name"),target.getAttribute("rel:message"))}var vote_category=target.getAttribute("rel:category");var user=new BF_User();var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[vote_category];var template=vote_definition.success_template;var data={username:user.getUserInfo().username,display_name:user.getUserInfo().display_name,title:unescape(parent.getAttribute("rel:buzz_title")),uri:parent.getAttribute("rel:buzz_uri"),badge:target.getAttribute("rel:badge_name")};if(BF_STATIC.tt_page!="Video"){badge_vote_manager._add_response(template,data,{parent_class:["feed-action","feed-badge"]});badge_vote_manager._hide_social_messages();if(target.getAttribute("rel:message")){$("badge-message").update(unescape(target.getAttribute("rel:message")))}if($("social_message")){$("social_message").show();var stuffs=$("social_message").select("a")[0];if(stuffs){stuffs.setAttribute("target","_none")}}if($("number_of_contribs_header")){$("number_of_contribs_header").show()}this._update_reaction_count(target.getAttribute("rel:badge_id"));if(typeof json.earned_reactions!="undefined"){BFW_Util.updateInfoCookie({earned_reactions:json.earned_reactions})}}gtrack.trackShares(23,("numReactions_"+data.badge.toLowerCase()));gtrack.track_events("[ttp]","react/"+data.badge.toLowerCase(),"");EventManager.fire("badge_vote:success",data.badge)}}else{}};this.loveHateResponse=function(r){var json=eval("("+r.responseText+")");if($("spinner-love_or_hate")){$("spinner-love_or_hate").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success&&json.element_id){BFW_Util.updateInfoCookie({last_active:json.last_active});var target=$(json.element_id);if(target.parentNode.id.match(/(love|hate)_button-\d+/)){$(target.parentNode).show()}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}Event.stopObserving(target,"click",badge_vote_manager.vote);if($("social-actions")){$("social-actions").fire("set:reaction")}target.removeAttribute("href");if(target.parentNode.nodeName=="LI"){$(target.parentNode).addClassName("voted")}else{if(target.parentNode.nodeName=="A"){$(target.parentNode).up().addClassName("voted")}}if(json.already_voted){return badge_vote_manager._already_voted(json)}var user=new BF_User();var vote_category=target.getAttribute("rel:category");var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[vote_category];var template=vote_definition.success_template;var data={display_name:user.getUserInfo().display_name,title:unescape(parent.getAttribute("rel:buzz_title")),uri:parent.getAttribute("rel:buzz_uri"),loves:target.getAttribute("rel:value")};var className=data.loves=="loves"?"feed-love":"feed-hate";badge_vote_manager._hide_social_messages();if(!badge_vote_manager.is_contribution(target)){var reaction=data.loves.match(/love/)?"love":"hate";badge_vote_manager.show_reaction_share_box(reaction);badge_vote_manager._add_response(template,data,{parent_class:["feed-action",className]});if($("number_of_contribs_header")){$("number_of_contribs_header").show()}this._update_reaction_count(reaction)}else{var contribution_message=$("social_message-"+parent.getAttribute("rel:buzz_id"));var vote_feedback=data.loves=="loves"?local.t("Yeah!"):local.t("Awww");contribution_message.update(vote_feedback);contribution_message.show()}}else{}};this._already_voted=function(json){badge_vote_manager._hide_social_messages();if($("share-reaction-box")){$("share-reaction-box").hide()}var target=$(json.element_id);if(badge_vote_manager.is_contribution(target)){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var social_message=$("social_message-"+parent.getAttribute("rel:buzz_id"));if(social_message){social_message.update(local.t("Okay!"));social_message.style.width="100%";social_message.show()}}else{$("social_message-already-voted").show()}};this._add_response=function(template_str,data,args){var items={};for(var each in data){items[each]=data[each].replace(/</g,"&lt;").replace(/>/g,"&gt;")}var template=new Template(template_str);var message=template.evaluate(items);var li=new Element("li",{"class":"feed-action"});if($("contribution-list")){$("contribution-list").insert({top:li})}if(args&&args.parent_class){var classes=args.parent_class;for(var i=0;i<classes.length;i++){li.addClassName(classes[i])}}li.update(message)};this._exceeded_maximum_badge_votes=function(){if(typeof fb_app=="undefined"){var buttons=$$(".vote-badge");for(var i=0;i<buttons.length;i++){Event.stopObserving(buttons[i],"click",badge_vote_manager.vote);buttons[i].observe("click",badge_vote_manager._show_vote_exceeded)}badge_vote_manager._show_vote_exceeded()}else{if($("badge_vote_msg")){$("badge_vote_msg").update("<h4>"+local.t("Sorry")+"</h4>, <p>"+local.t("you can only react up to three times")+'.<p> <a href="javascript:;" onclick="javascript:$(\'badge_vote_msg\').hide()" class="close">&times;</a>')}if(typeof fb_app.error_msg_timeout!="undefined"){clearTimeout(fb_app.error_msg_timeout)}fb_app.error_msg_timeout=setTimeout("Effect.Fade('badge_vote_msg',{'duration':2.0})",3000)}};this._show_vote_exceeded=function(e){if(typeof e!="undefined"){e.stop()}badge_vote_manager._hide_social_messages();if($("social_message-badge-votecount-exceeded")){$("social_message-badge-votecount-exceeded").show()}};this._hide_social_messages=function(){if($("social_message-badge-votecount-exceeded")){$("social_message-badge-votecount-exceeded").hide()}if($("social_message-already-voted")){$("social_message-already-voted").hide()}if($("social_message")){$("social_message").hide()}if($("social_message-loves")){$("social_message-loves").hide()}if($("social_message-hates")){$("social_message-hates").hide()}};this.init=function(){if(badge_vote_manager.initialized){return false}if(badge_vote_manager.initialization){setTimeout(this.init.bind(this,args),300)}badge_vote_manager.initialization=true;try{bf_login.init();this.ajax=new BF_Request();if($("badge_voting")&&BF_STATIC.tt_page!="Video"){var els=$("badge_voting").getElementsByTagName("UL")[0];badge_vote_manager.earned_reactions_buttons(els)}var user=new BF_User();$$(".add-pick").each(function(el){if(user.isLoggedIn()){el.removeClassName("hidden");el.up().removeClassName("hidden")}else{el.addClassName("hidden");el.up().addClassName("hidden")}});var user_info=user.getUserInfo();if(user_info&&typeof user_info.p_disable_reaction!="undefined"&&user_info.p_disable_reaction=="true"){$$("#lovehate_buttons, #badge_voting, .lovehate-buttons").each(function(el){el.style.visibility="hidden"})}else{for(var category in badge_vote_manager.VOTE_DEFINITIONS){var divs=$$(".vote-"+category);for(var i=0;i<divs.length;i++){var div=divs[i];if(div.className.match(/bf_dom/)){continue}div.setAttribute("rel:category",category);if(!div.id){div.id="vote-"+category+"-"+parseInt(Math.random()*10000000)}div.observe("click",badge_vote_manager.vote)}}}if(0){var reaction_camera=bf_react_cam.create();var reaction_camera_post_observer={_params:null,_on_previewFromServerOk:function(evt){console.log("_on_previewFromServerOk");bf_contribute.postit(reaction_camera_post_observer._params)},_on_previewFromServerError:function(evt){console.log("_on_previewFromServerError");reaction_camera_post_observer.stop()},_on_postitComplete:function(evt){console.log("_on_postitComplete");bf_badge_popup.force_close(reaction_camera);bf_badge_popup.set_active(true);reaction_camera_post_observer.stop()},start:function(params){reaction_camera_post_observer._params=params;reaction_camera_post_observer.stop();document.observe("contribute:previewFromServerOk",this._on_previewFromServerOk);document.observe("contribute:previewFromServerError",this._on_previewFromServerError);document.observe("contribute:postitOk",this._on_postitComplete);document.observe("contribute:postitError",this._on_postitComplete)},stop:function(){document.stopObserving("contribute:previewFromServerOk",this._on_previewFromServerOk);document.stopObserving("contribute:previewFromServerError",this._on_previewFromServerError);document.stopObserving("contribute:postitOk",this._on_postitComplete);document.stopObserving("contribute:postitError",this._on_postitComplete)}};reaction_camera.add_listener("enterframe",function(frame){if(frame!=2){return}bf_badge_popup.set_master(reaction_camera)});reaction_camera.add_listener("cnt_down",function(){bf_badge_popup.set_active(false)});reaction_camera.add_listener("record_complete",function(){bf_badge_popup.set_active(true)});reaction_camera.add_listener("save",function(){bf_badge_popup.set_active(false)});reaction_camera.add_listener("save_error",function(){bf_badge_popup.set_active(true)});reaction_camera.add_listener("save_success",function(gif){var params={form:"mixedpic",reactcam:"yes",delete_images:"no",buzz_id:bf_contribute.main_buzz_id,url:gif.image,width:gif.width,height:gif.height};reaction_camera_post_observer.start(params);$("contribute-submit").value="Preview";$("submit-mode").value="save";var preview_params=Object.clone(params);bf_contribute.previewFromServer(preview_params)});bf_badge_popup.register(reaction_camera,$$("body")[0],"click",function(evt){if(evt&&(evt.findElement("#"+reaction_camera.id)||evt.findElement("#react_cam_button"))){return false}reaction_camera.close()});bf_badge_popup.assign(reaction_camera,$("react_cam_button"),"mouseover",function(evt){bf_react_cam.reaction_camera_open(reaction_camera)});document.observe("contribute:goforit_reactcam",function(){bf_badge_popup.force_open(reaction_camera);bf_react_cam.reaction_camera_open(reaction_camera);reaction_camera.jumpto_record()})}var target=$("filter-show_everything");var showSortButtons=$$("#contribution-list .contrib").length>0&&$$("#contribution-list .feed-action").length>0;if(target){target.observe("click",function(e){e.stop();if($("contribution-list")){$("contribution-list").show()}if($("facebook_responses")){$("facebook_responses").hide()}$(e.target.parentNode).addClassName("current");if($("filter-show_facebook")){$("filter-show_facebook").parentNode.removeClassName("current")}})}target=$("filter-show_facebook");if(target){if(showSortButtons){target.show()}target.observe("click",function(e){e.stop();$("contribution-list").hide();$("facebook_responses").show();$(e.target.parentNode).addClassName("current");$($("filter-show_everything").parentNode).removeClassName("current")})}target=$("fb-login-again");if(target){target.observe("click",function(e){e.stop();$("log-into-facebook-again").hide()})}target=$("fb-dont-login-again");if(target){target.observe("click",function(e){e.stop();$("log-into-facebook-again").hide();createCookie("fb-vote-prompt","false")})}var contribs=$$(".contrib");for(var i=0;i<contribs.length;i++){var buzz_id=contribs[i].getAttribute("rel:buzz_id");if(buzz_id){contribs[i].observe("mouseout",function(e){var parent=e.target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var id="tools-"+buzz_id;if($(id)){$(id).removeClassName("selected_tools")}});contribs[i].observe("mouseover",function(e){var parent=e.target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var id="tools-"+buzz_id;if($(id)){$(id).addClassName("selected_tools")}})}}if(document.location.href.match(/#share/)&&$("badge_voting")){var target=$("badge_voting").getElementsByTagName("A")[0];if(!target.id){target.id=(new Date()).getTime()}var vote_category=target.getAttribute("rel:category");var earned=target.getAttribute("rel:badge_type")=="earned";badge_vote_manager.show_sharing_links({element_id:target.id,category:vote_category,earned:earned})}badge_vote_manager.initialized=true}catch(e){console.error(e);badge_vote_manager.initialization=false}};this.reset_sharing_box=function(){if($("social-sharing-box")){$("sharing-message").value="";$("sharing-box-caption").update("");$("sharing-box-submit").value=local.t("Post to Facebook");$("sharing-box-submit").stopObserving("click",fbtl_session.add_message);$("sharing-box-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}if($("share-reaction-box")){$("reaction-sharing-message").value="";$("reaction-share-submit").value=local.t("Share Link");$("reaction-share-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}};this.show_reaction_share_box=function(reaction,message){if($("share-reaction-box")){$("share-reaction-box").show();$("reaction-sharing-message").value="";if($("share-reaction-success-wrapper").visible()){$("share-reaction-success-wrapper").hide()}if(!$("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-content-wrapper")}$("reaction-share-submit").observe("click",badge_vote_manager.sharing_box_handler);if(typeof bf_rdio=="object"){var play_list=bf_rdio.fetch_rdio_buzz(reaction.toLowerCase());if(play_list&&$("share-reaction-box_title")){var rdio_message="I know, right? Now check out the Rdio <span class='react_box'>"+reaction+"</span> playlist <a onClick=\"trackPixel('http://ad.doubleclick.net/clk;267621454;93691579;z');\" href='http://buzzfeed.com"+play_list+"'>"+local.t("HERE")+"</a>";$("share-reaction-box_title").innerHTML=rdio_message}}["Nom Nom"].each(function(r){if(r==reaction&&message){$("share-reaction-box_title").innerHTML=unescape(message)}})}};this.show_sharing_box=function(target,caller){if($("social-sharing-box")){var shareBox=$("social-sharing-box");var pos=badge_vote_manager.find_position(target);if(typeof pos=="undefined"){return}var btnLeft=parseInt(pos[0]);var vote_category=target.getAttribute("rel:category");var btnTop=(vote_category&&vote_category=="badge")?parseInt(pos[1])+7:parseInt(pos[1])-1;var btn=$(target.getAttribute("id"));var btnWidth=parseInt(btn.getWidth());var shareBoxWidth=parseInt(shareBox.getWidth());var split=300;var boxLeft=btnLeft<(shareBoxWidth/2-btnWidth/2)?10:(btnLeft-(shareBoxWidth/2-btnWidth/2));shareBox.setStyle({top:(btnTop+35)+"px",left:boxLeft+"px"});var pointerHeight=10;var pointerLeft=btnLeft<(shareBoxWidth/2-btnWidth/2)?btnLeft-10+btnWidth/2:shareBoxWidth/2;pointerLeft=pointerLeft-10;$("arrowBorder").setStyle({top:-(pointerHeight)+"px",left:pointerLeft+"px",borderBottom:pointerHeight+"px solid #444"});$("arrowFill").setStyle({top:(-(pointerHeight)+2)+"px",left:pointerLeft+"px",borderBottom:pointerHeight+"px solid #F2F2F2"});if(typeof caller!="undefined"&&caller=="fbtl"){$("sharing-box-caption").update(local.t("Add a message?"));$("sharing-box-submit").value=local.t("Add A Message");$("sharing-box-submit").observe("click",fbtl_session.add_message)}else{$("sharing-box-caption").update(local.t("I know, right? Will your friends agree?"));var prefill_msg=target.getAttribute("rel:badge_name")?target.getAttribute("rel:badge_name")+"!":"";$("sharing-message").value=prefill_msg;$("sharing-box-submit").observe("click",badge_vote_manager.sharing_box_handler)}shareBox.show()}};this.find_position=function(el){var curleft=curtop=0;if(el.offsetParent){do{curleft+=el.offsetLeft;curtop+=el.offsetTop}while(el=el.offsetParent);return[curleft,curtop]}};this.sharing_box_handler=function(e){var message="";var meta_tags=document.getElementsByTagName("meta");var fields=["image","title","description","url"];var info={};if(objExists(e.target.id)){if(e.target.id="reaction-share-submit"){message=$("reaction-sharing-message").value}else{if(e.target.id="sharing-box-submit"){message=$("sharing-message").value}}}for(var i=0;i<meta_tags.length;i++){for(var j=0;j<fields.length;j++){var property="og:"+fields[j];if(meta_tags[i].getAttribute("property")==property){info[fields[j]+""]=meta_tags[i].getAttribute("content")}}}if(typeof pound!="undefined"){info.url=pound.urls.unescaped.hashAndQueryString()}var fb_args={};fb_args.description=info.description;fb_args.name=info.title;fb_args.link=info.url;fb_args.picture=info.image;fb_args.message=message;facebook.publish_to_stream(fb_args,function(){if($("social-sharing-box").visible()){$("social-sharing-box").hide()}if($("share-reaction-box")){if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideUp("share-reaction-content-wrapper")}if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-success-wrapper")}}})};this._hide_content=function(class_name,hide){var items=$$("#contribution-list ."+class_name);for(var i=0;i<items.length;i++){if(hide){items[i].hide()}else{items[i].show()}}};this.show_social_icons=function(){if(typeof(ActiveHistory)=="undefined"){return}ActiveHistory.observe("visited:digg",function(){if($("share_digg_button")){$("share_digg_button").show()}});ActiveHistory.observe("visited:twitter",function(){if($("share_twitter_button")){$("share_twitter_button").show()}});ActiveHistory.observe("visited:reddit",function(){if($("share_reddit_button")){$("share_reddit_button").show()}});ActiveHistory.observe("visited:stumbleupon",function(){if($("share_stumbleupon_button")){$("share_stumbleupon_button").show()}});ActiveHistory.observe("visited:delicious",function(){if($("share_delicious_button")){$("share_delicious_button").show()}});ActiveHistory.observe("visited:fark",function(){if($("share_fark_button")){$("share_fark_button").show()}})};this.flow_vote=function(e,data){var target=e.target;var user=new BF_User();var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}data.buzz_id=parent.getAttribute("rel:buzz_id");if(user.isLoggedIn()){if(data.category=="badge"){var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={}}if(typeof _badge_votes_so_far[data.buzz_id]=="undefined"){_badge_votes_so_far[data.buzz_id]={}}if(typeof _badge_votes_so_far!="undefined"){if(typeof _badge_votes_so_far[""+data.buzz_id]=="undefined"){_badge_votes_so_far[""+data.buzz_id]={}}if(typeof _badge_votes_so_far[""+data.buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[""+data.buzz_id][user_info.username]=1}else{_badge_votes_so_far[""+data.buzz_id][user_info.username]+=1}if(_badge_votes_so_far[""+data.buzz_id][user_info.username]>=4){return badge_vote_manager._flow_show_vote_exceeded(data.buzz_id)}}}badge_vote_manager._flow_vote(target,data)}else{badge_vote_manager.login(target);badge_vote_manager.onLogin=function(){badge_vote_manager._flow_vote(target,data)};badge_vote_manager.onRegister=function(){badge_vote_manager._flow_showRegistrationMessage(data.buzz_id)}}};this._flow_vote=function(target,data){badge_vote_manager._flow_hide_all_social_messages();var parent=target;if(!target.id){target.id="temp-"+(new Date()).getTime()}var vote_category=target.getAttribute("rel:category");var earned=target.getAttribute("rel:badge_type")=="earned";badge_vote_manager.show_sharing_links({element_id:target.id,category:vote_category,earned:earned});while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}data.buzz_id=parent.getAttribute("rel:buzz_id");data.buzz_uri="/"+parent.getAttribute("rel:buzz_uri");data.buzz_title=unescape(parent.getAttribute("rel:buzz_title"));data.blurb=unescape(parent.getAttribute("rel:blurb"));data.image_src=unescape(parent.getAttribute("rel:image_src"));data.title_is_excerpt=parent.getAttribute("rel:title_is_excerpt");badge_vote_manager._spinner=$(data.buzz_id+"-spinner-"+data.category);badge_vote_manager._spinner.show();var vote_definition=this.VOTE_DEFINITIONS[data.category];if(!vote_definition){return}var params={action:"vote",element_id:target.id,category:data.category,uri:data.buzz_uri,buzz_id:data.buzz_id,from_page:window.location.href.split("/").pop()};for(var each in vote_definition.parameters){params[each]=vote_definition.parameters[each](target)}badge_vote_manager.ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:function(r){vote_definition.onSuccess_flow(r,data)}})};this.flow_badgeResponse=function(r,data){var json=eval("("+r.responseText+")");if($("spinner-badge")){$("spinner-badge").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success){BFW_Util.updateInfoCookie({last_active:json.last_active});var user=new BF_User();var target=$(json.element_id);Event.stopObserving(target,"click",event_handler._event_handler);target.removeAttribute("href");$(target.parentNode).addClassName("voted");if(json.already_voted){badge_vote_manager._flow_already_voted(data.buzz_id);return}var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[data.category];data.username=user.getUserInfo().username;data.display_name=user.getUserInfo().display_name;data.title=data.buzz_title;data.uri=data.buzz_uri;data.badge=data.badge_name;badge_vote_manager._flow_hide_all_social_messages();$(data.buzz_id+"-social_message").show()}else{}};this.flow_loveHateResponse=function(r,data){var json=eval("("+r.responseText+")");if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success){var user=new BF_User();BFW_Util.updateInfoCookie({last_active:json.last_active});var target=$(json.element_id);Event.stopObserving(target,"click",event_handler._event_handler);target.removeAttribute("href");$(target.parentNode).addClassName("voted");if(json.already_voted){badge_vote_manager._flow_already_voted(data.buzz_id);return}var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[data.category];data.display_name=user.getUserInfo().display_name,data.title=data.buzz_title,data.uri=data.buzz_uri,data.loves=data.value;var className=data.loves=="loves"?"feed-love":"feed-hate";$(data.buzz_id+"-social_message-"+data.loves).show()}else{}};this._flow_already_voted=function(buzz_id){badge_vote_manager._flow_hide_all_social_messages();$(buzz_id+"-social_message-already-voted").show()};this._flow_hide_all_social_messages=function(){$$(".social-message").each(function(el){el.hide()})};this._flow_show_vote_exceeded=function(buzz_id){badge_vote_manager._flow_hide_all_social_messages();$(buzz_id+"-social_message-badge-votecount-exceeded").show()};this._flow_showRegistrationMessage=function(buzz_id){var targetParent=$(buzz_id+"-social-actions");if(targetParent){var div=document.createElement("div");div.className="section social-message validate contribute-message";var h5=document.createElement("h5");var span=document.createElement("span");span.appendChild(document.createTextNode("Please Validate Your Email"));h5.appendChild(span);var p=document.createElement("p");p.appendChild(document.createTextNode("Thanks for registering. Before you can react or contribute we need to quickly validate your email address. We've sent you a confirmation email with instructions. If you don't receive the email in a few minutes, please check your spam folder."));div.appendChild(h5);div.appendChild(p);targetParent.appendChild(div)}if($("registration-div")){$("registration-div").hide()}};this.vote=function(e){e.stop();var user=new BF_User();var target;if(e.target.nodeName=="SPAN"){target=e.target.up()}else{target=e.target}if(typeof fb_app!="undefined"){var badge_name=target.getAttribute("rel:badge_name");fb_app.show_bubble(badge_name);if(!fb_app.session||!fb_app.bf_user_info){fb_app.log_into_buzzfeed()}else{badge_vote_manager._vote(target)}}else{if(user.isLoggedIn()){var fb_vote_prompt=readCookie("fb-vote-prompt");(target.up(".contrib"))?badge_vote_manager._comment_vote(target):badge_vote_manager._vote(target)}else{var ev=target.fire("click");ev.signin_type="initial";ev.mode="badges";ev.location="reaction";ev.reg_params="";var category=target.getAttribute("rel:category");if(category=="love_or_hate"){ev.reg_params="c1&v"+(target.getAttribute("rel:value")=="loves"?1:0)+"&i"+target.id.substr(18)}else{ev.reg_params="c&v"+target.getAttribute("rel:badge_id")+"&i"+target.id.substr(11)}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}ev.reg_params+="&b"+parent.getAttribute("rel:buzz_id")+"&l"+parent.getAttribute("rel:buzz_uri");if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.country!="undefined"){ev.reg_params+="&u"+BF_STATIC.country}badge_vote_manager.onRegister=function(obj,json){badge_vote_manager.onRegister=null;badge_vote_manager._showRegistrationMessage(target)};signin.callbacks.onRegister.push(function(obj,json){if(badge_vote_manager.onRegister){badge_vote_manager.onRegister(obj,json)}});bf_login.loggedInCallbacks=[];bf_login.loggedInCallbacks.push(function(){badge_vote_manager.initialized=true;badge_vote_manager.vote_by_id(target.up("li").id)});signin.open(ev)}}EventManager.fire("badge_vote:vote_init",target.getAttribute("rel:badge_name"))};this.vote_by_id=function(elem){var are_we_ready=(typeof universal_dom!="undefined"&&badge_vote_manager.initialized&&$$("#"+elem+" a").length);if(are_we_ready){var ev=$$("#"+elem+" a")[0].fire("click");badge_vote_manager.vote(ev)}else{setTimeout(badge_vote_manager.vote_by_id.bind(this,elem),500)}};this._showRegistrationMessage=function(target){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var targetParent=$("tools-div-"+buzz_id);if(!targetParent){targetParent=$("social-actions")}if(targetParent){var div=document.createElement("div");div.className="section social-message validate contribute-message";var h5=document.createElement("h5");var span=document.createElement("span");span.appendChild(document.createTextNode("Please Validate Your Email"));h5.appendChild(span);var p=document.createElement("p");p.appendChild(document.createTextNode("Thanks for registering. Before you can react or contribute we need to quickly validate your email address. We've sent you a confirmation email with instructions. If you don't receive the email in a few minutes, please check your spam folder."));div.appendChild(h5);div.appendChild(p);targetParent.appendChild(div);if($("registration-div")){$("registration-div").hide()}}};this._comment_vote=function(target){var vote_category=target.getAttribute("rel:category");if(!vote_category){if(target.up("a")){target=target.up("a");vote_category=target.getAttribute("rel:category");if(!vote_category){return}}}Event.stopObserving(target,"click",badge_vote_manager.vote);var id=target.up(".contrib").getAttribute("rel:comment_id");var vote=target.getAttribute("rel:value");var params={action:"comment_vote",comment_id:id,badge_name:vote};var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params});var vote_number=parseInt(target.down(".count").innerHTML);if(vote_number>=0){target.down(".count").innerHTML=vote_number+1}};this._vote=function(target){var vote_category=target.getAttribute("rel:category");if(!vote_category){return}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(vote_category=="badge"){if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={};_badge_votes_so_far[buzz_id]={}}else{if(typeof _badge_votes_so_far[buzz_id]=="undefined"){_badge_votes_so_far[buzz_id]={}}}var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far!="undefined"){if(typeof _badge_votes_so_far[""+buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[""+buzz_id][user_info.username]=1}else{_badge_votes_so_far[""+buzz_id][user_info.username]+=1}if(_badge_votes_so_far[""+buzz_id][user_info.username]>=4){return badge_vote_manager._exceeded_maximum_badge_votes()}}}if(badge_vote_manager.is_contribution(target)){$("love_button-"+parent.getAttribute("rel:buzz_id")).hide();$("hate_button-"+parent.getAttribute("rel:buzz_id")).hide();$("social_message-"+parent.getAttribute("rel:buzz_id")).hide();badge_vote_manager._spinner=$("spinner-"+parent.getAttribute("rel:buzz_id"));$(badge_vote_manager._spinner).style.width="100%";$(badge_vote_manager._spinner).show()}else{if($("spinner-"+vote_category)){$("spinner-"+vote_category).show()}}var vote_definition=this.VOTE_DEFINITIONS[vote_category];if(!vote_definition){return}var params={action:"vote",element_id:target.id,category:vote_category,uri:"/"+parent.getAttribute("rel:buzz_uri"),buzz_id:parent.getAttribute("rel:buzz_id")};for(var each in vote_definition.parameters){params[each]=vote_definition.parameters[each](target)}var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:vote_definition.onSuccess});if(vote_category=="badge"&&target.getAttribute("rel:badge_type")!="earned"){if(typeof _badge_votes_so_far=="undefined"||_badge_votes_so_far[""+buzz_id][user_info.username]<2){var action="react";var article_url=window.location.toString().replace(/\?.*/i,"");if(BF_STATIC.bf_env!="live"){article_url=article_url.replace(/\/\/(stage(\d+)?|dev)\./i,"//www.").replace("/bf2/","/")}var badge_uri=target.getAttribute("rel:badge_uri");var objs={article:article_url,badge:"http://www.buzzfeed.com/badge/"+badge_uri};try{if(typeof(FB)!="undefined"){fbtl_session.trigger(action,objs)}}catch(e){console.error(e)}}}(new BF_Targetting_Pixel()).add("badge_reaction")};this.simple_love_vote=function(uri,buzz_id){var vote_definition=this.VOTE_DEFINITIONS.love_or_hate;var params={action:"vote",buzz_id:buzz_id,category:"love_or_hate",uri:uri,value:1};var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:vote_definition.onSuccess})};this.is_contribution=function(target){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}return parent.parentNode.className.match(/contribution-lovehate-buttons/)};this.login=function(target){var registration_div=$("registration-div");if(registration_div){registration_div.parentNode.removeChild(registration_div)}registration_div.addClassName("comment-lovehate-buttons");var login_form_target_str=target.getAttribute("rel:login_form_target");if(!login_form_target_str){var json=eval("("+target.getAttribute("rel:data")+")");if(json){login_form_target_str=json.vote.login_form_target}}if(!login_form_target_str){login_form_target_str="social-actions"}if($(login_form_target_str)){$(login_form_target_str).appendChild(registration_div)}comment_links.show_share_box({target:target,id:login_form_target_str});var reg=new BF_Register();reg.register_handler(false,{action:"badge_vote"});reg.fb_register_handler(false,{action:"badge_vote"});$("login-submit").value="Sign In";$("register-submit").value="Register";if($("preview-again-from-registration")){$("preview-again-from-registration").hide()}if($("preview-again-from-login")){$("preview-again-from-login").hide()}bf_login.args={action:"badge_vote"};$("registration-div").showOnScreen()};this._update_reaction_count=function(id_prefix){var id=id_prefix+"-reaction-count";var count=$(id).innerHTML.replace(/\s+/g,"");var count=parseInt(count);if(!isNaN(count)){count++;$(id).update(count)}};this.show_sharing_links=function(info){if(!info.category){info.category=info.element_id.split("-").slice(0,-1).join("-")}if(info.category=="love-button"){info.category="love_or_hate"}var parent=$(info.element_id);while((info.buzz_id=parent.getAttribute("rel:buzz_id"))==null&&parent.parentNode){parent=parent.parentNode}if($("generated-sharing-links")&&$("generated-sharing-links").getAttribute("rel:buzz_id")==info.buzz_id){return}var blank=BF_STATIC.image_root+"/static/images/public/backgrounds/trans.gif";["default-sharing-links","generated-sharing-links"].each(function(id){var el=$(id);if(el){var iframes=el.getElementsByTagName("IFRAME");for(var i=0;i<iframes.length;i++){iframes[i].src=blank}el.parentNode.removeChild(el)}});var data={image_root:BF_STATIC.image_root};while((data.buzz_uri=parent.getAttribute("rel:buzz_uri"))==null&&parent.parentNode){parent=parent.parentNode}while((data.buzz_name=parent.getAttribute("rel:buzz_title"))==null&&parent.parentNode){parent=parent.parentNode}for(var each in data){if(each!="image_root"&&each!="buzz_name"){data[each]=escape(data[each])}}var parent_div=badge_vote_manager.find_parent("div",$(info.element_id));if(parent_div.parentNode.className.match(/contrib/)){parent_div=parent_div.parentNode}else{parent_div=parent_div.parentNode.parentNode}if(info.earned){parent_div=parent_div.parentNode.parentNode}var div=document.createElement("div");div.id="generated-sharing-links";div.setAttribute("rel:buzz_id",info.buzz_id);data.buzz_id=info.element_id.split("-").pop();if($($(info.element_id).parentNode).parentNode.getAttribute("rel:buzz_id")){data.buzz_id=$($(info.element_id).parentNode).parentNode.getAttribute("rel:buzz_id")}data.hash_tag="";data.fb_uri=data.buzz_uri;if(typeof(hashtrack)!="undefined"){var hash_tag=hashtrack.hash_tag(window.location.href);if("hashtrack" in window&&"hash_track" in window){if(hash_tag&&typeof hash_track!="undefined"&&typeof hash_track[hash_tag]!="undefined"){var hashinfo=hash_track[hash_tag].conversion;data.hash_tag="%23"+hash_tag;data.fb_uri="ht/"+data.buzz_uri+"/"+hash_tag}}}var template=badge_vote_manager.SHARE_THE_LOVE_TEMPLATE;data.via=typeof bf_twitter_id=="undefined"?"":'data-via="'+bf_twitter_id+'"';div.innerHTML=template.evaluate(data);(function(){var s=document.createElement("SCRIPT"),s1=document.getElementsByTagName("SCRIPT")[0];s.type="text/javascript";s.async=true;s.src="http://widgets.digg.com/buttons.js";s1.parentNode.insertBefore(s,s1)})();$("social-sharing-content").update(div);if(typeof(FB)!="undefined"){FB.XFBML.parse(div)}var badge_prefix="";if($(info.element_id).getAttribute("rel:badge_name")){badge_prefix=$(info.element_id).getAttribute("rel:badge_name")+"! "}else{if($(info.element_id).getAttribute("rel:data")){var json=$(info.element_id).getAttribute("rel:data");var obj=eval("("+json+")");if(typeof obj.vote!="undefined"&&typeof obj.vote.badge_name!="undefined"){badge_prefix=obj.vote.badge_name+"! "}}}var msg=badge_prefix+unescape(unescape(data.buzz_name));BF_TWITTER2.init()};this.find_parent=function(tag,el){if(el.tagName.toLowerCase()==tag.toLowerCase()){return el}else{if(el.parentNode!=null){return badge_vote_manager.find_parent(tag,el.parentNode)}else{return console.warn("no "+tag+" found in DOM")}}};this.earned_reactions_buttons=function(target){if(local.non_english){return false}try{var btn_template=new Template('<li id="#{name}_button" class="#{name}"> <a id="vote-badge-#{rand}" class="vote-badge" rel:badge_type="earned" rel:badge_name="#{title}" rel:badge_id="#{badge_id}" rel:message="<b>'+local.t("I know, right?")+"</b> <span class=#{infinite}>"+local.t("You have #{remaining_less_one} of these babies left, use #{itslashthem} wisely")+"...</span><span class=#{none_left}>"+local.t("That was your last #{title} reaction. Go earn some more!")+'</span>"> #{title} <span class="earned-remaining">#{remaining}</span></a> <span id="#{badge_id}-reaction-count" class="badge-vote-count zero"></span> </li>');var str=(new BF_User()).getUserInfo().earned_reactions;var show_reactions=false;if(str&&target){var earned_reactions=eval("("+str+")");for(var reaction in earned_reactions){if(earned_reactions[reaction].remaining==0){continue}var name=reaction.toLowerCase().replace("[^a-zA-Z]","");if(typeof name==="undefined"||name==""){continue}var params={name:name,rand:parseInt(Math.random()*1000)+(new Date()).getTime(),title:reaction,remaining:earned_reactions[reaction].remaining==-1?"":" "+earned_reactions[reaction].remaining+"",badge_id:earned_reactions[reaction].badge_id};params.remaining_less_one=earned_reactions[reaction].remaining-1;params.infinite=params.remaining_less_one<1?"hidden":"";params.none_left=params.remaining_less_one==0?"":"hidden";params.itslashthem=params.remaining_less_one==1?"it":"them";var html=btn_template.evaluate(params);target.insert(html);show_reactions=true}if(show_reactions){$("special_header").show();$$(".special-reactions").each(function(el){el.show()})}}}catch(e){console.error(e)}}};badge_vote_manager=new bf_badge_vote_manager();badge_vote_manager.show_social_icons();BuzzLoader.register(function(){badge_vote_manager.init()},2);bf_user_reaction=function(){var reaction_url="/buzzfeed/_badge_vote";var reaction_message={success_voted:local.t("Thanks for your vote!"),already_voted:"<span>"+local.t("Oops")+".</span> "+local.t("It looks like you've already voted")+".",reaction_count_exceeded:"<span>"+local.t("Sorry")+"</span>, "+local.t("you can only react up to three times")+"."};var _this=this;this.init=function(){var user=new BF_User();$$(".user-reaction").each(function(cont,index){if(user.isLoggedIn()){cont.removeClassName("hide-user-reaction")}cont.select(".reaction-btn").each(function(element,index2){element.observe("click",_this.add_reaction)})});universal_dom.assign_handler({bucket:"fb-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"tw-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"pin-share",handler:bf_user_reaction.buzz_share,event:"click"})};this.buzz_share=function(obj){var parent=$("user-reaction-social-"+obj.id);if(!parent){return}var title=encodeURIComponent(parent.getAttribute("rel:title"));var host=BF_STATIC.bf_env!="live"?"http://stage.buzzfeed.com/":"http://www.buzzfeed.com/";var url=encodeURIComponent(host+parent.getAttribute("rel:link"));var thumb=encodeURIComponent(BF_STATIC.image_root+parent.getAttribute("rel:thumb"));var twitter_url="https://twitter.com/intent/tweet?text="+title+"&url="+url;if(BF_STATIC.tt_page="Community"){twitter_url=twitter_url+"&via=buzzfeeders"}if(obj.element.hasClassName("buzz-facebook-share")){window.open("http://facebook.com/sharer/sharer.php?s=100&p[url]="+url+"&p[title]="+title+"&p[images][0]="+thumb,"_blank","width=600, height=260")}else{if(obj.element.hasClassName("buzz-twitter-share")){window.open(twitter_url,"_blank","width=600,height=400")}else{if(obj.element.hasClassName("buzz-pinterest-share")){window.open("http://pinterest.com/pin/create/button/?media="+thumb+"&url="+url+"&description="+title,"_blank","width=600,height=400")}}}};this.add_reaction=function(el){var target=el.target;if(target.hasClassName("icon")){target=target.parentNode}var reaction_wrap=_this.get_reaction_wrap(target);_this.hide_all_reaction_messages(target);var reaction_params={action:"vote",element_id:target.id,category:target.getAttribute("rel:category"),buzz_id:reaction_wrap.getAttribute("rel:buzz_id"),uri:"/"+reaction_wrap.getAttribute("rel:buzz_uri")};if(target.getAttribute("rel:category")=="badge"&&!_this.is_reaction_available(reaction_wrap.getAttribute("rel:buzz_id"))){_this.show_reaction_message(target,"reaction_count_exceeded");return false}if(target.getAttribute("rel:badge_id")){reaction_params.badge_id=target.getAttribute("rel:badge_id")}if(target.getAttribute("rel:value")){reaction_params.value=target.getAttribute("rel:value")=="loves"?"1":(target.getAttribute("rel:value")=="hates"?"0":target.getAttribute("rel:value"))}var user=new BF_User();if(!user.isLoggedIn()){var t={signin_type:"initial",mode:"badges",location:"reactions"};t.reg_params="";if(reaction_params.category=="love_or_hate"){t.reg_params="c1&v"+reaction_params.value+"&i"+reaction_params.element_id.substr(18)}else{t.reg_params="c&v"+reaction_params.badge_id+"&i"+reaction_params.element_id.substr(11)}t.reg_params+="&b"+reaction_params.buzz_id+"&l"+reaction_params.uri;if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.country!="undefined"){t.reg_params+="&u"+BF_STATIC.country}bf_login.loggedInCallbacks.push(function(){_this.send_react_request(reaction_params);_this.show_reaction_loading(target)});signin.open(t);return false}_this.send_react_request(reaction_params);_this.show_reaction_loading(target);(new BF_Targetting_Pixel()).add("badge_reaction")};this.vote_by_id=function(elem){$$("#"+elem+" a")[0].scrollIntoView();var ev=$$("#"+elem+" a")[0].fire("click");bf_user_reaction.add_reaction(ev)};this.send_react_request=function(reaction_params){var ajax=new BF_Request();ajax.request(reaction_url,{method:"get",parameters:reaction_params,onSuccess:_this.add_reaction_success})};this.is_reaction_available=function(buzz_id){var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={}}if(typeof _badge_votes_so_far[buzz_id]=="undefined"){_badge_votes_so_far[buzz_id]={}}if(typeof _badge_votes_so_far[buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[buzz_id][user_info.username]=1;return true}else{if(_badge_votes_so_far[buzz_id][user_info.username]>=3){return false}_badge_votes_so_far[buzz_id][user_info.username]+=1;return true}};this.add_reaction_success=function(response){var json=eval("("+response.responseText+")");if(json.success){$(json.element_id).stopObserving("click",_this.add_reaction);$(json.element_id).addClassName("already-reacted");_this.hide_reaction_loading($(json.element_id));if(json.already_voted){_this.show_reaction_message($(json.element_id),"already_voted")}else{_this.show_reaction_message($(json.element_id),"success_voted")}}else{}};this.get_reaction_wrap=function(el){var reaction_wrap=el;while(reaction_wrap.parentNode&&!reaction_wrap.hasClassName("user-reaction")){reaction_wrap=reaction_wrap.parentNode}return reaction_wrap};this.show_reaction_loading=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(!reaction_wrap.select(".reaction-loading").length){reaction_wrap.insert('<div class="reaction-loading" style="display:none;">'+local.t("Saving")+"...</div>")}reaction_wrap.select(".reaction-loading")[0].show()};this.hide_reaction_loading=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(reaction_wrap.select(".reaction-loading").length){reaction_wrap.select(".reaction-loading")[0].hide()}};this.show_reaction_message=function(el,message_key){var reaction_wrap=_this.get_reaction_wrap(el);if(!reaction_wrap.select(".reaction-message-"+message_key).length){reaction_wrap.insert('<div class="reaction-message reaction-message-'+message_key+'" style="display:none;">'+reaction_message[message_key]+"</div>")}reaction_wrap.select(".reaction-message-"+message_key)[0].show()};this.hide_all_reaction_messages=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(reaction_wrap.select(".reaction-message").length){reaction_wrap.select(".reaction-message").each(function(element,index){element.hide()})}}};bf_user_reaction=new bf_user_reaction();BuzzLoader.register(function(){bf_user_reaction.init()},2);var BF_MobilePromos=function(){this.agent=navigator.userAgent.toLowerCase();this.is_mobile=this.agent.match(/iphone|ipod|android|ipad/);this.is_iphone=this.agent.match(/iphone|ipod/);this.is_android=this.agent.match(/android/);this.is_ipad=this.agent.match(/ipad/);this.init=function(){if(mobile_promos.is_iphone){}else{if(mobile_promos.is_android){}else{}}if(readCookie("BF_NO_MOBILE")&&readCookie("BF_NO_MOBILE").search(/true/)>-1){var a='<div id="bar_mobile_announcement">							<div id="bar_mobile_announcement_area" class="c">								<a id="announcement_mobile_close" class="close" href="javascript:;">Back To The Mobile Version</a>								<p></p>							</div>						</div>';$$("body")[0].insert({top:a});$("bar_mobile_announcement").observe("click",function(){eraseCookie("BF_NO_MOBILE",function(){window.location.reload()})})}}};var mobile_promos=new BF_MobilePromos();BuzzLoader.register(function(){mobile_promos.init()},1);function isEmpty(a){for(var b in a){return false}return true}BF_Editor=function(){this.init=function(){this.poller=new cookie_poller();var editor_links=$$(".editor-admin");var delete_reaction=$$(".editor-delete_reaction");var delete_related_links=$$(".editor-delete_related_links");var user=new BF_User();var isa=false;if(acl.user_can("edit_user_posts")){isa=true}var terminal_user=false;var basic_edit_functionality=false;var partners_manage=false;var userinfo;var editor_bf_ad=window.bf_ad;var editor_bf_partner=window.bf_partner;if(user&&user.isLoggedIn()){userinfo=user.getUserInfo();if(userinfo&&userinfo.terminal_user&&userinfo.terminal_user=="true"){terminal_user=true}else{basic_edit_functionality=true}if(userinfo&&userinfo.username){var regex=new RegExp("/"+userinfo.username+"(/?|$)");if(acl.user_can("partners_manage")&&((editor_bf_ad=="1"||editor_bf_partner=="1")||window.location.href.match(regex))){partners_manage=true}}}if(isa||partners_manage){for(var i=0;i<editor_links.length;i++){editor_links[i].stopObserving("click");editor_links[i].observe("click",bf_editor.load_editor);editor_links[i].show()}delete_reaction.each(function(el){el.stopObserving("click",bf_editor.delete_reaction);el.observe("click",bf_editor.delete_reaction);el.show()});delete_related_links.each(function(el){el.stopObserving("click",bf_editor.delete_related_links);el.observe("click",bf_editor.delete_related_links);el.show()})}else{if(terminal_user){var pathname=window.location.pathname;if(BF_STATIC.web_root.length>0){pathname=pathname.replace(BF_STATIC.web_root,"")}var user_page=pathname.split("/");if(user_page.length>0){user_page=user_page[1]}else{user_page=""}var current_user=user.getUserInfo().username;if(current_user==user_page){terminal_links=$$(".terminal-admin");for(var i=0;i<terminal_links.length;i++){var obj=terminal_links[i];var owner=obj.getAttribute("rel:owner");if(owner==current_user){obj.stopObserving("click",bf_editor.load_editor);obj.observe("click",bf_editor.load_editor);obj.show()}}}}}if(isa||terminal_user||basic_edit_functionality){var basic_admin=$$(".basic-admin");var username=(new BF_User()).getUserInfo().username;var regex=new RegExp("/"+username+"(/?|$)");if(!window.location.href.match(regex)&&!isa){return}for(var i=0;i<basic_admin.length;i++){var el=$(basic_admin[i]);var owner=el.getAttribute("rel:owner");var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;var buzz_type=buzz_data.type;if(owner==username||(isa&&$("user_post_edit"))){el.setAttribute("editor-style","basic");el.stopObserving("click",bf_editor.load_editor_in_dialog);el.observe("click",bf_editor.load_editor_in_dialog);el.show();var parent=el;while(parent.parentNode&&parent.tagName!="LI"){parent=parent.parentNode}$(parent).observe("mouseout",function(e){var username=(new BF_User()).getUserInfo().username;var owner=this.obj.getAttribute("rel:owner");if(username==owner||isa){if($(this.obj.parentNode)){$(this.obj.parentNode).hide()}}}.bind({obj:el}));$(parent).observe("mouseover",function(e){var username=(new BF_User()).getUserInfo().username;var owner=this.obj.getAttribute("rel:owner");if(username==owner||isa){if($(this.obj.parentNode)){$(this.obj.parentNode).show()}}}.bind({obj:el}))}}var delete_links=$$(".basic-admin-delete");for(var i=0;i<delete_links.length;i++){delete_links[i].observe("click",function(e){bf_editor.delete_quickpost(e)})}$$(".qe2").each(function(el){el.addClassName("with-stats")});var stats_links=$$(".basic-admin-stats");for(var i=0;i<stats_links.length;i++){stats_links[i].observe("click",function(e){bf_editor.load_stats(e)})}}var username=(new BF_User()).getUserInfo().username;var hide_edit_for_other_buzzes=new RegExp("(/submissions)?/"+username);var hide_me=new RegExp("with-stats");if(window.location.href.match(hide_edit_for_other_buzzes)){$$(".qe3").each(function(el){if(el.className.match(hide_me)){var owner="";var a=el.getElementsByTagName("A");owner=a[0].getAttribute("rel:owner");if(owner!=username){el.parentNode.removeChild(el)}}})}};this.delete_reaction=function(e){e.stop();var params={comment_id:e.target.getAttribute("rel:comment_id"),buzz_id:e.target.getAttribute("rel:buzz_id"),user_id:e.target.getAttribute("rel:user_id"),reactions:e.target.getAttribute("rel:reactions")};var old_iframe=$("user_post_delete_iframe");if(old_iframe){var parent=old_iframe.parentNode;parent.removeChild(old_iframe)}if($("user_post_delete_modal_text")){$("user_post_delete_modal_text").removeClassName("hidden");if($("post-headline")){$("post-headline").update("these reactions")}var cancel_btn=$("cancel-delete-button");var delete_btn=$("delete-button");if(cancel_btn){cancel_btn.stopObserving("click");cancel_btn.observe("click",function(){top.BF_UI.closeDialog("user_post_delete")})}if(delete_btn){delete_btn.stopObserving("click");delete_btn.observe("click",function(){bf_editor._delete_reaction(params)})}}BF_UI.showDialog("user_post_delete","Delete")};this._delete_reaction=function(obj){var params={action:"delete_reaction",buzz_id:obj.buzz_id,user_id:obj.user_id,responses:obj.reactions};var comment_id=obj.comment_id;var request=(new BF_Request()).request;request("/buzzfeed/comments_moderation",{method:"post",parameters:params,onComplete:function(){if(parent.$(comment_id)){parent.$(comment_id).update('<span style="color:red;">Item Deleted!</span>')}top.BF_UI.closeDialog("user_post_delete")}})};this.delete_related_links=function(e){e.stop();var campaignid=e.target.getAttribute("rel:campaignid");var related_campaignid=e.target.getAttribute("rel:related_campaignid");var buzz_name=e.target.getAttribute("rel:buzz_name");BF_UI.showDialog("user_post_delete","Delete");$("user_post_delete_iframe").setAttribute("src","/buzzfeed/editbuzz/delete_related_links?campaignid="+campaignid+"&related_campaignid="+related_campaignid+"&buzz_name="+buzz_name)};this.delete_quickpost=function(e){if(e.event){e=e.event}e.stop();var username=(new BF_User()).getUserInfo().username;var el=e.target;var owner=el.getAttribute("rel:owner");var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var track=eval("("+el.getAttribute("track")+")");var buzz_id=buzz_data.buzz_id;var user=new BF_User();var userinfo=user.getUserInfo();var isa=false;if(acl.user_can("edit_user_accounts")){isa=true}if(username!=owner&&!isa){return}BF_UI.showDialog("user_post_delete","Delete");$("user_post_delete_iframe").setAttribute("src","/buzzfeed/editbuzz/delete?id="+buzz_id)};this.load_stats=function(e){var user_info=(new BF_User()).getUserInfo();var buzz_info=e.target.getAttribute("rel:data").evalJSON();var owner=el.getAttribute("rel:owner");var track=eval("("+el.getAttribute("track")+")");window.location.href=BF_STATIC.web_root+"/dashboard/"+owner+"/"+track.buzz};this.edit_from_stats=function(e){e.stop();BF_UI.closeDialog("user_post_stats",{onComplete:bf_editor.close_user_stats});bf_editor.load_editor_in_dialog(e)};this.fill_stats_panel_shell=function(o){var shell=$$("#user_post_stats .bf_dialog_content").first();$$("#user_post_stats .bf_dialog_content").first().innerHTML=o.responseText;$("user-stats-cancel-button").observe("click",function(){BF_UI.closeDialog("user_post_stats",{onComplete:bf_editor.close_user_stats})});$("user-stats-snapshot-button").observe("click",function(){if(bf_editor.snapshot){Element.setStyle("user-stats-left-snapshot",{display:"none"});Element.setStyle("user-stats-left",{display:"block"});$("user-stats-snapshot-button").setAttribute("value","Snapshot");bf_editor.snapshot=0}else{Element.setStyle("user-stats-left",{display:"none"});Element.setStyle("user-stats-left-snapshot",{display:"block"});$("user-stats-snapshot-button").setAttribute("value","Current");bf_editor.snapshot=1}});$$(".edit-buzz-from-stats").each(function(el){el.observe("click",bf_editor.edit_from_stats)});$$("a.stats-loader").each(function(el){el.observe("click",bf_editor.load_stats)});bf_editor.stats_shell_loaded=true};this.pivot_stats=function(stats){new_ar=[];stats.each(function(el){new_ar[el.type]=el});$R(0,100).each(function(i){if(!new_ar[i]){new_ar[i]={total:0,totals:[0,0,0,0,0,0,0]}}});return new_ar};this.fill_stats_panel_stats=function(){index=this.index?this.index:"";if(arguments.length==1&&typeof arguments[0]=="object"){if(isEmpty(arguments[0])){return}if(arguments[0].snapshot){index="-snapshot"}bf_editor.stats_panel=bf_editor.stats_panel?bf_editor.stats_panel:{};bf_editor.stats_panel[index]=arguments[0];bf_editor.stats_panel[index].week_impressions=bf_editor.pivot_stats(bf_editor.stats_panel[index].week_impressions);if(bf_editor.stats_panel[index].all_impressions){bf_editor.stats_panel[index].all_impressions=bf_editor.pivot_stats(bf_editor.stats_panel[index].all_impressions)}}if(!bf_editor.stats_shell_loaded&&!bf_editor.secret_stats){return setTimeout(bf_editor.fill_stats_panel_stats.bind({index:index}),100)}else{var domain_template=new Template($F("referring-domain"));var domain_html=bf_editor.stats_panel[index].domains.map(function(d){if(d&&d.total){return domain_template.evaluate({total:bf_editor.add_commas(d.total),domain:d.domain})}}).join("");$("domains-list"+index).update(domain_html);var search_template=new Template($F("search-term"));var search_html=bf_editor.stats_panel[index].search.map(function(d){if(d&&d.total){return search_template.evaluate({total:bf_editor.add_commas(d.total),query:d.query})}}).join("");$("search-terms-list"+index).update(search_html);var stash={};stash["direct-week"]=bf_editor.stats_panel[index].week_impressions["0"].total;stash["internal-week"]=bf_editor.stats_panel[index].week_impressions["1"].total;stash["link-week"]=bf_editor.stats_panel[index].week_impressions["2"].total;stash["search-week"]=bf_editor.stats_panel[index].week_impressions["3"].total;stash["network-week"]=bf_editor.stats_panel[index].week_impressions["4"].total;stash["total-week"]=stash["direct-week"]+stash["internal-week"]+stash["link-week"]+stash["search-week"]+stash["network-week"];stash["viral-week"]=stash["direct-week"]+stash["link-week"]+stash["search-week"];stash["direct-today"]=bf_editor.stats_panel[index].week_impressions["0"].totals[6];stash["internal-today"]=bf_editor.stats_panel[index].week_impressions["1"].totals[6];stash["link-today"]=bf_editor.stats_panel[index].week_impressions["2"].totals[6];stash["search-today"]=bf_editor.stats_panel[index].week_impressions["3"].totals[6];stash["network-today"]=bf_editor.stats_panel[index].week_impressions["4"].totals[6];stash["total-today"]=stash["direct-today"]+stash["internal-today"]+stash["link-today"]+stash["search-today"]+stash["network-today"];stash["viral-today"]=stash["direct-today"]+stash["link-today"]+stash["search-today"];if(bf_editor.stats_panel[index].all_impressions){stash["direct-all-time"]=bf_editor.stats_panel[index].all_impressions["0"].total;stash["internal-all-time"]=bf_editor.stats_panel[index].all_impressions["1"].total;stash["link-all-time"]=bf_editor.stats_panel[index].all_impressions["2"].total;stash["search-all-time"]=bf_editor.stats_panel[index].all_impressions["3"].total;stash["network-all-time"]=bf_editor.stats_panel[index].all_impressions["4"].total;stash["total-all-time"]=stash["direct-all-time"]+stash["internal-all-time"]+stash["link-all-time"]+stash["search-all-time"]+stash["network-all-time"];stash["viral-all-time"]=stash["direct-all-time"]+stash["link-all-time"]+stash["search-all-time"]}$("traffic-summary-body"+index).update((new Template($F("traffic-summary"))).evaluate(stash));$("traffic-breakdown-body"+index).update((new Template($F("traffic-breakdown"))).evaluate(stash));$("chart_image"+index).src=bf_editor.get_graph(bf_editor.stats_panel[index].week_impressions);if(bf_editor.stats_panel[index].snapshot){Element.setStyle("user-stats-snapshot-button",{display:"block"})}}};this.get_graph=function(data){var type_names=["1","4","2","3","0"];var totals={};type_names.each(function($_){if(typeof data[$_]=="undefined"){data[$_]={}}if(!data[$_].totals){data[$_].totals=[0,0,0,0,0,0,0]}if(!data[$_].total){data[$_].total=0}});var chd=[];var chm=[];var chco=[];var max_val=0;var i=0;var day_total=[0,0,0,0,0,0,0];type_names.each(function($k){i++;if(data[$k].totals){var triples=data[$k].totals.map(function($_,index){day_total[index]+=$_;$_=day_total[index];if($_>max_val){max_val=$_}return[$_,$_,$_].join(",")});chd.push(triples.join(","))}else{empty_array=[];for(j=0;j<21;j++){empty_array.push(0)}chd.push(empty_array.join(","))}});return"http://chart.apis.google.com/chart?cht=ls&chs=170x105&chds="+[0,max_val].join(",")+"&chd=t:0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0|"+chd.join("|")+"&chco=ffffff,0077ee,44bbff,ee3322,ff5544,ff7777&chm=b,0077ee,0,1,0|b,44bbff,1,2,0|b,ee3322,2,3,0|b,ff5544,3,4,0|b,ff7777,4,5,0&chf=bg,s,ffffff"};this.add_commas=function(num){num+="";num=num.replace(/(\d)(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})?(\d{3,3})$/,"$1,$2,$3,$4,$5,$6,$7");num=num.replace(/,{2,}/,",");return num};this.close_user_stats=function(){bf_editor.stats_shell_loaded=false;$$("#user_post_stats .bf_dialog_content").first().innerHTML='<img src="'+BF_STATIC.static_root+'/images/public/spinners/loading.gif" />'};this.load_editor_in_dialog=function(e){var tag=e.target;var tag_data=tag.getAttribute("rel:data");var tag_data_obj=eval("("+tag_data+")");var buzz_id=tag_data_obj.buzz_id;var buzz_type=tag_data_obj.type;BF_UI.showDialog("user_post_edit","Edit");if(/^super.*/.test(buzz_type)){buzz_type="super";window.location.href=BF_STATIC.web_root+"/post?id="+buzz_id}else{$("user_post_edit_iframe").setAttribute("src","/buzzfeed/editbuzz/"+buzz_type+"?id="+buzz_id+"&cb="+(new Date()).getTime())}};this._load_editor_in_dialog=function(data){BF_UI.showDialog("user_post_edit","Edit");var buzz_type=data.type;if(/^super.*/.test(buzz_type)){buzz_type="super"}$("user_post_edit_iframe").setAttribute("src","/buzzfeed/editbuzz/"+buzz_type+"?id="+data.id+"&cb="+(new Date()).getTime())};this.load_editor=function(e){if(bf_editor.poller.active){alert("Please close the existing dialog before opening another.");return}if(e.event){e=e.event}var tag=e.target;var tag_data=tag.getAttribute("rel:data");var tag_data_obj=eval("("+tag_data+")");var buzz_id=tag_data_obj.buzz_id;var buzz_type=tag_data_obj.type;var poller_id=(new Date()).getTime();BF_Editor.editor_div_id=""+poller_id;var div_id=BF_Editor.editor_div_id;var editor_div=$(div_id);if(!editor_div){editor_div=document.createElement("div");editor_div.id=div_id;bf_editor.bodyTag().appendChild(editor_div);editor_div.className="qwik_edit";var close_button=document.createElement("a");close_button.className="close_editor";close_button.update('<img src="'+BF_STATIC.image_root+'/static/images/public/spinners/closebox.png" alt="x"/>');close_button.href="#";close_button.observe("click",function(e){e.stop();bf_editor.close_editor(e)});editor_div.appendChild(close_button)}bf_editor.start_spinner();var style=e.target.getAttribute("editor-style");if(!style){style="terminal"}bf_editor.load_iframe(buzz_id,{style:style,type:buzz_type});bf_editor.poller.add_poller_callback(buzz_id,bf_editor.close_window);var terminal_url=BF_STATIC.terminal_root_url;terminal_domain=terminal_url.replace(/(http:\/\/.*?)\/.*/,"$1");bf_editor.poller.start({callback_string:buzz_id,poll_url:terminal_domain+"/static/js/poller/cookie.js",pollid:poller_id,arguments:{id:div_id}})};this.close_editor=function(e){e.stop();var div=$(BF_Editor.editor_div_id);if(div){div.parentNode.removeChild(div);bf_editor.poller.stop_polling()}};this.close_window=function(args){if($(args.pollid)){$(args.pollid).parentNode.removeChild($(args.pollid))}};this.load_iframe=function(buzz_id,args){if(!args){args={style:"terminal"}}var style=args.style?args.style:"terminal";var type=args.type?args.type:"link";var iframe_id=this.generate_id("iframe");var iframe=$(iframe_id);if(!iframe){iframe=document.createElement("iframe");iframe.id=iframe_id;$(BF_Editor.editor_div_id).appendChild(iframe);iframe.observe("load",bf_editor.iframe_loaded);iframe.className="qwik_edit"}iframe.style.display="none";if(style=="terminal"){iframe.setAttribute("src",BF_STATIC.terminal_root_url+"?editor=qwik_edit&buzz_id="+buzz_id+"&cb="+(new Date()).getTime())}else{var buzz_type=type;if(/^super.*/.test(buzz_type)){buzz_type="super"}iframe.setAttribute("src","/bf2/editbuzz/"+buzz_type+"?id="+buzz_id+"&cb="+(new Date()).getTime())}};this.iframe_loaded=function(){bf_editor.stop_spinner();$(bf_editor.generate_id("iframe")).show()};this.start_spinner=function(){var spinner_id=this.generate_id("spinner");var spinner=$(spinner_id);if(!spinner){var spinner=document.createElement("div");spinner.id=spinner_id;spinner.className="qwik_edit-spinner";spinner.appendChild(document.createTextNode("Loading..."));$(BF_Editor.editor_div_id).appendChild(spinner);spinner.style.display="none"}var iframe=$(this.generate_id("iframe"));if(iframe){iframe.hide()}spinner.show()};this.stop_spinner=function(){$(this.generate_id("spinner")).hide()};this.bodyTag=function(){return document.getElementsByTagName("BODY")[0]};this.generate_id=function(key){return BF_Editor.editor_div_id+"_"+key}};BF_Editor.editor_div_id="_editor_div_"+Math.random()*100000;bf_editor=new BF_Editor();BuzzLoader.register(function(){bf_editor.init()},1);window.setTimeout(function(){if(typeof bf_editor.poller=="undefined"){bf_editor.init()}},3000);BF_PicksController=function(){this.controller="/buzzfeed/_picks";this.switchuser_list=new Template('<option class="pick_switch_user" rel:data="#{user.id}">#{user.display_name}</option>');this.init=function(){if(BF_STATIC&&BF_STATIC.page&&BF_STATIC.page.match(/Home/)){return true}if(window.location.pathname.match(/\/submit\/\w+/)){this.init_submissions()}else{var user_info=(new BF_User()).getUserInfo();$$(".make_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick)});if($("pick-buzz-button")){$("pick-buzz-button").observe("click",picks_controller.pick)}if($("pick-buzz-cancel-button")){$("pick-buzz-cancel-button").observe("click",function(e){var buzz_id=$("pick-buzz-button").getAttribute("rel:buzz_id");if(buzz_id){if($(buzz_id+"-accept_pick-spinner")){$(buzz_id+"-accept_pick-spinner").hide()}if($(buzz_id+"-make_pick-add")){$(buzz_id+"-make_pick-add").show()}if($(buzz_id+"-make_pick-success")){$(buzz_id+"-make_pick-success").hide()}if($(buzz_id+"-make_pick-spinner")){$(buzz_id+"-make_pick-spinner").hide()}}})}$$(".microsite-name").each(function(el){el.update(user_info.display_name)});var page=(document.location.pathname.split("/")).pop();if(page==user_info.username){if($("pending-submissions-notice")){$("pending-submissions-notice").show()}$$(".delete_pick").each(function(el){$(el.parentNode).show();el.show();el.observe("click",picks_controller.delete_pick)});if(document.location.pathname.match(/\/submissions\//)){$$(".accept_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick_accept)});$$(".delete-pick").each(function(el){el.removeClassName("delete-pick");el.addClassName("accept-pick")})}else{$$(".edit_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick_edit)});$$(".add-pick").each(function(el){var data=eval("("+el.getAttribute("data")+")");if(data!=null&&data.username==user_info.username){$(el.parentNode).hide();el.hide()}else{el.addClassName("edit-pick")}})}}else{$$(".add-pick").each(function(el){var data=eval("("+el.getAttribute("rel:data")+")");if(data&&data.username==user_info.username){$(el.parentNode).hide();el.hide()}})}}};this.init_submissions=function(){picks_controller.add_microsite_id=function(obj){obj.submit_to_microsite=($("contest-entry-form")&&$("contest-entry-form").getAttribute("rel:submit_to_microsite"))};picks_controller.login=function(target){var registration_div=$("registration-div");var reg=new BF_Register();reg.register_handler(false,{action:"microsite_submission"});reg.fb_register_handler(false,{action:"microsite_submission"});$("login-submit").value="Sign In";$("register-submit").value="Register";bf_login.args={action:"microsite_submission"};$("registration-div").show()};picks_controller.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){picks_controller.image_saved(resp)};var er=function(){contest_manager.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};picks_controller.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}this.settings.image=obj.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};picks_controller.save_ok=function(data){if($("successful-entry")){$("successful-entry").show()}if($("select-quickpost-box")){$("select-quickpost-box").hide()}};bf_login.init();user_post.init();EventManager.observe("user_post:save:success",picks_controller.save_ok);EventManager.observe("user_post:save:preparing",picks_controller.add_microsite_id);var user=new BF_User();if(user.isLoggedIn()){if(user.getUserInfo().terminal_user&&user.getUserInfo().terminal_user=="true"){if($("quickpost-enhanced-settings")){$("quickpost-enhanced-settings").show()}}else{if($("quickpost-enhanced-settings")){$("quickpost-enhanced-settings").hide()}}if($("registration-div")){$("registration-div").hide()}var regex=new RegExp("/submit/"+(user.getUserInfo()).username+"$");if(window.location.href.match(regex)){if($("error-div")){$("error-div").show()}}else{if($("contest-entry-form")){$("contest-entry-form").show()}}}else{this.login();this.onLogin=function(){var user=new BF_User();if(user.isLoggedIn()){if($("registration-div")){$("registration-div").hide()}if($("contest-entry-form")){$("contest-entry-form").show()}}else{if(facebook.is_logged_in()){BF_Request.location({reload_track:true})}else{$("regsitration-form").hide();$("registration-success").update("Thanks for registering. We've created your account, but we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.");$("registration-success").show()}}}}};this.make_request=function(action,buzz_id,note,success){var params={action:action,buzz_id:buzz_id,note:note};var user_id=$("pick-buzz-button").getAttribute("rel:switch_user_id");if(typeof user_id!="undefined"&&user_id){params.user_id=user_id}if(action=="delete"&&"acl" in window&&acl.user_can("picks_delete_from_anywhere")&&BF_STATIC.tt_page=="User"&&"bf_username" in window){params.username=bf_username}var user_info=(new BF_User()).getUserInfo();if((action=="hide"||action=="show")&&(("acl" in window&&acl.user_can("partners_manage"))||bf_username==user_info.username)&&"bf_username" in window){params.username=bf_username}var ajax=new BF_Request();ajax.request(picks_controller.controller,{method:"post",parameters:params,onSuccess:success})};this._accept=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;if($(buzz_id+"-accept_pick-spinner")){$(buzz_id+"-accept_pick-spinner").hide()}if($("post-"+buzz_id)){$("post-"+buzz_id).appendChild(new Element("span",{"class":"this-post-was-picked"}))}if($$("#post-2111731 .accept-pick")&&$$("#post-2111731 .accept-pick")[0]){$$("#post-2111731 .accept-pick")[0].hide()}}};this.hide_pick=function(e,success){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){picks_controller.make_request("hide",buzz_id,"",function(r){picks_controller._delete(r);success(r)})}};this.show_pick=function(e,success){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){picks_controller.make_request("show",buzz_id,"",function(r){picks_controller._delete(r);success(r)})}};this.delete_pick=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){if($(buzz_id+"-delete_pick-spinner")){$(buzz_id+"-delete_pick-spinner").show()}picks_controller.make_request("delete",buzz_id,"",picks_controller._delete)}};this._delete=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;if($(buzz_id+"-delete_pick-spinner")){$(buzz_id+"-delete_pick-spinner").hide()}if($("post-"+buzz_id)){$("post-"+buzz_id).hide()}}};this.launch_pick=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if($("easy_rebuzz")){$("easy_rebuzz").hide()}picks_controller.start_spinner(parent);(new BF_Request()).request(picks_controller.controller,{method:"get",parameters:{buzz_id:buzz_id,action:"get_pick"},onSuccess:function(o){picks_controller.easy_rebuzz(e,o)},onFailure:function(o){$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""},evalJSON:true});return};this.easy_rebuzz=function(e,o){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var obj=o.responseText.evalJSON();if(typeof obj.success!="undefined"&&obj.success==1){if(typeof obj.pick!="undefined"&&obj.pick!=0){picks_controller.launch_pick_edit(e,o)}else{$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value="";if(typeof obj.users!="undefined"){var list='<select id="switchuser_select">';var i=0;for(i=0;i<obj.users.length;i++){list+=this.switchuser_list.evaluate({user:obj.users[i]})}list+="</select>";if(i>0&&$("rebuzz_switchuser_list")){$("rebuzz_switchuser_list").update(list);if($("easy_rebuzz")){$("easy_rebuzz").show()}if($("switchuser_select")){$("switchuser_select").observe("change",function(e){e.stop();$$(".pick_switch_user").each(function(el){if(el.selected){var switch_user_id=el.getAttribute("rel:data");if(typeof switch_user_id!=undefined&&switch_user_id){picks_controller.choose_user(switch_user_id)}}})})}}}}}else{$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""}};this.launch_pick_edit=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Update Note";$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","update_note");$("pick_note").value="";$("pick_note").disabled=true;var pick_edit=function(o){$("pick_note").disabled=false;var obj=o.responseText.evalJSON();$("pick_note").value=BF_UI.renderEntities(obj.pick.note);if(obj.pick.is_pick==2&&obj.pick.pending_acceptance==1){$("pick-buzz-button").setAttribute("rel:action","accept_pick");$("pick-buzz-button").value="Accept Buzz"}};if(arguments[1]){pick_edit(arguments[1])}else{(new BF_Request()).request(picks_controller.controller,{method:"get",parameters:{buzz_id:buzz_id,action:"get_pick"},onSuccess:pick_edit,evalJSON:true})}BF_UI.showDialog("pick_dialog","Edit Your Note")};this.launch_pick_accept=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Accept Buzz";$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","accept");BF_UI.showDialog("pick_dialog","Accept a Submission")};this.choose_user=function(user_id){$("pick-buzz-button").setAttribute("rel:switch_user_id",user_id)};this.pick=function(e){e.stop();BF_UI.closeDialog("pick_dialog");var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var action=$("pick-buzz-button").getAttribute("rel:action");var callback=picks_controller._pick;if(!action){action="pick"}if(action=="update_note"){var note=$$("#post-"+buzz_id+" .buzznote .what").first();if(note){note.update($F("pick_note").replace(/</g,"&lt;").replace(/>/g,"&gt;"));$$("#post-"+buzz_id+" .buzznote").first().show()}}else{if(action=="accept"){callback=picks_controller._accept}else{if(action=="accept_pick"){action="accept"}}}if(buzz_id){picks_controller.make_request(action,buzz_id,$F("pick_note"),callback);picks_controller.start_spinner(parent)}};this._pick=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;picks_controller.stop_spinner();var user=new BF_User();if(user.isLoggedIn()){var username=(user.getUserInfo()).username;var your_feed="your Feed";if(typeof obj.username!="undefined"&&obj.username&&username!=obj.username){your_feed+=" (/"+obj.username+")";username=obj.username}if($("social_message-rebuzz")){$("social_message-rebuzz").update('<h5><span class="highlight">Rebuzzed!</span> This post has been added to <a href="'+(BF_STATIC?BF_STATIC.web_root:"")+"/"+username+'/">'+your_feed+"</a></h5>");$("social_message-rebuzz").show()}}gtrack.track_events("","share/rebuzz","")}else{picks_controller.stop_spinner()}};this.stop_spinner=function(){$$(".rebuzz_icon.busy").each(function(e){$(e).removeClassName("busy")})};this.start_spinner=function(parent){var icon=parent.select(".rebuzz_icon");if(icon&&icon.length){icon.first().addClassName("busy")}}};var JSON=JSON||{};if(typeof JSON.parse!=="function"){JSON.parse=function(a){return a.evalJSON()}}if(typeof JSON.stringify!=="function"){JSON.stringify=Object.toJSON}var BFTestRunner=function(){this.__mock_objects={};this.called={};this.init=function(){test_runner.force_testmode_on_ajax();this.load_files([{type:"text/css",url:"http://yui.yahooapis.com/2.7.0/build/logger/assets/logger.css"},{type:"text/css",url:"http://yui.yahooapis.com/2.7.0/build/yuitest/assets/testlogger.css"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/logger/logger-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yuitest/yuitest-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yahoo/yahoo-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/json/json-min.js"}]);this.observe("page_load:done",function(){test_runner.load_tests()});document.observe("dom:loaded",function(e){test_runner.fire_event("page_load",{})})};this.on_page=function(page){if(window.location.href.indexOf(page)!=-1){return true}else{var params=window.location.search;if(page.indexOf("?")!=-1){params=params.replace(/\?/,"&")}window.location.href=BF_STATIC.web_root+page+params}return false};this.append_to_function=function(old_fn,appendage){this.__mock_objects["special-"+old_fn]=eval(old_fn);this.mock(old_fn,function(){eval("var supr="+test_runner.__mock_objects[old_fn]);supr(eval(old_fn+".arguments"));appendage(eval(old_fn+".arguments"))})};this.force_testmode_on_ajax=function(params){if(typeof test_runner._request=="undefined"){this._request=Ajax.Request;this._request_events=Ajax.Request.Events;this.mock("Ajax.Request",function(path,params){params.parameters.testmode="on";Ajax.Request.Events=test_runner._request_events;new test_runner._request(path,params)},"special")}};this.remove_special=function(method){if(typeof this.__mock_objects[method]!="undefined"){eval(method+"="+this.__mock_objects["special-"+method])}};this.mock=function(method,fn,prefix){if(prefix){prefix+="-"}else{prefix=""}this.__mock_objects[prefix+method]=eval(method);var object_path=method.split(".");var first_word=eval(object_path[0]);if(typeof first_word=="undefined"||typeof first_word=="object"){this._mock_object(object_path,[]);object_path=method.split(".");var fn_name=object_path.pop();var obj=eval(object_path.join("."));obj[fn_name]=fn}else{if(typeof first_word=="function"&&object_path[1]){var obj=function(){};var old=first_word;for(var each in old.prototype){obj.prototype[each]=old.prototype[each]}obj.prototype[object_path[1]]=fn}}return obj};this.unmock=function(method){if(typeof test_runner.__mock_objects[method]!="undefined"){eval(method+"="+test_runner.__mock_objects[method])}};this.unmock_all=function(){for(var method in test_runner.__mock_objects){if(method.match(/^special-/)){continue}test_runner.unmock(method)}};this._mock_object=function(object_to_build,object_built){object_built.push(object_to_build.shift());var test;try{test=eval(object_built.join("."))}catch(e){var str=object_built.join(".")+" = new Object();";eval(str)}if(test=="undefined"){var str=object_built.join(".")+" = new Object();";eval(str)}if(object_to_build.length>0){this._mock_object(object_to_build,object_built)}};this._init_testmode=function(code){if(typeof test_runner=="undefined"){window.setTimeout(function(){test_runner._init_testmode(code)},200);return}test_runner.run=function(suite){code.suite=suite};code.reload_count=0;code.ajax=function(url,params){try{var response=code.suite.get_response(url,params.parameters);if(params.while_processing.show){$(params.while_processing.show).addClassName("hidden")}params.onSuccess({status:200,responseText:Object.toJSON(response)})}catch(e){if(code.reload_count++<15){window.setTimeout(function(){code.ajax(url,params)},200)}}}};this.generate_event_handler_tests=function(suite,tests){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated event handler tests"});for(var handler in tests){tests[handler].each(function(btn){if(typeof btn.el!="undefined"){btn.id=btn.id||btn.el.className||btn.el.tagName}else{btn.el=$(btn.id)}test_case["test_"+btn.id+"_is_hooked_up_to_"+handler+"_handler"]=function(handler,btn){if(typeof btn.setup!="undefined"){btn.setup()}var called={};if(typeof btn.preface!="undefined"){eval(btn.preface)}test_runner.mock(handler,function(){called[handler]=true;called.arguments=arguments});if(btn.el==null){btn.el=$(btn.id)}test_runner.Assert.isObject(btn.el,"Found "+btn.id+" element on the page");test_runner.UserAction.click(btn.el);test_runner.Assert.areSame(true,called[handler],"Called "+handler+" from "+btn.el.innerHTML+" element ("+btn.id+")");if(btn.args){btn.args.each(function(expected,idx){test_runner.Assert.isDeeply(expected,called.arguments[idx],"Got expected argument in position "+idx)})}}.curry(handler,btn)})}suite.add(test_case)};this.generate_dependency_tests=function(suite,dependencies){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated dependency tests"});dependencies.each(function(dependency){if(typeof dependency=="string"){test_case["test_"+dependency+"_element_id_exists"]=function(dependency){test_runner.Assert.elementIDExists(dependency)}.curry(dependency)}else{if(typeof dependency=="object"){if(dependency.test=="is_defined"){test_case["test_"+dependency.id+"_is_defined"]=function(dependency){test_runner.Assert.isObject(eval(dependency.id),dependency.id+" is loaded")}.curry(dependency)}}}});suite.add(test_case)};this.profile=function(object_name,object){test_runner.call_profile={};YAHOO.tool.TestRunner.subscribe(YAHOO.tool.TestRunner.COMPLETE_EVENT,function(){console.dir({coverage:test_runner.call_profile})});for(var each in object){if(typeof object[each]!="function"){continue}var rnd_name=each+"_"+(new Date()).getTime();object[rnd_name]=object[each];test_runner.call_profile[each]=0;object[each]=Function(object[each].argumentNames(),'test_runner.call_profile["'+each+'"]+=1;'+object_name+"."+rnd_name+"("+(object[each].argumentNames()).join(",")+")")}};var temp=BFW_Util.getCookie("bf_trace_path");this.trace_path=(temp==null)?new Array():eval("("+unescape(temp)+")");this.trace=function(object_name){var object=eval(object_name);var temp={};for(var key in object){temp[key]=object[key]}for(var each in temp){if(typeof object[each]!="function"){continue}if(object[each].toString().match(/trace_wrapper/)){continue}var rnd_name=each+"_"+(new Date()).getTime();object[rnd_name]=object[each];object[each]=Function(object[each].argumentNames(),'				var trace_wrapper = true; var __trace_context="unknown";				try{__trace_context = arguments.callee.caller.toString();}catch(e){} 				var __trace_result;					var __trace_e; 				var __log = {args:arguments,calling:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"calling_'+object_name+"."+each+'":__log}); 				try {					__trace_e="";					__trace_result='+object_name+"."+rnd_name+"("+(object[each].argumentNames()).join(",")+');				} catch(e){__trace_e=e}; 				__log = {error:__trace_e,_args:arguments,result:__trace_result,called:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"called_'+object_name+"."+each+'":__log}); 				BFW_Util.setCookie({name:"bf_trace_path",value:escape(Object.toJSON(test_runner.trace_path))}); 				if ( __trace_e != "" ) throw(__trace_e); 				return __trace_result')}};this.dump_trace=function(){var dump=window.open("","");test_runner.trace_path.each(function(entry){var str="<li>";for(var each in entry){str+="<b>"+each+"</b>: "+entry[each]+" ("+typeof entry[each]+") <br />"}str+="</li>";dump.document.writeln(str)})};this.clear_trace=function(){BFW_Util.deleteCookie("bf_trace_path");test_runner.trace_path=new Array()};this.wait_until=function(fn_timer,fn_run,deadlock_suffix){if(fn_timer()){fn_run()}else{if(!deadlock_suffix){deadlock_suffix=(new Date()).getTime();Facebook["__deadlock_"+deadlock_suffix]=0}else{if(Facebook["__deadlock_"+deadlock_suffix]++>100){fn_run()}}window.setTimeout(function(){test_runner.wait_until(fn_timer,fn_run,deadlock_suffix)},200)}};this.add=function(obj){var tr=YAHOO.tool.TestRunner;tr.add(obj)};this.run=function(suite){this._run(true,suite)};this.local_run=function(suite){this._run(false,suite)};this._run=function(post_to_server,suite){var tr=YAHOO.tool.TestRunner;tr.subscribe(tr.TEST_PASS_EVENT,test_runner.unmock_all);tr.subscribe(tr.TEST_FAIL_EVENT,test_runner.unmock_all);if(post_to_server){tr.subscribe(tr.COMPLETE_EVENT,function(results){var oReporter=new YAHOO.tool.TestReporter(BF_STATIC.web_root+"/_fixtures",YAHOO.tool.TestFormat.JSON);oReporter.report(results.results)})}var logger=new YAHOO.tool.TestLogger();if(window.location.href.match(/test_method=/i)){var params=window.location.href.split("&");params.each(function(args){if(args.match(/test_method=/i)){var trash=args.split(/=/);var test_method=trash[1];suite.items.each(function(test){for(var each in test){if(each.match(/^test_/i)&&each!=test_method){delete test[each]}}})}})}if(suite){tr.add(suite)}tr.run()};this.log_in=function(session){var default_session={session_key:"1234567812345678123456781234567812345678123456781234567812345678marcos",display_name:"Test%20User",image:"",username:"marcos",facebook_uid:"",show_account_settings:"true",registration_path:"signin",is_facebook_user:"false",terminal_user:"false",last_active:123456789,isa:"false",user_id:1234567};var obj=session?session:{};for(var key in default_session){if(typeof obj[key]=="undefined"){obj[key]=default_session[key]}}BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});var info_cookie="display_name="+obj.display_name;info_cookie+="&image="+obj.image;info_cookie+="&username="+obj.username;info_cookie+="&facebook_uid="+obj.facebook_uid;info_cookie+="&show_account_settings="+obj.show_account_settings;info_cookie+="&registration_path="+obj.registration_path;info_cookie+="&is_facebook_user="+obj.is_facebook_user;info_cookie+="&terminal_user="+obj.terminal_user;info_cookie+="&isa="+obj.isa;BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:info_cookie})};this.log_out=function(){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER)};this.extendAssertions=function(){test_runner.Assert=YAHOO.util.Assert;test_runner.UserAction={};for(var each in YAHOO.util.UserAction){if(each=="click"){test_runner.UserAction[each]=function(obj){if(obj.click){obj.click()}else{YAHOO.util.UserAction.click(obj)}}}else{test_runner.UserAction[each]=YAHOO.util.UserAction[each]}}test_runner.Assert.isVisible=function(id,msg){var value=$(id).visible()&&!$(id).hasClassName("hidden");test_runner.Assert.areEqual(true,value,msg?msg:id+" is visible")};test_runner.Assert.isHidden=function(id,msg){var value=$(id).visible()&&!$(id).hasClassName("hidden");test_runner.Assert.areEqual(false,value,msg?msg:id+" is hidden")};test_runner.Assert.isLike=function(str,regex,msg){test_runner.Assert.isNotNull(str.match(regex),msg?msg:str+" matches regex")};test_runner.Assert.isNotLike=function(str,regex,msg){test_runner.Assert.isNull(str.match(regex),msg?msg:str+" matches regex")};test_runner.Assert.elementIDExists=function(id,msg){test_runner.Assert.isNotNull($(id),msg?msg:id+" is on the page")};test_runner.Assert.isDeeply=function(obj1,obj2,msg){if(typeof obj1=="object"){for(var each in obj1){test_runner.Assert.isDeeply(obj1[each],obj2[each],msg)}}else{test_runner.Assert.areSame(obj1,obj2,msg)}}};this.load_tests=function(){var params=test_runner.parse_params();var tests_to_run=params.test_suite?test_runner.__test_suites[params.test_suite]():[];if(params.tests){var tests=params.tests.split(",");for(var i=0;i<tests.length;i++){tests_to_run.push(test_runner.__tests[tests[i]])}}if(params.test){tests_to_run.push(test_runner.__tests[params.test])}test_runner._wait_for_yahoo(test_runner.extendAssertions);test_runner._wait_for_yahoo(function(){test_runner.load_files(tests_to_run)})};this._wait_for_yahoo=function(fn){if(typeof this.__wait_count=="undefined"){this.__wait_count=0}else{if(this.__wait_count++>1000){alert("Took too long to load Yahoo files");return}}if(typeof YAHOO=="undefined"||typeof YAHOO.util=="undefined"||typeof YAHOO.util.UserAction=="undefined"||typeof YAHOO.util.Assert=="undefined"){window.setTimeout(function(e){test_runner._wait_for_yahoo(fn)},200)}else{fn()}};this.cookie=function(key){var cookie_arr=document.cookie.split(";");var cookie={};for(var i=0;i<cookie_arr.length;i++){var key_val=cookie_arr[i].split("=");key_val[0]=key_val[0].replace(/ /g,"");cookie[key_val[0]]=key_val[1]}return unescape(cookie[key])};this.parse_params=function(str){var params={};if(!str){str=window.location.search.substring(1)}var key_values=str.split("&");for(var i=0;i<key_values.length;i++){var data=key_values[i].split("=");if(data.length==2){params[data[0]]=data[1]}else{params[data[0]]=true}}return params};this.$=function(id){if($(id)){return $(id)}return $(test_runner.DOM_SYNONYMS[id])};this.load_files=function(files){if(typeof files=="string"){files=[{type:"text/javascript",url:files}]}for(var i=0;i<files.length;i++){var file_data=files[i];if(typeof file_data=="undefined"){continue}if(typeof file_data=="string"){file_data={type:"text/javascript",url:file_data}}if(file_data.type=="text/javascript"){this.load_javascript(file_data)}else{if(file_data.type=="text/css"){this.load_css(file_data)}else{console.error("unrecognized file type to load: "+file_data.type)}}}};this.load_javascript=function(data){var tag=document.createElement("script");tag.setAttribute("type",data.type);tag.setAttribute("src",data.url);tag.setAttribute("defer","false");if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(){document.getElementsByTagName("HEAD")[0].appendChild(tag)})}else{document.getElementsByTagName("HEAD")[0].appendChild(tag)}};this.load_css=function(data){var tag=document.createElement("link");tag.setAttribute("rel","stylesheet");tag.setAttribute("type",data.type);tag.setAttribute("href",data.url);if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(e){document.getElementsByTagName("HEAD")[0].appendChild(tag)})}else{document.getElementsByTagName("HEAD")[0].appendChild(tag)}};this.observe=function(ev,fn){if(!this.__EVENTS[ev]){this.__EVENTS[ev]=[]}this.__EVENTS[ev].push(fn)};this.fire_event=function(ev,args){var fns=test_runner.__EVENTS[ev]?test_runner.__EVENTS[ev]:[];for(var i=0;i<fns.length;i++){fns[i](args)}if(ev.indexOf(":done")==-1){test_runner.fire_event(ev+":done",args)}};this.__EVENTS={};this.DOM_SYNONYMS={};this.__tests={buzz_stats:"/static/js/public/test/buzz_stats.js",demo:"/static/js/public/test/demo.js",login:"/static/js/public/test/login.js",register:"/static/js/public/test/register.js",profile:"/static/js/public/test/profile.js",prepopulated_quickpost:"/static/js/public/test/prepopulated_quickpost_test.js",save_buzz:"/static/js/public/test/save_buzz_test.js",facebook2:"/static/js/public/test/facebook2_test.js",badges:"/static/js/public/test/badge_test.js",session_tracking:"/static/js/public/test/session_test.js",micro_sites:"/static/js/public/test/microsite_test.js",handler_test:"/static/js/public/test/generic_handler.js",inline_media_social_actions:"/static/js/public/test/inline-media-social-actions.js",signup:"/static/js/public/test/new_signup_page.js",settings:"/static/js/public/test/new_settings.js",quickpost:"/static/js/public/test/quickpost_test.js",dashboard:"/static/js/public/test/dashboard_test.js","dashboard-stats":"/static/js/public/test/dashboard-stats-test.js",dashboard_ad:"/static/js/public/test/dashboard_ad_test.js",dashboard_widget:"/static/js/public/test/dashboard_widget_test.js",dashboard_user_stats:"/static/js/public/test/dashboard_user_stats_test.js",realtimeweb:"/static/js/public/test/realtimeweb_test.js",user_switching:"/static/js/public/test/user_switching_test.js",user_tracking:"/static/js/public/test/user_tracking.js",user_panel:"/static/js/public/test/user_panel_test.js",universal_dom_traversal:"/static/js/public/test/universal_dom_traversal_test.js",social:"/static/js/public/test/social_test.js"};this.__test_suites={all:function(){var suite=[];for(var each in test_runner.__tests){suite.push(test_runner.__tests[each])}return suite}}};test_runner=new BFTestRunner();if(test_runner.parse_params()["testmode"]=="on"){test_runner.init()}var BoostManager=function(){this.BOOST_DIALOG_ID="bf_boost_dialog";this.BOOST_CALCULATE_CPM_PAGE="/buzzfeed/calculate_cpm";this.BOOST_SUBMIT_PAYMENT="/buzzfeed/buzzboost";this.REGISTER_AND_BOOST_SUBMIT_PAYMENT="/buzzfeed/_temp_wrapper";this.type="paypal";this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.pause=function(args){var params={action:"pause",ad_multiboost_id:args.ad_multiboost_id};var spinner=args.element.previous(".boost_spinner");spinner.show();args.element.hide();var sr=function(){args.element.siblings().each(function(el){el.show()});spinner.hide();var el=args.element.up("li");if(el&&el.hasClassName("running")){el.removeClassName("running");el.addClassName("paused")}};var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:params,onSuccess:sr})};this.unpause=function(args){var params={action:"unpause",ad_multiboost_id:args.ad_multiboost_id};var spinner=args.element.previous(".boost_spinner");spinner.show();args.element.hide();var sr=function(){args.element.siblings().each(function(el){el.show()});spinner.hide();var el=args.element.up("li");if(el&&el.hasClassName("paused")){el.removeClassName("paused");el.addClassName("running")}};var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:params,onSuccess:sr})};this.init=function(args){if(!acl.user_can("can_boost")){return}if(args.dialog){this.init_dialog(args)}else{if(args.create_post){this.init_create_post(args)}else{universal_dom.assign_handler({bucket:"boostable",event:"click",handler:bf_boost_manager.load_boost_dialog});universal_dom.assign_handler({bucket:"unpause",event:"click",handler:bf_boost_manager.unpause});universal_dom.assign_handler({bucket:"pause",event:"click",handler:bf_boost_manager.pause});universal_dom.get_bucket_elements("boostable").each(function(el){var data=el.getAttribute("rel:bf_data");if(data){try{var obj=eval("("+data+")");var user_id=parseInt(obj.user_id);el.removeClassName("hidden");el.parentNode.removeClassName("hidden")}catch(e){}}});if(acl.user_can("boost_admin")){$$(".admin-user-field").each(function(e){e.show()})}$$(".payment-type").each(function(e){e.observe("click",function(event){bf_boost_manager.toggle_payment()})})}}};this.init_dialog=function(args){};this.init_create_post=function(args){if(window.location.href.match(/\/boost(2)?/)){return}bf_login.init();user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(data){data.action="save_quickpost";data.anonymous=true});EventManager.observe("user_post:create:opening_form",bf_boost_manager.listen_for_enhanced);EventManager.observe("user_post:save:success",bf_boost_manager.save_ok);if($("facebook_post_to_fanpage_dialog")){$("facebook_post_to_fanpage_dialog").addClassName("hidden")}if($("quickpost-save-as-draft")){$("quickpost-save-as-draft").addClassName("hidden")}EventManager.observe("user_post:create:opening_form",bf_boost_manager.setup_preview);user_setting={save_image:bf_boost_manager.save_image}};this.setup_preview=function(args){var which_template=args.buzz_type=="link"?"preview-link-template":"preview-common-template";var template=$(which_template).innerHTML;template=template.replace(/%7B/g,"{");template=template.replace(/%7D/g,"}");bf_boost_manager.preview_template=new Template(template);var user=new BF_User();var data;if(user.isLoggedIn()){data=user.getUserInfo();if(!data.display_name){data.display_name=data.username}data.user_image=data.image||"/static/images/public/defaults/user.jpg";data.name="Your Title Here!";data.link_buzz="example.com";data.blurb="Your description here.";data.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{data={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}data.form=args.buzz_type;bf_boost_manager.update_preview(data);$("quickpost-title").observe("keyup",function(e){bf_boost_manager.update_preview({name:TT_Filters.html(e.target.value.substr(0,65))})});$("quickpost-description").observe("keyup",function(e){bf_boost_manager.update_preview({blurb:TT_Filters.boost_preview(e.target.value.substr(0,135))})});$("quickpost-link-url").observe("keyup",function(e){bf_boost_manager.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(id){$(id).observe("load",function(e){var isrc=e.target.getAttribute("src");bf_boost_manager.update_preview({image:isrc})})})};this.update_preview=function(args){for(var each in args){bf_boost_manager.preview_data[each]=args[each]}var html=bf_boost_manager.preview_template.evaluate(bf_boost_manager.preview_data);$("preview").update(html);$$(".ad_boost_image").each(function(e){e.src=bf_boost_manager.preview_data.image});var links=$("preview").getElementsByTagName("A");for(var i=0;i<links.length;i++){links[i].setAttribute("onclick","return false")}};this.listen_for_enhanced=function(args){if(args.buzz_type=="enhanced"){var modify_url=function(c){if((typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined")||(typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined")){if(typeof TopList!="undefined"){TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}if(typeof ClassifyQuiz!="undefined"){ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}}else{if(c<40){setTimeout(function(){modify_url(c+1)},250)}else{alert("We are unable to process your request at this time")}}};modify_url(0)}};this.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){bf_boost_manager.image_saved(resp)};var er=function(){bf_boost_manager.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if(typeof window.superlist!="undefined"){return superlist.set_parent_image(resp)}if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("quickpost-super-image-file")){$("quickpost-super-image-file").value=obj.thumb_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();if($("image-preview-div")){$("image-preview-div").show()}}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}if(!Object.isUndefined(this.settings)){this.settings.image=obj.image}}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(args){if(args.json.updated){window.location.href=BOOST_PAYMENT_FORM+"?buzz_id="+args.json.id}};this.load_boost_dialog=function(data){if(!acl.user_can("can_boost")){return}var onload=function(){var bf_boost_manager=new top.BoostManager();bf_boost_manager.init({dialog:true})};if(!"multiboost" in window){return}multiboost.get_boosts_setup();var url="boost_modal/select_tier",w=800,h=525;if(multiboost.has_active_multiboost()){if(multiboost.has_added_buzz(data.buzz_id)){url="boost_modal/already_added";h=205}else{if(multiboost.has_room_for_more_boosts()){url="boost_modal/add_it";h=190;multiboost.add_buzz_to_boost_list({campaignid:data.buzz_id})}else{if(multiboost.tier_id<3){url="boost_modal/upgrade";h=250}else{url="boost_modal/no_more_room";h=260}}}}BF_UI.create_or_show_dialog({width:w,height:h,scrolling:"no",title:"Boost This!",id:bf_boost_manager.BOOST_DIALOG_ID,url:"/buzzfeed/"+url+"?buzz_id="+data.buzz_id+"&cb="+(new Date()).getTime(),onload:[onload]})};this.toggle_payment=function(){var payment_type=$$("input[name=type]:checked").first().value,rate=multiboost.tier.default_rate;var spend="25";this.type=payment_type;if(payment_type=="paypal"||payment_type=="paypal_account"){spend="95"}if(payment_type=="coupon"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.show()});var minimum_impressions=multiboost.commify(parseInt(parseInt(spend)/rate,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(el){el.update(minimum_impressions)})}else{if(payment_type=="admin"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.show()});if($("spend-paypal").value){$("admin-spend").value=$("spend-paypal").value}}else{if(payment_type=="paypal"){$("submit").value="Charge My Card";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.show()})}else{$("submit").value="Pay with Paypal";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.show()})}}}};this.submit=function(args){try{for(var key in args){args[key]=args[key].toString().strip()}if(args.city=="City"){args.city=""}if(args.coupon_id=="Coupon Code"){args.coupon_id=""}if(args.first_name=="First Name"){args.first_name=""}if(args.last_name=="Last Name"){args.last_name=""}if(args.street=="Street Address"){args.street=""}if(args.zip=="Zip Code"){args.zip=""}if(args.cc_type=="unknown"){args.cc_type=""}if(this.type=="coupon"&&args.coupon_id==""){$("error-dialog").update("Please enter a Coupon Code");$("error-dialog").removeClassName("hidden");$("error-dialog").addClassName("error");return}if(this.type=="admin"){args.amount=$F("admin-spend");args.admin_boost=1}if($("spinner")&&$("payment_form")){$("spinner").removeClassName("hidden");$("submit").addClassName("hidden")}if($("error-dialog")){$("error-dialog").addClassName("hidden")}if($("registration-error-dialog")){$("registration-error-dialog").addClassName("hidden")}if($("login-error-dialog")){$("login-error-dialog").addClassName("hidden")}if(bf_boost_manager.errors){bf_boost_manager.errors.each(function(detail){if(document.forms.payment.elements[detail]){document.forms.payment.elements[detail].removeClassName("error")}})}args.action="multiboost";args.type=this.type;args.amount=Math.floor(args.amount*100)/100;args.amount=args.amount.toString();var check_decimals=args.amount.split(".");if(!check_decimals[1]){check_decimals[1]="00"}else{if(check_decimals[1].length==1){check_decimals[1]+="0"}}args.amount=check_decimals.join(".");var url=bf_boost_manager.BOOST_SUBMIT_PAYMENT;if(args.register_user=="true"){url=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;args.action="register_user_and_boost";var err=$("registration-error-dialog");if(args.pw.length<6){if(err){err.update("Password must be at least 6 characters");err.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");err.showOnScreen()}return}if(args.username.length<3||args.username.length>30){if(err){err.update("Username must be at least 3 characters and no more than 30 characters");err.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");err.showOnScreen()}return}}else{if(args.login_user=="true"){url=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;args.action="login_user_and_boost"}}(new BF_Request).request(url,{method:"post",parameters:args,onComplete:function(r){bf_boost_manager._submit(eval("("+r.responseText+")"))}})}catch(e){console.error(e)}};this._submit=function(result){if(result.success==0){var error_dialog=$("error-dialog");if(typeof result.login!="undefined"&&!result.login){error_dialog=$("login-error-dialog");error_dialog.update("Invalid username or password");error_dialog.removeClassName("hidden");if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}}else{if($("registration-error-dialog")&&result.error_section=="registration"){error_dialog=$("registration-error-dialog")}if($("login-error-dialog")&&result.error_section=="login"){error_dialog=$("login-error-dialog")}if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}error_dialog.removeClassName("hidden");error_dialog.update("");var ul=document.createElement("ul");ul.appendChild(document.createTextNode(result.message));bf_boost_manager.errors=result.errors;var prepend_login=false;if("login"==result.error_section){prepend_login=true}if("registration"==result.error_section){prepend_register=true}result.errors.each(function(detail){if(detail=="username"&&prepend_login){detail="login_username"}if(detail=="email"&&prepend_register){detail="register_email"}if(detail=="cc_type"){var li=document.createElement("li");li.appendChild(document.createTextNode("Invalid Credit Card"));ul.appendChild(li)}if(document.forms.payment.elements[detail]){$(document.forms.payment.elements[detail]).addClassName("error")}else{var li=document.createElement("li");li.appendChild(document.createTextNode(detail));ul.appendChild(li)}});error_dialog.appendChild(ul)}error_dialog.showOnScreen()}else{if(result.redirect){if(!(new BF_User()).isLoggedIn()){bf_login.loggedIn(result)}window.location.href=result.redirect}else{if(result.error){var error_dialog=$("login-error-dialog");error_dialog.removeClassName("hidden");error_dialog.update("There is a problem with your account. Please contact us at support@buzzfeed.com");error_dialog.showOnScreen()}else{var extra_data=[];["first_name","last_name","street","city","state","zip"].each(function(p){extra_data.push(p+"="+result.params[p])});if(!(new BF_User()).isLoggedIn()){bf_login.loggedIn(result)}window.location.href="/buzzfeed/_boost_receipt?transaction_id="+result.transaction_id+"&buzz_id="+result.buzz_id+"&"+extra_data.join("&")}}}};this.update_expiration_date=function(f){var parts=[f.elements.month[f.elements.month.selectedIndex].value,f.elements.year[f.elements.year.selectedIndex].value];var ok=true;if(parts[0]<10){parts[0]="0"+parts[0]}else{parts[0]=""+parts[0]}parts.each(function(v){if(v==0){ok=false}});if(ok){f.elements.cc_expires.value=parts.join("")}};this.cc_checker=[{id:"AMEX",regex:new RegExp("^3")},{id:"VISA",regex:new RegExp("^4")},{id:"MASTERCARD",regex:new RegExp("^5")},{id:"DISCOVER",regex:new RegExp("^6")}];this.update_cc_type=function(cc_number,update_field,highlight_mapping){var type="unknown";bf_boost_manager.cc_checker.each(function(data){if($(highlight_mapping[data.id])){$(highlight_mapping[data.id]).removeClassName("selected")}});bf_boost_manager.cc_checker.each(function(data){if(cc_number.match(data.regex)){type=data.id;if(typeof highlight_mapping[type]!="undefined"&&$(highlight_mapping[type])){$(highlight_mapping[type]).addClassName("selected")}}});if($(update_field)){$(update_field).value=type}}};var bf_boost_manager=new BoostManager();BuzzLoader.register(function(){if(window.location.href.match(/boost_dialog/)){bf_boost_manager.init({dialog:true,url:window.location.href})}else{if(window.location.href.match(/\/boost$/)){bf_boost_manager.init({create_post:true})}else{bf_boost_manager.init({})}}},2);var BF_MultiBoost=function(){this.debug=function(msg,data){if(multiboost.debug){if(!data){data={}}data.msg=msg;console.dir(data)}};this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.boost_list=[];this.TIER_DEFINITIONS={"1":{name:"Boost",max_boosts:1,level:1,min_buy:95,max_buy:999,default_rate:0.003},"2":{name:"Optimized Boost",max_boosts:5,level:2,min_buy:1000,max_buy:4999,default_rate:0.002},"3":{name:"Big Seed",max_boosts:10,level:3,min_buy:5000,max_buy:100000,default_rate:0.002}};this.BOOST_COOKIE_NAME="bf_boost_list";this.FACEBOOK_BUZZ_AD=new Template(' 		<p class="error-message" id="error-message-#{unique_id}" style="display:none;"></p> 		<div class="fb_box c"> 		 <h3 class="bf_dom editable" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_name\'}}">#{fb_name}</h3><div id="#{campaignid}-fb_name-length" class="blurb_length headline"></div> 		 <div class="c"> 			 <div class="photo"><img src="#{image_root}#{image}" alt="" /></div> 			 <div class="info"> 				 <p class="bf_dom editable" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_blurb\'}}">#{fb_blurb}</p><div id="#{campaignid}-fb_blurb-length" class="blurb_length"></div> 				 <a rel:gtrack_id="preview/fb-ad/link" class="bf_dom" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_link_url\'}}" href="#{fb_link_url}" onclick="return false" contentEditable="true">#{fb_link_url}</a> 			 </div> 			</div>   		</div> 		<a rel:gtrack_id="preview/fb-ad/edit" class="edit button" href="javascript:;" onclick="multiboost.toggle_fb_contenteditable(this.parentNode); return false;">Edit</a> 		<a rel:gtrack_id="preview/fb-ad/preview" class="bf_dom save button" href="javascript:;" rel:bf_bucket_data="{\'fb-save\':{\'id\':\'#{campaignid}\'}}">Preview</a> 	');this.FACEBOOK_BUZZ_KEYWORDS=new Template(' 		<div class="c"> 			<div class="interests"> 			  <div class="interest_field"> 					<input rel:gtrack_id="preview/fb-ad/keywords/input" class="keyword" placeholder="Enter an interest" onkeyup="facebook.updateKeywords(\'#{unique_id}\',this.value,true)" type="text" id="kw-#{unique_id}" /> 					<input rel:gtrack_id="preview/fb-ad/keywords/search" id="search-#{unique_id}" onclick="var kw_val = $(\'kw-#{unique_id}\').value; if (kw_val && kw_val.strip() != \'\') {facebook.lookup_keywords(this.parentNode,$(\'kw-#{unique_id}\').value, \'#{unique_id}\');}" type="button" value="+" /> 					<img id="lookup-loading-#{unique_id}" style="display:none;" src="#{static_root}/images/public/spinners/small_on_white.gif" /> 			  	<p style="display:none;" id="users-reach-#{unique_id}">Keyword Reach: <span id="users-#{unique_id}">&hellip;</span></p> 				</div> 				<div style="display: none;" id="keywords-#{unique_id}" onmouseover="clearTimeout(this.hide_timeout);" onmouseout="facebook.keyword_suggest_mouseout(\'#{unique_id}\');" class="keywords_list"></div> 				<ul class="keywords" id="terms-#{unique_id}"></ul> 			</div> 		</div> 		<div class="reach" id="post-reach-#{unique_id}" style="display:none;"><strong>Estimated Reach:</strong> <span id="post-#{unique_id}">&hellip;</span></div> 	');this.COMMA_DELIMITER=/(\d)(\d\d\d)(,\d{3,})*$/;this.get_tier_from_cookie=function(){var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);var tier="1";if(obj_str){var obj=eval("("+unescape(obj_str)+")");tier=obj.tier;multiboost.select_tier({tier:tier})}return tier};this.init=function(){if(!acl.user_can("can_boost")){return}if(Prototype.Browser.IE6){$("step_crumbs").hide();$("boost_ie6_warning").removeClassName("hidden");return}try{multiboost.already_boosted=[];multiboost.buzz_cache={};multiboost.set_page({step:"select_tier"});multiboost.get_boosts_setup();multiboost.boost_search_element="search-buzz";multiboost.boost_search_spinner="search-buzz-spinner";multiboost.boost_list_preview_element="selected-buzz";multiboost.boost_list_preview_spinner="selected-buzz-spinner";multiboost.customization_table="customization-table";multiboost.update_cart_icon();if(window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){universal_dom.assign_handler({bucket:"update_field",handler:multiboost.update_field});universal_dom.assign_handler({bucket:"select-tier",event:"click",handler:multiboost.select_tier});universal_dom.assign_handler({bucket:"upgrade-tier",event:"click",handler:function(args){multiboost.select_tier({tier:multiboost.tier_id+1});if(args.choose_buzz){multiboost.choose_buzz()}if(args.customize_buzz){multiboost.customize_buzz()}}});universal_dom.assign_handler({bucket:"upgrade-tier-and-add",event:"click",handler:function(args){multiboost.select_tier({tier:multiboost.tier_id+1});multiboost.add_buzz_to_boost_list({campaignid:args.buzz_id});$("boost_modal_upgrade").hide();$("boost_modal_selected_upgrade").show();if(args.close){multiboost.start_timer(5)}}});universal_dom.assign_handler({bucket:"select-tier-and-add",event:"click",handler:function(args){multiboost.select_tier({tier:args.tier});multiboost.add_buzz_to_boost_list({campaignid:args.buzz_id});$("boost_modal_choose_tier").hide();$("boost_modal_selected_tier").show();if(args.close){multiboost.start_timer(8)}}});universal_dom.assign_handler({bucket:"confirm-removal-buzz-from-list",event:"click",handler:multiboost.confirm_removal_buzz_from_boost_list});universal_dom.assign_handler({bucket:"close-modal",event:"click",handler:function(){universal_dom.get_bucket_elements("boost-modal").each(function(el){el.hide()})}});universal_dom.assign_handler({bucket:"pull-buzz-from-list",event:"click",handler:multiboost.remove_buzz_from_boost_list});universal_dom.assign_handler({bucket:"add-buzz-to-list",event:"click",handler:multiboost.add_buzz_to_boost_list});universal_dom.assign_handler({bucket:"search-next-page",event:"click",handler:function(e){multiboost.search_page++}});universal_dom.assign_handler({bucket:"search-previous-page",event:"click",handler:function(e){multiboost.search_page--}});universal_dom.assign_handler({bucket:"user-search-input",event:"keypress",handler:function(e){if(e.keyCode==Event.KEY_RETURN){Event.stop(e);multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}}});universal_dom.assign_handler({bucket:"user-search",event:"click",handler:function(e){multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}});universal_dom.assign_handler({bucket:"open-search",event:"click",handler:multiboost.open_search});universal_dom.assign_handler({bucket:"change-tier",event:"click",handler:function(){multiboost.set_page({step:"select_tier"})}});universal_dom.assign_handler({bucket:"choose-buzz",event:"click",handler:multiboost.choose_buzz});universal_dom.assign_handler({bucket:"customize-buzz",event:"click",handler:multiboost.customize_buzz});universal_dom.assign_handler({bucket:"edit",event:"keyup",handler:multiboost.edit_buzz});universal_dom.assign_handler({bucket:"fb-save",event:"click",handler:function(data){multiboost.toggle_fb_contenteditable(data.element.parentNode);multiboost.edit_buzz(data)}});universal_dom.assign_handler({bucket:"set-page",event:"click",handler:multiboost.set_page});universal_dom.assign_handler({bucket:"save-buzz",event:"click",handler:function(data){data.target.form=$("edit-quickpost-form");user_post.save_quickpost(data)}});universal_dom.assign_handler({bucket:"boost_payment",event:"click",handler:multiboost.boost_payment});universal_dom.assign_handler({bucket:"update_amount",event:"blur",handler:multiboost.update_amount});universal_dom.assign_handler({bucket:"reboost",event:"click",handler:multiboost.reboost});universal_dom.assign_handler({bucket:"boost-help",event:"click",handler:multiboost.help_dialog});multiboost.refresh_boosted_buzz_preview();multiboost.search_page=1;if(window.location.href.match(/\/(buzz)?(old_)?boost(2)?/)){if(typeof(user_post)!="undefined"){user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(data){data.action="save_quickpost";data.anonymous=true;data.manual_moderation=1});EventManager.observe("user_post:create:opening_form",multiboost.listen_for_enhanced);EventManager.observe("user_post:save:success",multiboost.save_ok);EventManager.observe("user_post:create:opening_form",multiboost.setup_preview);user_setting={save_image:multiboost.save_image}}}if(typeof(facebook)!="undefined"){facebook.FB_KEYWORDS_CONTROLLER="/buzzfeed/_temp_wrapper"}if(multiboost.tier&&window.location.href.indexOf("#customize")!=-1){var timeout_incr=0,fn=function(){try{multiboost.customize_buzz()}catch(e){if(timeout_incr<=10){setTimeout(fn,250)}timeout_incr++}};fn()}}}catch(e){}};this.get_boosts_setup=function(){multiboost.boost_list=multiboost.load_boost_list();multiboost.tier_id=multiboost.get_tier_from_cookie();multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id]};this.contact_customer_service=function(){var user=new top.BF_User();return window.location.href.indexOf("/old_boost")!=-1&&user.isLoggedIn()&&user.getUserInfo().f_raw==0};this.commify=function(num){num=num+"";while(num.match(multiboost.COMMA_DELIMITER)){num=num.replace(multiboost.COMMA_DELIMITER,"$1,$2$3")}return num};this.reboost=function(args){if(!args.ad_multiboost_id){return}var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:{action:"reboost",ad_multiboost_id:args.ad_multiboost_id}})};this.has_active_multiboost=function(){var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);return obj_str!=null};this.has_room_for_more_boosts=function(){if(!multiboost.has_active_multiboost){return false}return multiboost.tier.max_boosts-multiboost.boost_list.length};this.update_field=function(data,args){var value=eval(args.value),comma_delimiter=eval(args.comma_delimiter);if(comma_delimiter){value=multiboost.commify(value)}args.element.update(value)};this.update_amount=function(data){$("submit").removeClassName("hidden");var amount=parseInt(data.element.value,10),rate=multiboost.tier.default_rate,min_buy=multiboost.tier.min_buy,max_buy=multiboost.tier.max_buy;if(!amount||amount==NaN){amount=0}if(amount<min_buy||amount>max_buy){if($("amount-error-field")&&$("amount-error-field-text")){$("amount-error-field-text").update("Your amount must be between $"+multiboost.commify(min_buy)+" and $"+multiboost.commify(max_buy)+".");$("amount-error-field").show();$("submit").addClassName("hidden")}amount=""}else{if($("amount-error-field")){$("amount-error-field").hide()}}data.element.value=amount;var minimum_impressions=multiboost.commify(parseInt(amount/rate,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(el){el.update(minimum_impressions)})};this.boost_payment=function(){var overrides={};var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");for(var each in multiboost.buzz_cache){var buzz=multiboost.buzz_cache[each];if(buzz.fb_blurb){buzz.fb_blurb=buzz.fb_blurb.unescapeHTML();buzz.fb_blurb=buzz.fb_blurb.replace(/<[^>]*>/g,"").substr(0,89);buzz.fb_blurb=buzz.fb_blurb.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(buzz.fb_blurb.match(subsequent_punctuation)){buzz.fb_blurb=buzz.fb_blurb.replace(subsequent_punctuation,"$1 $2")}}if(buzz.fb_name){buzz.fb_name=buzz.fb_name.unescapeHTML();buzz.fb_name=buzz.fb_name.replace(/<[^>]*>/g,"").substr(0,24);buzz.fb_name=buzz.fb_name.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(buzz.fb_name.match(subsequent_punctuation)){buzz.fb_name=buzz.fb_name.replace(subsequent_punctuation,"$1 $2")}}overrides[each]={name:multiboost.buzz_cache[each].fb_name,blurb:multiboost.buzz_cache[each].fb_blurb}}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);obj=eval("("+unescape(obj_str)+")")||{};obj.overrides=overrides;createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON(obj)),null,".buzzfeed.com");window.location.href=BOOST_PAYMENT_FORM};this.set_page=function(args){universal_dom.get_bucket_elements("step").each(function(el){var info=el.getAttribute("rel:bf_bucket_data");var data=eval("("+info+")");el.removeClassName("selected");universal_dom.get_bucket_elements(data.step).each(function(id){id.addClassName("hidden")})});universal_dom.get_bucket_elements("step").each(function(el){var info=el.getAttribute("rel:bf_bucket_data");var data=eval("("+info+")");if(data.step==args.step){el.addClassName("selected");universal_dom.get_bucket_elements(data.step).each(function(id){id.removeClassName("hidden")})}});multiboost._retrigger_gtrack("1")};this.open_search=function(){$(multiboost.boost_search_element).update("");if(multiboost.exceeded_max_boosts()){return}else{multiboost.set_page({step:"search"})}var user=new BF_User();if(user.isLoggedIn()){universal_dom.get_bucket_elements("user-search-input").each(function(el){el.value=user.getUserInfo().username})}};this.choose_buzz=function(){multiboost.search_page=1;multiboost.set_page({step:"choose"});universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});if($("select-quickpost-box")){$("select-quickpost-box").show()}if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.removeClassName("hidden")})}};this.setup_preview=function(args){var which_template=args.buzz_type=="link"?"preview-link-template":"preview-common-template";if(!which_template||!$(which_template)){return}var template=$(which_template).innerHTML;template=template.replace(/%7B/g,"{");template=template.replace(/%7D/g,"}");multiboost.preview_template=new Template(template);var user=new BF_User();var data;if(user.isLoggedIn()){data=user.getUserInfo();if(!data.display_name){data.display_name=data.username}data.user_image=data.user_image||"/static/images/public/defaults/user.jpg";data.name="Your Title Here!";data.link_buzz="example.com";data.blurb="Your description here.";data.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{data={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}data.form=args.buzz_type;multiboost.update_preview(data);$("quickpost-title").observe("keyup",function(e){multiboost.update_preview({name:TT_Filters.html(e.target.value)})});$("quickpost-description").observe("keyup",function(e){multiboost.update_preview({blurb:TT_Filters.boost_preview(e.target.value)})});$("quickpost-link-url").observe("keyup",function(e){multiboost.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(id){$(id).observe("load",function(e){var isrc=e.target.getAttribute("src");multiboost.update_preview({image:isrc})})});multiboost.set_page({step:"create-buzz"})};this.update_preview=function(args){for(var each in args){multiboost.preview_data[each]=args[each]}var html=multiboost.preview_template.evaluate(multiboost.preview_data);$("preview").update(html);var links=$("preview").getElementsByTagName("A");for(var i=0;i<links.length;i++){links[i].setAttribute("onclick","return false")}};this.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){multiboost.image_saved(resp)};var er=function(){multiboost.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}this.settings.image=obj.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(args){multiboost.add_buzz_to_boost_list({campaignid:args.json.id});multiboost.set_page({step:"choose"})};this.exceeded_max_boosts=function(){var exceeded=false;if(multiboost.tier&&multiboost.boost_list.length>=multiboost.tier.max_boosts){var msg="You cannot create more boosts. ";if(multiboost.tier.max_boosts<10){var next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);msg+="You can upgrade to "+(next_tier?next_tier.name:"a higher plan")+" if you want more boosts."}alert(msg);exceeded=true;window.setTimeout(multiboost.choose_buzz,250)}return exceeded};this.listen_for_enhanced=function(args){if(multiboost.exceeded_max_boosts()){return}if(args.buzz_type=="enhanced"){var modify_url=function(c){if((typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined")||(typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined")){if(typeof TopList!="undefined"){TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}if(typeof ClassifyQuiz!="undefined"){ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}}else{if(c<40){setTimeout(function(){modify_url(c+1)},250)}else{alert("We are unable to process your request at this time.")}}};modify_url(0)}};this.select_tier=function(args){if(multiboost.contact_customer_service()){alert("There is a problem with your account. Please contact support@buzzfeed.com")}else{multiboost.tier_id=args.tier;multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id];if(!multiboost.tier){return}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME),next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);obj=eval("("+unescape(obj_str)+")")||{};if(multiboost.boost_list.length>multiboost.tier.max_boosts){multiboost.boost_list=multiboost.boost_list.splice(0,multiboost.tier.max_boosts)}createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");multiboost.refresh_boosted_buzz_preview();multiboost.choose_buzz();universal_dom.get_bucket_elements("current-tier").each(function(el){el.update(multiboost.tier.name)});universal_dom.get_bucket_elements("next-tier").each(function(el){el.update(next_tier&&next_tier.name?next_tier.name:multiboost.tier.name)});universal_dom.get_bucket_elements("max-buzz-for-tier").each(function(el){el.update(multiboost.tier.max_boosts)});if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.hide()})}}};this.load_boost_list=function(){var boost_list=[];var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);if(obj_str){obj=eval("("+unescape(obj_str)+")");boost_list=obj.boosts}return boost_list};this.boost_list_upsell=function(){if(multiboost.boost_list.length>=multiboost.tier.max_boosts&&multiboost.tier.level<3){var preview_elm=$(multiboost.boost_list_preview_element);preview_elm.select(".upsell").each(function(el){el.remove()});var li=document.createElement("li"),next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);li.className="upsell preview";li.innerHTML='<div class="msg">Want to boost more posts?<br /><a href="javascript:;" rel:gtrack_id="upgrade-tier/choose" class="bf_dom" rel:bf_bucket_data="{\'upgrade-tier\':{\'choose_buzz\':true}}" onclick="return false;">Upgrade</a> to '+(next_tier?next_tier.name:"a higher plan")+".</div>";preview_elm.appendChild(li);universal_dom.update(preview_elm)}};this.already_boosted_this=function(id){alert("This buzz already has been boosted and cannot be reboosted until its current campaign finishes.");multiboost.remove_buzz_from_boost_list({id:id})};this.add_buzz_to_boost_list=function(args){if(multiboost.exceeded_max_boosts()){return}var id=args.campaignid;if(!id){multiboost.debug("add_buzz_to_boost_list requires campaignid",args)}var ok=true;multiboost.already_boosted.each(function(id){if(id==args.campaignid){multiboost.already_boosted_this(id);ok=false}});if(ok){if(multiboost.boost_list.length<multiboost.tier.max_boosts){var dup=false;multiboost.boost_list.each(function(bid){if(id==bid){dup=true}});if(!dup){multiboost.boost_list.push(id)}}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);obj=eval("("+unescape(obj_str)+")")||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.hide()});multiboost.refresh_boosted_buzz_preview();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.removeClassName("hidden")})}}multiboost._retrigger_gtrack("2")};this.help_dialog=function(args){if(!args.article){return false}universal_dom.get_bucket_elements("boost-help-dialog").each(function(el){el.select(".article").each(function(el2){if(el2.id==args.article){el2.show()}else{el2.hide()}});el.removeClassName("hidden");el.show()})};this.confirm_removal_buzz_from_boost_list=function(args){universal_dom.get_bucket_elements("remove-buzz").each(function(el){el.args=args;universal_dom.assign_handler({bucket:"remove-buzz-button",event:"click",handler:function(e){multiboost.remove_buzz_from_boost_list(el.args);el.hide()}});el.removeClassName("hidden");el.show()})};this.remove_buzz_from_boost_list=function(args){var id=args.campaignid;if(!id){multiboost.debug("add_buzz_to_boost_list requires campaignid",args)}var list=[];multiboost.boost_list.each(function(bid){if(bid!=id){list.push(bid)}});delete multiboost.buzz_cache[id];multiboost.boost_list=list;var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);var obj=eval("("+unescape(obj_str)+")")||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.show()})}multiboost.refresh_boosted_buzz_preview();multiboost.update_customized_buzz();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.addClassName("hidden")})}multiboost._retrigger_gtrack("3")};this.refresh_boosted_buzz_preview=function(){if(!window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){return}if(!multiboost.tier){return}var missing_buzzes=[];multiboost.boost_list.each(function(bid){if(!multiboost.buzz_cache[bid]){missing_buzzes.push(bid)}});if(missing_buzzes.length>0){var ajax=(new BF_Request).request;ajax("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"get_buzzes",buzz_ids:missing_buzzes.join(",")},onSuccess:multiboost._refresh_boosted_buzz_preview,while_processing:{show:multiboost.boost_list_preview_spinner,hide:multiboost.boost_list_preview_element}})}else{multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(i){return multiboost.buzz_cache[i]})})}};this._refresh_boosted_buzz_preview=function(r){var obj=eval("("+r.responseText+")");obj.buzzes.each(function(buzz){multiboost.buzz_cache[buzz.campaignid]=buzz});var buzz_list=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(i){return multiboost.buzz_cache[i]});multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:buzz_list});multiboost.update_customized_buzz()};this._refresh_buzz_preview=function(args){if(!args.container){return}var container=$(args.container),buzz_list=args.buzz_list,template_cache={},h3_regex=new RegExp("<h3>"),p_regex=new RegExp('<p class="description">');container.innerHTML="";if(buzz_list&&buzz_list.length>0){buzz_list.each(function(data){var template;if(data){data.image_root=BF_STATIC.image_root;data.user_image=data.user_image||"/static/images/public/defaults/user.jpg";if(!args.template){var templateElement=(data.form=="link"?"preview-link-template":"preview-common-template");if(!template_cache[templateElement]){template_str=$(templateElement).innerHTML;template_str=template_str.replace(/%7B/g,"{");template_str=template_str.replace(/%7D/g,"}");template_cache[templateElement]=new Template(template_str)}template=template_cache[templateElement]}else{template=args.template}data.static_root=BF_STATIC.static_root;var html=template.evaluate(data);var li=document.createElement("li");li.className="preview"+(multiboost.buzz_cache[data.campaignid]?" selected":"")+(data.boosted?" already_boosted":"");li.innerHTML=html;container.appendChild(li);try{if(data.boosted){multiboost.already_boosted.push(data.campaignid)}}catch(e){}}});var imgs=container.getElementsByTagName("img");for(var i=0;i<imgs.length;i++){$(imgs[i]).removeClassName("ad_boost_image")}}multiboost.boost_list_upsell();universal_dom.update(container)};this.search_for_user_posts=function(args){var username=args.username,ajax=(new BF_Request()).request,pagination=$$("#modal_search .pagination").first();if(username==""){return false}if(pagination){pagination.hide()}if(multiboost.search_page<1){multiboost.search_page=1}ajax("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"recent_buzz",usernames:username,flag_boosted:1,page:multiboost.search_page},onSuccess:multiboost._search_for_user_posts,while_processing:{show:multiboost.boost_search_spinner,hide:multiboost.boost_search_element}})};this._search_for_user_posts=function(r){var obj=eval("("+r.responseText+")"),container=$(multiboost.boost_search_element),pagination=$$("#modal_search .pagination").first();if(obj.buzzes&&obj.buzzes.length>0){multiboost._refresh_buzz_preview({container:container,buzz_list:obj.buzzes});if(pagination){pagination.show()}}else{container.innerHTML='<p class="suggest">No posts were found. Please check to see if the username exists.</p>';if(pagination){pagination.hide()}}multiboost._retrigger_gtrack("5")};this.customize_buzz=function(){if(!multiboost.contact_customer_service()){multiboost.set_page({step:"customize"});multiboost.update_customized_buzz()}};this.toggle_fb_contenteditable=function(el){var contenteditable=el.hasClassName("contenteditable");el.select(".editable").each(function(elm){if(contenteditable){elm.contentEditable=false;elm.removeAttribute("contentEditable");var obj=eval("("+elm.getAttribute("rel:bf_bucket_data")+")");elm.innerHTML=multiboost.buzz_cache[obj.edit.id][obj.edit.field]}else{elm.setAttribute("contentEditable",true)}});if(contenteditable){el.removeClassName("contenteditable")}else{el.addClassName("contenteditable")}return false};this.filter_facebook_text=function(str){return str.replace(/<[^>]*>/g,"").replace(/(&rsquo;|&lsquo;)/ig,"'").replace(/(&rdquo;|&ldash;)/ig,'"').replace(/(&mdash;|&ndash;)/ig,"-").replace(/&([A-Z0-9\-\#]+);/ig,"").replace(/[^\w\d \-\;\&\.\,\!\'\"\?]/g,"")};this.update_customized_buzz=function(){var buzz_list=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).reject(function(i){return(typeof(multiboost.buzz_cache[i])=="undefined")}).map(function(i){return multiboost.buzz_cache[i]});var temp=document.createElement("ul");temp.className="hidden";var fb_temp=document.createElement("ul");fb_temp.className="hidden";var kw_temp=document.createElement("ul");kw_temp.className="hidden";document.getElementsByTagName("BODY")[0].appendChild(temp);document.getElementsByTagName("BODY")[0].appendChild(fb_temp);document.getElementsByTagName("BODY")[0].appendChild(kw_temp);var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");buzz_list.each(function(buzz){if(!buzz){return}if(!buzz.link_url){buzz.link_url=""}if(!buzz.fb_name){buzz.fb_name=buzz.title.unescapeHTML();buzz.fb_name=multiboost.filter_facebook_text(buzz.fb_name).substr(0,24).strip();while(buzz.fb_name.match(subsequent_punctuation)){buzz.fb_name=buzz.fb_name.replace(subsequent_punctuation,"$1 $2")}}if(!buzz.fb_blurb){buzz.fb_blurb=buzz.blurb.unescapeHTML();buzz.fb_blurb=multiboost.filter_facebook_text(buzz.fb_blurb).substr(0,89).strip();while(buzz.fb_blurb.match(subsequent_punctuation)){buzz.fb_blurb=buzz.fb_blurb.replace(subsequent_punctuation,"$1 $2")}}if(!buzz.fb_link_url){buzz.fb_link_url=buzz.link_url.replace(/<[^>]*>/g,"")}buzz.unique_id=buzz.campaignid});multiboost._refresh_buzz_preview({container:temp,buzz_list:buzz_list});multiboost._refresh_buzz_preview({container:fb_temp,buzz_list:buzz_list,template:multiboost.FACEBOOK_BUZZ_AD});multiboost._refresh_buzz_preview({container:kw_temp,buzz_list:buzz_list,template:multiboost.FACEBOOK_BUZZ_KEYWORDS});boosts=temp.getElementsByTagName("LI");fbs=fb_temp.getElementsByTagName("LI");kws=kw_temp.getElementsByTagName("LI");var table=$(multiboost.customization_table);table.update("");table.addClassName("loading");for(var i=0;i<boosts.length;i++){var tr=document.createElement("tr"),td1=document.createElement("td"),td2=document.createElement("td"),td3=document.createElement("td"),td4=document.createElement("td"),td5=document.createElement("td");tr.id="preview-"+buzz_list[i].campaignid;td1.className="notice";td1.innerHTML='<div class="cellbox c"><span>&nbsp;</span></div>';tr.appendChild(td1);td2.className="boost_preview";td2.innerHTML='<div class="cellbox c">'+boosts[i].innerHTML+"</div>";tr.appendChild(td2);if(multiboost.tier.level==1){td3.className="fb_preview upsell";var next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);td3.colSpan=2;td3.innerHTML='<div class="cellbox c"><div class="msg"><a href="javascript:;" rel:gtrack_id="upgrade-tier/customize" class="bf_dom" rel:bf_bucket_data="{\'upgrade-tier\':{\'customize_buzz\':true}}" onclick="return false;">Upgrade</a> to '+(next_tier?next_tier.name:"a higher plan")+" for Facebook promotion. </div></div>";tr.appendChild(td3)}else{td3.className="fb_preview";if(fb_errors){if(fb_errors[buzz_list[i].campaignid]){td3.className+=" fb_err"}else{td3.className+=" fb_ok"}}td3.innerHTML='<div class="cellbox c">'+fbs[i].innerHTML+"</div>";tr.appendChild(td3);td4.className="targeting";td4.innerHTML=(multiboost.hide_targeting?"&nbsp;":'<div class="cellbox c">'+kws[i].innerHTML+"</div>");tr.appendChild(td4)}td5.className="actions";td5.innerHTML='<div class="cellbox c"><a class="bf_dom pull-it" href="" title="Remove from Campaign" onclick="return false" rel:bf_bucket_data="{\'confirm-removal-buzz-from-list\':{\'campaignid\':\''+buzz_list[i].campaignid+"'}}\"></a></div>";tr.appendChild(td5);table.appendChild(tr);if(multiboost.tier.level!=1){multiboost.toggle_fb_contenteditable($$("#preview-"+buzz_list[i].campaignid+" .fb_preview .cellbox").first())}multiboost.updateMaxLength((buzz_list[i].campaignid+"-fb_name-length"),24,buzz_list[i].fb_name.length);multiboost.updateMaxLength((buzz_list[i].campaignid+"-fb_blurb-length"),89,buzz_list[i].fb_blurb.length)}universal_dom.update(table);multiboost._retrigger_gtrack("6");table.removeClassName("loading");temp.parentNode.removeChild(temp);fb_temp.parentNode.removeChild(fb_temp);kw_temp.parentNode.removeChild(kw_temp)};this.edit_buzz=function(args){var value=args.target.innerHTML;if(args.update){value=value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<[^>]*>/g,"")}value=value.replace(/&nbsp;/ig," ");value=value.replace(/<br>/ig,"");var max=args.field=="fb_name"?24:89;if(value.length>max){value=value.substr(0,max)}var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");value=value.replace(/[^\w\d \.\,\!\']/g,"");while(value.match(subsequent_punctuation)){value=value.replace(subsequent_punctuation,"$1 $2")}multiboost.buzz_cache[args.id][args.field]=value;multiboost.buzz_cache[args.id].edited=true;$$("#preview-"+args.id+" td.notice").first().removeClassName("warning");if(args.update){multiboost.update_customized_buzz()}if(args.field=="fb_name"||args.field=="fb_blurb"){multiboost.updateMaxLength((args.id+"-"+args.field+"-length"),max,value.length)}};this.i_am_selected=function(el){while(el.tagName.toLowerCase()!="li"&&el.parentNode){el=el.parentNode}if(el.tagName.toLowerCase()=="li"){el.addClassName("selected")}};this.updateMaxLength=function(input_id,maxlen,value){var len=maxlen-value;if($(input_id)){$(input_id).update('<span class="'+(len<=5?"warning":"")+'">'+len+"</span> character"+(len==1?"":"s")+" remaining")}};this.has_added_buzz=function(id){var added=false;if(!multiboost.boost_list){multiboost.boost_list=[]}multiboost.boost_list.slice(0,multiboost.tier.max_boosts).each(function(i){if(id==i){added=true;throw $break}});return added};this.update_cart_icon=function(){if(!multiboost.tier){return}var num=(multiboost.boost_list?multiboost.boost_list.slice(0,multiboost.tier.max_boosts).length:0);universal_dom.get_bucket_elements("boost-cart").each(function(el){if(num>0){if(!el.hasClassName("boost")){el.addClassName("boost")}el.update('<a href="'+BF_STATIC.web_root+'/boost" rel:gtrack_id="utils/boost/'+num+'"><span class="text">Boost</span><span class="num">'+num+"</span></a>")}else{el.removeClassName("boost");el.update('<a rel:gtrack_id="utils/advertise" href="'+BF_STATIC.web_root+'/advertise">Advertise</a>')}var p=el.up(".has_gtrack_unit");if(p){gtrack._init(p)}})};this._retrigger_gtrack=function(str){var el=$("multiboost_container");if(el&&typeof(gtrack)!="undefined"){gtrack._init(el,{skip_impression:true})}};this.start_timer=function(s){$("modal_close_timer_seconds").update(s+" second"+(s!=1?"s":""));$("modal_close_timer").show();var modal_ct_intv=setInterval(function(){--s;$("modal_close_timer_seconds").update(s+" second"+(s!=1?"s":""));if(s<1){clearInterval(modal_ct_intv);top.BF_UI.closeDialog(bf_boost_manager.BOOST_DIALOG_ID,{})}},1000)}};var multiboost=new BF_MultiBoost();BuzzLoader.register(multiboost.init,2);var BF_TWITTER2={placement:function(f,b){try{var a=f.target;if(!b){a=a.parentNode}return $(a).readAttribute("rel:share_placement")}catch(c){return null}},url:function(f,b){try{var a=f.target;if(!b){a=a.parentNode}return $(a).readAttribute("rel:share_url")}catch(c){return null}},gtrack_name:function(l,h){try{var g=l.target,f,c;while(g!=document){c=$(g).readAttribute("rel:bf_bucket");if(c&&c.match(/gtrack/)){f=$(g).readAttribute("rel:gt_cat");if(f&&f!=""){return f}}g=$(g).parentNode}return null}catch(k){return null}},clicked:function(h){var c=$(h.target)[bfjs.read_attr](bfjs.gtrack_act);if(c&&c.match("^tweet/")){return}var a=BF_TWITTER2.gtrack_name(h);var b="share/twitter/"+(h.region?h.region:"");if(h.region=="tweet"){gtrack.trackShares(21,"numSharesTwitter")}gtrack.track_events(a,b,"");try{var g=h.data.screen_name}catch(f){g=""}if(g=="buzzfeed"){localStorage.setItem("tw_follow_buzzfeed",1)}(new BF_Targetting_Pixel()).add("twitter")},insert:function(){BF_XSS.swift_injection(document.location.protocol+"//platform.twitter.com/widgets.js")},cache_button:function(a,b){$(a).addClassName("hidden");var c=false;return function(g){if(c){return false}c=true;var f;if(g){f=g.target.up(".tweet-btn")}else{f=a.up(".tweet-btn")}$$(".twitter-button-fixer a").each(function(h){h.addClassName("twitter-share-button")});f.insert("<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');<\/script>");setTimeout(function(){$$(".twitter-button-fixer").each(function(h){h.style.display="block"})},800)}(b)},init:function(){if(BF_STATIC.tt_page!=="Video"){BF_TWITTER2.insert()}universal_dom.get_bucket_elements("twitter_hover").each(function(b){if(BF_STATIC.tt_page=="Video"){BF_TWITTER2.cache_button(b);$(b).addClassName("hidden")}else{$(b).observe("mouseover",function(c){$(b).addClassName("hidden");BF_TWITTER2.cache_button(b,c)})}});var a=setInterval(function(){if(typeof(twttr)=="undefined"||!twttr){return false}clearInterval(a);if(twttr.events._handlers){twttr.events.unbind("click");twttr.events.unbind("tweet");twttr.events.unbind("follow")}twttr.events.bind("click",BF_TWITTER2.clicked);twttr.events.bind("follow",BF_TWITTER2.clicked);twttr.events.bind("tweet",BF_TWITTER2.clicked)},500)}};BuzzLoader.register(BF_TWITTER2.init,2);sailthru_horizon_track=function(g){getCookie=function(k){var m=k+"=";var h=document.cookie.split(";");for(var l=0;l<h.length;l++){var n=h[l];while(n.charAt(0)==" "){n=n.substring(1,n.length)}if(n.indexOf(m)==0){return n.substring(m.length,n.length)}}return null};var a=getCookie("sailthru_hid");if(!a||!g.domain){return}var c="http://"+g.domain+"/horizon/track?r="+parseInt(Math.random()*10000,10)+"&url="+encodeURIComponent(document.location);if(g.tag){g.tags=g.tag}if(g.tags){if(g.tags instanceof Array){c+="&tags="+encodeURIComponent(g.tags.join(","))}else{if(g.tags instanceof Object){for(var b in g.tags){c+="&tags["+encodeURIComponent(b)+"]="+encodeURIComponent(g.tags[b])}}else{c+="&tags="+encodeURIComponent(g.tags)}}c+="&spider=1"}if(g.set){for(var b in g.set){c+="&set["+encodeURIComponent(b)+"]="+encodeURIComponent(g.set[b])}}var f=new Image();f.src=c};sailthru_submit_email=function(l){var g={};var k={longform:"Great! You'll get your first email soon."};var c="/buzzfeed/_email/";var b=$("sailthru_email_form-"+l.id).getValue().strip();var h=(l.category)?l.category:"";var f=g[h]?g[h]:"Sorry! We weren't able to sign you up. Please try again.";var a=k[h]?k[h]:"Great! You'll get your first email soon.";if($("sailthru_email_success-"+l.id)){$("sailthru_email_success-"+l.id).addClassName("hidden")}if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).addClassName("hidden")}if($("sailthru_email_form-"+l.id)){$("sailthru_email_form-"+l.id).removeClassName("error-border")}if($("sailthru_email_signup-"+l.id)){$("sailthru_email_signup-"+l.id).show()}if($("sailthru_email_signup-"+l.id).select(".button2").first()){$("sailthru_email_signup-"+l.id).select(".button2").first().disable()}if(!b||b=="your email address"){if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).removeClassName("hidden")}if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).innerHTML="Please enter an email address."}if($("sailthru_email_form-"+l.id)){$("sailthru_email_form-"+l.id).addClassName("error-border")}if($("sailthru_email_signup-"+l.id).select(".button2").first()){$("sailthru_email_signup-"+l.id).select(".button2").first().enable()}}else{if($("sailthru_email_spinner-"+l.id)){$("sailthru_email_spinner-"+l.id).removeClassName("hidden")}new Ajax.Request(c,{method:"get",parameters:{email:b,category:h},onSuccess:function(n){if(n.responseText.match(/Email added/)){if($("sailthru_email_success-"+l.id)){$("sailthru_email_success-"+l.id).removeClassName("hidden")}if($("sailthru_email_signup-"+l.id)){$("sailthru_email_signup-"+l.id).hide()}if($("sailthru_email_success-"+l.id)){$("sailthru_email_success-"+l.id).innerHTML=a}if(typeof(gtrack)!="undefined"){gtrack.track_events("","signup/email-success","")}var m=$$(".newsletterWrapper").first();if(m!=undefined){if(m.select(".customPage").first()){m.select(".customPage").first().addClassName("hidden")}if(m.select(".defaultPage").first()){m.select(".defaultPage").first().removeClassName("hidden")}if(m.select("span.email").first()){m.select("span.email").first().innerHTML=b}if(m.select("#email_address").first()){m.select("#email_address").first().value=b}if(m.select("."+h+"_signup").first()){m.select("."+h+"_signup").first().toggleClassName("checkOn")}if(m.select("."+h+"_signup").first()){m.select("."+h+"_signup").first().toggleClassName("checkOff")}}}else{if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).removeClassName("hidden")}if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).innerHTML=f}if($("sailthru_email_signup-"+l.id)){$("sailthru_email_signup-"+l.id).show()}if($("sailthru_email_form-"+l.id)){$("sailthru_email_form-"+l.id).addClassName("error-border")}if($("sailthru_email_signup-"+l.id).select(".button2").first()){$("sailthru_email_signup-"+l.id).select(".button2").first().enable()}}if($("sailthru_email_spinner-"+l.id)){$("sailthru_email_spinner-"+l.id).addClassName("hidden")}},onFailure:function(m){if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).removeClassName("hidden")}if($("sailthru_email_failure-"+l.id)){$("sailthru_email_failure-"+l.id).innerHTML=f}if($("sailthru_email_signup-"+l.id)){$("sailthru_email_signup-"+l.id).show()}if($("sailthru_email_form-"+l.id)){$("sailthru_email_form-"+l.id).addClassName("error-border")}if($("sailthru_email_spinner-"+l.id)){$("sailthru_email_spinner-"+l.id).addClassName("hidden")}if($("sailthru_email_signup-"+l.id).select(".button2").first()){$("sailthru_email_signup-"+l.id).select(".button2").first().enable()}}})}};BF_DID_REGISTER=false;BF_Register=function(){this.highlight_field=new Array();this.ajax=new BF_Request();this.ERR_MISSING_PARAMS="Please complete all fields.";this.ERR_BAD_USERNAME="Your username may only contain letters and numbers.";this.ERR_USERNAME_LENGTH="Your username must be between 3 and 30 characters in length.";this.ERR_PW_LENGTH="Your password must be at least 6 characters in length.";this.ERR_MUST_AGGEE=local.t("You must agree to the Terms of Service in order to register.");this.ERR_PW_MUST_MATCH="Your passwords do not match.";this.ERR_DUP_USERNAME="Sorry, that username is not available. Please try another.";this.ERR_DUP_SITENAME="Sorry, that domain name is not available. Please try another.";this.ERR_BAD_INVITE="Sorry, the invite code you entered is not valid.";this.ERR_DUP_EMAIL="There is already an account with that email address.";this.ERR_FB_DUP_EMAIL="The email address that belongs to your Facebook account has already been used by another BuzzFeed account.";this.BANNED_FB_UID=local.t("You cannot register with that Facebook user.");this.ERR_BAD_EMAIL="You have entered an invalid email address.";this.ERR_NO_ALIASES="Sorry, you don't have enough site aliases left to create a tracked site.";this.ERR=local.t("Sorry, we are unable to process your request at this time.");this.ERR_ALREADY_REGISTERED="You have already registered for an account";this.highlight_field[this.ERR_BAD_USERNAME]="register-username";this.highlight_field[this.ERR_USERNAME_LENGTH]="register-username";this.highlight_field[this.ERR_PW_LENGTH]="register-pw1";this.highlight_field[this.ERR_PW_MUST_MATCH]="register-pw2";this.highlight_field[this.ERR_MUST_AGGEE]="register-agree";this.highlight_field[this.ERR_DUP_USERNAME]="register-username";this.highlight_field[this.ERR_DUP_EMAIL]="bfe";this.highlight_field[this.ERR_BAD_EMAIL]="bfe";this.SUCCESS1="Thanks for registering. We've created your account and saved your post, but before we post it we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br /><br />Your post will appear automatically once you validate.";this.SUCCESS1_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook, created your account and saved your post. ");this.SUCCESS2="Thanks for registering. We've created your account, but before you can vote we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.";this.SUCCESS2_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook and created your account. You now can vote.");this.SUCCESS3="<h3>Please Validate Your Email</h3><p>Thanks for registering. We've created your account, but before you can log in we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.</p>";this.SUCCESS3_VALIDATED="<h3>Your Email Has Been Validated</h3><p>"+local.t("Thanks for registering. We've created your account and validated your email address with Facebook. Some of your profile data has been prepopulated with information from your Facebook profile. You can log in now.")+"</p>";this.SUCCESS4="Thanks for registering. We've created your account, but before you can post we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br/><br/>Once you validate <a id='register_this_page_url' href=''>click here</a> to make a post.";this.SUCCESS4_VALIDATED="Thanks for registering. We've created your account and validated your email address with Facebook.";this.fb_link_handler=function(){var handler=function(event){event.stop();$("facebook-login").hide();$("facebook-registration-form").hide();bf_login.switch_to_link_accounts()}.bind(this);if($("fb-link-submit")){$("fb-link-submit").observe("click",handler)}if($("fb-link-submit2")){$("fb-link-submit2").observe("click",handler)}};this.fb_register_handler=function(reset_form,args){if(BF_Register.registered_fb_handler){return}BF_Register.registered_fb_handler=true;this.fb_link_handler();if(typeof reset_form=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.facebook_register()}.bind(this);if($("facebook-registration-form")){$("facebook-registration-form").stopObserving("submit",handler)}if($("facebook-registration-form")){$("facebook-registration-form").observe("submit",handler)}if($("fb-register-submig")){$("fb-register-submit").disabled=false}if(reset_form&&$("facebook-registration-form")){$("facebook-registration-form").reset()}};this.alias_register_handler=function(reset_form,args){if(BF_Register.alias_registered_handler){return}BF_Register.alias_registered_handler=true;if(typeof reset_form=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.alias_register()}.bind(this);BF_UserSwitcher.count_aliases(function(obj){var user_info=new BF_User().getUserInfo();var remaining=parseInt(user_info.max_aliases)-parseInt(obj.count);if($("self-serve-form")){if(remaining<=0&&user_info.max_aliases!=0){$("registration-form-tabs").hide();$("self-serve-form").hide();$("self-max-alias").show()}}if($("alias-sites-left")&&obj.success){$("alias-sites-left").update(remaining);if(remaining==1){$("alias-sites-left-plural").hide()}if(obj.unlimited==1){$("alias-count-message").hide()}else{$("alias-count-message").show()}if(remaining<=0&&user_info.max_aliases!=0){$("alias-registration-fieldset").hide();$("alias-registration-hit-limit").show()}}});if($("alias-registration-form")){$("alias-registration-form").stopObserving("submit",handler)}if($("alias-registration-form")){$("alias-registration-form").observe("submit",handler)}if($("alias-registration-form")){$("alias-register-submit").disabled=false}if(reset_form&&$("alias-registration-form")){$("alias-registration-form").reset()}};this.admin_register_handler=function(reset_form,args){var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();if(!acl.user_can("partners_manage")){return}$("admin_options").show()}};this.register_handler=function(reset_form,args){if(BF_Register.registered_handler){return}BF_Register.registered_handler=true;if(typeof(reset_form)=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.register()}.bind(this);if($("regsitration-form")){$("regsitration-form").stopObserving("submit",handler)}if($("regsitration-form")){$("regsitration-form").observe("submit",handler)}if($("register-submit")){$("register-submit").disbaled=false}if(reset_form&&$("regsitration-form")){$("regsitration-form").reset()}this.self_serve_handler()};this.register_tab_handler=function(){return;var handler=function(e){if(e.element().id=="self-serve-tab"){$("registration-div").hide();$("self-serve-div").show()}if(e.element().id=="create-your-feed-tab"){$("self-serve-div").hide();$("registration-div").show()}if(e.element().id=="create-new-feed-tab"){$("self-serve-div").hide();$("registration-div").show()}};if($("create-your-feed-tab")){$("create-your-feed-tab").observe("click",handler)}if($("create-new-feed-tab")){$("create-new-feed-tab").observe("click",handler)}if($("self-serve-tab")){$("self-serve-tab").observe("click",handler)}};this.self_serve_handler=function(){var handler=function(e){var domain=$F("self-serve-your-domain").strip();if(domain=="yoursite.com"){domain=""}var code=$("self-serve-invite-code")?$F("self-serve-invite-code").strip():"";if(code=="invite code"){code=""}err_mess="";if(!domain||(!code&&SS_INVITE_NEEDED==true)){err_mess="Please complete all fields."}if(domain!=""&&!domain.match(/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/)){err_mess="Please enter a domain for your site (example.com)."}if($F("self-serve-standalone")&&!$F("self-serve-email")){err_mess="You must enter an email address for a seperate account!"}if(err_mess){if(Prototype.Browser.IE){$("self-serve-error-message").innerText=err_mess}else{$("self-serve-error-message").update(err_mess)}$("self-serve-error-message").addClassName("error").show();$("self-serve-error-message").show()}else{var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();default_session=user_info.default_user.session_key;var userid=user_info.userid;$("self-serve-buttons").hide();$("submit-self-serve-spinner").show();$("self-serve-error-message").hide();var save_params={action:"create_site",mycode:code,default_session:default_session,mydomain:domain};if($F("self-serve-standalone")){save_params.standalone_user=1;if($F("self-serve-email")){save_params.email=$F("self-serve-email")}if($F("self-serve-send-email")){save_params.send_email=1}}(new BF_Request()).request("/buzzfeed/_self_serve_tracking",{method:"get",parameters:save_params,onSuccess:function(r){var obj=eval("("+r.responseText+")");if(obj&&obj.success==1){var redir=BF_STATIC.web_root+"/sites/"+obj.status.self_serve_user.username;document.location.href=redir}else{$("self-serve-buttons").show();$("submit-self-serve-spinner").hide();err_mess="Unable to process your request";if(obj.message){if(obj.message=="bad invite code"){err_mess=this.ERR_BAD_INVITE}else{if(obj.message=="duplicate site name"){err_mess=this.ERR_DUP_SITENAME}else{if(obj.message=="no user aliases left"){err_mess=this.ERR_NO_ALIASES}else{if(obj.message=="Cannot validate account with Facebook"){err_mess="Cannot validate your Facebook account; please grant extended permissions or register without your Facebook account"}else{err_mess=local.t("Unable to process your request")}}}}}if(Prototype.Browser.IE){$("self-serve-error-message").innerText=err_mess}else{$("self-serve-error-message").update(err_mess)}$("self-serve-error-message").addClassName("error");$("self-serve-error-message").show()}}.bind(this),onFailure:function(r){$("self-serve-buttons").show();$("submit-self-serve-spinner").hide();if(Prototype.Browser.IE){$("self-serve-error-message").innerText="Unable to process your request"}else{$("self-serve-error-message").update("Unable to process your request")}$("self-serve-error-message").addClassName("error");$("self-serve-error-message").show()}.bind(this)})}else{this.args={onRegister:function(obj){if($("registration-form-tabs")){$("self-serve-registration-div").hide()}if($("self-serve-registration-div")){$("self-serve-registration-div").hide()}if($("self-serve-form")){$("self-serve-form").hide()}if($("registration-success-message")){$("registration-success-message").show()}}};$("self-serve-buttons").hide();$("self-serve-registration-div").show();if($("register-submit")){$("register-submit").disbaled=false}}}}.bind(this);bf_register.self_serve_submit_handler=handler;if($("self-serve-form")){$("self-serve-form").observe("submit",handler)}};this.facebook_register=function(){var name=$F("fb-register-name").strip();var email="get_from_facebook@buzzfeed.com";try{email=facebook.user_data.email}catch(e){}var username=$F("fb-register-username").strip();var pw1=$F("fb-register-pw1").strip();var agreed=true;var emailme=0;var import_fb_profile=$("import_fb_profile_checkbox").checked?"true":"false";if(import_fb_profile=="false"){name=username}var facebook_uid=$("fb-facebook-uid")?$("fb-facebook-uid").value:"";this.username=username;this.password=pw1;if($("fb-email-me").checked){emailme=1}var rr=function(resp){this.response(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);var params={name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:rr,onFailure:er})};this.alias_register=function(){var username=$("alias-register-username").value.strip();if(!username.match(/^[a-zA-Z0-9]+$/)){this._alias_register({success:0,message:"Site URL must consist of only alphanumeric characters"});return}var display_name=$("alias-register-display_name").value;if($("alias-registering-status")){$("alias-registering-status").show()}if(!username||!display_name){this._alias_register({success:0,message:"missing username"})}else{BF_UserSwitcher.create_alias({username:username,display_name:display_name},this._alias_register)}};this._alias_register=function(obj){if(obj.success==0||obj.status!=200){$("alias-message").show();if(obj.message.match(/missing username/i)){$("alias-message").update("please fill out all fields")}else{if(obj.message.match(/logged in/i)){$("alias-message").update("please log in and try again")}else{if(obj.message.match(/privileges/i)){$("alias-message").update("you don't have permission to create an alias")}else{if(obj.message.match(/limit/i)){$("alias-message").update("Sorry, but you are over your alias limit")}else{if(obj.message.match(/username/i)){$("alias-message").update("this site URL already is taken, please select another")}else{$("alias-message").update(obj.message)}}}}}}else{if($("alias-registration-fieldset")){$("alias-registration-fieldset").hide()}if($("alias-registration-creating-site")){$("alias-registration-creating-site").show()}BF_UserSwitcher.switchTo(obj.userid,function(){})}if($("alias-registering-status")){$("alias-registering-status").hide()}};this.register=function(){if($("registering-status")){$("registering-status").show()}var self_serve_domain="";var self_serve_invite_code="";if($("self-serve-div")&&$("self-serve-div").getStyle("display")!="none"){self_serve_domain=$F("self-serve-your-domain").strip();self_serve_invite_code=$("self-serve-invite-code")?$F("self-serve-invite-code").strip():""}if(typeof this.args=="undefined"){this.args={action:"vote"}}var name=$F("register-name").strip();var email=$F("bfe").strip();var username=$F("register-username").strip();var pw1=$F("register-pw1").strip();var pw2=$F("register-pw2").strip();var agreed=false;var emailme="";var facebook_location="";var facebook_uid="";var facebook_url="";var import_fb_profile=false;if(BF_STATIC.facebook_enabled){facebook_uid=$("facebook-uid")?$("facebook-uid").value:"";import_fb_profile=$("import_fb_profile_checkbox").checked}if($("register-agree").checked){agreed=true}if($("email-me").checked){emailme=1}var is_error=true;if(!name||!email||!username||!pw1||!pw2){this.update_registration_message(this.ERR_MISSING_PARAMS)}else{if(!username.match(/^[a-zA-Z0-9]+$/)){this.update_registration_message(this.ERR_BAD_USERNAME)}else{if(username.length<3||username.length>30){this.update_registration_message(this.ERR_USERNAME_LENGTH)}else{if(pw1!=pw2){this.update_registration_message(this.ERR_PW_MUST_MATCH)}else{if(!agreed){this.update_registration_message(this.ERR_MUST_AGGEE)}else{if(typeof pw1=="undefined"||pw1.length<6){this.update_registration_message(this.ERR_PW_LENGTH)}else{if(typeof email=="undefined"||!email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){this.update_registration_message(this.ERR_BAD_EMAIL)}else{if(self_serve_domain=="yoursite.com"||self_serve_invite_code=="invite code"){this.update_registration_message("Please enter your site's domain.")}else{if(self_serve_domain!=""&&!self_serve_domain.match(/\w\.\w/)){this.update_registration_message("Please enter a valid domain for site (example.com).")}else{is_error=false;this.username=username;this.password=pw1;var rr=function(resp){this.response(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);$("register-submit").disbaled=true;if($("self-serve-div")&&$("self-serve-div").getStyle("display")!="none"){var params={self_serve_username:self_serve_domain,self_serve_invite:self_serve_invite_code,name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,location:facebook_location,link:facebook_url,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent}}else{var params={name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,location:facebook_location,link:facebook_url,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent}}new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:rr,onFailure:er})}}}}}}}}}if(is_error){if($("register-submit")){$("register-submit").disabled=false}$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()}};this.update_registration_message=function(msg){if(Prototype.Browser.IE){$("registration-message").innerText=msg;$("facebook-registration-message").innerText=msg}else{$("registration-message").update(msg);$("facebook-registration-message").update(msg)}if(this.__error_field){this.__error_field.style.border="1px solid gray";this.__error_field=null}if(this.highlight_field[msg]&&$(this.highlight_field[msg])){$(this.highlight_field[msg]).style.border="1px solid red";this.__error_field=$(this.highlight_field[msg])}};this.response=function(resp){var username=this.username;var password=this.password;$("registering-status").hide();try{$("register-submit").disbaled=false;obj=eval("("+resp.responseText+")");if(!obj||!obj.status){this.err()}else{if(obj.status=="success"){__reg_ok=true;BF_DID_REGISTER=true;$("regsitration-form").reset();if(this.args&&this.args.action=="vote"&&vote_manager.contribution_id){if($("contribute-success")){$("contribute-success").hide()}var reg_success_div=$("registered-success").remove();$("registration-div").hide();var div=document.createElement("div");div.appendChild(reg_success_div);$($("registration-div").parentNode).appendChild(div);$("registered-success").show();$("registered-success").style.marginTop="10px";var show_message=this.SUCCESS2;if(obj.user_validated){show_message=this.SUCCESS2_VALIDATED;if($("please-validate-your-email")){$("please-validate-your-email").update("We Have Validated Your Email")}}$("reg-success-message").update(show_message);if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_vote")}}else{if(this.args&&this.args.action=="signin"){if($("contribute-success")){$("contribute-success").hide()}if($("registered-success")){$("registered-success").show()}if($("registration-div")){$("registration-div").hide()}if($("reg-success-message")){var show_message=this.SUCCESS3;if(obj.user_validated){show_message=this.SUCCESS3_VALIDATED}$("reg-success-message").update(show_message);$("reg-success-message").show();if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_signin")}if(obj.user_validated){var params={username:username,password:password,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:function(r){bf_login.loggedIn(r);if(window.location.href.indexOf("/signin")!=-1){window.location.href="/"+username}},onFailure:bf_login.err})}}}else{if(this.args&&this.args.action=="badge_vote"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_badge_vote")}if(badge_vote_manager&&badge_vote_manager.onRegister){badge_vote_manager.onRegister()}else{if($("registered-vote-success")){$("registered-vote-success").show()}if($("registration-div")){$("registration-div").hide()}}}else{if(this.args&&this.args.action=="contest_entry"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_contest_entry")}if(typeof contest_manager!="undefined"&&contest_manager.onLogin){contest_manager.onLogin()}}else{if(this.args&&this.args.action=="micosite_submission"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_microsite")}if(typeof picks_controller!="undefined"&&picks_controller.onLogin){picks_controller.onLogin()}}else{if(this.args&&this.args.onRegister){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}this.args.onRegister(obj)}else{if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}if($("contribute-success")){$("contribute-success").hide()}if($("registered-success")){$("registered-success").show()}if($("registration-div")){$("registration-div").hide()}if(bf_contribute&&bf_contribute.type=="image"){var show_message=this.SUCCESS4;if(obj.user_validated){show_message=this.SUCCESS4_VALIDATED}if($("reg-success-message")){$("reg-success-message").update(show_message)}}else{var show_message=this.SUCCESS1;if(obj.user_validated){show_message=this.SUCCESS1_VALIDATED;if($("please-validate-your-email")){$("please-validate-your-email").update("We Have Validated Your Email")}var params={username:username,password:password,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:function(r){bf_login.loggedIn(r,this.args);if(window.location.href.indexOf("/signin")!=-1){window.location.href="/"+username}},onFailure:bf_login.err})}if($("reg-success-message")){$("reg-success-message").update(show_message)}}bf_contribute.submit({session_key:obj.session_key})}}}}}}if($("register_this_page_url")){var rurl=document.location.href;rurl=rurl.replace(/#.*/,"");$("register_this_page_url").href=rurl}}else{var some_error=true;if(obj.message=="bad beta key"){this.update_registration_message(this.ERR_BETA_KEY)}else{if(obj.message=="duplicate username"){this.update_registration_message(this.ERR_DUP_USERNAME)}else{if(obj.message=="duplicate site name"){this.update_registration_message(this.ERR_DUP_SITENAME)}else{if(obj.message=="Your invite code is not valid."){this.update_registration_message(this.ERR_BAD_INVITE)}else{if(obj.message=="duplicate email"){if(facebook.is_logged_in()){this.update_registration_message(this.BANNED_FB_UID)}else{this.update_registration_message(this.ERR_DUP_EMAIL)}}else{this.err();some_error=false}}}}}if(some_error){if($("register-submit")){$("register-submit").disabled=false}$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show()}}}}catch(e){console.dir({e:e});this.err()}};this.err=function(resp){$("register-submit").disabled=false;$("facebook-registration-message").update(this.ERR);$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").update(this.ERR);$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()};this.redirect_to=function(url){window.location.href=BF_STATIC.web_root+"/"+url};this.form_values=function(obj){if(typeof obj.pw=="undefined"){if($("register-password").value!=$("register-password").getAttribute("defaultvalue")){obj.pw=$("register-password").value}}if(typeof obj.username=="undefined"){if(bf_register.signup_page()){if($(signup_page.currentNameBox()).value!=$(signup_page.currentNameBox()).getAttribute("defaultvalue")){obj.name=obj.username=$(signup_page.currentNameBox()).value}}else{obj.name=obj.username=$("register-uri-text").value}}if(typeof obj.email=="undefined"){if($("register-email").value!=$("register-email").getAttribute("defaultvalue")){obj.email=$("register-email").value}}return obj};this.create_advertiser_account=function(data){if(!acl.user_can("partners_manage")){return}var errors=[];var obj={create_advertiser_account:1,pw:data.pw||"",pw2:data.pw||"",name:data.name||data.username||"",username:data.username||"",email:data.email||"",contribute:1};var missingEmail=false;var strip=new Array("email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"&&typeof obj[el].strip!="undefined"){obj[el]=obj[el].strip()}if(typeof obj[el]=="undefined"||obj[el]==""){errors.push("Missing "+el);if(el=="email"){missingEmail=true}}});if(!missingEmail&&!data.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){errors.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(errors.length){return error(errors.join(", "))}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})};this.create_contributor_account=function(data){if(!acl.user_can("editors_manage")){return}var errors=[];var obj={create_contributor_account:1,pw:data.pw||"",pw2:data.pw||"",name:data.name||data.username||"",username:data.username||"",email:data.email||"",contribute:1};var missingEmail=false;var strip=new Array("email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"&&typeof obj[el].strip!="undefined"){obj[el]=obj[el].strip()}if(typeof obj[el]=="undefined"||obj[el]==""){errors.push("Missing "+el);if(el=="email"){missingEmail=true}}});if(!missingEmail&&!data.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){errors.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(errors.length){return error(errors.join(", "))}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})};this.newRegisterCallbacks=[];this.new_register=function(obj){if(obj.create_advertiser_account){return bf_register.create_advertiser_account(obj)}if(obj.create_contributor_account){return bf_register.create_contributor_account(obj)}if(typeof obj.pw2=="undefined"){obj.pw2=obj.pw}if(typeof obj.name=="undefined"){obj.name=obj.username}var errors=false;var required={username:"Please enter a username.",email:"Please enter a valid email address.",pw:"Please enter a password."};var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};obj=this.form_values(obj);var strip=new Array("name","email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"){obj[el]=obj[el].strip()}});if(obj.username=="username"){obj.username=""}for(var each in required){if(typeof obj[each]=="undefined"||obj[each]==""){error(required[each]);if(signin.signin_page){signin.register_errors(each,required[each])}break}}if(obj.username=="url"){obj.username=""}if(obj.pw=="password"){obj.pw=""}if(obj.email=="your@email.com"){obj.email=""}if(!errors&&!obj.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){error("Please enter a valid email address");if(signin.signin_page){signin.register_errors("email","Please enter a valid email address")}}if(!errors&&(obj.username.length<3||obj.username.length>30)){error("Please enter a URL between 3 and 30 characters");if(signin.signin_page){signin.register_errors("username","Please enter a URL between 3 and 30 characters")}}if(!errors&&obj.pw.length<6){error("Your password must have at least 6 characters");if(signin.signin_page){signin.register_errors("pw"," Your password must have at least 6 characters")}}if(!errors){if(document.location.search.indexOf("registered_from=")){var search=document.location.search.substring(1);var kvpairs=search.split("&");kvpairs.each(function(kvpair){var kv=kvpair.split("=");if(kv[0]=="registered_from"){obj.registered_from_url=kv[1]}})}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})}};this._new_register=function(obj,json){if(json.status=="failed"){bf_register._error(json)}else{bf_register._success(obj,json)}};this._error=function(json){var messages={"duplicate email":bf_register.ERR_DUP_EMAIL,"duplicate username":bf_register.ERR_DUP_USERNAME};if(signin.signin_page){signin.register_errors(json.message,messages[json.message])}if($("registration-success-message")){old_msg.hide()}var msg=bf_register.currentErrorBox();if(bf_register.signup_page()){signup_page.toggleSpinner(0)}if(msg){var match;if(match=json.message.match(/^(.*) at lib/)){json.message=match[1]}msg.update(messages[json.message]||json.message);msg.show()}};this._success=function(obj,json){if(bf_register.currentErrorBox()){bf_register.currentErrorBox().hide()}if(signin.signin_page){signin.register_settings(obj)}json.user_validated=json.user_validated==true||json.user_validated=="true";if(json.user_validated){var params={username:obj.username,password:obj.pw,contribute:1};bf_register.dont_switch=json.dont_switch||0;bf_register.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:params,while_processing:{show:"logging-in",hide:"new-registration-form"},onSuccess:function(r){if(bf_register.dont_switch){var o=eval("("+r.responseText+")");bf_register.redirect_to("settings/"+o.username)}else{if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}if(signin.social_register){bf_login.loggedIn(r,{no_reload:true})}else{bf_login.loggedIn(r);bf_register.redirect_to("settings?firstTime=true")}}}})}else{if(bf_register.signup_page()){signup_page.toggleSpinner(0);signup_page.openDialog("old")}if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}var form=$("new-registration-form");var msg=$("registration-success-message");if(form){form.hide()}if(msg){msg.show()}}if(this.newRegisterCallbacks.length){this.newRegisterCallbacks.each(function(fn){fn(obj,json)})}};this.register_alias=function(obj){var errors=false;var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(!obj.username||obj.username.length<3||obj.username.length>30){if(bf_register.signup_page()){error("Please enter a username between 3 and 30 characters")}else{error("Please enter a URL between 3 and 30 characters")}}if(!errors){if(bf_register.signup_page()){signup_page.toggleSpinner(1)}BF_UserSwitcher.create_alias({username:obj.username,display_name:typeof obj.name=="undefined"?obj.username:obj.name},bf_register._register_alias)}};this._register_alias=function(obj){if(obj.success==0||obj.status!=200){bf_register._error({message:obj.message||"Unable to create an alias at this time"})}else{BF_UserSwitcher.switchTo(obj.userid,function(){if(!signin.social_register){bf_register.redirect_to("settings?firstTime=true")}})}};this.signup_page=function(){return BF_STATIC.tt_page=="Signup"?true:false};this.currentErrorBox=function(){return bf_register.signup_page()?$(signup_page.currentErrorBox()):$("registration-error-message")}};var playing_animations=new Object();BFAnimatedGifPlayer=function(){this.load_count=0;this.play=function(b,a){this.overlay=a;var c=$(b.image_id).src.replace(/_preview\.gif$/,".gif");this.image=new Image();this.image.src=c;$(b.image_id).src=c;$(b.image_id).parentNode.className+=" animated-spinner";this.gifIsLoaded()};this.gifIsLoaded=function(){this.load_count++;var b=this.load_count*200;if(!this.image.complete&&b<10000){var a=function(){this.gifIsLoaded()}.bind(this);setTimeout(a,200)}else{this.overlay.hide()}}};function RegisterAnimation(args){if(!args||!args.image_element_play_id){console.error("RegisterAnimation needs args: {image_element_play_id: 'animation-id-1234'}")}$(args.image_element_play_id).observe("click",function(e){e.stop();var data=e.element().getAttribute("gif_animation");var player=new BFAnimatedGifPlayer();player.play(eval("("+data+")"),e.element())})}if(typeof deconcept=="undefined"){var deconcept=new Object()}if(typeof deconcept.util=="undefined"){deconcept.util=new Object()}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object()}deconcept.SWFObject=function(r,b,s,g,n,o,l,k,f,p){if(!document.getElementById){return}this.DETECT_KEY=p?p:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(r){this.setAttribute("swf",r)}if(b){this.setAttribute("id",b)}if(s){this.setAttribute("width",s)}if(g){this.setAttribute("height",g)}if(n){this.setAttribute("version",new deconcept.PlayerVersion(n.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(o){this.addParam("bgcolor",o)}var a=l?l:"high";this.addParam("quality",a);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var m=(k)?k:window.location;this.setAttribute("xiRedirectUrl",m);this.setAttribute("redirectUrl","");if(f){this.setAttribute("redirectUrl",f)}};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"expressinstall.swf":a;this.setAttribute("useExpressInstall",true)},setAttribute:function(a,b){this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addParam:function(b,a){this.params[b]=a},getParams:function(){return this.params},addVariable:function(b,a){this.variables[b]=a},getVariable:function(a){return this.variables[a]},getVariables:function(){return this.variables},getVariablePairs:function(){var c=new Array();var b;var a=this.getVariables();for(b in a){c[c.length]=b+"="+a[b]}return c},getSWFHTML:function(){var b="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}b='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';b+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var h=this.getParams();for(var g in h){b+=[g]+'="'+h[g]+'" '}var f=this.getVariablePairs().join("&");if(f.length>0){b+='flashvars="'+f+'"'}b+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}b='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';b+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var c=this.getParams();for(var g in c){b+='<param name="'+g+'" value="'+c[g]+'" />'}var a=this.getVariablePairs().join("&");if(a.length>0){b+='<param name="flashvars" value="'+a+'" />'}b+="</object>"}return b},write:function(b){if(this.getAttribute("useExpressInstall")){var a=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(a)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var c=(typeof b=="string")?document.getElementById(b):b;c.innerHTML=this.getSWFHTML();return true}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}return false}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var g=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var a=navigator.plugins["Shockwave Flash"];if(a&&a.description){g=new deconcept.PlayerVersion(a.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var b=1;var c=3;while(b){try{c++;b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);g=new deconcept.PlayerVersion([c,0,0])}catch(f){b=null}}}else{try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(f){try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");g=new deconcept.PlayerVersion([6,0,21]);b.AllowScriptAccess="always"}catch(f){if(g.major==6){return g}}try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(f){}}if(b!=null){g=new deconcept.PlayerVersion(b.GetVariable("$version").split(" ")[1].split(","))}}}return g};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major){return false}if(this.major>a.major){return true}if(this.minor<a.minor){return false}if(this.minor>a.minor){return true}if(this.rev<a.rev){return false}return true};deconcept.util={getRequestParameter:function(c){var f=document.location.search||document.location.hash;if(c==null){return f}if(f){var b=f.substring(1).split("&");for(var a=0;a<b.length;a++){if(b[a].substring(0,b[a].indexOf("="))==c){return b[a].substring((b[a].indexOf("=")+1))}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var b=document.getElementsByTagName("OBJECT");for(var c=b.length-1;c>=0;c--){b[c].style.display="none";for(var a in b[c]){if(typeof b[c][a]=="function"){b[c][a]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(a){return document.all[a]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;try{BF_XSS.swift_injection(BF_STATIC.static_root+"/js/public/video/flowplayer-3.2.8.min.js?v="+BF_STATIC.version);BF_XSS.swift_injection(BF_STATIC.static_root+"/js/flash/detector.js?v="+BF_STATIC.version)}catch(e){}BF_VIDEO_TYPES_STRING="YouTube, Vimeo, Soundcloud, Rdio, Spotify, Facebook, Hulu, Google Video, LiveLeak, MetaCafe, DailyMotion, or MySpace Video";bf2_terminal_Video=function(){this.type=null;this.id=null;this.embed_link=null;this.detected=false;this.src_link=null;this.getting_thumbnail=false;this.detect_type=function(h){this.detected=false;if(h){h=h.strip()}if(h){var c=h.match(/(http(s)?:\/\/)?(\w+\.)?youtube\.com\/((watch(\?|\#\!|\#)(.*\&)?v=)|(v\/|embed\/))([\w-]+)((#|&|&amp;)t=([\w-]+))?/);var n=h.match(/(http(s)?:\/\/)?(\w+\.)?youtube\.com\/user\/(.*)\#([\w\d\-\/]+\/)?([\w-]{3,})(\/[\w\d\-\/]+)?((#|&|&amp;)t=([\w-]+))?/);var l=h.match(/(http(s)?:\/\/)?(\w+\.)?youtu\.be\/([\w-]{3,})(?:\?t=([\w-]+))?/);if(c||n||l){yt_protocal=document.location.protocol+"//";this.type="youtube";this.id=(l?l[4]:(n?n[6]:c[9]));if(c&&c[12]){this.start_time=c[12]}else{if(n&&n[8]){this.start_time=n[8]}else{if(l&&l[5]){this.start_time=l[5]}else{this.start_time=""}}}if(this.start_time!==""){var a=this.start_time.match(/(\d*)(\D)?(\d*)(\D)?/);this.start_time=0;if(a[2]&&a[2]==="m"){this.start_time+=parseInt(a[1],10)*60}else{if(a[2]&&a[2]==="s"){this.start_time+=parseInt(a[1],10)}else{if(a[1]){this.start_time+=parseInt(a[1],10)}}}if(a[2]&&a[2]==="m"&&a[3]){this.start_time+=parseInt(a[3],10)}}this.embed_link=yt_protocal+"youtube.com/watch?v="+this.id;if(this.start_time){this.embed_link=this.embed_link+"&amp;t="+this.start_time}this.detected=(new Date()).valueOf();this.src_link=yt_protocal+"www.youtube.com/"+(c&&c[4]=="embed/"?"embed":"v")+"/"+this.id;if(this.start_time){this.src_link=this.src_link+"&amp;t="+this.start_time}this.img0=yt_protocal+"img.youtube.com/vi/"+this.id+"/0.jpg";this.img1=yt_protocal+"img.youtube.com/vi/"+this.id+"/1.jpg";this.img2=yt_protocal+"img.youtube.com/vi/"+this.id+"/2.jpg";this.img3=yt_protocal+"img.youtube.com/vi/"+this.id+"/3.jpg";this.thumbs=[this.img1,this.img0,this.img2,this.img3];this.thumbnail_available=true}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?vimeo\.com\/(video\/|moogaloop\.swf\?clip_id=)*(\d+)/);if(c){var k=document.location.protocol+"//";this.type="vimeo";this.id=c[5];this.embed_link=k+"vimeo.com/"+this.id;this.detected=true;this.src_link=k+"player.vimeo.com/video/"+this.id;this.thumbnail_available=true}}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?facebook\.com\/(video\/video\.php\?v\=|v\/)(\d+)/);if(c){var k=document.location.protocol+"//";this.type="facebook";this.id=c[5];this.embed_link=k+"www.facebook.com/video/video.php?v="+this.id;this.detected=true;this.src_link=k+"www.facebook.com/v/"+this.id;this.possible_privacy_restrictions=true;this.thumbnail_available=false}}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?facebook\.com\/([\w\.]+)\/posts\/([\w\d\.]+)/);if(c){var k=document.location.protocol+"//";this.type="facebook_post";this.id=c[4];this.post_id=c[5];this.embed_link=k+"www.facebook.com/"+this.id+"/posts/"+this.post_id;this.src_link=this.embed_link;this.possible_embed_privacy_restrictions=true;this.detected=true;this.thumbnail_available=false}}if(!this.detected){c=h.match(/(http(s)?:\/\/)(\w+\.)facebook\.com\/photo\.php\?v=([\d]+)/);if(c){var k=document.location.protocol+"//";this.type="facebook_video_post";this.post_id=c[4];this.embed_link=k+"www.facebook.com/photo.php?v="+this.post_id;this.src_link=this.embed_link;this.possible_embed_privacy_restrictions=true;this.detected=true;this.thumbnail_available=false}}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?facebook\.com\/photo.php\?fbid=(\w+)(?:&amp;|&)set=([\w\d\.]+)(?:&amp;|&)type=([\w\d\.]+)/);if(c){var k=document.location.protocol+"//";this.type="facebook_photo";this.id=c[4];this.set_id=c[5];this.type_id=c[6];this.embed_link=k+"www.facebook.com/photo.php?fbid="+this.id+"&amp;set="+this.set_id+"&amp;type="+this.type_id;this.src_link=this.embed_link;this.possible_embed_privacy_restrictions=true;this.detected=true;this.thumbnail_available=false}}if(!this.detected){var f=[RegExp(/(http(s)?:\/\/buzzfeed-video1.s3.amazonaws.com\/.*)/),RegExp(/(http(s)?:\/\/s\.video\.buzzfeed\.com\/.*)/),RegExp(/(http(s)?:\/\/s3.amazonaws.com\/buzzfeed-video1\/.*)/)];for(var b=0;b<f.length;b++){c=h.match(f[b]);if(c){this.type="buzzfeed";this.id=c[1];this.embed_link=this.id;this.detected=true;this.src_link=this.id;this.thumbnail_available=false;this.thumbnail=h.replace(/(\.mp4|\.flv)/i,".jpg");break}}}if(!this.detected){c=h.match(/^http:\/\/video\.google\.com\/videoplay?(.*)?docid=((\-)?(\d+))/);if(c){this.type="google video";this.id=c[2];this.embed_link="http://video.google.com/videoplay?docid="+this.id;this.detected=true;this.src_link="http://video.google.com/googleplayer.swf?docid="+this.id}}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?bloomberg.com\/video\/(?!embed\/)(.+[-]+)?(.*)/);if(c){this.type="bloomberg_video";this.tag="iframe";this.id=c[5].replace(".html","");this.embed_link="http://www.bloomberg.com/video/embed/"+this.id;this.detected=true;this.src_link=h;this.thumbnail_available=false}}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?bloomberg.com\/video\/embed\/(.*)/);if(c){this.type="bloomberg_video";this.tag="iframe";this.id=c[4].split("?")[0];this.embed_link="http://www.bloomberg.com/video/embed/"+this.id;this.detected=true;this.src_link=this.embed_link;this.thumbnail_available=false}}if(!this.detected){c=h.match(/(http(s)?:\/\/)?(\w+\.)?oscar.go.com\/(embed|video)\/([^"]*)/);if(c){this.type="oscar_video";this.tag="iframe";if(c[4]==="video"){this.id=c[5].split("_m_")[1]}else{this.id=c[5]}this.embed_link="http://oscar.go.com/embed/"+this.id;this.detected=true;this.src_link=this.embed_link;this.thumbnail_available=false}}if(!this.detected){c=h.match(/http:\/\/video\.google\.com\/googleplayer.swf\?docid=((\-)?(\d+))/);if(c){this.type="google video";this.id=c[1];this.embed_link="http://video.google.com/videoplay?docid="+this.id;this.detected=true;this.src_link="http://video.google.com/googleplayer.swf?docid="+this.id}}if(!this.detected){c=h.match(/^http:\/\/(www\.)?liveleak\.com\/.*i=(\w{3}_(\d+)?)/);if(c){this.type="live leak";this.id=c[2];this.embed_link="http://www.liveleak.com/view?i="+this.id;this.detected=true;this.src_link="http://www.liveleak.com/e/"+this.id}}if(!this.detected){c=h.match(/http:\/\/(www\.)?liveleak\.com\/e\/(\w{3}_(\d+))/);if(c){this.type="live leak";this.id=c[2];this.embed_link="http://www.liveleak.com/view?i="+this.id;this.detected=true;this.src_link="http://www.liveleak.com/e/"+this.id}}if(!this.detected){c=h.match(/^http:\/\/vids\.myspace\.com\/.*ideoID=(\d+)/i);if(c){this.type="myspace";this.id=c[1];this.embed_link="http://vids.myspace.com/index.cfm?fuseaction=vids.individual&VideoID="+this.id;this.detected=true;this.src_link="http://mediaservices.myspace.com/services/media/embed.aspx/m="+this.id+",t=1,mt=video"}}if(!this.detected){c=h.match(/http:\/\/vids\.myspace\.com\/.*ideoID=(\d+)/i);if(c){this.type="myspace";this.id=c[1];this.embed_link="http://vids.myspace.com/index.cfm?fuseaction=vids.individual&VideoID="+this.id;this.detected=true;this.src_link="http://mediaservices.myspace.com/services/media/embed.aspx/m="+this.id+",t=1,mt=video"}}if(!this.detected){c=h.match(/src="(http:\/\/(www\.)?hulu\.com\/(embed\/|embed\.html\?eid=)(.*?))"/i);if(c){this.type="hulu";this.id=c[4];this.embed_link="http://www.hulu.com/embed/"+this.id;this.detected=true;this.src_link=c[1]}}if(!this.detected){c=h.match(/^http:\/\/(www\.)?hulu\.com\/embed\/(.*)$/i);if(c){this.type="hulu";this.id=c[2];this.embed_link="http://www.hulu.com/embed/"+this.id;this.detected=true;this.src_link=this.embed_link}}if(!this.detected){if(/http(s)?:\/\/(w\.)?soundcloud.com\/player/i.test(h)){c=h.match(/http(s)?:\/\/(w\.)?soundcloud.com\/player\/\?([\/\d\w=%\.;:-_&]*)/i);var m=c[3].replace(/&amp;/g,"&");var o=m.toQueryParams();this.id=o.hasOwnProperty("url")?o.url:"";this.soundcloud_visual=o.hasOwnProperty("visual")?o.visual:"false";this.soundcloud_artwork=o.hasOwnProperty("show_artwork")?o.show_artwork:"false";this.type="soundcloud";this.tag="iframe";this.detected=true;this.embed_link="https://w.soundcloud.com/player/?url="+this.id+"&color=ff5500&auto_play=false&hide_related=false&visual="+this.soundcloud_visual+"&show_artwork="+this.soundcloud_artwork;this.src_link=this.embed_link}}if(!this.detected&&h.match(/spotify/)){if(h.match(/open\.spotify/)){h=h.replace("http://open.spotify.com","spotify");h=h.replace(/\//g,":")}c=h.match(/(spotify:.*:[0-9a-zA-Z]{22})/i);if(c){this.type="spotify";this.tag="iframe";this.id=c[1];this.embed_link="https://embed.spotify.com/?uri="+this.id;this.detected=true;this.src_link=c[1]}}if(acl.user_can("general_admin")&&!this.detected&&h.match(/polldaddy/)){c=h.match(/polldaddy.com\/poll\/(\d+)\//i);if(c){this.type="polldaddy";this.tag="script";this.id=c[1];this.embed_link="http://polldaddy.com/poll/"+this.id+"/";this.detected=true;this.src_link="http://polldaddy.com/poll/"+this.id+"/";this.thumbs=[BF_STATIC.image_root+"/static/images/public/contrib/poll-daddy.gif"];this.thumbnail_available=true}}if(!this.detected&&h.match(/(msnbc|nbcnews)\./)){c=h.match(/(nbcnews\.com\/video\/[^\/]+\/|launch=)(\d+)/i);if(c){this.type="msnbc";this.id=c[2];this.embed_link="http://www.nbcnews.com/video/nbcnews.com/"+this.id;this.detected=true;this.thumbs=[BF_STATIC.image_root+"/static/images/public/contrib/msnbc.jpg"];this.thumbnail_available=true;this.src_link=this.embed_link}}if(acl.user_can("general_admin")&&!this.detected&&h.match(/storify/)){c=h.match(/storify.com\/([^\/]+\/[^\/.]+)/i);if(c){this.type="storify";this.tag="script";this.id=c[1];this.embed_link="http://storify.com/"+this.id;this.detected=true;this.thumbnail_available=false;this.src_link="http://storify.com/"+this.id}}if(!this.detected){c=h.match(/(http:\/\/(www\.)?dailymotion\.com\/swf\/(\w+))/i);if(c){this.type="daily motion";this.id=c[3];this.embed_link="http://www.dailymotion.com/swf/"+this.id;this.detected=true;this.src_link=c[1]}}if(!this.detected){c=h.match(/http:\/\/(www\.)?dailymotion\.com\/.*(related|video)\/([\w-]+)/i);if(c){this.type="daily motion";this.id=c[3];this.embed_link="http://www.dailymotion.com/swf/"+this.id;this.detected=true;this.src_link=this.embed_link}}if(!this.detected){c=h.match(/^http:\/\/(www\.)?metacafe\.com\/watch\/(.*?)\/(\w+)/i);if(c){this.type="metacafe";this.id=c[2];this.embed_link="http://www.metacafe.com/fplayer/"+this.id+"/"+c[3]+".swf";this.detected=true;this.src_link=this.embed_link}}if(!this.detected){c=h.match(/http:\/\/(www\.)?metacafe\.com\/fplayer\/(.*?)\/(\w+)/i);if(c){this.type="metacafe";this.id=c[2];this.embed_link="http://www.metacafe.com/fplayer/"+this.id+"/"+c[3]+".swf";this.detected=true;this.src_link=this.embed_link}}if(!this.detected){c=h.match(/http(s)?:\/\/rd\.io\/[xi]\/([a-zA-Z0-9_]+)/i);if(c){this.type="rdio";this.id=c[2];this.embed_link="http://rd.io/i/"+this.id;this.detected=true;this.thumbnail_available=true;this.src_link=this.embed_link}}if(!this.detected){c=h.match(/\/\/instagram.com\/p\/([^\/]+)\//i);if(c){this.type="instagram";this.id=c[1];this.embed_link="http://instagram.com/p/"+this.id+"/";this.detected=true;this.thumbnail_available=true;this.src_link=this.embed_link}}if(!this.detected){c=h.match(/vine.co\/v\/([^\/]+)/i);if(c){this.type="vine";this.id=c[1];this.embed_link="https://vine.co/v/"+this.id;this.detected=true;this.thumbnail_available=false;this.src_link=this.embed_link}}if(!this.detected){c=h.match(/<a href="(http:\/\/www\.someecards.com\/.*)"><img src="([^"]*)".* \/><\/a>/i);if(c){this.type="someecard";this.id=c[2];this.embed_link=c[2];this.detected=true;this.thumbnail_available=false;this.src_link=c[1]}}if(acl.user_can("upload_audio_files")&&!this.detected){c=h.match(/.*\/([^\/]+)\.mp3/i);if(c){this.type="audio";this.id=c[1];this.embed_link=h;this.detected=true;this.thumbnail_available=false}}if(BF_STATIC.bf_test_mode){var g="http://dev.buzzfeed.com/static/images/public/t/640x480.jpg";this.thumbs=[g,g,g,g]}}};this.detect_thumbnail_url=function(c,f){if(this.getting_thumbnail){return}else{this.getting_thumbnail=true}if(typeof(c)==="function"){f=c;c=this.embed_link}if(!c){return false}c=c.strip();var a="/buzzfeed/_rservice/?uri="+encodeURIComponent(c)+"&thumbnail_url",b=this;if(this.thumbs&&this.thumbs.length){if(typeof(f)==="function"){f.call(b);return false}}new Ajax.Request(a,{method:"get",onComplete:function(g){b.getting_thumbnail=false;b.thumbs=[g.responseText];if(typeof(f)==="function"){f.call(b)}}})};this.detect_duration=function(c,f){if(this.getting_duration){return}else{this.getting_duration=true}if(typeof(c)==="function"){f=c;c=this.embed_link}if(!c){return false}c=c.strip();c=c.replace(/&amp;t=([\w-]+)/,"");var a="/buzzfeed/_rservice/?uri="+encodeURIComponent(c)+"&video_duration",b=this;if(this.duration){if(typeof(f)==="function"){f.call(b);return false}}new Ajax.Request(a,{method:"get",onComplete:function(g){b.getting_duration=false;b.duration=g.responseText;if(typeof(f)==="function"){f.call(b)}}})}};BF_initSwfObject=function(a,o){try{if(typeof(a)=="undefined"){return null}a=a.strip();var p=new bf2_terminal_Video(),g=null,c=425,r=355,b=(new Date()).getTime(),h=0,q="",f="",l="",k="";if(o&&o.width){c=o.width}if(o&&o.height){r=o.height}if(o&&o.id){b=o.id}if(o&&o.dfp&&o.dfp==true){k="&dfp=true"}if(o&&o.autoplay){h=o.autoplay}if(o&&o.hideYouTubeInfo){q="&autohide=2&showinfo=0"}if(o&&o.modestBranding){l="&modestbranding=1"}p.detect_type(a);if(p.detected){a=p.src_link}if(a.match(/vimeo\.com/)){g={addParam:function(){},write:function(s){$(s).insert('<iframe src="'+a+'" frameborder="0" width="'+c+'" height="'+r+'"></iframe>')},getSWFHTML:function(){return'<iframe src="'+a+'" frameborder="0" width="'+c+'" height="'+r+'"></iframe>'}}}else{if(a&&a.match(/(hulu|myspace|liveleak|flickr)\.com/)){g=new SWFObject(a,b,c,r,"6","#000")}else{if(a.match(/video\.google\.com/)){g=new SWFObject(a,b,c,r,"6","#000")}else{if(a.match(/(nbcnews\.com\/video\/[^\/]+\/)(\d+)/i)){var m=a.match(/(nbcnews\.com\/video\/[^\/]+\/)(\d+)/i);g=new SWFObject("http://www.msnbc.msn.com/id/32545640",b,c,r,"6","#000");g.addVariable("launch",p.id);g.addVariable("width",c);g.addVariable("height",r)}else{if(a.match(/youtube\.com/)){if(p.start_time){f="&start="+p.start_time}if(a.match(/embed/)){g={getId:function(){return p.id},getEmbedCode:function(){return'<div style="position:relative;" id="video_wrapper_'+p.id+'"><iframe id="yt_'+p.id+'" type="text/html" allowscriptaccess="always" allowfullscreen="true" width="'+c+'" height="'+r+'" src="'+a+"?version=3&fs=1&hl=en&origin="+window.location.protocol+"//"+window.location.host+"&playerapiid=embed_"+p.id+"&autoplay="+h+q+k+l+f+'&enablejsapi=1&wmode=opaque" bgcolor="#000" class="ytvideo"></iframe></div>'}}}else{g=new SWFObject(a+"?version=3&fs=1&hl=en&playerapiid="+b+"&autoplay="+h+q+k+l+f+"&enablejsapi=1",b,c,r,"6","#000");g.addParam("wmode","transparent");g.addParam("allowscriptaccess","always")}}else{if(a.match(/s\.video\.buzzfeed\.com\//)||a.match(/s3\.amazonaws\.com\/buzzfeed-video1\//)||a.match(/buzzfeed-video1\.s3\.amazonaws\.com\//)){g=new FlowVid(o);g.width=c;g.height=r;g.vid_id=a.replace(/^(http:\/\/)(s\.video\.buzzfeed\.com\/|s3\.amazonaws\.com\/buzzfeed\-video1\/|buzzfeed-video1\.s3\.amazonaws\.com\/)(.*)(\.[A-Z0-9]+)$/i,"$3");g.url=a;if(window.autoplay!="undefined"&&window.autoplay==true){h=true}g.vid_autoplay=h}else{g=new SWFObject(a+(!a.match(/\?/)?"?":"")+"&amp;autostart=false&amp;autoplay="+h+"&amp;color1=0x3a3a3a&amp;color2=0x999999&amp;border=0",b,c,r,"6","#000")}}}}}}return g}catch(n){console.dir(n);return false}};var FlowVid=function(a){this.use_html5=false;this.width="100%";this.height="100%";this.debug=false;this.track_ga=true;this.track_formula=false;this.vid_id="unknown-video";this.url=null;this.vid_player="flowplayer";this.vid_onloadstart=null;this.vid_onplay=null;this.vid_onended=null;this.vid_cuepoints={25:null,50:null,75:null};this.vid_onclick=null;this.vid_autoplay=false;this.vid_scaling="fit";this.hide_controls=false;this.timestamp=(new Date()).getTime();this.html5_support=function(){var c=document.createElement("video"),b=false;try{if(b=!!c.canPlayType){b=new Boolean(b);b.ogg=c.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"");b.h264=c.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"");b.webm=c.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(f){}return b};this.default_onloadstart=function(){if($(this.player_div)&&!$(this.player_div).tracked.impression){$(this.player_div).tracked.impression=true;this._video_track(this.vid_id,"[nc]video:load","",null,true);if(this.vid_onloadstart){if(this.debug){console.log("Video Track (Custom, onloadstart): [...]")}try{this.vid_onloadstart()}catch(b){console.log("ERROR: Video Track (Custom, onloadstart): "+b)}}}};this.default_onplay=function(){if($(this.player_div)&&!$(this.player_div).tracked.start){$(this.player_div).tracked.start=true;this._video_track(this.vid_id,"video-play");if(this.vid_onplay){if(this.debug){console.log("Video Track (Custom, onplay): [...]")}try{this.vid_onplay()}catch(b){console.log("ERROR: Video Track (Custom, onplay): "+b)}}}};this.default_onended=function(){if($(this.player_div)&&!$(this.player_div).tracked.finish){$(this.player_div).tracked.finish=true;this._video_track(this.vid_id,"[nc]video:end");if(this.vid_onended){if(this.debug){console.log("Video Track (Custom, onended): [...]")}try{this.vid_onended()}catch(b){console.log("ERROR: Video Track (Custom, onended): "+b)}}}};this.default_timeupdate=function(){var c=$(this.player_div);for(var b in this.vid_cuepoints){if(!(c.tracked.reach[b])){if(c.currentTime*1000>Math.floor(c.duration*b*10-(b==100?100:0))){c.tracked.reach[b]=true;this._video_track(this.vid_id,"[nc]video:reached",b+"%")}}}};this._video_track=function(c,q,f){var k=q+(f?"/"+f:"");if(this.debug){console.log("Video Track: "+k+"/"+c)}if(this.track_ga&&typeof(_gaq)!="undefined"&&_gaq!=null){try{var l=gtrack.tt_page;if(a.dfp){var h="dfp/"+q}else{var h=q}var m=this.vid_id;var n=(f?":"+f:"");var o=h.match(/load/)?true:false;gtrack.track_events(l,(h+n),m,"",o)}catch(g){console.log("ERROR: Video Track")}}};this.addParam=function(b,c){};this.write=function(m){if(!this.url){console.error("Video URL must be specified!");return}try{this.player_div="player_"+this.timestamp;var g=this.url,b=navigator.userAgent.toLowerCase(),l=$(m);if(!this.vid_thumbnail){this.vid_thumbnail=this.url.replace(/^(.*)(\.)([A-Z0-9]+)$/i,"$1.jpg")}if(this.use_html5||b.match(/iphone|ipad|android/i)||(false&&b.match(/chrome|safari/i))){var c=document.createElement("video");c.id=this.player_div;c.tracked={impression:false,start:false,finish:false,reach:[]};c.style.width=this.width+((this.width+"").match(/%/)?"":"px");c.style.height=this.height+((this.height+"").match(/%/)?"":"px");c.setAttribute("src",g.replace(/(\.flv)$/i,".mp4"));c.addClassName("bf_video");c.binding=this;if(this.vid_thumbnail){c.setAttribute("poster",this.vid_thumbnail)}if(b.match(/android/)){c.setAttribute("onclick","this.play();")}else{c.setAttribute("controls","controls")}if(this.default_timeupdate){c.setAttribute("ontimeupdate","this.binding.default_timeupdate()")}if(this.default_onended){c.setAttribute("onended","this.binding.default_onended()")}if(this.default_onplay){c.setAttribute("onplay","this.binding.default_onplay()")}if(this.default_onloadstart){c.setAttribute("onloadstart","this.binding.default_onloadstart()")}$(m).insert(c)}else{if(this.vid_player=="flowplayer"){var c=document.createElement("div"),k=this;this.controls_height=(this.hide_controls?0:24);c.id=this.player_div;c.tracked={impression:false,start:false,finish:false,reach:[]};c.style.width=this.width+((this.width+"").match(/%/)?"":"px");c.style.height=((this.height+"").match(/%/)?this.height:((parseInt(this.height)+this.controls_height)+"px"));$(m).insert(c);var f={playlist:[],screen:{width:"100%",height:"100%",top:0,left:0},canvas:{backgroundGradient:"none",background:"rgba(34,34,34,1)"},plugins:{controls:{playlist:false,autoHide:(this.hide_controls?"auto":"never"),buttonOverColor:"rgba(255,255,255,1)",progressGradient:"none",timeBgColor:"rgb(0,0,0,0)",durationColor:"rgba(255,255,255,1)",timeBorder:"0px solid rgba(0,0,0,0)",sliderGradient:"none",buttonColor:"rgba(255,255,255,.82)",backgroundGradient:"none",timeColor:"rgba(255,255,255,1)",borderRadius:"0px",tooltipTextColor:"rgba(255,255,255,1)",timeSeparator:" ",bufferGradient:"none",volumeBorder:"1px solid rgba(255,255,255,.36)",volumeSliderColor:"rgba(255,255,255,.09)",volumeColor:"rgba(255,255,255,1)",sliderBorder:"1px solid rgba(255,255,255,.36)",volumeSliderGradient:"none",tooltipColor:"rgba(0,0,0,1)",sliderColor:"rgba(255,255,255,.09)",buttonOffColor:"rgba(130,130,130,1)",progressColor:"rgba(0,119,238,1)",bufferColor:"rgba(255,255,255,.18)",backgroundColor:"rgba(34,34,34,1)",height:24,opacity:1}},onLoad:function(){if(k.default_onloadstart){k.default_onloadstart()}},key:"#$6f5e940abb368c2a4e2"};if(!this.vid_autoplay){f.playlist.push({url:this.vid_thumbnail,duration:0,scaling:this.vid_scaling})}f.playlist.push({url:g,autoPlay:this.vid_autoplay,scaling:this.vid_scaling,onStart:function(n){if(k.default_onplay){k.default_onplay()}if(n.fullDuration>0){for(var o in k.vid_cuepoints){n.onCuepoint(Math.floor(n.fullDuration*o*10-(o==100?100:0)),function(p){if($(k.player_div)&&!$(k.player_div).tracked.reach[this]){$(k.player_div).tracked.reach[this]=true;k._video_track(k.vid_id,"[nc]video:reached",this+"%");if(k.vid_cuepoints[this]){if(k.debug){console.log("Video Track (Custom, reached/"+this+"%): [...]")}try{k.vid_cuepoints[this](k)}catch(q){console.log("ERROR: Video Track (Custom, reached/"+this+"%): "+q)}}}}.bind(o))}}},onFinish:function(n){if(k.default_onended){k.default_onended()}}});flowplayer(this.player_div,{src:"http://s3.amazonaws.com/buzzfeed-video1/flowplayer.commercial-3.2.7.swf",onFail:function(){$(k.player_div).up(".video-embed-area").addClassName("video-embed-noflash")},wmode:"opaque"},f)}else{console.error("FlowVid Error: Video player type not specified.")}}}catch(h){console.error("FlowVid Error: "+h)}}};ga_cv_map={"1":"template","2":"postCategory","3":"pageType","4":"postAuthor","5":"postBadges","6":"isRegistered","7":"signupDate","8":"facebookConnected","9":"registrationPath","10":"userFlags","11":"allowsEmailUpdates","12":"gender","13":"age","14":"origReferrer","15":"origPageType","16":"origSegment","17":"username","18":"lastVisit","19":"numShares","20":"numSharesFacebook","21":"numSharesTwitter","22":"numSharesEmail","23":"numReactions","24":"reactionCounts","25":"numComments","26":"numPosts","27":"numAwards","28":"categoryCounts","29":"categoryShareCounts","30":"logged-in","31":"facebookConnected","32":"numShares","33":"numReactions","34":"time_since_last_visit","35":"country","36":"","37":"postTags1","38":"postTags2","39":"postTags3","40":"numEvents","41":"sinceFV_d","42":"sinceFDHPV_d","43":"nDHPV","44":"postFlags","45":"postPublished","46":"","47":"campaignID","48":"ReactGifImpression","49":"postForm","50":"mobileVariation"};var BF_GTrack=function(){this.trackable_tags=["a","input","button","i"];this.tt_page=typeof(BF_STATIC.tt_page)!="undefined"?BF_STATIC.tt_page:"NA";this.scrollDepth=0;this.UserCVIDs=[6,8,9,10,11,12,13,14,15],this.VistCVIDs=[30,31,32,33,34],this.ShareCVs=[19,20,21,22];this.postEvents=[];this.click_event_storage=[];this.ga_status=function(){return typeof(_gaq)!="undefined"&&typeof(_gat)!="undefined"&&!gtrack.checkTestMode()?true:false};this.ga_debug=function(){return document.location.search.match(/debug=ga/)?true:false};this.track_timing=function(category,variable,time,opt_label,opt_sample){if(BF_STATIC.bf_env=="live"&&!BF_STATIC.bf_test_mode){_gaq.push(["_trackTiming",category,variable,time,opt_label,opt_sample])}else{console.log("TrackTiming: ['"+category+"','"+variable+"', "+time+", '"+opt_label+"', "+opt_sample+"]")}};this.is_homepage=function(){var p=BF_STATIC&&BF_STATIC.hasOwnProperty("tt_page")?BF_STATIC.tt_page:"";return p.match("Home|France|Espanol|Brasil")?true:false};this.init=function(){gtrack.trackScroll();bfjs.universal_each(gtrack.trackable_tags,function(t){var trigger="mousedown";if(bfjs.isMobile()&&BF_STATIC.env=="live"){trigger="click"}$(document.body).on(trigger,t,function(event){var el=bfjs.eventFindEl(event,t);gtrack.click(el)})})};this.cleanLink=function(href){if(typeof href=="string"){return href.replace("http://","").replace("https://","").replace("www.","")}else{return null}};this.click=function(el){var gt_act=$(el)[bfjs.read_attr](bfjs.gtrack_act);var gt_label=$(el)[bfjs.read_attr](bfjs.gtrack_label);var gt_cat=gtrack.findCatLabel(el);var tag=el.tagName.toUpperCase();if(tag=="A"){if(typeof el.href!="undefined"&&el.href.match(/http/)&&!el.href.match(/buzzfeed.com/)){$(el)[bfjs.write_attr]("target","_blank")}}if(typeof(gt_act)!="string"){gt_act="link";gt_label=gtrack.cleanLink(el.href)}if(gt_act.indexOf("dfp")>=0){var doubleclick=(el.href.match(/doubleclick/)&&el.href.match(/http/)&&el.href.split("http://").length>2?true:false);gt_label=(gt_label?gt_label+"/":"")+(doubleclick?gtrack.cleanLink(el.href.split("http://")[2]):gtrack.cleanLink(el.href))}gtrack.track_events(gt_cat,gt_act,gt_label)};this.findCatLabel=function(element){try{var count=0,max=99;while(element!=document&&count<max){var parent=$(element)[bfjs.up]();if(parent[bfjs.read_attr](bfjs.gtrack_cat)){return parent[bfjs.read_attr](bfjs.gtrack_cat)}else{element=parent;count++}}return null}catch(e){return null}};this.track_events=function(cat,act,label,value,br){if(act=="ignore"){return}br=typeof(br)!="undefined"?br:false;if(typeof cat=="undefined"||!cat){cat=gtrack.tt_page}if(typeof act=="undefined"||!act){act=""}if(label&&typeof label!="string"&&label!=null){label=label.toString()}if(typeof label=="undefined"||!label){label="(no label)"}act=act.indexOf("[nc]")<0?"click:"+act:act.replace("[nc]","");cat=cat.indexOf("[ttp]")<0?cat:cat.replace("[ttp]",gtrack.tt_page);try{if(BF_STATIC.bf_env!="live"&&hasLocalStorage()&&(act.match("click")||act.match("page-exit"))&&!act.match("ab:")){localStorage.setItem("custom_events",window.JSON.stringify({category:cat,action:act,label:label}))}if(gtrack.ga_status()){_gaq.push(["_trackEvent",cat,act,label,,br])}if(BF_STATIC.bf_env!="live"){console.log("Event: ['"+cat+"','"+act+"','"+label+"','"+value+"','"+br+"']")}if(gtrack.postEvents.length>0&&!act.match("impab")&&!act.match("page-exit")&&!act.match("video:load")){var abact=act.match(":")?act.replace(":","ab:"):("ab:"+act);var postLabel=gtrack.postEvents.toString()+(label?";ol:"+label:""),br=true;if(BF_STATIC.bf_env!="live"&&hasLocalStorage()&&abact.match("click")&&!abact.match("ab:")){localStorage.setItem("custom_events",window.JSON.stringify({category:cat,action:abact,label:postLabel}))}if(gtrack.ga_status()){_gaq.push(["_trackEvent",cat,abact,postLabel,,br])}if(BF_STATIC.bf_env!="live"){console.log("Event: ['"+cat+"','"+abact+"','"+postLabel+"','"+value+"','"+br+"']")}}if(gtrack.tt_page=="Buzz"&&objExists(buzzDetails)&&buzzDetails.ad=="1"&&!cat.match("header")&&!cat.match("bottom")){bfjs.universal_each(["share/","video-play"],function(x){if(act.match(x)){var clickType=objExists(hashtrack)&&objExists(hashtrack.tracked_hash_tag)?tracker.types.HASH_CLICK:tracker.types.SITE_CLICK;tracker.add({type:clickType});tracker.run()}})}if(gtrack.tt_page=="Buzz"&&objExists(dfa)){dfa.fire_event(act)}}catch(err){if(BF_STATIC.bf_env!="live"){console.log(err)}}};this.checkTestMode=function(){if(BF_STATIC.bf_test_mode&&document.cookie.match("sel2_third_party_ananlytics")===null&&document.cookie.match("sel2_gtrack")===null&&!bfjs.isMobile()){return true}else{return false}};this.abTracking=function(){if(gtrack.checkTestMode()){return}if(!gtrack.ga_status()||typeof(abtest.abLive)=="undefined"){setTimeout("gtrack.abTracking()",500);return false}if(abtest.abLive){var abTests=abtest.abTests.split(","),abVars=abtest.abVariations.split(",");for(var x=0;x<abTests.length;x++){gtrack.postEvents.push(abTests[x]+":"+abVars[x])}gtrack.fireABImp()}};this.fireABImp=function(){if(gtrack.postEvents.length>0){gtrack.track_events("[ttp]","[nc]impab",gtrack.postEvents.toString(),"",true)}};this.whodatTracking=function(){if(gtrack.checkTestMode()){return}if(typeof window.whodat_bucket!="undefined"){gtrack.postEvents.push("whodat:"+window.whodat_bucket)}};this.trackShares=function(index,id){if(!gtrack.ga_status()){return}_gaq.push(function(){var tracker=_gat._getTrackerByName();var shares=gtrack.getCustomVars(index,0);var CVs={};if(index==23){var selectedBadge=id.split("_")[1];id=id.split("_")[0]}if(!isNaN(parseFloat(Number(shares)))){shares++}CVs[index]=shares;if(index>=20&&index<=22){var numShares=1;for(var shareID=20;shareID<=22;shareID++){numShares+=Number(gtrack.getCustomVars(shareID,0))}CVs[19]=numShares;var sessionShares=isNaN(gtrack.getCustomVars(32,0))?0:gtrack.getCustomVars(32,0);sessionShares=Number(sessionShares)+1;gtrack.setCustomVars(2,{32:sessionShares});var buzz_cat=BF_STATIC.bf_category;if(Number(buzz_cat)){var cc=gtrack.getCustomVars(29,"").split("");var lid="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(buzz_cat);if(cc.length>=50){cc.shift()}cc.push(lid);CVs[29]=cc.join("")}}if(index==23){var reactionCounts="";var badges=(gtrack.getCustomVars(24,"L-0_WI-0_OM-0_WT-0_C-0_F-0_G-0_T-0_OL-0_E-0")).split("_");for(badge=0;badge<badges.length;badge++){var badgeAbr=badges[badge].split("-")[0];var badgeVal=badges[badge].split("-")[1];if((selectedBadge.substring(0,badgeAbr.length).toLowerCase()==badgeAbr.toLowerCase())&&(badgeVal<999)){badgeVal++}reactionCounts+=badgeAbr+"-"+badgeVal+"_"}reactionCounts=escape(reactionCounts.substring(0,reactionCounts.length-1));CVs[24]=reactionCounts;var sessionReactions=Number(gtrack.getCustomVars(33,0))+1;gtrack.setCustomVars(2,{33:sessionReactions})}gtrack.setCustomVars(1,CVs)})};this.getCustomVars=function(index,defVal){var tracker=_gat._getTrackerByName();if(gtrack.VistCVIDs.indexOf(index)>=0&&window.sessionStorage&&typeof sessionStorage["CV_"+index]!="undefined"){return sessionStorage["CV_"+index]}else{if(!tracker._getVisitorCustomVar(index)){var CValue=defVal}else{var CValue=tracker._getVisitorCustomVar(index)}}return CValue};this.CVsExist=function(IDs,scope){for(var x=0;x<IDs.length;x++){if(scope==2&&window.sessionStorage){if(typeof sessionStorage["CV_"+IDs[x]]=="undefined"){return false}}else{if(gtrack.getCustomVars(IDs[x],null)==null){return false}}}return true};this.setVisitCVs=function(){if(gtrack.checkTestMode()){return}if(!gtrack.ga_status()){setTimeout("gtrack.setVisitCVs()",500);return false}var ts_now=Math.round(new Date().getTime()/1000);if(typeof bf_login!="undefined"){bf_login.loggedInCallbacks.push(gtrack.loggedInStatus)}gtrack.loggedInStatus();if(!gtrack.CVsExist([41],2)||gtrack.getCustomVars(41,null)==null||gtrack.ga_debug()){var time_cookie=bfjs.read_cookie("__utma");var numDays=0;if(time_cookie&&time_cookie.split(".").length>=2){var firstVisit=time_cookie.split(".")[2];numDays=Math.floor((ts_now-firstVisit)/86400)}gtrack.setCustomVars(2,{41:numDays})}if(!gtrack.CVsExist([42],2)||gtrack.getCustomVars(42,null)==null||gtrack.ga_debug()){var firstHPVisit=bfjs.read_cookie("firstHPVisit");var daysSinceFirstHPVisit="NA";if(document.referrer==""){if(firstHPVisit&&typeof firstHPVisit!="undefined"){daysSinceFirstHPVisit=Math.floor((ts_now-firstHPVisit)/86400)}else{if(gtrack.is_homepage()||gtrack.ga_debug()){daysSinceFirstHPVisit=0;bfjs.write_cookie("firstHPVisit",ts_now.toString())}}}if(typeof daysSinceFirstHPVisit=="number"){gtrack.setCustomVars(2,{42:daysSinceFirstHPVisit})}}var HPVisits=parseInt(gtrack.getCustomVars(43,0));if(gtrack.is_homepage()&&(document.referrer==""||gtrack.ga_debug())){HPVisits+=1}gtrack.setCustomVars(1,{43:HPVisits});var country="";if(bfjs.isMobile()){country=(readCookie("country")!=null&&readCookie("country")!="us"?readCookie("country"):"us")}else{if(typeof BFW_Util=="object"){country=(BFW_Util.getCookie("country")!=null&&BFW_Util.getCookie("country")!="us"?BFW_Util.getCookie("country"):"us")}}gtrack.setCustomVars(1,{35:country})};this.loggedInStatus=function(){var user=new BF_User();var userInfo=user.getUserInfo();var isRegistered=typeof user.isLoggedIn()!="undefined"?user.isLoggedIn():"false";var facebookConnected=typeof userInfo.is_facebook_user!="undefined"?userInfo.is_facebook_user:"false";var userid=parseInt(userInfo.userid);var CVs={30:isRegistered,31:facebookConnected};if(isRegistered){CVs[17]=(userInfo.p_editor_admin?"editor":"user")+"/"+userid.toString(36)}gtrack.setCustomVars(2,CVs)};this.setBuzzCVs=function(){if(gtrack.checkTestMode()){return}var ad=buzzDetails.hasOwnProperty("ad")?buzzDetails.ad:"",raw=buzzDetails.hasOwnProperty("raw")?buzzDetails.raw:"",nsfw=buzzDetails.hasOwnProperty("nsfw")?buzzDetails.nsfw:"",login=buzzDetails.hasOwnProperty("login")?buzzDetails.login:"",editor=buzzDetails.hasOwnProperty("editor")?buzzDetails.editor:"",f_ad=BF_STATIC.hasOwnProperty("f_ad")?BF_STATIC.f_ad:"",f_partner=buzzDetails.hasOwnProperty("f_partner")?buzzDetails.f_partner:"",user=buzzDetails.hasOwnProperty("user")?buzzDetails.user:"",trigger=buzzDetails.hasOwnProperty("trigger")?buzzDetails.trigger:"",postBadges=buzzDetails.hasOwnProperty("postBadges")?buzzDetails.postBadges:"",postTags=buzzDetails.hasOwnProperty("postTags")?buzzDetails.postTags:"",published=buzzDetails.hasOwnProperty("published")?buzzDetails.published.split(" ")[0]:"",username=BF_STATIC.hasOwnProperty("username")?BF_STATIC.username:"",category_name=buzzDetails.hasOwnProperty("category_name")?buzzDetails.category_name:"",form=buzzDetails.hasOwnProperty("form")?buzzDetails.form:"",campaignid=BF_STATIC.hasOwnProperty("campaignid")?BF_STATIC.campaignid:"";var postTagsArray=postTags.split(","),postTagsStorage=["","",""],postTagStorageKey=0;for(var x=0;x<postTagsArray.length;x++){if(postTagStorageKey>2){continue}var pt=postTagsArray[x].substring(0,63);if(postTagsStorage[postTagStorageKey].length+pt.length>=127){postTagStorageKey++}postTagsStorage[postTagStorageKey]+=pt+","}var CVs={44:escape("raw-"+raw+"_nsfw-"+nsfw+"_ad-"+f_ad+"_partner-"+f_partner+"_editor-"+editor+"_user-"+user+"_trigger-"+trigger),45:published,4:username,5:postBadges.substring(0,postBadges.length-1),2:category_name,37:postTagsStorage[0].substring(0,Math.min(postTagsStorage[0].length-1,127)),38:postTagsStorage[1].substring(0,Math.min(postTagsStorage[1].length-1,127)),39:postTagsStorage[2].substring(0,Math.min(postTagsStorage[2].length-1,127)),49:form,47:campaignid};gtrack.setCustomVars(3,CVs)};this.setUserCVs=function(){if(!gtrack.ga_status()){setTimeout("gtrack.setUserCVs()",500);return false}for(var i=0;i<gtrack.ShareCVs.length;i++){var id=gtrack.ShareCVs[i],so={};if(gtrack.getCustomVars(id,null)==null){so[id]="0";gtrack.setCustomVars(1,so)}}var buzz_cat=BF_STATIC.bf_category;if(Number(buzz_cat)){var cc=gtrack.getCustomVars(28,"").split("");var lid="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(buzz_cat);if(cc.length>=50){cc.shift()}cc.push(lid);gtrack.setCustomVars(1,{28:cc.join("")})}if(gtrack.getCustomVars(14,null)==null||gtrack.ga_debug()){var referrer=document.referrer?document.referrer.replace("http://","").replace("https://","").replace("www.","").split(/[/?#]/)[0]:"(direct)";if(referrer.indexOf("buzzfeed.com",referrer.toLowerCase())>=0){referrer="(direct)"}gtrack.setCustomVars(1,{14:referrer})}if(gtrack.getCustomVars(15,null)==null||gtrack.ga_debug()){var pageType=typeof(BF_STATIC.tt_page)!="undefined"?BF_STATIC.tt_page:false;gtrack.setCustomVars(1,{15:pageType})}if((gtrack.getCustomVars(16,null)==null||gtrack.ga_debug())&&typeof(hashtrack)!="undefined"){if(typeof(hashtrack.tracked_hash_tag)!="undefined"){var ht=hashtrack.tracked_hash_tag;var level=ht.charAt(0)+ht.charAt(ht.length-1);var segment=ht.substring(1,ht.length-1);gtrack.setCustomVars(1,{16:level+"/"+segment})}}if(gtrack.getCustomVars(34,null)==null||gtrack.ga_debug()){var lastVisit=Number(gtrack.getCustomVars(18,null));var today=new Date().getTime()/1000;var lastYear=new Date().setDate(new Date().getDate()-365)/1000;if(!isNaN(lastVisit)&&typeof(lastVisit)=="number"){if(lastYear<lastVisit&&lastVisit<today){var timeDiff=today-lastVisit;var hours=(timeDiff/3600);lastVisit=isNaN(hours)?null:Math.round(hours)}}else{lastVisit=null}gtrack.setCustomVars(2,{34:lastVisit});gtrack.setCustomVars(1,{18:Math.round(today)})}var user=new BF_User();var isRegistered=user.isLoggedIn();if((!gtrack.CVsExist(gtrack.UserCVIDs,1))||(isRegistered==true&&gtrack.getCustomVars(6,null)=="false")||gtrack.ga_debug()){if(isRegistered){var userInfo=user.getUserInfo();settings_call=(new BF_Request()).request;settings_call("/buzzfeed/_edit_user",{method:"get",parameters:{action:"settings",session_key:userInfo.session_key},onSuccess:function(userResp){var userData=eval("("+userResp.responseText+")");var facebookConnected=userInfo.is_facebook_user;var registrationPath=userInfo.registration_path;var gender=(userData.user.gender==null?"false":userData.user.gender.toLowerCase()=="male"||userData.user.gender.toLowerCase()=="female"?userData.user.gender.toLowerCase():"false");var userFlags=(userInfo.p_admin=="true"?"admin":userInfo.moderated=="1"?"moderated":userInfo.f_raw=="1"?"raw":false);var allowsEmailUpdates=(userData.user.allow_email_updates==1?"true":"false");var signUpDate=(typeof userInfo.date_created_unix!=undefined?userInfo.date_created_unix:null);var CVs={6:isRegistered,7:signUpDate,8:facebookConnected,9:registrationPath,10:userFlags,11:allowsEmailUpdates,12:userData.user.gender,13:gtrack.DOB2Age(userData.user.age)};gtrack.setCustomVars(1,CVs);GAPageLoad()},onFailure:function(){console.error("unable to fetch user data for gtrack.setUserCVs()");GAPageLoad()}})}else{var CVs={6:false,8:false,9:false,10:false,11:false,12:false,13:false,7:false};gtrack.setCustomVars(1,CVs);GAPageLoad()}}else{GAPageLoad()}};this.setCustomVars=function(scope,CVs){if(gtrack.checkTestMode()){return}if(!gtrack.ga_status()){setTimeout(function(){gtrack.setCustomVars(scope,CVs)},500);return false}if(typeof scope!="number"||typeof CVs!="object"){return false}for(cv in CVs){if(typeof cv=="undefined"||typeof CVs[cv]=="undefined"){continue}var key=Number(cv),value=CVs[cv],label=ga_cv_map[key];if(key>=1&&key<=5){if(typeof _gat._getTrackerByName()._getVisitorCustomVar(key)!="undefined"){_gaq.push(["_deleteCustomVar",key])}}if(gtrack.ga_status()){_gaq.push(["_setCustomVar",key,label,(value+""),scope])}if(scope==2&&hasLocalStorage()){sessionStorage.setItem("CV_"+key,value)}if(BF_STATIC.bf_env!="live"){console.log("CustomVar: ['"+key+"','"+label+"','"+value+"']")}}};this.DOB2Age=function(date){var age;var today=new Date();if(/\d{4}\-\d{2}\-\d{2}/.test(date)){date=date.split("-");if((today.getMonth()+1)>date[1]){age=today.getFullYear()-date[0]}else{if((today.getMonth()+1)==date[1]){if(today.getDate()>=date[2]){age=today.getFullYear()-date[0]}else{age=(today.getFullYear()-date[0])-1}}else{age=(today.getFullYear()-date[0])-1}}if(age>150){return null}else{return age}}return date};this.trackScroll=function(){if(bfjs.isMobile()){return false}var page_flow=document.getElementById("page_flow")?document.getElementById("page_flow"):document.getElementById("feed")?document.getElementById("feed"):null;if(gtrack.tt_page=="Home"){var feed=$(page_flow)?$(page_flow)[bfjs.selector]("li:not(.scrolled_past)"):[];var screenBottom=document.documentElement.clientHeight+document.viewport.getScrollOffsets()[1];bfjs.universal_each(feed,function(el){var buzzBottom=bfjs.getOffset(el)[1]+$(el)[bfjs.get_height]();if(buzzBottom<=screenBottom){$(el)[bfjs.add_class]("scrolled_past");if(gtrack.ga_debug()){bfjs.setStyle(el,{border:"solid green 1px"})}}else{if(gtrack.ga_debug()){bfjs.setStyle(el,{border:"solid blue 1px"})}}});gtrack.scrollDepth=$(page_flow)[bfjs.selector]("li.scrolled_past").length}else{var docHeight=document.documentElement.scrollHeight-document.documentElement.clientHeight;var docElScrollTop=typeof document.documentElement.scrollTop!="undefined"?document.documentElement.scrollTop:0;var userGeo=docElScrollTop+document.body.scrollTop;var scrollPercent=(userGeo/docHeight)*100;if(!isNaN(parseFloat(scrollPercent))&&isFinite(scrollPercent)&&scrollPercent>0&&scrollPercent<=100){scrollPercent=(scrollPercent%5)>=1?parseInt(scrollPercent/5)*5+5:parseInt(scrollPercent/5)*5;gtrack.scrollDepth=Math.max(gtrack.scrollDepth,scrollPercent)}}};this.pageUnload=function(){var SD;if(!bfjs.isMobile()){SD=gtrack.scrollDepth}else{var s=$(window).scrollTop(),d=$(document).height(),c=$(window).height();SD=Math.round((s/(d-c))*100)}SD=SD.toString();if(gtrack.tt_page!="Home"){SD+="%"}gtrack.track_events("","[nc]page-exit",SD,null,true)}};var gtrack=new BF_GTrack();bfjs.onPageLoad(gtrack.init);bfjs.windowEvent("unload",function(){gtrack.pageUnload()});if(!bfjs.isMobile()){bfjs.windowEvent("scroll",function(){gtrack.trackScroll()})}EventManager.observe("abtest:ad_unit_design",function(a,b){});EventManager.observe("abtest:video_layout",function(a,b){if(a.match("^video_layout_new")){b.addClassName("new_layout")}if(a==="video_layout_new_wide"){setTimeout("videopage.view_larger()",100)}});var BF_ABTest=function(){this.tt_page=typeof(BF_STATIC.tt_page)!="undefined"?BF_STATIC.tt_page:"NA";this.vertical=typeof(BF_STATIC.vertical)!="undefined"?BF_STATIC.vertical:"NA";this.country=typeof(BF_STATIC.country)!="undefined"?BF_STATIC.country:"NA";this.abTests="",this.abVariations="",this.abLive;this.abConfig={ExampleTest1:{author:"CKelley",page:"testPage",vertical:"verticalcategory|vertical2",country:"US|UK",type:"css",freeze_variation:false,variations:{ab_red:50,ab_blue:25,ab_green:25},start:"1326646414",stop:"1327251214"},ExampleTest2:{author:"Patrick",page:"testPage",type:"html",freeze_variation:false,variations:{ab_stories:50,ab_thumbs:25,ab_grid:25},start:"unixtime",stop:"unixtime"},video_buzz_playlist:{author:"",page:"Buzz",type:"css",freeze_variation:false,variations:{playlist_ok:50,playlist_removal:50},start:"unixtime",stop:"unixtime"},diy_connect:{author:"IDemo",page:"Buzz",vertical:"diy",type:"css",freeze_variation:false,variations:{old_diy_connect:50,new_diy_connect:50},start:"unixtime",stop:"unixtime"},inline_video2:{author:"",page:"Home",context:"*",type:"html",freeze_variation:false,variations:{ab_video_c:50,ab_video_d:50},start:"unixtime",stop:"unixtime"},related_content:{author:"",page:"Buzz",context:"*",type:"html",freeze_variation:false,variations:{related_control:60,related_one:20,related_two:20},start:"1355896801",stop:"1356674399"},inline_share_icon:{author:"",page:"Buzz",context:"*",type:"css",freeze_variation:false,variations:{inline_share_icon_control:50,inline_share_icon_arrow:50},start:"unixtime",stop:"unixtime"},video_layout:{author:"PCarey",page:"Video",context:"*",type:"css",freeze_variation:false,variations:{video_layout_new:80,video_layout_new_wide:20},start:"unixtime",stop:"unixtime"},related_buzz:{author:"naviltsev",page:"Buzz",context:"*",type:"html",freeze_variation:false,variations:{filter_id_0:60,filter_id_2:40},start:"unixtime",stop:"unixtime"}};this.init=function(){abtest.abLoadConfig();if(!bfjs.isMobile()){universal_dom.assign_handler({bucket:"abtest",handler:abtest._init})}else{var a=bfjs.getElsByAttr("[rel\\:bf_bucket]");bfjs.universal_each(a,function(b){if($(b)[bfjs.read_attr]("rel:bf_bucket")=="abtest"){abtest._init(b)}})}};this._init=function(b){if(b.hasAttribute("rel:ab_test")){var a=$(b)[bfjs.read_attr]("rel:ab_test");if(abtest.abTests.search(a)>-1){abtest.abTest(b)}}};this.abTimeCheck=function(f){var b=abtest.abConfig[f].start;var a=abtest.abConfig[f].stop;var c=Math.round((new Date()).getTime()/1000);if(isNaN(b)||isNaN(a)){return true}else{if(c>=b&&c<=a){return true}else{return false}}};this.abLoadConfig=function(){for(x in this.abConfig){var a=false,n=bfjs.getElsByAttr("[rel\\:ab_test]");bfjs.universal_each(n,function(q){if($(q)[bfjs.read_attr]("rel:ab_test")==x){a=true}});if(abtest.abTimeCheck(x)&&a){var f=this.abConfig[x],m=f.page,b=f.context,h=f.vertical,c=f.country;if((m.match(abtest.tt_page)||m=="*")&&(!h||(h&&(h.match(abtest.vertical))))&&(!c||(c&&(c.match(abtest.country))))){var o=[],l=[],g;for(y in f.variations){var p=f.variations[y];for(var k=0;k<p;k++){o.push(y)}l.push(y)}if(document.location.search.match(/abdebug/)){var g=prompt("Please select a variation for test '"+x+"':\n"+l.toString().replace(/,/g,"\n"),l[0])}else{if(!bfjs.isMobile()&&objExists(getUrlVars()[x])){g=getUrlVars()[x]}else{if(f.freeze_variation&&typeof(Storage)!=="undefined"&&localStorage.getItem(x)&&!(localStorage.getItem(x)===null)){g=localStorage.getItem(x)}else{o=o.sort(function(){return 0.5-Math.random()});g=o[Math.floor(Math.random()*o.length)]}}}abtest.addTest(x,g)}}}if(typeof abtest.abLive=="undefined"){abtest.abLive==false}};this.addTest=function(a,b){abtest.abTests=abtest.abTests?abtest.abTests+=","+a:a;abtest.abVariations=abtest.abVariations?abtest.abVariations+=","+b:b;abtest.abLive=true};this.getBucket=function(b){var c=this.abTests.split(","),f=this.abVariations.split(","),a=bfjs.indexOf(b,c);return(a<0||typeof f[a]==="undefined")?null:f[a]};this.abTest=function(c){var l=abtest.abTests.split(",");var b=abtest.abVariations.split(",");var f=$(c)[bfjs.read_attr]("rel:ab_test");var a=this.abConfig.hasOwnProperty(f)?this.abConfig[f]:new Object();var g=a.hasOwnProperty("type")?a.type:null;var m=a.hasOwnProperty("freeze_variation")?a.freeze_variation:false;for(x=0;x<l.length;x++){if(l[x]==f){break}}var h=b[x];var k=document.location.search.match(/variation=([a-zA-Z_]*)/);if(BF_STATIC.env!="live"&&k!=null&&k.length>1){h=k[1]}var h=b[x];if(g=="css"){$(c)[bfjs.add_class](h)}else{if(g=="html"){$(document.getElementById(h))[bfjs.remove_class]("hidden")}}if(m&&hasLocalStorage()){localStorage.setItem(l[x],h)}if(typeof EventManager=="object"){EventManager.fire("abtest:"+l[x],h,c)}}};var abtest=new BF_ABTest();bfjs.onPageLoad(abtest.init);BF_Targetting_Pixel=function(){this.pixels={comment:['<img src="http://ib.adnxs.com/seg?add=162223&t=2" width="1" height="1" />'],email:['<img src="http://ib.adnxs.com/seg?add=162219&t=2" width="1" height="1" />','<img src="http://ads.audienceamplify.com/px?id=23000&t=2" width="1" height="1" />'],badge_reaction:['<img src="http://ib.adnxs.com/seg?add=162222&t=2" width="1" height="1" />'],facebook:['<img src="http://ib.adnxs.com/seg?add=162218&t=2" width="1" height="1" />','<img src="http://ads.audienceamplify.com/px?id=22996&t=2" width="1" height="1" />'],google_plus:['<img src="http://ib.adnxs.com/seg?add=162225&t=2" width="1" height="1" />','<img src="http://ads.audienceamplify.com/px?id=22999&t=2" width="1" height="1" />'],stumbleupon:['<img src="http://ib.adnxs.com/seg?add=162220&t=2" width="1" height="1" />','<img src="http://ads.audienceamplify.com/px?id=22998&t=2" width="1" height="1" />'],twitter:['<img src="http://ib.adnxs.com/seg?add=162221&t=2" width="1" height="1" />','<img src="http://ads.audienceamplify.com/px?id=22997&t=2" width="1" height="1" />']};this.hashtrack_pixels=[{url_regex:/peggy\/some-uri/g,pixel_seed:'<iframe width="0" height="0" frameborder="0" scrolling="no" src="abcd"></iframe>',pixel_viral:'<iframe width="0" height="0" frameborder="0" scrolling="no" src="wxyz"></iframe>'}];this.add=function(o,m){if(!!window.fb_app){return}var p;if(o=="hashtrack"){p=m.pixel}else{p=this.pixels[o+""]}if(typeof p=="undefined"||!p){return}var q=/<([a-z]+)\b.*src="([^"]*)".*\/?>/;for(var c=0;c<p.length;c++){var l=p[c];var g=q.exec(l);if(!g||typeof g[1]=="undefined"||(g[1]!="img"&&g[1]!="iframe"&&g[1]!="script")){return false}var f=g[1],h=g[2];if(!$("third-party-tracking-pixel")){var a=document.createElement("div");a.id="third-party-tracking-pixel";document.getElementsByTagName("BODY")[0].appendChild(a)}if(!window.BF_STATIC||!BF_STATIC.bf_test_mode){var b;try{b=document.createElement(l)}catch(k){b=document.createElement(f)}if(f=="img"){b.src=h;b.height=1;b.width=1;b.setAttribute("style","width:1px;height:1px;position:absolute;")}else{if(f=="iframe"){b.src=h;b.height=0;b.width=0;b.setAttribute("frameborder",0);b.setAttribute("scrolling","no")}else{if(f=="script"){b.src=h;b.setAttribute("type","text/javascript")}}}}else{console.info("disable "+h+" for sel tests")}if(BF_STATIC.bf_env!="live"||!window.BF_STATIC||BF_STATIC.bf_test_mode){console.info("track px ("+o+") >> "+h)}else{document.getElementById("third-party-tracking-pixel").appendChild(b)}}};this.hashtrack_pixel=function(c,a){if(a==1){document.observe("dom:loaded",(function(){(new BF_Targetting_Pixel()).add("hashtrack",{pixel:['<img src="http://ads.audienceamplify.com/seg?add=187653&t=2" width="1" height="1" />']})}))}else{if(a==2){document.observe("dom:loaded",(function(){(new BF_Targetting_Pixel()).add("hashtrack",{pixel:['<img src="http://ads.audienceamplify.com/seg?add=187654&t=2" width="1" height="1" />']})}))}}for(var f=0;f<this.hashtrack_pixels.length;f++){if(this.hashtrack_pixels[f].url_regex.exec(c)){var b={};if(a==1){b={pixel:[this.hashtrack_pixels[f].pixel_seed]}}else{if(a==2){b={pixel:[this.hashtrack_pixels[f].pixel_viral]}}}if(typeof b.pixel!="undefined"){document.observe("dom:loaded",(function(g){return function(){(new BF_Targetting_Pixel()).add("hashtrack",g)}})(b))}}}}};BF_Post_Tools=function(){this.cache={};this.is_queue=false;this.is_draft_page=false;this.page_name=null;this.is_viewdraft_page=false;this.supertag_cache=[];this.partner_acl="partners_manage";this.languages=["fr","pt","es","uk"];this.init=function(){try{var user=new BF_User();var userinfo=user.getUserInfo();var username=user.isLoggedIn()?userinfo.username:"not_logged_in";var isa=userinfo.isa=="true"||("acl" in window&&acl.user_can("edit_user_posts"));var isa_partner=bf_post_tools.isa_partner();if(!user.isLoggedIn()||(!isa&&!isa_partner&&!location.href.match(username))){if(signin&&signin.callbacks){signin.callbacks.onLogin.push(bf_post_tools.init.bind(this))}return false}this.is_queue=(document.location.pathname.match(/\/queue($|\/)/))?true:false;this.is_draft_page=(document.location.pathname.match(/\/drafts\//))?true:false;this.is_viewdraft_page=(document.location.pathname.match(/\/_draft|_breaking_preview\//))?true:false;var t_pathname=document.location.pathname;if(t_pathname.match(/\/queue($|\/)/i)){this.page_name="queue"}else{if(t_pathname.match(/\/drafts\//i)){this.page_name="drafts"}else{if(t_pathname.match(/\/_draft\//i)){this.page_name="_drafts"}else{if(t_pathname.match(/\/responses($|\/)/i)){this.page_name="responses"}else{if(t_pathname.match(/\/activity($|\/)/i)){this.page_name="activity"}else{if(t_pathname.match(/\/hidden_posts($|\/)/i)){this.page_name="hidden"}else{this.page_name="posts"}}}}}}universal_dom.assign_handler({bucket:"open-queue-schedule",event:"change",handler:function(ev){var open_dialog=(ev.target.value=="queue-at"&&ev.element.checked);var name=ev.name;if(universal_dom._bucket&&universal_dom._bucket["queue-schedule"]){universal_dom._bucket["queue-schedule"].elements.each(function(udo){if(typeof udo.data!="undefined"&&udo.data.name==name){if(open_dialog){udo.element.removeClassName("hidden")}else{udo.element.addClassName("hidden")}}})}}});universal_dom.assign_handler({bucket:"open-queue-dialog",event:"change",handler:function(ev,obj){var open_dialog=ev.element.checked;if(ev.force_closed=="true"){open_dialog=false}var name=ev.name;if(universal_dom._bucket&&universal_dom._bucket["queue-dialog"]){universal_dom._bucket["queue-dialog"].elements.each(function(udo){if(typeof udo.data!="undefined"&&udo.data.name==name){if(open_dialog){udo.element.removeClassName("hidden")}else{udo.element.addClassName("hidden")}}})}}});universal_dom.assign_handler({bucket:"open-vertical-dialog",event:"change",handler:function(ev,obj){var open_dialog=ev.element.checked;if(universal_dom._bucket&&universal_dom._bucket["vertical-dialog"]){universal_dom._bucket["vertical-dialog"].elements.each(function(udo){if(open_dialog){if(udo.data==1){udo.element.removeClassName("hidden")}else{udo.element.addClassName("hidden")}}else{if(udo.data==1){udo.element.addClassName("hidden")}else{udo.element.removeClassName("hidden")}}})}}});universal_dom.assign_handler({bucket:"translation_status",handler:bf_post_tools.show_translation_status});universal_dom.assign_handler({bucket:"translation_status",event:"click",handler:bf_post_tools.handle_translation_status});universal_dom.assign_handler({bucket:"mimic-radio",event:"change",handler:function(ev){var el=ev.target;var name=el.getAttribute("name");var value=el.getAttribute("value");var id=el.getAttribute("id");if(id=="queue-this"&&el.getAttribute("rel:clicked")==0){el.setAttribute("rel:clicked",1);$$('input[type="checkbox"][name="promotion"][value="queue-at"]')[0].checked=true;$("queue-calendar").removeClassName("hidden");var next=new Date();if(next.getMinutes()>=0&&next.getMinutes()<10){next.setMinutes(15)}else{if(next.getMinutes()>=10&&next.getMinutes()<25){next.setMinutes(30)}else{if(next.getMinutes()>=25&&next.getMinutes()<40){next.setMinutes(45)}else{if(next.getMinutes()>=40&&next.getMinutes()<55){next.setMinutes(60)}else{next.setMinutes(75)}}}}var day=$$('#queue-calendar [name="queue-on-day"]')[0],hour=$$('#queue-calendar [name="queue-on-hour"]')[0],date=dateFormat(next,"yyyy-mm-dd"),time=dateFormat(next,"H:MM");for(var i=0;i<day.options.length;i++){if(day.options[i].value==date){day.selectedIndex=i}}for(var i=0;i<hour.options.length;i++){if(hour.options[i].value==time){hour.selectedIndex=i}}}universal_dom.get_bucket_elements("mimic-radio").each(function(obj){if(obj.getAttribute("name")==name&&obj!=ev.target){obj.checked=false}})}});universal_dom.assign_handler({bucket:"flex_toggle_active",event:"click",handler:bf_post_tools.stop_splash});universal_dom.assign_handler({bucket:"pin-button",event:"click",handler:bf_post_tools.does_pin_dialog_have_anything_checked});universal_dom.assign_handler({bucket:"switch_promo_std",event:"click",handler:bf_post_tools.promo.switch_promo_std});universal_dom.assign_handler({bucket:"switch_promo_fp",event:"click",handler:bf_post_tools.promo.switch_promo_fp});universal_dom.assign_handler({bucket:"switch_promo_fpuk",event:"click",handler:bf_post_tools.promo.switch_promo_fpuk});this.poller=new cookie_poller();var permissions={isa:false,isa_partner:false,terminal_user:false,basic_edit_functionality:false,is_advertiser:false};if(user&&user.isLoggedIn()){if(acl.user_can("edit_user_posts")){permissions.isa=true}if(bf_post_tools.isa_partner()){permissions.isa_partner=true}if(acl.user_can("terminal_user")){permissions.terminal_user=true}else{permissions.basic_edit_functionality=true}if(acl.user_can("general_advertiser")){permissions.is_advertiser=true}}var isEditFormOpened=($("editForm")&&$("editForm").getStyle("display")!="none"),isQwikEditOpened=($$("div.qwik_edit").length&&$$("div.qwik_edit")[0].getStyle("display")=="block");bf_post_tools.buzz_opened=(isEditFormOpened||isQwikEditOpened);var ptool_posts=[];var posts=$$(".post",".post2","div.contrib");var ctool_posts=$$("li.contrib");for(var i=0;i<posts.length;i++){var existing_ptools=posts[i].select(".ptools");if(existing_ptools.length){if(!existing_ptools[0].up(".ptools-buzzpage")&&posts[i].childElements().indexOf(existing_ptools[0])!=-1){posts[i].removeChild(existing_ptools[0])}}}if(permissions.isa){for(var i=0;i<posts.length;i++){var is_ptools=posts[i].getAttribute("rel:ptool");if(!!is_ptools&&is_ptools!=="false"&&!posts[i].select(".ptools").length){if(!(posts[i].nodeName=="HEADER"&&posts[i].up(".buzz")&&$$(".ptools-buzzpage").length)){ptool_posts.push(posts[i])}}}this.create_tools(ctool_posts,bf_post_tools.create_ctool,permissions)}else{if(permissions.isa_partner){for(var i=0;i<posts.length;i++){var is_ptools=posts[i].getAttribute("rel:ptool");var is_partner=posts[i].getAttribute("rel:partner");var is_advertiser=posts[i].getAttribute("rel:advertiser");var is_owner=posts[i].getAttribute("rel:owner");var current_user=userinfo.username;if(!!is_ptools&&is_ptools!=="false"&&!posts[i].select(".ptools").length&&((!!is_partner&&is_partner=="1")||(!!is_advertiser&&is_advertiser=="1"))){ptool_posts.push(posts[i])}else{if(!!is_ptools&&is_ptools!=="false"&&!!is_owner&&is_owner==current_user&&!posts[i].select(".ptools").length){ptool_posts.push(posts[i])}}}if(BF_STATIC.f_partner=="1"||BF_STATIC.f_ad=="1"){this.create_tools(ctool_posts,bf_post_tools.create_ctool,permissions)}}else{if(permissions.terminal_user||permissions.basic_edit_functionality){var current_user=userinfo.username;for(var i=0;i<posts.length;i++){var is_ptools=posts[i].getAttribute("rel:ptool");var is_owner=posts[i].getAttribute("rel:owner");if(!!is_ptools&&is_ptools!=="false"&&!!is_owner&&is_owner==current_user&&!posts[i].select(".ptools").length){ptool_posts.push(posts[i])}}}}}if(permissions.isa||permissions.isa_partner||permissions.terminal_user||permissions.basic_edit_functionality){var ptool_css=document.createElement("link");ptool_css.rel="stylesheet";ptool_css.href=BF_STATIC.static_root+"/css/post-tools.css?v="+BF_STATIC.version;ptool_css.type="text/css";bf_post_tools.load_link(ptool_css);if(typeof user_post=="undefined"){var userpost_js=document.createElement("script");userpost_js.src=BF_STATIC.static_root+"/js/public/contribute/user_post.js?v="+BF_STATIC.version;userpost_js.type="text/javascript";bf_post_tools.load_link(userpost_js)}var bfui_css=document.createElement("link");bfui_css.rel="stylesheet";bfui_css.href=BF_STATIC.static_root+"/css/bf_ui.css?v="+BF_STATIC.version;bfui_css.type="text/css";bf_post_tools.load_link(bfui_css);$$(".pinned").each(function(el,i){var buzz_data=el.getAttribute("rel:data");var require_acl="homepage_edit";if((BF_STATIC.page||"")=="VerticalFront"){require_acl="queue_edit_"+BF_STATIC.tt_page.toLowerCase()}if((BF_STATIC.page||"")=="Buzz"&&typeof buzz_profile!="undefined"){require_acl="queue_edit_"+buzz_profile.category.toLowerCase()}if(buzz_data&&permissions.isa&&acl.user_can(require_acl)){var pin_tool=document.createElement("DIV");var pin_remove=document.createElement("A");var pin_up=document.createElement("A");var pin_down=document.createElement("A");pin_tool.className="pin-tool";pin_up.setAttribute("rel:data",buzz_data);pin_up.className="pin-up";pin_down.setAttribute("rel:data",buzz_data);pin_down.className="pin-down";pin_remove.setAttribute("rel:data",buzz_data);pin_remove.className="pin-remove";pin_tool.setAttribute("style","display:none");pin_tool.appendChild(pin_remove);pin_tool.appendChild(pin_up);pin_tool.appendChild(pin_down);el.insert(pin_tool);if(typeof el.previous("li")=="undefined"){el.getElementsByClassName("pin-tool")[0].addClassName("upper")}if(typeof el.next("li")=="undefined"){el.getElementsByClassName("pin-tool")[0].addClassName("downer")}$(el).observe("mouseover",function(){pin_tool.show()});$(el).observe("mouseout",function(){pin_tool.hide()});$(el).select(".pin-tool a").each(function(link){link.observe("click",function(e){if(e.target.hasClassName("pin-up")){bf_post_tools.move_tool(e,"up",el)}else{if(e.target.hasClassName("pin-down")){bf_post_tools.move_tool(e,"down",el)}else{if(e.target.hasClassName("pin-remove")){bf_post_tools._pin_buzz(e,true,el)}}}})})}if(!buzz_data){el.remove()}});this.create_tools(ptool_posts,bf_post_tools.create_ptool,permissions);var pt_buttons=$$(".ptools a",".ctools a",".mobile-preview a");for(var i=0;i<pt_buttons.length;i++){$(pt_buttons[i]).stopObserving("click");$(pt_buttons[i]).observe("click",this.click_buttons.bind(this))}}if(document.location.href.match("/_draft|breaking_preview/")&&$$(".draft-promo-content").length){var ptools=$$(".ptools-draftpage")[0];$$(".draft-promo-content")[0].appendChild(ptools);bf_post_tools.mobile_preview.init({back_button:$$(".browser-back-button")[0],browser_frame:$("mobile-preview-browser-window"),home_button:$$(".home-button")[0],preview:$("mobile-preview"),preview_url:window.location.href+"/mobile",trigger:$$(".pt-preview-mobile")[0],user:user,userinfo:userinfo})}}catch(e){console.error(e)}};this.show_translation_status=function(e){try{if(bf_post_tools.cache.language=="en"){universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"ui"}).each(function(el){el.removeClassName("hidden")})}}catch(e){console.warn("bf_post_tools.cache is not loaded yet")}};this.handle_translation_status=function(e){if(e.my_type=="mark as candidate"){bf_post_tools.supertag_cache.push("translatethis");universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"mark as candidate"}).each(function(el){el.addClassName("hidden")});universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"marked as candidate"}).each(function(el){el.removeClassName("hidden")})}};this.click_buttons=function(e){var el=e.target;if(el.className.indexOf("pt-wrench")!=-1){if($("editForm")&&$("editForm").getStyle("display")!="none"||$$("div.qwik_edit").length&&$$("div.qwik_edit")[0].getStyle("display")=="block"){$("editForm")?$("editForm").scrollTo():$$("div.qwik_edit")[0].scrollTo();return false}var ed_post=el.getAttribute("rel:data").evalJSON();bf_post_tools.cancel_inline_editor();bf_post_tools.load_inline_editor(ed_post)}else{if(el.className.indexOf("c-wrench")!=-1){var ed_post=el.getAttribute("rel:comment_id").evalJSON();bf_post_tools.cancel_inline_editor();bf_post_tools.load_inline_editor({comment_id:ed_post,type:"contribution"})}else{if(el.className.indexOf("pt-flexpro")!=-1){bf_post_tools.load_flexpro(e)}else{if(el.className.indexOf("pt-rebuzz_button")!=-1){bf_post_tools.load_rebuzz_button(e)}else{if(el.className.indexOf("pt-splash")!=-1){bf_post_tools.load_splash(e)}else{if(el.className.indexOf("pt-boost_button")!=-1){bf_post_tools.load_boost_button(e)}else{if(el.className.indexOf("pt-edit")!=-1){bf_post_tools.load_editor_in_dialog(e)}else{if(el.className.indexOf("pt-t-edit")!=-1){bf_post_tools.load_t_editor(e)}else{if(el.className.indexOf("pt-stats")!=-1){bf_post_tools.load_stats(e)}else{if(el.className.indexOf("pt-remove")!=-1){bf_post_tools.delete_quickpost(e)}else{if(el.className.indexOf("pt-hide")!=-1){bf_post_tools.hide_post(e)}else{if(el.className.indexOf("pt-show")!=-1){bf_post_tools.show_post(e)}else{if(el.className.indexOf("pt-pin")!=-1){bf_post_tools.pin_buzz(e,false)}else{if(el.className.indexOf("pt-preview-mobile")!=-1){bf_post_tools.mobile_preview.toggle_preview()}else{if(el.className.indexOf("sleep-button")!=-1){bf_post_tools.mobile_preview.toggle_preview()}else{if(el.className.indexOf("home-button")!=-1){bf_post_tools.mobile_preview.launch_app("home")}else{if(bf_post_tools.is_queue){e.stop();var buzz_data=el.getAttribute("rel:data");buzz_data=eval("("+buzz_data+")");Object.extend(e,buzz_data);var args={buzz_id:buzz_data.buzz_id};if(el.className.indexOf("pt-publish")!=-1){queue.publish_to_hp(args)}else{if(el.className.indexOf("pt-remove")!=-1){queue.show_alert(args)}else{if(el.className.indexOf("pt-queue")!=-1){queue.update_queue_time(e)}}}}}}}}}}}}}}}}}}}}};this.load_link=function(obj){var obj_loaded=false;if(obj.tagName=="LINK"){var page_links=document.getElementsByTagName("LINK");for(var i=0;i<page_links.length;i++){if(page_links[i].rel==obj.rel&&page_links[i].href==obj.href){obj_loaded=true}}}if(obj.tagName=="SCRIPT"){var page_links=document.getElementsByTagName("SCRIPT");for(var i=0;i<page_links.length;i++){if(page_links[i].src==obj.src){obj_loaded=true}}}if(!obj_loaded){document.getElementsByTagName("HEAD")[0].appendChild(obj)}};this.create_tools=function(posts,fn,permissions){if(typeof permissions=="undefined"){permissions=null}for(var i=0;i<posts.length;i++){var injection=fn(posts[i],permissions);if(!!injection){posts[i].appendChild(injection);posts[i].appendChild(bf_post_tools.create_spinner());$(posts[i]).stopObserving("mouseout");$(posts[i]).stopObserving("mouseover");$(posts[i]).observe("mouseout",function(e){var target=this.obj.hasClassName("ptools")?this.obj:this.obj.select(".ptools")[0];target=target?target:this.obj;target.hide()}.bind({obj:injection}));$(posts[i]).observe("mouseover",function(e){var target=this.obj.hasClassName("ptools")?this.obj:this.obj.select(".ptools")[0];target=target?target:this.obj;target.show()}.bind({obj:injection}))}}};this.create_spinner=function(){var ptool_spinner=document.createElement("div");ptool_spinner.hide();ptool_spinner.className=("ptool_spinner");ptool_spinner.style.textAlign="center";var ptool_spinner_img=document.createElement("img");ptool_spinner_img.src=BF_STATIC.static_root+"/images/public/spinners/loading.gif";ptool_spinner.appendChild(ptool_spinner_img);return ptool_spinner};this.load_editor_in_dialog=function(e){var tag=e.target;var tag_data=tag.getAttribute("rel:data");var tag_data_obj=eval("("+tag_data+")");var buzz_id=tag_data_obj.buzz_id;var buzz_type=tag_data_obj.type;if(typeof buzzDetails!="undefined"&&buzzDetails.hasOwnProperty("breaking")&&buzzDetails.breaking){window.location.href=BF_STATIC.web_root+"/breaking_post?id="+buzz_id}else{if(/^super.*/.test(buzz_type)){buzz_type="super";window.location.href=BF_STATIC.web_root+"/post?id="+buzz_id}else{BF_UI.showDialog("user_post_edit","Edit");$("user_post_edit_iframe").setAttribute("src","/buzzfeed/editbuzz/"+buzz_type+"?id="+buzz_id+"&cb="+(new Date()).getTime())}}};this.buttons_actions=function(){if($("quickpost-tags")&&typeof user_post!="undefined"){$("quickpost-tags").stopObserving();$("quickpost-tags").observe("keydown",user_post.auto_complete_special);$("quickpost-tags").observe("keyup",user_post.auto_complete);$("quickpost-tags").observe("blur",function(){window.setTimeout(function(){$("tag_suggestions").hide()},1000)})}if($("save_edited_buzz")){$("save_edited_buzz").stopObserving("click",bf_post_tools.save_edited_buzz);$("save_edited_buzz").observe("click",bf_post_tools.save_edited_buzz)}if($("edit_buzz_image")){$("edit_buzz_image").stopObserving("click",bf_post_tools.edit_image);$("edit_buzz_image").observe("click",bf_post_tools.edit_image);user_setting={save_image:bf_post_tools.save_image};parent.user_post.save_quickpost_image=function(){BF_UI.closeDialog("super-image-edit")}}if($("edit_in_terminal")){$("edit_in_terminal").stopObserving("click",function(e){bf_post_tools.terminal_edit(bf_post_tools.current_contrib)});$("edit_in_terminal").observe("click",function(e){bf_post_tools.terminal_edit(bf_post_tools.current_contrib)})}if($("delete_contribution")){$("delete_contribution").stopObserving("click",function(e){bf_post_tools.delete_quickpost(e,"contrib")});$("delete_contribution").observe("click",function(e){bf_post_tools.delete_quickpost(e,"contrib")})}if($("remove_contribution_from_raw")){$("remove_contribution_from_raw").stopObserving("click",function(e){bf_post_tools.update_contribution_raw_flag(e,0)});$("remove_contribution_from_raw").observe("click",function(e){bf_post_tools.update_contribution_raw_flag(e,0)})}if($("restore_contribution_to_raw")){$("restore_contribution_to_raw").stopObserving("click",function(e){bf_post_tools.update_contribution_raw_flag(e,1)});$("restore_contribution_to_raw").observe("click",function(e){bf_post_tools.update_contribution_raw_flag(e,1)})}};this.put_in_vertical=function(vertical,action){var buzz=bf_post_tools.cache;var vert={};buzz.verticals.each(function(v){if(v.category_name==vertical){vert=v}});if(action=="publish"){if(typeof buzz.delete_this_category_if_another_is_added!="undefined"){var old_vert={};buzz.verticals.each(function(v){if(v.category_name==buzz.delete_this_category_if_another_is_added){old_vert=v}});if(old_vert.action=="publish"){old_vert.action="delete"}}buzz.delete_this_category_if_another_is_added=vertical}if(typeof vert.category_name=="undefined"){buzz.verticals.push(vert);vert.category_name=vertical;vert.campaign_id=buzz.campaignid}if(action==vert.action){return}else{vert.action=action}};this.save_edited_buzz=function(e){var errors=[];var required=["name","blurb"];var buzz=bf_post_tools.cache;if(bf_post_tools.contrib!=1){var form=bf_post_tools.edit_form;required.each(function(field){if(form.elements[field].value==""){errors.push("Missing required field ("+field+")")}});var all_supertags=$$(".supertag");var supertag_set=false;for(var i=0;i<all_supertags.length;i++){if(all_supertags[i].checked){supertag_set=true;break}}if(!(form.elements["nsfw-btn"].hasClassName("selected")||form.elements["tame-btn"].hasClassName("selected"))){errors.push("Please specify if it's NSFW or not")}if(errors.length){alert("Cannot save. Please address the following error"+(errors.length>1?"s":"")+":\n"+errors.join("\n"));return}for(var each in bf_post_tools.buzz_fields_to_text_fields){if(form.elements[bf_post_tools.buzz_fields_to_text_fields[each]].disabled==false){buzz[each]=form.elements[bf_post_tools.buzz_fields_to_text_fields[each]].value}else{delete buzz[each]}}buzz.language=form.elements.language.options[form.elements.language.selectedIndex].value}else{var form=bf_post_tools.edit_form_contrib}var badge_checkboxes=form.select('[id="badges_list"]')[0].getElementsByTagName("INPUT");buzz.badges=[];for(var i=0;i<badge_checkboxes.length;i++){var cbox=badge_checkboxes[i];if(cbox.checked){buzz.badges.push(cbox.value)}}var ajax=new BF_Request();if(bf_post_tools.contrib==1){if(buzz.badges&&buzz.badges.length>0){var params={action:"update_contribution",comment_id:buzz.id,badges:buzz.badges.join(",")};ajax.request("/buzzfeed/comments_moderation",{method:"post",parameters:params,onSuccess:bf_post_tools._save_edited_buzz,while_processing:{show:$("save-edited-buzz-spinner"),hide:e.target}})}else{return}}else{var contrib_state=(form.elements["responses-on-btn"].hasClassName("selected"))?1:0;var contrib_checkboxes=form.select('[id="responses-options"]')[0].getElementsByTagName("INPUT");for(var i=0;i<contrib_checkboxes.length;i++){buzz[contrib_checkboxes[i].name]=(contrib_checkboxes[i].checked)?contrib_state:0}var new_tags=form.elements.namedItem("tags").value.split(",");new_tags.each(function(tag){buzz.tags.push(tag)});var all_supertags=$$(".supertag");var supertags=[];buzz.supertags=[];for(var i=0;i<all_supertags.length;i++){if(all_supertags[i].checked){buzz.supertags.push("--supertag-"+all_supertags[i].value)}}bf_post_tools.supertag_cache.each(function(tag){buzz.supertags.push("--"+tag)});buzz.nsfw=form.elements["nsfw-btn"].hasClassName("selected")?"true":"false";var category_option=form.elements.category.options[form.elements.category.selectedIndex];buzz.category_name=category_option.text;buzz.category_id=category_option.value;var params={action:"update_buzz",buzz:Object.toJSON(buzz),update_html:1};if(bf_post_tools.buzz_template){params.template=bf_post_tools.buzz_template}var promotion=[];if($("queue-this")&&$("queue-this").checked){var ck_promotion;for(var i=0;i<form.elements.promotion.length;i++){if(form.elements.promotion[i].checked){ck_promotion=form.elements.promotion[i].value}}if(promotion&&promotion!="none"){params.action="update_and_promote"}if(ck_promotion=="queue-at"){params["queue-on-day"]=form.elements["queue-on-day"].options[form.elements["queue-on-day"].selectedIndex].value;params["queue-on-hour"]=form.elements["queue-on-hour"].options[form.elements["queue-on-hour"].selectedIndex].value}if(ck_promotion){promotion.push(ck_promotion)}}if($("uk_queue-this")&&$("uk_queue-this").checked){var ck_promotion;for(var i=0;i<form.elements.uk_promotion.length;i++){if(form.elements.uk_promotion[i].checked){ck_promotion=form.elements.uk_promotion[i].value}}if(promotion&&promotion!="none"){params.action="update_and_promote"}if(ck_promotion=="uk_queue-at"){params["uk_queue-on-day"]=form.elements["uk_queue-on-day"].options[form.elements["uk_queue-on-day"].selectedIndex].value;params["uk_queue-on-hour"]=form.elements["uk_queue-on-hour"].options[form.elements["uk_queue-on-hour"].selectedIndex].value}if(ck_promotion){promotion.push(ck_promotion)}}if($("au_queue-this")&&$("au_queue-this").checked){var ck_promotion;for(var i=0;i<form.elements.au_promotion.length;i++){if(form.elements.au_promotion[i].checked){ck_promotion=form.elements.au_promotion[i].value}}if(promotion&&promotion!="none"){params.action="update_and_promote"}if(ck_promotion=="au_queue-at"){params["au_queue-on-day"]=form.elements["au_queue-on-day"].options[form.elements["au_queue-on-day"].selectedIndex].value;params["au_queue-on-hour"]=form.elements["au_queue-on-hour"].options[form.elements["au_queue-on-hour"].selectedIndex].value}if(ck_promotion){promotion.push(ck_promotion)}}if($("suggest-this")&&$("suggest-this").checked){params.fq_suggest=1}var cleanup_regex=new RegExp("boost-|add-");["boost","add","remove"].each(function(action){var legit_fields=["raw","thumbnails","network","homepage","homepage_now","homepage_uk","homepage_uk_now","homepage_au","homepage_au_now"];bf_post_tools.languages.each(function(abbr){legit_fields.push("thumbnails-"+abbr);legit_fields.push("thumbnails-"+abbr)});legit_fields.each(function(field){var ck_promotion=action+"-"+field;var obj=$(ck_promotion);if(obj&&obj.checked&&!obj.disabled){if(ck_promotion!="add-homepage"||acl.user_can("homepage_edit")){promotion.push(ck_promotion.replace(cleanup_regex,""));params.action="update_and_promote"}}})});if(promotion.length){params.promotion=promotion.join(",")}ajax.request("/buzzfeed/_admin",{method:"post",parameters:params,onSuccess:bf_post_tools._save_edited_buzz,while_processing:{show:$("save-edited-buzz-spinner"),hide:e.target}})}};this._save_edited_buzz=function(r){if(bf_post_tools.contrib==1){bf_post_tools.cancel_inline_editor()}else{if(BF_STATIC.page=="Buzz"){BF_Request.location();return}}var obj=eval("("+r.responseText+")");if(obj.success==1){try{var buzz=bf_post_tools.cache;var form=bf_post_tools.edit_form;var post=$("post-"+bf_post_tools.current_buzz);form.addClassName("hidden");form.parentNode.removeChild(form);document.getElementsByTagName("BODY")[0].appendChild(form);post.show();if(post.up("#queue")){post.scrollTo();post.insert("<span class='edit_success'>Edit successfully saved!</span>");window.setTimeout(function(){var successMsg=post.select(".edit_success")[0];if(successMsg){successMsg.remove()}},5000)}else{post.replace(obj.html)}$("post-"+bf_post_tools.current_buzz).className=post.className;universal_dom.update($("post-"+bf_post_tools.current_buzz));bf_post_tools.init();delete bf_post_tools.cache;bf_post_tools.supertag_cache=[]}catch(e){console.dir({e:e})}}};this.save_image=function(path,image,region,sendTo){var buzz=bf_post_tools.cache;var params=region;params.type=buzz.form+"buzz";if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=bf_post_tools.image_saved;var er=bf_post_tools.image_errored;var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_errored=function(){alert("There was an error trying to save your image")};this.image_saved=function(resp){var buzz=bf_post_tools.cache;if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if(bf_post_tools.promo.editing=="std"&&$("img_preview")){buzz.oldimage=buzz.image;buzz.image=obj.thumb_image;$("img_preview").src=BF_STATIC.image_root+obj.thumb_image}else{if(bf_post_tools.promo.editing=="fp"&&$("img_fp_preview")){buzz["frontpage-image"]=obj.thumb_image;$("img_fp_preview").src=BF_STATIC.image_root+obj.thumb_image}else{if(bf_post_tools.promo.editing=="fpuk"&&$("img_fpuk_preview")){buzz["frontpage_uk-image"]=obj.thumb_image;$("img_fpuk_preview").src=BF_STATIC.image_root+obj.thumb_image}}}}else{this.image_errored()}};this.edit_image=function(e){var buzz=bf_post_tools.cache;$("super-image-edit-iframe").src="/static/images/public/spinners/big_on_eee.gif";BF_UI.showDialog("super-image-edit","page_container");$("super-image-edit-iframe").src="/buzzfeed/_edit_user_contribution_image?action=imageform&template=public/user/cropper_form.tt&wide_cropper=1";var buzz_type="link";if(buzz.form=="image"){buzz_type="image"}else{if(buzz.form=="video"){buzz_type="video"}}$("super-image-edit-iframe").stopObserving("load");$("super-image-edit-iframe").observe("load",function(ev){try{ev.target.contentWindow.user_image.setBuzzType(buzz_type)}catch(e){console.warn("unable to set buzz type")}})};this.cancel_inline_editor=function(){if(bf_post_tools.buzz_opened){bf_post_tools.clean_badges_list();var no_form;if(bf_post_tools.current_buzz){var form=bf_post_tools.edit_form;var show_at=$("post-"+bf_post_tools.current_buzz);if(bf_post_tools.show_at){show_at=bf_post_tools.show_at}show_at.show()}else{if(bf_post_tools.current_contrib){var form=bf_post_tools.edit_form_contrib;$("contribwhat_"+bf_post_tools.current_contrib).parentNode.show()}else{no_form=1}}if(!bf_post_tools.cancel_button){delete bf_post_tools.current_contrib;delete bf_post_tools.current_buzz}else{delete bf_post_tools.cancel_button}if(!no_form){if(form.select('[id="fav_badges"]')[0]){form.select('[id="fav_badges"]')[0].hide()}else{if(form.select('[id="all_badges"]')[0]){form.select('[id="all_badges"]')[0].hide()}}form.addClassName("hidden");document.getElementsByTagName("BODY")[0].appendChild(form)}delete no_form;bf_post_tools.cache={};bf_post_tools.contrib=0;bf_post_tools.fav_badges=0;bf_post_tools.buzz_opened=0}};this.clean_badges_list=function(){var fav_list=$("fav_badges").getElementsByTagName("INPUT");var all_list=$("all_badges").getElementsByTagName("INPUT");for(var i=0;i<fav_list.length;i++){fav_list[i].checked=false}for(var i=0;i<all_list.length;i++){all_list[i].checked=false}};this.toggle_badges=function(){var buzz=bf_post_tools.cache;bf_post_tools.clean_badges_list();var form=bf_post_tools.edit_form;if(bf_post_tools.current_contrib){form=bf_post_tools.edit_form_contrib}if(bf_post_tools.fav_badges){form.select('[id="fav_badges"]')[0].hide();buzz.badges.each(function(badge){if(typeof form.elements[badge]!="undefined"){if(typeof form.elements[badge][1]!="undefined"){form.elements[badge][1].checked=true}else{form.elements[badge].checked=true}}});form.select('[id="all_badges"]')[0].show();bf_post_tools.fav_badges=0}else{form.select('[id="all_badges"]')[0].hide();buzz.badges.each(function(badge){if(typeof form.elements[badge]!="undefined"){if(typeof form.elements[badge][0]!="undefined"){form.elements[badge][0].checked=true}else{form.elements[badge].checked=true}}});form.select('[id="fav_badges"]')[0].show();bf_post_tools.fav_badges=1}};this.buzz_fields_to_text_fields={name:"name",blurb:"blurb","frontpage-description":"frontpage-description","frontpage-title":"frontpage-title","frontpage_uk-description":"frontpage_uk-description","frontpage_uk-title":"frontpage_uk-title"};this.process_inline_editor=function(r){var obj=eval("("+r.responseText+")");if(obj.success==1){if(obj.html){var form_div=document.createElement("div");form_div.innerHTML=obj.html;form_div.id="ptools_form";form_div.hide();document.getElementsByTagName("BODY")[0].appendChild(form_div)}bf_post_tools.cache=obj.buzz_data.evalJSON();var buzz=bf_post_tools.cache;bf_post_tools.supertag_cache=[];if(obj.contribution!=1){var converter=$("_converter");if(!converter){converter=document.createElement("div");converter.id="_converter";converter.addClassName("hidden");document.getElementsByTagName("BODY")[0].appendChild(converter)}bf_post_tools.edit_form=$("editForm");var form=bf_post_tools.edit_form}else{bf_post_tools.edit_form_contrib=$("editFormContrib");var form=bf_post_tools.edit_form_contrib}try{var cbox=form.getElementsByTagName("INPUT");for(var i=0;i<cbox.length;i++){cbox[i].checked=false}var show_at;if(obj.contribution!=1){try{$$("#post-"+bf_post_tools.current_buzz+" .ptool_spinner")[0].hide()}catch(e){console.warn("no spinner")}show_at=$("post-"+bf_post_tools.current_buzz)}else{$$("#contribwhat_"+bf_post_tools.current_contrib)[0].parentNode.getElementsByClassName("ptool_spinner")[0].hide();show_at=$("contribwhat_"+bf_post_tools.current_contrib).parentNode}if(bf_post_tools.show_at){show_at=bf_post_tools.show_at}bf_post_tools.cache.owner=show_at.getAttribute("rel:owner");bf_post_tools.buzz_opened=1}catch(e){console.dir({e:e})}if(bf_post_tools.cache.published){var rawPubDateTime=bf_post_tools.cache.published;var rawPubDTComp=rawPubDateTime.split(" ");var rawPubDate=rawPubDTComp[0].split("-");var rawPubTime=rawPubDTComp[1].split(":");var composedDateTime=new Date(rawPubDate[0],rawPubDate[1]-1,rawPubDate[2],rawPubTime[0],rawPubTime[1],rawPubTime[2],0);var formattedPubDate=composedDateTime.format("mmm d, h:MM tt");if($("published_datetime")){$("published_datetime").update(formattedPubDate)}}else{if($("published_datetime")){$("published_datetime").update("N/A")}}if($("quickpost-public-draft")){$("quickpost-public-draft").checked=buzz.draft_public=="1"}form.parentNode.removeChild(form);show_at.hide();show_at.parentNode.insertBefore(form,show_at);form.removeClassName("hidden");form.show();buzz.badges.each(function(badge){if(typeof form.elements[badge]!="undefined"){if(typeof form.elements[badge][0]!="undefined"){form.elements[badge][0].checked=true}else{form.elements[badge].checked=true}}});bf_post_tools.fav_badges=1;var all_badges=form.select('[id="all_badges"]');var fav_badges=form.select('[id="fav_badges"]');try{if(all_badges){all_badges[0].hide()}if(fav_badges){fav_badges[0].show()}}catch(e){console.dir({e:e})}if(obj.contribution!=1){$H(bf_post_tools.buzz_fields_to_text_fields).each(function(pair){var buzz_field=pair[0];var form_field=pair[1];converter.update(unescape(buzz[buzz_field]));if(form.elements[form_field]){form.elements[form_field].value=converter.innerHTML}});if(buzz.language&&form.elements.language){var options=form.elements.language.options;for(var i=0;i<options.length;i++){if(options[i].value==buzz.language){options[i].selected=true}}}var tag_list=$("tag_list");if(tag_list){tag_list.update("");buzz.tags.each(function(tag,idx){if(idx>0&&tag!=""){tag_list.appendChild(document.createTextNode(", "))}tag_list.appendChild(document.createTextNode(tag))})}if(buzz.supertags){var supertags=[];buzz.supertags.each(function(supertag){if($(supertag)){$(supertag).checked=true;supertags.push("--supertag-"+$(supertag).value)}else{bf_post_tools.supertag_cache.push(supertag)}})}if(buzz.contributions&&buzz.contributions.length){$("responses-on-btn").addClassName("selected");$("responses-off-btn").removeClassName("selected");$("responses-options").show();buzz.contributions.each(function(contribution){if($("c_"+contribution)){$("c_"+contribution).checked=true}})}else{$("responses-off-btn").addClassName("selected");$("responses-on-btn").removeClassName("selected");$("responses-options").hide()}if(buzz.verticals){var insertAfter=$("section-placeholder");if(insertAfter){var template=new Template(' 							<li> 								<input type="checkbox" checked="true" disabled="true" /> 								Added to #{category_name} #{time}								<input class="bf_dom" rel:bf_bucket="mimic-radio" type="checkbox" name="vertical-#{category_name}" onclick="bf_post_tools.put_in_vertical(\'#{category_name}\',this.checked?\'delete\':\'\')">Remove</input>								<input class="bf_dom" rel:bf_bucket="mimic-radio" type="checkbox" name="vertical-#{category_name}" onclick="bf_post_tools.put_in_vertical(\'#{category_name}\',this.checked?\'boost\':\'\')">Boost</input>							</li> 						');var ul=document.createElement("ul");buzz.verticals.each(function(vertical){var li=template.evaluate(vertical);ul.innerHTML+=li;var option=$("select-publish-to-"+vertical.category_id);if(option){option.disabled=true}});insertAfter.appendChild(ul)}}if(!acl.user_can("homepage_edit")){var not_yet_queued=$("not-yet-queued");var not_yet_suggested=$("not-yet-suggested");var already_suggested=$("already-suggested");if(not_yet_queued&&not_yet_suggested&&already_suggested){not_yet_queued.addClassName("hidden");if(buzz.suggestion==1){not_yet_suggested.addClassName("hidden");already_suggested.removeClassName("hidden");var suggested=$("suggested");if(suggested){suggested.checked=suggested.disabled=true}}else{not_yet_suggested.removeClassName("hidden");already_suggested.addClassName("hidden")}}var uk_not_yet_queued=$("uk_not-yet-queued");if(uk_not_yet_queued){uk_not_yet_queued.addClassName("hidden")}}if(buzz.run_at&&buzz.already_ran!=""){var already=$("already-queued");var not_yet_queued=$("not-yet-queued");var not_yet_suggested=$("not-yet-suggested");var already_suggested=$("already-suggested");var run_at=$("run_at");if(already&&not_yet_queued&&not_yet_suggested&&already_suggested&&run_at){already.removeClassName("hidden");not_yet_queued.addClassName("hidden");not_yet_suggested.addClassName("hidden");already_suggested.addClassName("hidden");run_at.update(buzz.run_at);$("already-queued-cbox").checked=true;$("already-queued-cbox").disabled=true}}if(buzz.uk_run_at&&buzz.uk_already_ran!=""){var uk_already=$("uk_already-queued");var uk_not_yet_queued=$("uk_not-yet-queued");var uk_run_at=$("uk_run_at");if(uk_already&&uk_not_yet_queued&&uk_run_at){uk_already.removeClassName("hidden");uk_not_yet_queued.addClassName("hidden");uk_run_at.update(buzz.uk_run_at);$("uk_already-queued-cbox").checked=true;$("uk_already-queued-cbox").disabled=true}}if(buzz.au_run_at&&buzz.au_already_ran!=""){var au_already=$("au_already-queued");var au_not_yet_queued=$("au_not-yet-queued");var au_run_at=$("au_run_at");if(au_already&&au_not_yet_queued&&au_run_at){au_already.removeClassName("hidden");au_not_yet_queued.addClassName("hidden");au_run_at.update(buzz.au_run_at);$("au_already-queued-cbox").checked=true;$("au_already-queued-cbox").disabled=true}}if(buzz.homepage){var already_added=$("already-added");var already_added_cbox=$("already-added-cbox");var already_added_on=$("already-added-on");if(already_added&&already_added_cbox&&already_added_on){already_added.removeClassName("hidden");already_added_cbox.checked=already_added_cbox.disabled=true;already_added_on.update(buzz.homepage)}else{console.warn("missing expected HTML id[s] already-added, already-added-cbox, and/or already-added-on")}}if(buzz.uk_homepage){var uk_already_added=$("uk_already-added");var uk_already_added_cbox=$("uk_already-added-cbox");var uk_already_added_on=$("uk_already-added-on");if(uk_already_added&&uk_already_added_cbox&&uk_already_added_on){uk_already_added.removeClassName("hidden");uk_already_added_cbox.checked=uk_already_added_cbox.disabled=true;uk_already_added_on.update(buzz.uk_homepage)}else{console.warn("missing expected HTML id[s] uk_already-added, uk_already-added-cbox, and/or uk_already-added-on")}}if(buzz.australia_homepage){var au_already_added=$("au_already-added");var au_already_added_cbox=$("au_already-added-cbox");var au_already_added_on=$("au_already-added-on");if(au_already_added&&au_already_added_cbox&&au_already_added_on){au_already_added.removeClassName("hidden");au_already_added_cbox.checked=au_already_added_cbox.disabled=true;au_already_added_on.update(buzz.australia_homepage)}else{console.warn("missing expected HTML id[s] au_already-added, au_already-added-cbox, and/or au_already-added-on")}}if(buzz.network){var obj=$("add-network");if(obj){obj.checked=obj.disabled=true}obj=$("added-network");if(obj){obj.removeClassName("hidden")}obj=$("added-network-on");if(obj){obj.update("ed: "+buzz.network)}}}if(buzz.raw&&$("add-raw")){var raw_obj=$("add-raw");raw_obj.checked=raw_obj.disabled=true;raw_obj=$("added-raw");if(raw_obj){raw_obj.removeClassName("hidden")}raw_obj=$("added-raw-on");if(raw_obj){raw_obj.update("ed: "+buzz.raw)}}if(buzz.raw&&$("remove_contribution_from_raw")){if(buzz.raw=="0000-00-00 00:00:00"){$("remove_contribution_from_raw").hide();$("restore_contribution_to_raw").show()}else{$("remove_contribution_from_raw").show();$("restore_contribution_to_raw").hide()}}if(obj.contribution!=1){if(buzz.thumbnails&&buzz.thumbnails!="0"){var obj=$("add-thumbnails");obj.checked=obj.disabled=true;obj=$("added-thumbnails");if(obj){obj.removeClassName("hidden")}obj=$("added-thumbnails-on");if(obj){obj.update("ed: "+buzz.thumbnails)}}bf_post_tools.languages.each(function(language_code){if(buzz["f_promoted-"+language_code]&&buzz["f_promoted-"+language_code]!="0"){var obj=$("add-thumbnails-"+language_code);obj.checked=obj.disabled=true;obj=$("added-thumbnails-"+language_code);if(obj){obj.removeClassName("hidden")}obj=$("added-thumbnails-"+language_code+"-on");if(obj){obj.update("ed: "+buzz["f_promoted-"+language_code])}}});if(buzz.nsfw=="true"){form.elements["nsfw-btn"].addClassName("selected");form.elements["tame-btn"].removeClassName("selected")}else{form.elements["tame-btn"].addClassName("selected");form.elements["nsfw-btn"].removeClassName("selected")}if($("img_preview")){$("img_preview").setAttribute("src",BF_STATIC.image_root+buzz.image)}if($("img_fp_preview")&&buzz["frontpage-image"]){$("img_fp_preview").setAttribute("src",BF_STATIC.image_root+buzz["frontpage-image"])}if($("img_fpuk_preview")&&buzz["frontpage_uk-image"]){$("img_fpuk_preview").setAttribute("src",BF_STATIC.image_root+buzz["frontpage_uk-image"])}if(buzz.category_id){var categories=form.elements.category.options;for(var i=0;i<categories.length;i++){if(categories[i].value==buzz.category_id){categories[i].selected=true}}}universal_dom.update(form);if(typeof buzz.translation_records!="undefined"){var pending;var translated;var deleted;universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"pending"}).each(function(el){pending=el;pending.update("")});universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"translated"}).each(function(el){translated=el;translated.update("")});universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"deleted"}).each(function(el){deleted=el;deleted.update("")});if(buzz.translation_records.length==0||buzz.translation_records==null){universal_dom.get_bucket_elements_with_data("translation_status",{my_type:"not requested"}).each(function(el){el.removeClassName("hidden")})}else{buzz.translation_records.each(function(record){if(record.status==5){if(pending.childNodes.length==0){pending.removeClassName("hidden");pending.appendChild(document.createTextNode("Candidate"))}}if(record.status==1){pending.removeClassName("hidden");pending.appendChild(document.createTextNode("Awaiting "+record.language+" translation "))}if(record.status==2){translated.removeClassName("hidden");var t=new Template('Translated <a target="_blank" href="/#{uri}">#{language}</a> ');var span=document.createElement("span");span.update(t.evaluate(record));translated.appendChild(span)}if(record.status==6){deleted.removeClassName("hidden");var t=new Template("Removed #{language} ");var span=document.createElement("span");span.update(t.evaluate(record));deleted.appendChild(span)}});if(!deleted.hasClassName("hidden")){var a=document.createElement("a");a.observe("click",function(){bf_post_tools.supertag_cache.push("translatethis");this.parentNode.removeChild(this);return false});a.appendChild(document.createTextNode("Restore"));deleted.appendChild(a)}}}}bf_post_tools.buttons_actions();if($("editForm")){user_post.limit_categories_by_acl($("editForm").elements.category)}}};this.load_inline_editor=function(args){bf_post_tools.hide_message();if(args.buzz_id||args.comment_id){if(args.type=="contribution"){bf_post_tools.current_contrib=args.comment_id;$$("#contribwhat_"+bf_post_tools.current_contrib)[0].parentNode.getElementsByClassName("ptool_spinner")[0].show();if(typeof bf_post_tools.edit_form_contrib=="undefined"){var params={action:"get_form_contrib"}}else{var params={action:"get_contrib_data"}}bf_post_tools.contrib=1;params.comment_id=args.comment_id;var ajax=new BF_Request();ajax.request("/buzzfeed/comments_moderation",{method:"post",parameters:params,onSuccess:bf_post_tools.process_inline_editor})}else{bf_post_tools.current_buzz=args.buzz_id;try{$$("#post-"+bf_post_tools.current_buzz+" .ptool_spinner")[0].show();$$(".buzz header")[0].scrollTo()}catch(e){console.warn("no spinner")}if(typeof bf_post_tools.edit_form=="undefined"){var params={action:"get_form"}}else{try{bf_post_tools.edit_form.parentNode.removeChild(bf_post_tools.edit_form);delete bf_post_tools.edit_form}catch(e){console.warn("cannot find parent")}var params={action:"get_form"}}params.buzz_id=args.buzz_id;var ajax=new BF_Request();ajax.request("/buzzfeed/_admin",{method:"post",parameters:params,onSuccess:bf_post_tools.process_inline_editor})}}else{alert("Invalid ID ("+args.buzz_id+")")}};this.load_flexpro=function(e){var buzz_info=e.target.getAttribute("rel:data").evalJSON();var owner=e.target.getAttribute("rel:owner");var timestamp=(new Date()).getTime();if(buzz_info.buzz_id){if(acl.user_can("auto_flex")){window.open("/buzzfeed/_optimize/"+owner+"/"+buzz_info.uri,"_new_"+timestamp)}else{window.open(BF_STATIC.web_root+"/_flex_pro/"+owner+"/"+buzz_info.uri,"_new_"+timestamp)}}else{alert("Invalid ID ("+buzz_info.buzz_id+")")}};this.load_rebuzz_button=function(e){picks_controller.launch_pick(e)};this.load_splash=function(e){var buzz_info=e.target.getAttribute("rel:data").evalJSON();var owner=e.target.getAttribute("rel:owner");var medium=e.target.getAttribute("rel:medium");if(buzz_info.buzz_id){this._splash_buzz({uri:buzz_info.uri,username:owner,medium:medium})}else{alert("Invalid ID ("+buzz_info.buzz_id+")")}};this.load_boost_button=function(e){var timestamp=(new Date()).getTime();if(acl.user_can("boost_button")){window.open("http://discotech.buzzfeed.com/boost?buzz_url="+encodeURIComponent(location.href),"_new_"+timestamp)}};this.stop_splash=function(e){var el=e.target;var promoid=$(el).getAttribute("rel:promoid");var params={action:"set_active",active:0,promotion_id:promoid};var request=new BF_Request;request.request("/buzzfeed/_edit_flex_pro",{parameters:params,method:"post",onCreate:function(){$("splash-container").insert('<div style="width:100%; height:250px; background:rgba(200,200,200,.8); position:absolute; top:0px;"><img src="'+BF_STATIC.static_root+'/images/public/spinners/big_on_white.gif" style="position:absolute; left:50%; top:100px;" /></div>')},onSuccess:function(){BF_Request.location({reload_track:true})}})};this.load_stats=function(e){var buzz_info=e.target.getAttribute("rel:data").evalJSON();var owner=e.target.getAttribute("rel:owner");var timestamp=(new Date()).getTime();if(buzz_info.buzz_id){window.open(BF_STATIC.web_root+"/dashboard/"+owner+"/"+buzz_info.uri,"_new_"+timestamp)}else{alert("Invalid ID ("+buzz_info.buzz_id+")")}};this.mobile_preview={init:function(config){this.config=config;if($("mobile-preview")&&this.config.user.isLoggedIn()&&this.config.userinfo.p_disable_quickpost!="true"&&!document.location.pathname.match(/\/_(buzz|breaking)_preview/)&&config.preview.hasClassName("is-auto-loaded")){this.toggle_preview()}this.send_preview_init()},toggle_preview:function(){var buzz_info=this.config.trigger.getAttribute("rel:data").evalJSON();if(this.config.preview.hasClassName("is-inactive")){if(buzz_info.buzz_id){this.open_preview()}else{alert("Invalid ID ("+this.buzz_info.buzz_id+")")}}else{this.close_preview()}},open_preview:function(){var _self=this,preview=this.config.preview,browser_frame=this.config.browser_frame,preview_url=this.config.preview_url,trigger=this.config.trigger,back_button=this.config.back_button,home_button=this.config.home_button;if(preview_url.indexOf("?")!=-1){preview_url=preview_url.substring(0,preview_url.indexOf("?"));preview_url=preview_url+"/mobile"}preview_url=preview_url+"?drafttools=0";if(/breaking_preview/.test(document.location)){preview_url+="&"+document.location.search.replace(/^\?/,"")}trigger.addClassName("is-loading");browser_frame.src=preview_url;Event.observe(browser_frame,"load",function(){preview.show();preview.removeClassName("is-inactive");var preview_layout=new Element.Layout(preview),preview_height=Element.getHeight(preview),preview_top=preview_layout.get("top"),browser_frame_height=Element.getHeight(browser_frame),browser_frame_doc_height=browser_frame.contentWindow.document.body.scrollHeight;trigger.removeClassName("is-loading");Event.observe(window,"scroll",function(){_self.move_preview(preview_top);_self.scroll_browser(browser_frame_height,browser_frame_doc_height)});Event.observe(browser_frame,"mouseover",function(){$$("body")[0].setStyle({overflow:"hidden"})});Event.observe(browser_frame,"mouseout",function(){$$("body")[0].setStyle({overflow:"auto"})});Event.observe(back_button,"click",function(){browser_frame.src=preview_url})})},close_preview:function(){this.config.preview.hide();this.config.preview.addClassName("is-inactive");Event.stopObserving(window,"scroll")},move_preview:function(orig_top){var new_top=orig_top,page_height=Element.getHeight($(page_container)),page_offset=Element.viewportOffset($(page_container)),preview=this.config.preview,preview_height=Element.getHeight(preview),preview_offset=Element.viewportOffset(preview);window.clearTimeout(scroll_timer);var scroll_timer=setTimeout(function(){if(page_offset.top<0){new_top=10}else{if(page_offset.top>0){new_top=orig_top}else{return}}if(new_top>(page_height-preview_height)&&page_height>preview_height){new_top=page_height-preview_height}preview.setStyle({top:new_top+"px"})},1)},send_preview_init:function(){var _self=this;if(acl.user_can("general_admin")){$$(".send-preview")[0].removeClassName("is-disabled")}$("send-preview-form").observe("submit",function(event){event.stop();_self.send_preview(this)});$("send-preview-again").observe("click",function(event){event.stop();$$(".send-preview")[0].removeClassName("is-sent")});var saved_number=readCookie("send_preview_number");if(saved_number){saved_number=JSON.parse(saved_number);$$(".send-preview-form-fields-phone-number")[0].writeAttribute("value",saved_number.phone_number);$$(".send-preview-form-fields-phone-country")[0].select('option[value="'+saved_number.country_code+'"]')[0].writeAttribute("selected","selected")}},send_preview:function(el){var ajax=new BF_Request(),container=$$(".send-preview")[0],data=el.serialize(true),url="/buzzfeed/_draft/sms_message/"+BF_STATIC.campaignid,errors=false,country_code=data.country_code,phone_number=data.phone_number,cookie_data={};container.removeClassName("is-error");container.removeClassName("is-sent");phone_number=phone_number.replace(/[^0-9]/gi,"");if(phone_number===""||((country_code==="1"&&phone_number.length!==10)||(country_code==="44"&&phone_number.length!==10)||(country_code==="61"&&phone_number.length!==9))){errors=true}if(data.save&&!errors){cookie_data.country_code=country_code;cookie_data.phone_number=data.phone_number;createCookie("send_preview_number",JSON.stringify(cookie_data),"","")}if(!errors){ajax.request(url,{parameters:{phone_number:country_code+" "+phone_number,message:"Here's your mobile preview of \""+BF_STATIC.buzz_name+'" '+window.location.href+"/mobile"},method:"get",onSuccess:function(resp){data=JSON.parse(resp.responseText);if(data.success==1){container.removeClassName("is-ready");container.addClassName("is-sent")}else{$$(".send-preview-message-error")[0].update("Oh dear. Looks like you broke something. Please try again.");container.addClassName("is-error")}}})}else{$$(".send-preview-message-error")[0].update("Whoops! Please make sure you've entered a valid phone number");container.addClassName("is-error")}},scroll_browser:function(frame_height,frame_doc_height){var viewport_height=document.viewport.getHeight(),document_height=Element.getHeight($$("body")[0]),scroll_offset=document.viewport.getScrollOffsets(),scroll_percentage=(scroll_offset.top)/(document_height-viewport_height);var scrollTo=scroll_percentage*(frame_doc_height-frame_height);this.config.browser_frame.contentWindow.scrollTo(0,scrollTo)},launch_app:function(app){if(app=="home"){var home_messages=["OMG!","WTF?","LOL","WIN!","CUTE","FAIL"];var message_key=Math.floor((Math.random()*(home_messages.length-1))+1);alert(home_messages[message_key])}}};this.update_contribution_raw_flag=function(e,raw){if(e.event){e=e.event}e.stop();var raw_flag=raw?1:0;var params={action:"update_contribution",comment_id:bf_post_tools.cache.id,f_raw:raw};var ajax=new BF_Request();ajax.request("/buzzfeed/comments_moderation",{method:"post",parameters:params,onSuccess:bf_post_tools._save_edited_buzz,while_processing:{show:$("save-edited-buzz-spinner"),hide:e.target}})};var update_count=function(action){var delta=action=="hide"?1:-1;var posts_count_element=$$("#posts-count")[0];if(posts_count_element){var posts_count=eval("("+posts_count_element.getAttribute("rel:data")+")");posts_count.posts_count-=delta;posts_count_element.setAttribute("rel:data",JSON.stringify(posts_count));posts_count_element.childNodes[0].nodeValue=posts_count.posts_count}var hidden_count_element=$$("#hidden-count")[0];if(hidden_count_element){var hidden_count=eval("("+hidden_count_element.getAttribute("rel:data")+")");hidden_count.hidden_count+=delta;hidden_count_element.setAttribute("rel:data",JSON.stringify(hidden_count));hidden_count_element.childNodes[0].nodeValue=hidden_count.hidden_count}};this.show_post=function(e){if(e.event){e=e.event}e.stop();var user=new BF_User();var userinfo=user.getUserInfo();var username=userinfo.username;var el=e.target;var owner=el.getAttribute("rel:owner");var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;if("acl" in window&&acl.user_can("partners_manage")){el.setAttribute("rel:buzz_id",buzz_id);return picks_controller.show_pick({stop:function(){},target:el},function(){update_count("show")})}};this.hide_post=function(e){if(e.event){e=e.event}e.stop();var user=new BF_User();var userinfo=user.getUserInfo();var username=userinfo.username;var el=e.target;var owner=el.getAttribute("rel:owner");var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;if("acl" in window&&acl.user_can("partners_manage")){el.setAttribute("rel:buzz_id",buzz_id);return picks_controller.hide_pick({stop:function(){},target:el},function(){update_count("hide")})}};this.delete_quickpost=function(e,type){if(e.event){e=e.event}e.stop();if(type=="contrib"){var comment_id=bf_post_tools.current_contrib;var old_iframe=$("user_post_delete_iframe");if(old_iframe){var parent=old_iframe.parentNode;parent.removeChild(old_iframe)}if($("user_post_delete_modal_text")){$("user_post_delete_modal_text").removeClassName("hidden");if($("post-headline")){$("post-headline").update("this contribution")}var cancel_btn=$("cancel-delete-button");var delete_btn=$("delete-button");if(cancel_btn){cancel_btn.stopObserving("click");cancel_btn.observe("click",bf_post_tools._cancel_delete_quickpost)}if(delete_btn){delete_btn.stopObserving("click");delete_btn.observe("click",function(){bf_post_tools._delete_contribution({comment_id:comment_id})})}}BF_UI.showDialog("user_post_delete","Delete")}else{var user=new BF_User();var userinfo=user.getUserInfo();var username=userinfo.username;var el=e.target;var owner=el.getAttribute("rel:owner");var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;if(BF_STATIC.tt_page=="Home"&&"acl" in window&&acl.user_can("uk_homepage_edit")&&BF_STATIC.country!=="us"){BF_UI.showDialog("user_post_delete","Remove from the "+BF_STATIC.country.toUpperCase()+" frontpage");$("user_post_delete_iframe").setAttribute("src","/buzzfeed/editbuzz/remove?id="+buzz_id+"&country="+BF_STATIC.country);return}var isa=false;if("acl" in window&&acl.user_can("delete_user_posts")){isa=true}if(!isa&&acl.user_can("partners_manage")&&typeof BF_STATIC!="undefined"&&(BF_STATIC.f_ad||BF_STATIC.f_partner)){isa=true}if(username!=owner&&!isa){return}if(owner!=username&&"picks_controller" in window&&"acl" in window&&acl.user_can("picks_delete_from_anywhere")&&$(buzz_id+"-delete_pick-spinner")){el.setAttribute("rel:buzz_id",buzz_id);var posts_count_el=$("posts-count");if(posts_count_el&&posts_count_el.up("li").hasClassName("selected")){var posts_count=posts_count_el.getAttribute("rel:data");posts_count=eval("("+posts_count+")");posts_count.posts_count--;posts_count_el.setAttribute("rel:data",Object.toJSON(posts_count));posts_count_el.update(posts_count.posts_count)}return picks_controller.delete_pick({stop:function(){},target:el})}else{var old_iframe=$("user_post_delete_iframe");if(old_iframe){var parent=old_iframe.parentNode;parent.removeChild(old_iframe)}if($("user_post_delete_modal_text")){$("user_post_delete_modal_text").removeClassName("hidden");var headline=(buzz_data!=null)?owner+"/"+buzz_data.uri:"this contribution";if($("post-headline")){$("post-headline").update(headline)}var cancel_btn=$("cancel-delete-button");var delete_btn=$("delete-button");if(cancel_btn){cancel_btn.stopObserving("click");cancel_btn.observe("click",bf_post_tools._cancel_delete_quickpost)}if(delete_btn){delete_btn.stopObserving("click");delete_btn.observe("click",function(){bf_post_tools._delete_quickpost({buzz_id:buzz_id})})}}BF_UI.showDialog("user_post_delete","Delete")}}};this._cancel_delete_quickpost=function(obj){top.BF_UI.closeDialog("user_post_delete")};this._delete_quickpost=function(obj){var params={action:"delete",id:obj.buzz_id};var url="/buzzfeed/_public_admin";if("reranked_id" in window){delete params.id;params.reranked_id=reranked_id;url="/buzzfeed/rerank_subbuzz"}var request=(new BF_Request()).request;request(url,{method:"post",needsToken:true,parameters:params,while_processing:{show:"delete-button-spinner",hide:"delete-button"},onSuccess:function(r){var r_obj=eval("("+r.responseText+")");if(r_obj.success!=1){var msg=r_obj.error;if(msg==="You cannot delte once the buzz has appeared on the homepage or has been promoted"){msg="Sorry, this post has been promoted by BuzzFeed editors so it can no longer be edited or deleted. Contact community@buzzfeed.com for more info."}$("delete-quickpost-form").innerHTML='<div class="bf_dialog_content_area"><div class="bf_dialog_pad">'+msg+'</div></div><div id="user_post_preview_footer" class="bf_dialog_footer"></div>';return}if(BF_STATIC.page=="Buzz"){top.BF_UI.closeDialog("user_post_delete");if(document.cookie.indexOf("testmode")==-1){BF_Request.location({reload_track:true})}}else{top.BF_UI.closeDialog("user_post_delete");parent.$("post-"+obj.buzz_id).hide();var draft_count_el=parent.$("draft-count");var posts_count_el=parent.$("posts-count");if(draft_count_el&&draft_count_el.up("li").hasClassName("selected")){var draft_count=draft_count_el.getAttribute("rel:data");draft_count=eval("("+draft_count+")");draft_count.draft_count--;draft_count_el.setAttribute("rel:data",Object.toJSON(draft_count));draft_count_el.update(draft_count.draft_count)}if(posts_count_el&&posts_count_el.up("li").hasClassName("selected")){var posts_count=posts_count_el.getAttribute("rel:data");posts_count=eval("("+posts_count+")");posts_count.posts_count--;posts_count_el.setAttribute("rel:data",Object.toJSON(posts_count));posts_count_el.update(posts_count.posts_count)}}}})};this._delete_contribution=function(obj){var params={action:"update_contribution",f_deleted:1,comment_id:obj.comment_id};var request=(new BF_Request()).request;request("/buzzfeed/comments_moderation",{method:"post",needsToken:true,parameters:params,while_processing:{show:"delete-button-spinner",hide:"delete-button"},onSuccess:function(){top.BF_UI.closeDialog("user_post_delete");bf_post_tools.cancel_inline_editor()}})};this.does_pin_dialog_have_anything_checked=function(obj){var changed=false;universal_dom.get_bucket_elements("pin-button").each(function(el){if(el.checked){changed=true}});var set_pin=$("set-pin");if(set_pin){if(changed){set_pin.removeClassName("hidden")}else{set_pin.addClassName("hidden")}}};this.pin_buzz=function(e,type,li){if($("pin-message")){$("pin-message").remove()}var el=e.findElement("li")||e.findElement("header")||$$(".buzz header")[0]||document.body;var data=el.getAttribute("rel:data");var vertical_feature_html="";if(data){var html="";var template=new Template("<li> 				<input class=\"bf_dom\" name=\"#{name}\" rel:bf_bucket_data=\"{'mimic-radio':1,'pin-button':1,'open-queue-dialog':{'name':'#{name}','force_closed':'true'}}\" value=\"#{suggest_category}\" type=\"checkbox\"#{checked}></input>#{msg} #{category} 			</li>");var select_template=new Template('<li> 				<input class="bf_dom" rel:bf_bucket="pin-button open-vertical-dialog" value="Feature" type="checkbox" />Add To 				<span class="bf_dom hidden" rel:bf_bucket_data="{\'vertical-dialog\': 1}"><select class="bf_dom" name="category" rel:bf_bucket="pin-dropdown">#{html}</select></span> 				<span class="bf_dom" rel:bf_bucket_data="{\'vertical-dialog\':0}">vertical</span> 				Big Stories</li>');var select_option_template=new Template('<option value="#{value}">#{value}</option>');var editor_add_template=new Template('<li> 				<input class="bf_dom" rel:bf_bucket="mimic-radio pin-button" name="#{category}" value="#{category}" type="checkbox"#{checked}></input>Add to <b>#{category}</b> 			</li>');var editor_queue_template=new Template("<li> 				<input class=\"bf_dom\" rel:bf_bucket_data=\"{'mimic-radio':1,'pin-button':1,'open-queue-dialog':{'name':'#{category}'}}\" name=\"#{category}\" value=\"#{category}\" type=\"checkbox\"#{checked}></input>Queue for <b>#{category}</b> 				#{queue_dialog} 			</li>");var queue_template=new Template('<div class="hidden bf_dom" rel:bf_bucket_data="{\'queue-dialog\':{\'name\':\'#{category}\'}}">Queue: 				<input id="queue-dialog-at" type="checkbox" class="bf_dom" name="pin-queue" value="queue-at" checked="true" 					rel:bf_bucket_data="{\'mimic-radio\':1,\'open-queue-schedule\':{\'name\':\'#{category}\'}}" />					<label for="queue-dialog-at">For</label> 				<span class="bf_dom" rel:bf_bucket_data="{\'queue-schedule\':{\'name\':\'#{category}\'}}"> 					<select name="queue-on-day">#{days}</select> 					<select name="queue-on-hour">#{hours}</select> 				</span> 				</div> 			');var option_template=new Template('<option value="#{value}"#{selected}>#{label}</option>');var interval_in_minutes=60;var hours_option="",first_hour="";var time=0;var next=new Date(),next_set=false;while(time<24*60){var seconds="00",raw_hours,raw_minutes;var hours=raw_hours=parseInt(time/60);var minutes=raw_minutes=time%60;if(minutes<10){minutes="0"+minutes}var ampm=hours<12?"am":"pm";if(hours==0){hours=12}if(hours>12){hours-=12}var tmpl=option_template.evaluate({value:[raw_hours,minutes,seconds].join(":"),label:[hours,minutes].join(":")+" "+ampm,selected:!first_hour||(raw_hours==next.getHours()&&raw_minutes==next.getMinutes())?' selected="selected"':""});if(!first_hour){first_hour=tmpl}else{hours_option+=tmpl}time+=interval_in_minutes;if(!next_set&&next.getHours()*60+next.getMinutes()+5<=time){next.setHours(0);next.setMinutes(time);next_set=true}}if(!next_set){next.setHours(0);next.setMinutes(time+interval_in_minutes)}else{first_hour=first_hour.replace(/\sselected="selected"/,"")}hours_option=first_hour+hours_option;var days="";var generate_date=function(d){var year=d.getYear();if(year<1900){year+=1900}return[year,d.getMonth()+1,d.getDate()].join("-")};var day_of_week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var terms=function(days){var d=(days==0?new Date():new Date((new Date()).getTime()+(days*24*60*60*1000)));return{value:generate_date(d),label:(days==0?"Today":(days==1?"Tomorrow":day_of_week[d.getDay()])),selected:(next.getDate()==d.getDate()?' selected="selected"':"")}};var values=[0,1,2,3,4,5,6].map(terms);values.each(function(value){days+=option_template.evaluate(value)});data=eval("("+data+")");var added_vertical=false;var community=(/^\/buzzfeed\/queue\/community/.test(window.location.pathname))?true:false;if((!added_vertical&&typeof data.category!="undefined"&&data.category!="")||community){var options="";user_post.vertical_categories.each(function(index){var perm="queue_edit_"+((user_post.categories[index]||"").toLowerCase());if(perm in acls&&acl.user_can(perm)){options+=select_option_template.evaluate({value:user_post.categories[index]})}});html+=select_template.evaluate({html:options});added_vertical=true}var use_template=template;var params={suggest_category:"fq_suggest",category:"Homepage",name:"Homepage Flow",msg:"Suggest for"};params.queue_dialog=queue_template.evaluate({category:"Homepage Flow",days:days,hours:hours_option});html+=use_template.evaluate(params);if(acl.user_can("homepage_edit")){params.category="Homepage Flow";html+=editor_queue_template.evaluate(params);params.category="Homepage Big Stories";html+=editor_add_template.evaluate(params)}if(acl.user_can("uk_homepage_edit")){params.category="UK Homepage Big Stories";html+=editor_add_template.evaluate(params)}if(acl.user_can("australia_homepage_edit")){params.category="AU Homepage Big Stories";html+=editor_add_template.evaluate(params)}vertical_feature_html='<ul style="text-align:left;padding-left:24px;">'+html+"</ul>"}el.insert('		  <div class="pin-dialog"  id="pin-message"> 		  <div class="fixer">		    <div id="pin-text">   		    <span id="msg-text" class="pin-title">Feature This Post? <a class="pin-cancel" onclick="bf_post_tools.hide_message()">X</a></span>     		  <div>'+vertical_feature_html+'     		    <div class="pin-dialog-buttons"> 							<select id="splash-dropdown" class="hidden"> 								<option value="0">Splash</option> 							</select> 	    		    <button type="button" class="button2 hidden pin" style="float:left;" id="set-splash">Splash</button> 	    		    <button type="button" class="button2 grey pin" id="cancel-pin">Cancel</button> 	    		    <button type="button" class="button2 pin" id="set-pin">Let\'s Do It!</button>     		  	</div>     		  </div>   		  </div>   		  <div id="pin-spinner" class="hidden" style="text-align:center; margin-top:25px;">   		    <img src="/static/images/public/spinners/big_on_e6e6e6.gif" />   		  </div> 		  </div> 		  </div> 		');delete universal_dom._bucket["pin-button"].elements;universal_dom.update(el);bf_post_tools.does_pin_dialog_have_anything_checked();if(bf_post_tools.show_splash()){$("splash-dropdown").removeClassName("hidden")}if(type){if(type==="order"){$("msg-text").update("Move this Buzz to to top?");$("set-pin").observe("click",function(){bf_post_tools._pin_buzz(e,false,null)})}else{if(type==="remove"){$("msg-text").update("Remove this Buzz from the list?");$("set-pin").update("Remove");$("set-pin").observe("click",function(){bf_post_tools._pin_buzz(e,true,li)})}}}else{$("set-pin").observe("click",function(){bf_post_tools._pin_buzz(e,false,null)});var data=el.getAttribute("rel:data");var owner=el.getAttribute("rel:owner");if(data&&owner){data=eval("("+data+")");data.username=owner;$("splash-dropdown").observe("change",function(e){e.stop();bf_post_tools._splash_buzz(data)})}else{$("set-splash").addClassName("hidden")}}$("cancel-pin").observe("click",bf_post_tools.hide_message);document.body.appendChild($("pin-message"))};this._splash_buzz=function(data){try{var medium,splash_options=$("splash-dropdown"),window_name="_self";if(splash_options){medium=splash_options.options[splash_options.selectedIndex].value}else{if(data&&typeof data.medium!=="undefined"){medium=data.medium;window_name="_new_"+(new Date()).getTime()}else{medium=0}}if(medium!=0){window.open("/buzzfeed/_flex_pro/"+data.username+"/"+data.uri+"/splashing?medium="+medium,window_name)}}catch(e){console.dir({e:e})}};this.show_splash=function(){var splash_options=$("splash-dropdown");var show_splash=false;if(acl.user_can("homepage_splashing")){show_splash=true;splash_options.options[splash_options.options.length]=new Option("Homepage Splash","splash")}if(acl.user_can("uk_homepage_splashing")){show_splash=true;splash_options.options[splash_options.options.length]=new Option("UK Frontpage Splash","uk_frontpage_splash")}if(acl.user_can("australia_homepage_edit")){show_splash=true;splash_options.options[splash_options.options.length]=new Option("AU Frontpage Splash","australia_frontpage_splash")}var isa_queue_edit_acl=new RegExp(/^queue_edit_.*/);for(var ck_acl in acls){if(isa_queue_edit_acl.match(ck_acl)&&acl.user_can(ck_acl)){show_splash=true;var splash_value=ck_acl.replace(/queue_edit_/g,"");var splash_name=splash_value.capitalize()+" Splash";var medium_name=splash_value+"_splash";splash_options.options[splash_options.options.length]=new Option(splash_name,medium_name)}}return show_splash};this._pin_buzz=function(e,unpin,li){if(e.event&&typeof e.event!=" undefined"){e=e.event}e.stop();var el=e.target;var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;var action;if(unpin){action="unpin"}else{action="pin"}var params={action:action,buzz_id:buzz_id};if(buzz_data.column){params.column=buzz_data.column}if(params.action=="unpin"){if(BF_STATIC.tt_page!="Home"){params.is_vertical=1;params.vertical_name=BF_STATIC.tt_page}}else{var cboxes=[];var category_flag;try{cboxes=$("pin-message").getElementsByTagName("INPUT")}catch(e){}var hp_flow_queue=false;for(var i=0;i<cboxes.length;i++){if(cboxes[i].getAttribute("type")=="checkbox"&&cboxes[i].checked){var name=cboxes[i].name;var value=cboxes[i].value;if(value=="Homepage Big Stories"){params.bs_add=1}else{if(value=="UK Homepage Big Stories"){params.uk_bs_add=1}else{if(value=="AU Homepage Big Stories"){params.au_bs_add=1}else{if(value=="Homepage Flow"){hp_flow_queue=true}else{if(value=="bs_suggest"){params.bs_suggest=1}else{if(value=="fq_suggest"){params.fq_suggest=1}else{if(value.match(/queue-(next|last|at)/)){if(hp_flow_queue){params[value]=value;var selects=$("pin-message").getElementsByTagName("SELECT");for(var j=0;j<selects.length;j++){var option=selects[j].options;params[selects[j].getAttribute("name")]=option[selects[j].selectedIndex].value}}}else{if(value=="Feature"){category_flag=$("pin-message").select('select[name="category"]');if(category_flag[0].value){params.add_to_vertical=category_flag[0].value.toLowerCase()}}}}}}}}}}}}ajax=new BF_Request();ajax.request("/buzzfeed/_admin",{method:"post",parameters:params,while_processing:{show:"pin-spinner",hide:"pin-text"},onSuccess:function(e){var res=e.responseText.evalJSON();if(res.success){if(e.request.parameters.action=="unpin"&&li!=null){if(li.hasClassName("first")){$(li).next("li").addClassName("first")}li.hide()}bf_post_tools.hide_message()}else{$("msg-text").update("<h2>Error:"+res.error+"</h2>")}}})};this.hide_message=function(){if($("pin-message")){$("pin-message").remove()}};this.remove_from_parent=function(){var params={};params.action="moderate";params.id=bf_post_tools.current_contrib;var sr=function(r){var obj=eval("("+r.responseText+")");alert("Remove from parent cintribution id"+obj.id+": "+obj.updated)};var er=function(r){var obj=eval("("+r.responseText+")");console.error(obj);alert("Error! Remove from parent")};var ajax=new BF_Request();ajax.request("/buzzfeed/_contribution_moderator",{method:"get",parameters:params,onSuccess:sr,onFailure:er})};this.create_element=function(parent,class_name){var pt_element=document.createElement("A");var pt_owner=parent.getAttribute("rel:owner");var buzz_info=parent.getAttribute("rel:data").evalJSON();var buzz_id=parent.getAttribute("rel:buzz_id");pt_element.className=class_name;pt_element.href="#";pt_element.innerHTML=class_name;pt_element.setAttribute("onclick","return false");pt_element.setAttribute("rel:data",JSON.stringify(buzz_info));pt_element.setAttribute("rel:buzz_id",buzz_id);if(class_name=="pt-wrench"){pt_element.setAttribute("rel:actions","click:bf_post_tools.load_inline_editor");pt_element.setAttribute("rel:bf_bucket","event_handler")}if(class_name=="pt-remove"){var username=(new BF_User()).getUserInfo().username;var owner=parent.getAttribute("rel:owner");if(owner!=username&&"picks_controller" in window&&"acl" in window&&acl.user_can("picks_delete_from_anywhere")&&$(buzz_id+"-delete_pick-spinner")||BF_STATIC.tt_page=="Home"&&"acl" in window&&acl.user_can("uk_homepage_edit")&&BF_STATIC.country!=="us"){pt_element.addClassName("pt-remove-picks")}}pt_element.setAttribute("rel:owner",pt_owner);return pt_element};this.create_ptool=function(item,permissions){try{if(!"acl" in window){throw new Error("acl is not available")}var inject=document.createElement("DIV");inject.className="ptools";inject.setAttribute("style","display:none");if(BF_STATIC.tt_page=="Home"&&acl.user_can("uk_homepage_edit")&&BF_STATIC.country!=="us"){inject.appendChild(bf_post_tools.create_element(item,"pt-remove"))}var stats;if(bf_post_tools.is_queue){var qtool=document.createElement("DIV");qtool.className="queue_ptools";var buzz_data=item.getAttribute("rel:data");if(buzz_data){buzz_data=eval("("+buzz_data+")")}else{buzz_data={}}var ptool_data=item.getAttribute("rel:ptool-data");if(ptool_data){ptool_data=eval("("+ptool_data+")")}else{ptool_data={}}if(typeof BF_Queue!=="undefined"&&BF_Queue.allow_hp_change&&ptool_data.allow_q!=0){qtool.appendChild(bf_post_tools.create_element(item,"pt-queue"))}if((acl.user_can("queue_super_admin")&&typeof BF_Queue!=="undefined"&&BF_Queue.allow_hp_publish&&ptool_data.allow_hp!=0)||(BF_STATIC.country=="uk"&&acl.user_can("uk_homepage_edit"))){qtool.appendChild(bf_post_tools.create_element(item,"pt-publish"))}if(ptool_data.allow_pin!=0){qtool.appendChild(bf_post_tools.create_element(item,"pt-pin"))}if(typeof BF_Queue!=="undefined"&&BF_Queue.allow_hp_change){qtool.appendChild(bf_post_tools.create_element(item,"pt-remove"))}if(acl.user_can("edit_user_posts")){inject.appendChild(bf_post_tools.create_element(item,"pt-wrench"));inject.appendChild(bf_post_tools.create_element(item,"pt-t-edit"))}inject.appendChild(bf_post_tools.create_element(item,"pt-flexpro"));inject.appendChild(bf_post_tools.create_element(item,"pt-stats"));inject.appendChild(qtool);return inject}else{if(bf_post_tools.is_viewdraft_page){var fixer;fixer=document.createElement("DIV");fixer.className="ptools-draftpage";fixer.appendChild(inject);if(acl.user_can("edit_user_posts")){inject.appendChild(bf_post_tools.create_element(item,"pt-t-edit"))}inject.appendChild(bf_post_tools.create_element(item,"pt-preview-mobile"));return fixer}else{if(bf_post_tools.is_draft_page){if(acl.user_can("edit_user_posts")){inject.appendChild(bf_post_tools.create_element(item,"pt-wrench"))}inject.appendChild(bf_post_tools.create_element(item,"pt-t-edit"));inject.appendChild(bf_post_tools.create_element(item,"pt-remove"));return inject}else{var fixer;if(acl.user_can("general_admin")){if(item.nodeName=="HEADER"&&item.up(".buzz")&&$$(".ptools-buzzpage").length){return false}if(item.nodeName=="HEADER"&&item.up(".buzz")){fixer=document.createElement("DIV");fixer.className="ptools-buzzpage";stats=document.createElement("DIV");stats.className="ptools-stats";var stats_data=item.getAttribute("rel:ptool_stats");if(stats_data){stats_data=eval("("+stats_data+")")}else{stats_data={}}var share_icons_map={impressions:"fa-eye",viral_lift:"fa-bolt",facebook_count:"fa-facebook",twitter_count:"fa-twitter",pinterest_count:"fa-pinterest-square",email_shares:"fa-envelope"};Object.keys(share_icons_map).each(function(name){if(stats_data[name]){var share=document.createElement((name=="twitter_count")?"a":"span");share.className=name+" stats";share.update("<i class='fa "+share_icons_map[name]+"'></i>"+stats_data[name]);if(name=="twitter_count"){var buzz_data=item.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");if(buzz_data.uri){share.target="_blank";share.href="https://twitter.com/search?q="+buzz_data.uri}}stats.appendChild(share)}});var stats_wrapper=document.createElement("DIV");stats_wrapper.className="ptools-stats-wrapper";stats_wrapper.appendChild(stats);inject.appendChild(stats_wrapper);fixer.appendChild(inject);bf_post_tools.ptools_buzzpage=window.setInterval(function(){var ptool=null,ptoolcon=null,ptools_div=null,bodyfixer=null;var btt=$("back_to_top");if(document.location.href.match("/_buzz_preview")){document.body.addClassName("DraftPage")}return function(){if(ptool==null){ptool=$$(".ptools")[0];ptoolcon=ptool.up();ptools_div=document.createElement("div");ptools_div.addClassName("ptools_wrench_popup");ptools_div.addClassName("hidden");ptoolcon.appendChild(ptools_div);ptoolcon.select(".pt-wrench")[0].style.zIndex=101;$("page_container").insert({before:ptoolcon})}if(!btt){btt=$("back_to_top");if(btt){btt.style.top="50px"}}if(ptool){if((document&&((document.documentElement&&document.documentElement.scrollTop)||(document.body&&document.body.scrollTop)))&&(40<=(document.documentElement.scrollTop||document.body.scrollTop))){ptoolcon.style.position="fixed"}else{if(bodyfixer==null){bodyfixer=document.createElement("div");bodyfixer.style.width="100%";bodyfixer.style.height="40px";$("header_wrapper").insert({before:bodyfixer})}}}var isNewEditFormOnScreen=($("editForm")&&$("editForm").getStyle("display")!="none"),isOldEditFormOnScreen=($$("div.qwik_edit").length&&$$("div.qwik_edit")[0].getStyle("display")=="block");if(bf_post_tools.buzz_opened||isNewEditFormOnScreen||isOldEditFormOnScreen){ptools_div.removeClassName("hidden")}else{ptools_div.addClassName("hidden")}}}(),200)}}var user=new BF_User();var username=user.getUserInfo().username;var owner=item.getAttribute("rel:owner");var buzz_data=item.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;var can_delete=acl.user_can("delete_user_posts")||(acl.user_can("partners_manage")&&typeof BF_STATIC!="undefined"&&(BF_STATIC.f_ad||BF_STATIC.f_partner))||username==owner;item.setAttribute("rel:buzz_id",buzz_id);if(permissions.isa||permissions.isa_partner){inject.appendChild(bf_post_tools.create_element(item,"pt-t-edit"));inject.appendChild(bf_post_tools.create_element(item,"pt-pin"));if(stats){stats.appendChild(bf_post_tools.create_element(item,"pt-stats"))}else{inject.appendChild(bf_post_tools.create_element(item,"pt-stats"))}inject.appendChild(bf_post_tools.create_element(item,"pt-flexpro"));inject.appendChild(bf_post_tools.create_element(item,"pt-wrench"));if(acl.user_can("boost_button")&&BF_STATIC.page=="Buzz"){inject.appendChild(bf_post_tools.create_element(item,"pt-boost_button"))}if(BF_STATIC.page=="Buzz"){inject.appendChild(bf_post_tools.create_element(item,"pt-rebuzz_button"))}if(can_delete&&!$(document.body).hasClassName("HomeSection")){inject.appendChild(bf_post_tools.create_element(item,"pt-remove"))}}else{if(permissions.terminal_user){inject.appendChild(bf_post_tools.create_element(item,"pt-t-edit"));if(stats){stats.appendChild(bf_post_tools.create_element(item,"pt-stats"))}else{inject.appendChild(bf_post_tools.create_element(item,"pt-stats"))}if(can_delete){inject.appendChild(bf_post_tools.create_element(item,"pt-remove"))}}else{if(permissions.basic_edit_functionality){inject.appendChild(bf_post_tools.create_element(item,"pt-edit"));if(stats){stats.appendChild(bf_post_tools.create_element(item,"pt-stats"))}else{inject.appendChild(bf_post_tools.create_element(item,"pt-stats"))}if(can_delete){inject.appendChild(bf_post_tools.create_element(item,"pt-remove"))}}}}var username_of_page_owner=$("username_of_page_owner")?$("username_of_page_owner").value:username;if(username_of_page_owner==owner&&BF_STATIC.tt_page=="User"&&BF_STATIC.user_is_f_ad&&acl.user_can("partners_manage")){if(bf_post_tools.page_name=="posts"){inject.appendChild(bf_post_tools.create_element(item,"pt-hide"))}if(bf_post_tools.page_name=="hidden"){inject.appendChild(bf_post_tools.create_element(item,"pt-show"))}}return fixer?fixer:inject}}}}catch(e){console.error(e)}};this.create_pin_tool=function(item,permissions){var inject=document.createElement("DIV");inject.className="pin_tools";inject.setAttribute("style","display:none");inject.appendChild(bf_post_tools.create_element(item,"pt-remove"));inject.appendChild(bf_post_tools.create_element(item,"pt-orders"));return inject};this.move_tool=function(e,move,li){if(e.event&&typeof e.event!=" undefined"){e=e.event}e.stop();var el=e.target;li.getElementsByClassName("pin-tool")[0].setAttribute("style","display:none");li.stopObserving("mouseover");li.stopObserving("mouseout");var spinner=document.createElement("DIV");var spinner_img=document.createElement("IMG");spinner.setAttribute("id","move_tool_spinner");spinner_img.setAttribute("src","/static/images/public/spinners/big_on_white.gif");spinner.appendChild(spinner_img);li.insertBefore(spinner,li.firstChild);var buzz_data=li.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");var buzz_id=buzz_data.buzz_id;var current_position=Number(buzz_data.position);var neighbor_buzz_ids=[];var new_position=current_position+1;var column="";column=buzz_data.column?buzz_data.column:"vertical";if(move=="up"){new_position=current_position-1;var neighbor=li.previous("li");if(neighbor&&neighbor.getAttribute("rel:buzz_id")==null){neighbor=neighbor.previous("li")}var neighbor_buzz_data=neighbor.getAttribute("rel:data");neighbor_buzz_data=eval("("+neighbor_buzz_data+")");neighbor_buzz_ids.push(neighbor_buzz_data.buzz_id);var previous=li.previous("li").previous("li");if(previous&&previous.getAttribute("rel:buzz_id")==null){previous=previous.previous("li")}if(column=="vertical"&&typeof previous!="undefined"){previous_neighbor_buzz_data=previous.getAttribute("rel:data");previous_neighbor_buzz_data=eval("("+previous_neighbor_buzz_data+")");neighbor_buzz_ids.push(previous_neighbor_buzz_data.buzz_id)}}else{var neighbor=li.next("li");if(neighbor&&neighbor.getAttribute("rel:buzz_id")==null){neighbor=neighbor.next("li")}var neighbor_buzz_data=neighbor.getAttribute("rel:data");neighbor_buzz_data=eval("("+neighbor_buzz_data+")");neighbor_buzz_ids.push(neighbor_buzz_data.buzz_id);var next=li.next("li").next("li");if(next&&next.getAttribute("rel:buzz_id")==null){next=next.next("li")}if(column=="vertical"&&typeof next!="undefined"){next_neighbor_buzz_data=next.getAttribute("rel:data");next_neighbor_buzz_data=eval("("+next_neighbor_buzz_data+")");neighbor_buzz_ids.push(next_neighbor_buzz_data.buzz_id)}}var params={neighbors:neighbor_buzz_ids,position:new_position,move:move,action:"move",buzz_id:buzz_id,country:BF_STATIC.country,column:column};if(BF_STATIC.tt_page!="Home"){params.is_vertical=1;params.vertical_name=BF_STATIC.tt_page}ajax=new BF_Request();ajax.request("/buzzfeed/_admin",{method:"post",parameters:params,onSuccess:function(e){var res=e.responseText.evalJSON();if(res.success){var p=li.parentElement;if(move=="up"&&li.previous("li")){buzz_data.position=Number(buzz_data.position)-1;li.setAttribute("rel:data",Object.toJSON(buzz_data));neighbor_buzz_data.position=Number(neighbor_buzz_data.position)+1;li.previous("li").setAttribute("rel:data",Object.toJSON(neighbor_buzz_data));p.insertBefore(li,li.previous("li"));if(typeof li.previous("li")=="undefined"){li.getElementsByClassName("pin-tool")[0].addClassName("upper");li.next("li").getElementsByClassName("pin-tool")[0].removeClassName("upper")}else{if(typeof li.next("li").next("li")=="undefined"){li.getElementsByClassName("pin-tool")[0].removeClassName("downer");li.next("li").getElementsByClassName("pin-tool")[0].addClassName("downer")}}}else{if(move=="down"&&li.next("li")){buzz_data.position=Number(buzz_data.position)+1;li.setAttribute("rel:data",Object.toJSON(buzz_data));neighbor_buzz_data.position=Number(neighbor_buzz_data.position)-1;li.next("li").setAttribute("rel:data",Object.toJSON(neighbor_buzz_data));p.insertBefore(li.next("li"),li);if(typeof li.previous("li").previous("li")=="undefined"){li.getElementsByClassName("pin-tool")[0].removeClassName("upper");li.previous("li").getElementsByClassName("pin-tool")[0].addClassName("upper")}else{if(typeof li.next("li")=="undefined"){li.getElementsByClassName("pin-tool")[0].addClassName("downer");li.previous("li").getElementsByClassName("pin-tool")[0].removeClassName("downer")}}}}}spinner.remove();li.observe("mouseover",function(){li.getElementsByClassName("pin-tool")[0].show()});li.observe("mouseout",function(){li.getElementsByClassName("pin-tool")[0].hide()})}})};this.create_ctool=function(item,permissions){try{if(item.getAttribute("rel:comment_id")==""){return false}var inject=document.createElement("DIV");inject.className="ctools";inject.setAttribute("style","display:none");var pt_element=document.createElement("A");pt_element.className="c-wrench";pt_element.href="#";pt_element.innerHTML="c-wrench";pt_element.setAttribute("onclick","return false");inject.appendChild(pt_element);var comment_info=item.getAttribute("rel:comment_id").evalJSON();pt_element.setAttribute("rel:comment_id",JSON.stringify(comment_info));item.appendChild(inject);return inject}catch(e){if(!item.getAttribute("track")||!item.getAttribute("track").evalJSON()||item.getAttribute("track").evalJSON().user!="You"){console.error(e)}}};this.load_t_editor=function(e){var buzz_info={};var owner;if(/\/_draft\//.test(window.location.href)&&window.opener&&/\/post/.test(window.opener.location.href)){e.stop();return window.close()}if(typeof e=="undefined"&&bf_post_tools.cache!={}&&bf_post_tools.buzz_opened){buzz_info.buzz_id=bf_post_tools.cache.campaignid;buzz_info.form_id=bf_post_tools.cache.form_id;buzz_info.type=bf_post_tools.cache.form;buzz_info.uri=bf_post_tools.cache.uri;owner=bf_post_tools.cache.owner}else{buzz_info=e.target.getAttribute("rel:data").evalJSON();owner=e.target.getAttribute("rel:owner")}var appendix="",appendixData={};if($$(".ptools-buzzpage").length&&(!$$(".ptools_wrench_popup").length||$$(".ptools_wrench_popup")[0].getStyle("display")=="none")){var selection=window.getSelection();if(selection.focusNode&&selection.toString()){var el=selection.focusNode.parentNode.hasClassName("buzz_superlist_item")?selection.focusNode.parentNode:selection.focusNode.parentNode.up(".buzz_superlist_item");if(el&&el.id){appendixData.id="suplist_item_"+el.id.replace("superlist_"+buzz_info.buzz_id+"_","");appendixData.meta=false;var nodeName=selection.focusNode.nodeName;var node=nodeName=="#text"?selection.focusNode.parentNode:selection.focusNode;if(nodeName=="#text"||nodeName=="P"||nodeName=="H2"){var subbuzz=selection.focusNode.parentNode.up(".buzz_superlist_item");if(node.nodeName=="H2"){appendixData.meta="title"}else{if(node.nodeName=="A"&&node.up(".sub_buzz_source_via")||node.nodeName=="DIV"&&node.hasClassName("sub_buzz_source_via")){appendixData.meta="via"}}if(selection.focusNode.nodeName=="#text"){appendixData.start=selection.anchorOffset;appendixData.end=selection.focusOffset;var node=selection.focusNode.parentNode}else{appendixData.start=0;appendixData.end=selection.focusNode.textContent.length;var node=selection.focusNode}var offset=0;var els=$A(el.children);for(var i=0;i<=els.length;i++){if(els[i]!=node&&els[i]&&els[i].textContent){offset+=els[i].textContent.length}else{break}}appendixData.offset=offset}if(selection.focusNode&&selection.focusNode.nodeName=="#text"||selection.focusNode.nodeName=="P"){appendixData.text=selection.toString().substr(0,20).strip()}}else{selection=null}appendix="#"+Object.toJSON(appendixData)}if(!selection||!selection.focusNode||!selection.toString()){appendixData.scrollonly="true";var doctop=document.documentElement.scrollTop||document.body.scrollTop,docheight=document.viewport.getHeight(),docbot,buzzlist=[];if($$(".buzz header")[0].cumulativeOffset().top+100<doctop){docheight=docheight-docheight*0.2;docbot=doctop+docheight;var bonus=25;$$("#buzz_sub_buzz .buzz_superlist_item").each(function(el){var eltop=el.cumulativeOffset().top,elheight=parseInt(el.getStyle("height")),elbot=eltop+elheight;if(eltop<doctop&&doctop<elbot||doctop<eltop&&eltop<docbot){var pen_bon=0;if(eltop<doctop||(doctop+document.viewport.getHeight())<elbot){pen_bon=-5}if(bonus>0&&doctop<eltop&&elbot<(doctop+document.viewport.getHeight())){pen_bon+=bonus;bonus-=15}var h=elheight-(doctop-eltop>0?doctop-eltop:0)-(elbot-docbot>0?elbot-docbot:0);buzzlist.push({id:el.id,per:(h/(docheight/100))+pen_bon})}});var max=0,id;buzzlist.map(function(el){if(el.per>max){max=el.per;id=el.id}});if(!buzzlist.length){id=$$("#buzz_sub_buzz .buzz_superlist_item").last().id}appendixData.id="suplist_item_"+id.replace("superlist_"+buzz_info.buzz_id+"_","");appendix="#"+Object.toJSON(appendixData)}}}var is_queue_suggestions_page=(buzz_info.form_id==null&&document.location.href.match("/queue"));var timestamp=(new Date()).getTime();if(typeof buzzDetails!="undefined"&&buzzDetails.hasOwnProperty("breaking")&&buzzDetails.breaking){window.open(BF_STATIC.web_root+"/breaking_post?id="+buzz_info.buzz_id)}else{if(buzz_info.form_id>=20||is_queue_suggestions_page){window.open(BF_STATIC.web_root+"/post?id="+buzz_info.buzz_id+appendix,"_new_"+timestamp)}}if(buzz_info.type=="quick post"){window.open(BF_STATIC.web_root+"/buzzfeed/edit/"+owner+"/"+buzz_info.uri+appendix,"_new_"+timestamp)}if(buzz_info.form_id<20&&buzz_info.type!="quick post"){bf_post_tools.terminal_edit(buzz_info.buzz_id)}};this.terminal_edit=function(buzz_id){var timestamp=(new Date()).getTime();window.open(BF_STATIC.terminal_root_url+"?action=buzz_edit&bid="+buzz_id,"_new_"+timestamp)};this.load_old_wrench=function(){if(bf_post_tools.poller.active){alert("Please close the existing dialog before opening another.");return}var buzz_id=bf_post_tools.current_buzz;var buzz_type=bf_post_tools.cache.form;var poller_id=(new Date()).getTime();bf_post_tools.cancel_inline_editor();BF_Post_Tools.editor_div_id=""+poller_id;var div_id=BF_Post_Tools.editor_div_id;var editor_div=$(div_id);if(!editor_div){editor_div=document.createElement("div");editor_div.id=div_id;bf_post_tools.bodyTag().appendChild(editor_div);editor_div.className="qwik_edit";var close_button=document.createElement("a");close_button.className="close_editor";close_button.update('<img src="'+BF_STATIC.image_root+'/static/images/public/spinners/closebox.png" alt="x"/>');close_button.href="#";close_button.stopObserving("click");close_button.observe("click",function(e){e.stop();bf_post_tools.close_editor(e)});editor_div.appendChild(close_button)}bf_post_tools.start_spinner();var style="terminal";bf_post_tools.load_iframe(buzz_id,{style:style,type:buzz_type});bf_post_tools.poller.add_poller_callback(buzz_id,bf_post_tools.close_window);var terminal_url=BF_STATIC.terminal_root_url;terminal_domain=terminal_url.replace(/(http:\/\/.*?)\/.*/,"$1");bf_post_tools.poller.start({callback_string:buzz_id,poll_url:terminal_domain+"/static/js/poller/cookie.js",pollid:poller_id,arguments:{id:div_id}})};this.close_editor=function(e){e.stop();var div=$(BF_Post_Tools.editor_div_id);if(div){div.parentNode.removeChild(div);bf_post_tools.poller.stop_polling()}};this.close_window=function(args){if($(args.pollid)){$(args.pollid).parentNode.removeChild($(args.pollid))}};this.load_iframe=function(buzz_id,args){if(!args){args={style:"terminal"}}var style=args.style?args.style:"terminal";var type=args.type?args.type:"link";var iframe_id=this.generate_id("iframe");var iframe=$(iframe_id);if(!iframe){iframe=document.createElement("iframe");iframe.id=iframe_id;$(BF_Post_Tools.editor_div_id).appendChild(iframe);iframe.stopObserving("load");iframe.observe("load",bf_post_tools.iframe_loaded);iframe.className="qwik_edit"}iframe.style.display="none";if(style=="terminal"){iframe.setAttribute("src",BF_STATIC.terminal_root_url+"?editor=qwik_edit&buzz_id="+buzz_id+"&cb="+(new Date()).getTime())}else{var buzz_type=type;if(/^super.*/.test(buzz_type)){buzz_type="super"}iframe.setAttribute("src","/bf2/editbuzz/"+buzz_type+"?id="+buzz_id+"&cb="+(new Date()).getTime())}};this.iframe_loaded=function(){bf_post_tools.stop_spinner();$(bf_post_tools.generate_id("iframe")).show()};this.start_spinner=function(){var spinner_id=this.generate_id("spinner");var spinner=$(spinner_id);if(!spinner){var spinner=document.createElement("div");spinner.id=spinner_id;spinner.className="qwik_edit-spinner";spinner.appendChild(document.createTextNode("Loading..."));$(BF_Post_Tools.editor_div_id).appendChild(spinner);spinner.style.display="none"}var iframe=$(this.generate_id("iframe"));if(iframe){iframe.hide()}spinner.show()};this.stop_spinner=function(){$(this.generate_id("spinner")).hide()};this.bodyTag=function(){return document.getElementsByTagName("BODY")[0]};this.generate_id=function(key){return BF_Post_Tools.editor_div_id+"_"+key};this.promo={container:"promo_fields",fp_class:"fp_promo",std_class:"std_promo",fpuk_class:"fpuk_promo",editing:"std",switch_promo_std:function(e){if(typeof superlist!="undefined"){return true}bf_post_tools.promo.editing="std";$(bf_post_tools.promo.container).addClassName(bf_post_tools.promo.std_class);$(bf_post_tools.promo.container).removeClassName(bf_post_tools.promo.fp_class);$(bf_post_tools.promo.container).removeClassName(bf_post_tools.promo.fpuk_class)},switch_promo_fp:function(e){if(typeof superlist!="undefined"){return true}bf_post_tools.promo.editing="fp";$(bf_post_tools.promo.container).addClassName(bf_post_tools.promo.fp_class);$(bf_post_tools.promo.container).removeClassName(bf_post_tools.promo.std_class);$(bf_post_tools.promo.container).removeClassName(bf_post_tools.promo.fpuk_class)},switch_promo_fpuk:function(e){if(typeof superlist!="undefined"){return true}bf_post_tools.promo.editing="fpuk";$(bf_post_tools.promo.container).addClassName(bf_post_tools.promo.fpuk_class);$(bf_post_tools.promo.container).removeClassName(bf_post_tools.promo.std_class);$(bf_post_tools.promo.container).removeClassName(bf_post_tools.promo.fp_class)}};this.isa_partner=function(){return"acl" in window&&acl.user_can(bf_post_tools.partner_acl)};this.set_buzz_template=function(template){this.buzz_template=template}};BF_Post_Tools.editor_div_id="_editor_div_"+Math.random()*100000;bf_post_tools=new BF_Post_Tools();BuzzLoader.register(function(){bf_post_tools.init()},1);document.observe("dom:loaded",function(){var f=new Date();var c=Math.floor(f.getTime()/1000);var a=Math.floor(Math.random()*c);var b=Math.floor(Math.random()*c);if((c>=1334808059)&&(c<=1334894399)){if($("pepsi-header")!=null){$("pepsi-header").show()}if($("pepsi-hot-module")!=null){$("pepsi-hot-module").show()}$("pepsi-hot-module").insert('<IMG SRC="http://ad.doubleclick.net/ad/N5371.244372.BUZZFEED/B6445150.2;sz=1x1;ord='+a+'?" BORDER=0 WIDTH=1 HEIGHT=1 ALT="">');$("pepsi-header").insert('<IMG SRC="http://ad.doubleclick.net/ad/N5371.244372.BUZZFEED/B6445150.9;sz=1x1;ord='+b+'?" BORDER=0 WIDTH=1 HEIGHT=1 ALT="">')}if($("prius-stats")){$("prius-stats").observe("click",function(){var g=new Image();if(BF_STATIC.tt_page=="Home"){g.src="http://ad.doubleclick.net/clk;254412577;78956947;f;pc=;"}else{g.src="http://ad.doubleclick.net/clk;254412577;78956999;m;pc=;"}})}});var BF_ACL=function(){this.init=function(){if("acls" in window){for(var a in acls){acl.manage_visibility(a)}}};this.manage_visibility=function(a){if(acl.user_can(a)){document.getElementsByTagName("BODY")[0].addClassName("can_"+a)}};this.test_user=function(a,b){["p_admin","p_developer_admin","p_other_admin","p_editor_admin","p_partner_admin"].each(function(c){if(a[c]==1){a[c]="true"}else{a[c]="false"}});return acl._check(a,b)?"pass":"fail"};this.user_can=function(a){return acl.switch_user_can(a)||acl.default_user_can(a)};this.switch_user_can=function(b){var a=new BF_User();if(a.isLoggedIn()){a=a.getUserInfo();a.id=a.userid;return acl._check(a,b)}else{return false}};this.default_user_can=function(b){var a=new BF_User();if(a.isLoggedIn()){return acl._check(a.getUserInfo().default_user,b)}else{return false}};this._check=function(f,a){var l=false;if("acls" in window){if(!acls[a]){console.warn("Reference to undefined ACL: "+a)}var h=acls[a]||["p_admin"];for(var g=0;g<h.length;g++){var c=h[g];if(c=="anyone"){return true}var m=c.replace(/^!/,"");var b=m!=c;var k=m.match(/^[0-9]+$/)?true:false;if(b&&k&&parseInt(f.id)==parseInt(m)){return false}if(!b&&k&&parseInt(f.id)==parseInt(m)){return true}if(!b&&!k&&f[m]=="true"){l=true}}}else{console.warn("No ACLs loaded")}return l}};acl=new BF_ACL();BuzzLoader.register(function(){acl.init()},10);var FlexProSplash=function(){this.draw_overlay=function(h,a){var b=document.createElement("div");b.addClassName(a.position);b.addClassName("splash-overlay");if($$("#"+h.id+" .splash-overlay").length>0){$(h.id).removeChild($$("#"+h.id+" .splash-overlay")[0])}b.id="splash-overlay";if(a.label.name!="none"){var k=document.createElement("div");k.addClassName("label");k.update(a.label.value);if(a.is_video){var g=document.createElement("div");var f=document.createElement("span");g.addClassName("label-wrap");f.addClassName("splash-video-icon");f.update("&nbsp;");g.insert(k);g.insert(f);b.appendChild(g)}else{b.appendChild(k)}}["title"].each(function(n){if(a.promo[n]){try{var o=document.createElement("div");o.addClassName(n);o.addClassName(a.color);o.style.fontSize=a.size+"px";o.style.lineHeight=a.size+"px";var q=document.createElement("div");q.addClassName("splash-desc");q.innerHTML=a.promo[n];o.appendChild(q);b.appendChild(o)}catch(p){console.error(p)}}});h.appendChild(b);if($$(".splash-overlay")&&$$("#edit-flex-pro-form")!=""){var m=$$(".splash-overlay")[0];var l=$$("#splash-container1")[0].getHeight();var c=$$(".splash-size-warning")[0];if(m){if(m.getHeight()>(l*0.94)){c.addClassName("visible")}else{if(c.hasClassName("visible")){c.removeClassName("visible")}}}}}};var SigninAnywhere=function(){this.init=function(){universal_dom.assign_handler({bucket:"SigninAnywhere.open",event:"click",handler:signin_anywhere.open});universal_dom.assign_handler({bucket:"SigninAnywhere.close",event:"click",handler:signin_anywhere.close});universal_dom.assign_handler({bucket:"sign-in",event:"click",handler:signin_anywhere.reset});signin_anywhere.dialog=null;bf_login.init({current_page:"signin_anywhere"})};this.close=function(){if(signin_anywhere.dialog){signin_anywhere.dialog.hide()}};this.open=function(l){var m=document.getElementsByTagName("BODY");if(!m){return}var r=$(l.el);var h;var p;var c="login";if(signin_anywhere.dialog){p=signin_anywhere.dialog;n=p.getElementsByTagName("IFRAME")[0];if((new BF_User().isLoggedIn())){if(typeof l.logged_in_iframe_url!="undefined"){n.src=l.logged_in_iframe_url;c="react"}}else{n.src=BF_STATIC.web_root+"/signin_anywhere?logged_in_iframe_url="+l.logged_in_iframe_url}p.show()}else{p=document.createElement("div");p.id="signin_anywhere_container";var n=document.createElement("iframe");n.id="signin_anywhere_iframe";if((new BF_User().isLoggedIn())){if(typeof l.logged_in_iframe_url!="undefined"){n.src=l.logged_in_iframe_url;c="react"}}else{n.src=BF_STATIC.web_root+"/signin_anywhere"+(l.logged_in_iframe_url?"?logged_in_iframe_url="+l.logged_in_iframe_url:"")}m[0].appendChild(p);signin_anywhere.dialog=p;signin_anywhere.loading=h;p.insert(n);universal_dom.update(p)}if(c=="login"){var f={width:620,height:520};if(Prototype.Browser.IE){f.height=560}var k=m[0].getDimensions();var q=Math.round(parseInt(k.width)/2-parseInt(f.width)/2);var o=r.cumulativeOffset().top-200;var g={top:o+"px",left:q+"px"};h=document.createElement("div");h.id="signin_anywhere_loading";h.innerHTML='<img src="/static/images/public/spinners/big_on_e6e6e6.gif" style="margin:'+f.height/2+"px "+(f.width/2-15)+'px;" />';h.setStyle({left:q,top:o});p.setStyle({zIndex:"1001",padding:"20px 0px 0px 0px",display:"block",position:"absolute",top:g.top,left:g.left,background:"#fff","box-shadow":"2px 2px 2px #888",width:f.width+"px",height:f.height+"px",border:"1px solid #000"});p.insert({top:h});n.setStyle({width:f.width+"px",height:f.height+"px"});if(!$("exit_bar")){var b='					<div id="exit_bar" style="width:100%;height:25px;background-color:#000000; position: absolute; top: 0px;"> 					<a class="bf_dom" style="float:right;color:white;margin:2px 5px; font-size:16px; font-family:Helvetica; font-weight:bold;" onclick="signin_anywhere.close();" href="javascript:;">x</a> 					</div> 				';p.insert({top:b})}}else{if(c="react"){a(r,p,n)}}n.observe("load",function(){if((new BF_User()).isLoggedIn()){(new BF_UserNav()).init()}if(h){h.hide()}var s=$("signin_anywhere_iframe").contentWindow.document.getElementById("social-actions");if(s){s.observe("set:reaction",function(t){a(r,p,n);if($("reaction-message")){$("reaction-message").addClassName("reaction-complete")}if(r.hasClassName("heart")){r.up().addClassName("deactivated")}else{r.addClassName("deactivated")}})}else{window.parent.bf_login.loggedInCallbacks.push(function(){signin_anywhere.close()})}});function a(z,t,w){w.addClassName("hidden");t.addClassName("hidden");var s=' 			<div id="reaction-message"> 				<span class="icon timetoshare"></span> 				<span class="icon checkmark"></span> 				<h3>Yes! Share it with friends</h3> 			</div> 			';if(!$("reaction-message")){if($(z).up(".splash_dfp_story")){z.up("div").insert({after:s})}else{if($$(".one_vid").length>0){$$(".badges.one_vid")[0].insert({bottom:s});$("reaction-message").setStyle({width:"410px"});$$(".icon.timetoshare")[0].hide();var v=new RegExp("^[0-9]+");var A=v.exec("150px");$$(".video-module-sharing.one_vid")[0].setStyle({left:(A*1+290)+"px"})}}}}};this.reset=function(){$("new-registration-form").hide();$("login-form").show()}};var signin_anywhere=new SigninAnywhere();BuzzLoader.register(function(){signin_anywhere.init()},2);(function(){var b={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/};var a={pointerX:0,pointerY:0,button:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,bubbles:true,cancelable:true};Event.simulate=function(l,f){var h=Object.extend(Object.clone(a),arguments[2]||{});var c,k=null;l=$(l);for(var g in b){if(b[g].test(f)){k=g;break}}if(!k){throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported")}if(document.createEvent){c=document.createEvent(k);if(k=="HTMLEvents"){c.initEvent(f,h.bubbles,h.cancelable)}else{c.initMouseEvent(f,h.bubbles,h.cancelable,document.defaultView,h.button,h.pointerX,h.pointerY,h.pointerX,h.pointerY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,l)}l.dispatchEvent(c)}else{h.clientX=h.pointerX;h.clientY=h.pointerY;c=Object.extend(document.createEventObject(),h);l.fireEvent("on"+f,c)}return l};Element.addMethods({simulate:Event.simulate})})();var BF_header=function(){this.searchHideTimer;this.searchEffect;this.menuTimer;this.menuDelay=150;this.menuOrder={news:["world","politics","business","tech","sports","longform","ideas"],entertainment:["entertainment","celebrity","music","rewind","books","comics"],life:["animals","food","diy","lgbt","geeky","travel","style"],video:["all-videos","ov-original-videos","ov-life-hacks","ov-awesome-science","ov-quizzes","ov-greatest-hits","ov-animals"],more:["hot","quiz","community","gif_feed","uk"]};this.showMenuEvent=(is_touch()?"click":"mouseenter");this.hideMenuEvent=(is_touch()?"touchstart":"mouseleave");this.menuOpen=false;this.init=function(){universal_dom.assign_handler({bucket:"signin",event:"click",handler:signin.open});universal_dom.assign_handler({bucket:"country_switch_menu",event:"click",handler:header.country_switch_menu});universal_dom.assign_handler({bucket:"country_switch",event:"click",handler:header.country_switch});universal_dom.assign_handler({bucket:"remove_cookie_notice",event:"click",handler:header.remove_cookie_notice});universal_dom.assign_handler({bucket:"set_country_cookie",event:"click",handler:header.set_country_cookie});try{if($$("#nav-search #nav-search-btn")&&$$("#nav-search #nav-search-btn").first()){$$("#nav-search #nav-search-btn").first().observe("click",function(b){header.showSearchBox()})}$$(".menu-item, #nav_menu").each(function(b){$(b).observe(header.showMenuEvent,function(c){if(b==header.nav_menu()){clearTimer(header.menuTimer)}else{header.triggerMenu(c)}if(is_touch()){var f;if(c.target.tagName.toUpperCase()=="DIV"){f=c.target}else{f=c.target.up("div")}if(f.getAttribute("menu_group").match("(news|entertainment|life|video)")){c.stop()}}});if(!is_touch()){$(b).observe(header.hideMenuEvent,function(c){clearTimer(header.menuTimer);header.menuTimer=setTimeout(function(){header.hideNavMenu()},header.menuDelay)})}});$$("#nav_menu .nav_menu_vertical a").each(function(b){$(b).observe("mouseover",function(){var c=$(b).findParent(".nav_menu_vertical").id.replace("nav_menu_","");header.navMenuShowVertical(c)})});if($("hothead")){$("hothead").on("mouseover",".HotHead",function(b){var c=b.toElement?b.toElement:(b.relatedTarget||b.target);if(!c.hasClassName("HotHead")){c.up(".HotHead")}if(c.hasClassName("appliedFix")){return}c.addClassName("appliedFix");c.select(".unit").each(function(f){$(f).observe("mouseover",function(g){header.fix_length(g)})})})}if(is_touch()){$$("body")[0].addClassName("has_touch")}header.bf_community_submit();header.check_for_cookie_notice();setTimeout("header.youtube_dfp()",1500)}catch(a){console.dir(a)}};this.get_window_size=function(){var a={w:0,h:0};if(!window.innerWidth){if(!(document.documentElement.clientWidth==0)){a.w=document.documentElement.clientWidth;a.h=document.documentElement.clientHeight}else{a.w=document.body.clientWidth;a.h=document.body.clientHeight}}else{a.w=window.innerWidth;a.h=window.innerHeight}return a};this.nav_menu=function(){return $("nav_menu")};this.stopSearchEffect=function(){if(typeof searchEffect!="undefined"){searchEffect.cancel()}};this.showSearchBox=function(){clearTimer(header.searchHideTimer);header.stopSearchEffect();if($("nav-search-box").getWidth()>150){return false}$("nav-search-btn").hide();$("nav-search-box").show();$("nav-search-box").setStyle({width:"0px"});$("header_search").focus();if($("nav-shares")){if(isMSIE()){$("nav-shares").hide()}else{new Effect.Opacity("nav-shares",{from:1,to:0,duration:0.1});$("nav-shares").addClassName("hidden")}}header.searchEffect=new Effect.Morph($("nav-search-box"),{style:{width:"170px"},duration:0.5,afterFinish:function(){$("search_submit").show();document.observe("click",function(a){if(!a.target.hasClassName("search_el")){header.hideSearchBox()}})}})};this.triggerMenu=function(f){var a=f.element();if(!a.hasAttribute("menu_group")){a=a.findParent(".menu-item")}var b=a.getAttribute("menu_group");var c=header.menuOrder[b];if(!header.menuOpen&&!is_touch()){header.menuTimer=setTimeout(function(){header.openMenu(b,c,a)},header.menuDelay)}else{header.openMenu(b,c,a)}};this.openMenu=function(b,c,a){clearTimer(header.menuTimer);header.menuOpen=true;var f=$("just_block");if(f!==null){f.className="";f.addClassName("justmode-"+b)}header.toggleMoreMenu(b);header.setMenuContent(c);header.moveNavMenu(a);header.updateNameMenu(a);if(header.nav_menu().hasClassName("video-menu")){header.nav_menu().removeClassName("video-menu")}if(b=="video"){header.nav_menu().addClassName("video-menu")}if(is_touch()){header.hideNavMenuTouch(a)}};this.hideNavMenu=function(){header.updateNameMenu(null);header.nav_menu().hide();header.menuOpen=false};this.hideNavMenuTouch=function(a){document.observe(header.hideMenuEvent,function(c){if(typeof c.element!="function"){return false}var b=$(c.element());if(!(b.findParent("#nav_menu"))&&!(b==header.nav_menu())&&!(b==a)&&!(b.findParent(".menu-item"))){header.hideNavMenu()}})};this.toggleMoreMenu=function(a){var b=$("nav_menu_more");if(b){if(a=="more"){b.show()}else{b.hide()}}};this.hideSearchBox=function(){clearTimer(header.searchHideTimer);header.stopSearchEffect();if($("nav-search-box").getWidth()<10){return false}$("nav-search").stopObserving("mouseout");$("nav-search-box").setStyle({width:"170px"});$("search_submit").hide();header.searchEffect=new Effect.Morph($("nav-search-box"),{style:{width:"0px"},duration:0.5,afterFinish:function(){$("nav-search-btn").show();if($("nav-shares")){if(isMSIE()){$("nav-shares").show()}else{new Effect.Opacity("nav-shares",{from:0,to:1,duration:0.1});$("nav-shares").removeClassName("hidden")}}$("nav-search-box").hide()}})};this.updateNameMenu=function(a){$$(".menu-item").each(function(b){if($(b)==a){if(!$(b).hasClassName("active")){$(b).addClassName("active")}}else{if($(b).hasClassName("active")){$(b).removeClassName("active")}}})};this.setMenuContent=function(b){var a=false;$$("#nav_menu #nav_menu_vertical_list li").each(function(f){var c=f.id.replace("nav_menu_","");if(b.indexOf(c)<0){$(f).addClassName("hidden")}else{if(!a){header.navMenuShowVertical(c);a=true}if($(f).hasClassName("hidden")){$(f).removeClassName("hidden")}}})};this.moveNavMenu=function(c){var a=Number($(c).cumulativeOffset()[1])+Number($(c).getHeight())-1;var b=Number($(c).cumulativeOffset()[0]);if(isNumber(a)&&isNumber(b)){header.nav_menu().setStyle({left:b+"px",top:a+"px"});header.nav_menu().show()}};this.navMenuShowVertical=function(a){$$("#nav_menu .nav_menu_vertical").each(function(b){var f=$(b).id.replace("nav_menu_","");var c=$("nav_preview_"+f);$(b).addClassName("active");if(f==a&&c){if(!$(b).hasClassName("active")){$(b).addClassName("active")}c.show()}else{if($(b).hasClassName("active")){$(b).removeClassName("active")}if(c!=null){c.hide()}}})};this.bf_community_submit=function(){var b=$("community-submit-btn");if(b){var a=new BF_User();if(a.isLoggedIn()){b.innerHTML="Make A Post!"}bf_login.loggedInCallbacks.push(function(){b.innerHTML="Make A Post!"})}};this.fix_length=function(k){var g=k.target;if(!g.hasClassName("unit")){g=g.up(".unit")}g.stopObserving("mouseover",header.fix_length);var a=g.select(".title")[0],h=parseInt(a.getStyle("height")),f=parseInt(g.getStyle("height")),b=false;if(a.select(".bf-name").length){b=a.select(".bf-name")[0]}if(h>(f-5)){a.addClassName("invisible");var l=b?b.innerHTML.split(" "):a.innerHTML.split(" "),m=0;b?b.innerHTML="":a.innerHTML="";while(parseInt(a.getStyle("height"))<parseInt(g.getStyle("height"))-5){m++;if(b){b.innerHTML=l.slice(0,m).join(" ")+"&hellip;"}else{a.innerHTML=l.slice(0,m).join(" ")+"&hellip;"}}m--;if(b){b.innerHTML=l.slice(0,m).join(" ")+"&hellip;"}else{a.innerHTML=l.slice(0,m).join(" ")+"&hellip;"}a.removeClassName("invisible")}};this.youtube_dfp=function(){$$(".bf-widget.partner-area").each(function(b){if(b){var a=b.select(".bf-user-url")[0].getAttribute("href");if(a&&a!=undefined){if(a.search("youtubecomedyweek")!=-1){if(b.hasClassName("current")||!b.hasClassName("variation")){b.addClassName("variation")}}}}})};this.country_switch_menu=function(b){var a=($(Event.element(b)).hasClassName("country_switch")?Event.element(b):$(Event.element(b)).findParent(".country_switch"));var c=$(a).down(".country_switch_menu");if(a&&c){BF_Effect.OpenMenu(a,c,{left:0});document.observe("mouseup",function(){c.hide()})}};this.country_switch=function(a){var b=a.r;if(b){document.location.href=b}};this.set_country_cookie=function(a){var b=a.country;if(b){BFW_Util.setCookie({name:"country",value:b,clem_valid:true,callback:function(){if($("cookie_notice")){BF_Effect.FadeOut($("cookie_notice"))}}})}};this.remove_cookie_notice=function(){if($("cookie_notice")){BF_Effect.FadeOut($("cookie_notice"))}localStorage.setItem("hide_cookie_notice","true")};this.check_for_cookie_notice=function(){if(!$("cookie_notice")){return false}var h=localStorage.getItem("hide_cookie_notice"),g=$("cookie_notice"),b=($("cookie_notice"))?$("cookie_notice").getAttribute("country"):"",l=BFW_Util.getCookie("country")!=null?BFW_Util.getCookie("country"):"us",c=((b==l)||(!l&&b=="us"))?true:false,a=null,f=(BF_STATIC.browser_language_settings||navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2),k=BF_STATIC.tt_page=="Buzz"?true:false;if(k){if(f!="en"&&f!=l){if(typeof liveCountries!="undefined"){if(liveCountries.hasOwnProperty(f)&&liveCountries[f]){a=$("have-you-seen-message");if(typeof cookieBarVerticalBpageMessage!="undefined"&&cookieBarVerticalBpageMessage&&cookieBarVerticalBpageMessage.hasOwnProperty(f)){a.update(cookieBarVerticalBpageMessage[f])}}}}}else{if(typeof liveCountries!="undefined"&&liveCountries.hasOwnProperty(l)&&liveCountries[l]){if(!h){if(c){if(b!="us"){a=$("cookie-us-message")}}else{a=$("cookie-set-message")}}else{if(!c){a=$("cookie-set-message")}}}}if(a&&(liveCountries.hasOwnProperty(b)&&liveCountries[b]===1)&&(liveCountries.hasOwnProperty(l)&&liveCountries[l]===1)){g.removeClassName("hidden");a.removeClassName("hidden")}}};var header=new BF_header();BuzzLoader.register(header.init,1);var BF_Shares=function(){this.fixedEncodeURIComponent=function(a){return(encodeURIComponent(a).replace(/[!'()]/g,escape).replace(/\*/g,"%2A"))};this.email_link=function(f){if(!objExists(f.el)){return false}if(!objExists(f.words)){f.words="Email"}if(!objExists(f.size)){f.size="big"}if(!objExists(f.subject)){f.subject=""}if(!objExists(f.body)){f.body=""}if(!objExists(f.onclick)){f.onclick=""}if(!objExists(f.color)){f.color=""}if(!objExists(f.wrapper)){f.wrapper=false}var b=objExists(f.tracking_action)?"rel:gt_act='"+f.tracking_action+"'":"";var a=objExists(f.tracking_label)?"rel:gt_label='"+f.tracking_label+"'":"";f.subject=bf_shares.fixedEncodeURIComponent(f.subject);var c="";var c="			"+(f.wrapper?'<div class="email_share">':"")+"			<a class='shareBtn big "+f.color+"'			onclick=\""+f.onclick+'"			href="mailto:?body='+f.body+"			&subject="+f.subject+'			" '+b+" "+a+"><div class='email_icon'></div>			<div class='label'>"+local.t(f.words)+"</div></a>			"+(f.wrapper?"</div>":"");$(f.el).insert(c)};this.fb_share=function(f){if(!objExists(f.el)||!objExists(f.uri)){return false}if(!objExists(f.words)){f.words="Share On Facebook"}if(!objExists(f.picture)){f.picture=""}if(!objExists(f.title)){f.title=""}if(!objExists(f.description)){f.description=""}if(!objExists(f.size)){f.size="big"}if(!objExists(f.color)){f.color="darkblue"}if(!objExists(f.onclick)){f.onclick=""}if(!objExists(f.wrapper)){f.wrapper=false}var b=objExists(f.tracking_action)?"rel:gt_act='"+f.tracking_action+"'":"";var a=objExists(f.tracking_label)?"rel:gt_label='"+f.tracking_label+"'":"";f.description=bf_shares.fixedEncodeURIComponent(f.description);f.title=bf_shares.fixedEncodeURIComponent(f.title);var c="			"+(f.wrapper?'<div class="fb_share">':"")+"			<a class='shareBtn "+f.size+" "+f.color+"'			type='box_count'			onclick=\"var sTop=window.screen.height/2-(218);var sLeft=window.screen.width/2-(313);window.open('https://www.facebook.com/dialog/feed?display=popup&			app_id="+BF_STATIC.fb_app_id+"			&link="+f.uri+"			&picture="+f.picture+"			&name="+f.title+"			&description="+f.description+"			&redirect_uri="+(BF_STATIC.bf_env=="dev"?"http://dev.buzzfeed.com/bf2":BF_STATIC.bf_env=="stage"?"http://stage.buzzfeed.com/":BF_STATIC.bf_env=="live"?"http://buzzfeed.com/":"")+"static/html/timemachine_share.html			','sharer','toolbar=0,status=0,width=580,height=400,top='+sTop+',left='+sLeft);			"+f.onclick+'			;return false"			 '+b+" "+a+'><div class="fb_icon">&nbsp;</div>			<div class="label">'+local.t(f.words)+"</div></a>			"+(f.wrapper?"</div>":"");$(f.el).insert(c)};this.tw_tweet=function(f){if(!objExists(f.el)||!objExists(f.uri)){return false}if(!objExists(f.words)){f.words="Tweet"}if(!objExists(f.via)||!f.via){f.via="buzzfeed"}if(!objExists(f.size)){f.size="big"}if(!objExists(f.description)){f.description=""}if(!objExists(f.onclick)){f.onclick=""}if(!objExists(f.hashtags)){f.hashtags=""}if(!objExists(f.color)){f.color=""}if(!objExists(f.wrapper)){f.wrapper=false}var b=objExists(f.tracking_action)?"rel:gt_act='"+f.tracking_action+"'":"";var a=objExists(f.tracking_label)?"rel:gt_label='"+f.tracking_label+"'":"";f.description=bf_shares.fixedEncodeURIComponent(f.description);var c=(f.wrapper?'<div class="tweet_share">':"");c+="<a class='shareBtn "+f.size+" "+f.color+"'"+b+" "+a+" ";c+="onClick=\"window.open('https://twitter.com/intent/tweet?url="+f.uri;if(f.description){c+="&text="+f.description}if(f.hashtags){c+="&hashtags="+f.hashtags}if(f.via){c+="&via="+f.via}c+="', 'twitterwindow', 'height=450, width=550, top='+((BF_UTIL.browser.dimensions.height()/2) - 225 + BF_UTIL.browser.position.top()) +', left='+((BF_UTIL.browser.dimensions.width()/2) - 275 + BF_UTIL.browser.position.left()) +', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');"+f.onclick+";return false;\">			<div class='twitter_icon'></div>			<div class='label'>"+local.t(f.words)+"</div></a>			"+(f.wrapper?"</div>":"");$(f.el).insert(c)}};var bf_shares=new BF_Shares();sharing={};sharing.lib={};sharing.types={};sharing.lib.get_url=function(a){if(typeof pound!="undefined"){return pound.urls.hashAndQueryString()}else{if(a.url){return a.url}}return encodeURIComponent(document.URL)};sharing.lib.bind=function(b,a,c){if(window.addEventListener){b.addEventListener(a,c,false)}else{if(window.attachEvent){b.attachEvent("on"+a,c)}else{b["on"+a]=c}}};sharing.lib.unbind=function(b,a,c){if(!b){return}if(b.removeEventListener){b.removeEventListener(a,c,false)}else{if(b.detachEvent){b.detachEvent("on"+a,c)}else{b["on"+a]=function(f){return false}}}};sharing.lib.endEvent=function(a){if(a){a.cancelBubble=true;a.returnValue=false;if(a.stopPropagation){a.stopPropagation()}if(typeof a.preventDefault!="undefined"){a.preventDefault()}}return false};sharing.lib.apply_attrs=function(c,a){for(var b in a){if(a.hasOwnProperty(b)&&a[b]!=null&&a[b]!=""){c.setAttribute(b,a[b])}}};sharing.types.Buzz=function(){var a=this;this.build=function(h){var b=h.parentNode;var k=h.replace;var c=document.createElement("div");if(typeof k!="undefined"){k.parentNode.insertBefore(c,k);k.parentNode.removeChild(k)}var g=document.createElement("a");var l=document.createElement("div");var f=document.createElement("div");c.appendChild(g);g.appendChild(l);g.appendChild(f);g.setAttribute("class","bf_dom shareBtn big square");f.setAttribute("class","label");l.innerHTML="&nbsp;";f.innerHTML="Share";if(typeof b!="undefined"){b.appendChild(c)}a.container=c;a.anchor=g;a.icon=l;a.label=f;return c};this.type=function(){return"buzz"};this.elements=function(){return{container:a.container,anchor:a.anchor,icon:a.icon,label:a.label}};this.addClickEvent=function(b){if(typeof b!="undefined"){sharing.lib.bind(a.anchor,"click",b)}};this.toString=function(){return"[sharing.HeaderButton]"}};sharing.types.SubBuzz=function(){var a=this;this.build=function(c){var b=document.createElement("a");var f=c.replace;if(typeof f!="undefined"){f.parentNode.insertBefore(b,f);f.parentNode.removeChild(f)}b.setAttribute("href","javascript:;");b.setAttribute("class","share-icon bf_dom");if(typeof c.parentNode!="undefined"){c.parentNode.appendChild(b)}a.anchor=b;return b};this.type=function(){return"subbuzz"};this.elements=function(){return{anchor:a.anchor}};this.addClickEvent=function(b){if(typeof b!="undefined"){sharing.lib.bind(a.anchor,"click",b)}}};sharing.types.Longform=function(){var a=this;this.build=function(c){var b=document.createElement("a");var f=c.replace;if(typeof f!="undefined"){f.parentNode.insertBefore(b,f);f.parentNode.removeChild(f)}b.setAttribute("href","javascript:;");if(typeof c.parentNode!="undefined"){c.parentNode.appendChild(b)}a.anchor=b;return b};this.type=function(){return"longform"};this.elements=function(){return{anchor:a.anchor}};this.addClickEvent=function(b){if(typeof b!="undefined"){sharing.lib.bind(a.anchor,"click",b)}}};sharing.buttons=new (function(){var a=this;this._build=function(b){if(b.type&&b.type=="subbuzz"){button=new sharing.types.SubBuzz()}else{if(b.type&&b.type=="longform"){button=new sharing.types.Longform()}else{button=new sharing.types.Buzz()}}button.build(b);b.url=sharing.lib.get_url(b);return button};this._window=function(f){var b=(window.screen.height/2)-(f.height/2);var c=(window.screen.width/2)-(f.width/2);var g="toolbar=0, status=0, width="+f.width+", height="+f.height+", top="+b+", left="+c;window.open(f.url,f.name,g)};this.facebook_share=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._facebook_share_subbuzz(c,b)}else{if(c.type()=="longform"){a._facebook_share_longform(c,b)}else{a._facebook_share_default(c,b)}}c.network="facebook";return c};this._facebook_share_default=function(f,c){var b=function(h){var g="http://www.facebook.com/sharer.php?s=100";if(c.url){g+="&p[url]="+c.url}if(c.picture){g+="&p[images][0]="+c.picture}if(c.title){g+="&p[title]="+encodeURIComponentoptions(c.title)}if(c.blurb){g+="&p[summary]="+encodeURIComponent(c.blurb)}a._window({width:626,height:256,url:g,name:"fbWindow"});if(typeof fbSharePixel!="undefined"){fbSharePixel()}return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);f.container.setAttribute("class","fb_share");f.icon.setAttribute("class","fb_icon");sharing.lib.apply_attrs(f.anchor,{href:"javascript:;","rel:gt_act":(c.gt_act?c.gt_act:"share/facebook/share"),"rel:gt_label":(c.gt_label?c.gt_label:null)})};this._facebook_share_longform=function(f,c){var b=function(h){var g="http://www.facebook.com/sharer.php?s=100";if(c.url){g+="&p[url]="+c.url}if(c.picture){g+="&p[images][0]="+c.picture}if(c.title){g+="&p[title]="+encodeURIComponentoptions(c.title)}if(c.blurb){g+="&p[summary]="+encodeURIComponent(c.blurb)}a._window({width:626,height:256,url:g,name:"fbWindow"});if(typeof fbSharePixel!="undefined"){fbSharePixel()}return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);sharing.lib.apply_attrs(f.anchor,{"class":"fb_icon inlineShareBtn",href:"javascript:;","rel:gt_act":(c.gt_act?c.gt_act:"share/facebook/share"),"rel:gt_label":(c.gt_label?c.gt_label:null)})};this._facebook_share_subbuzz=function(c,b){sharing.lib.apply_attrs(c.anchor,{"class":"share-icon bf_dom sub-buzz-facebook-share",id:"facebook"+b.subbuzz,"rel:bf_bucket_data":JSON.stringify({"fb-share":{id:b.subbuzz}}),"rel:gt_act":(b.gt_act?b.gt_act:"share/facebook/list-item:"+b.subbuzz_no),"rel:gt_label":(b.gt_label?b.gt_label:b.image)})};this.email=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._email_subbuzz(c,b)}else{if(c.type()=="longform"){a._email_longform(c,b)}else{if(b.method&&b.method=="mailto"){a._email_mailto_link(c,b)}else{a._email_default(c,b)}}}c.network="email";return c};this._email_subbuzz=function(c,b){sharing.lib.apply_attrs(c.anchor,{"class":"share-icon bf_dom sub-buzz-email-share",id:"emailShare"+b.subbuzz,"rel:bf_bucket_data":JSON.stringify({"email-share":{id:b.subbuzz}}),"rel:gt_act":(b.gt_act?b.gt_act:"share/email/list-item:"+b.subbuzz_no),"rel:gt_label":(b.gt_label?b.gt_label:b.image)})};this._email_longform=function(g,f){var c=function(h){return sharing.lib.endEvent(h)};var b=function(h){if(tracker){tracker.add({type:tracker.types.SHARE_EMAIL});tracker.run()}};sharing.lib.bind(g.anchor,"click",c);sharing.lib.bind(g.anchor,"mousedown",b);sharing.lib.apply_attrs(g.anchor,{"class":"bf_dom email_icon inlineShareBtn","rel:gt_act":(f.gt_act?f.gt_act:"share/email"),"rel:gt_label":(f.gt_label?f.gt_label:null),"rel:bf_bucket":"event_handler sticky_popup_button",no_scroll:"true",title:"Email this to a friend","rel:actions":"click:share_email","rel:data":JSON.stringify({share_email:{buzz_id:f.buzzid}}),href:"javascript:;"})};this._email_default=function(g,f){var c=function(h){return sharing.lib.endEvent(h)};var b=function(h){if(tracker){tracker.add({type:tracker.types.SHARE_EMAIL});tracker.run()}};sharing.lib.bind(g.anchor,"click",c);sharing.lib.bind(g.anchor,"mousedown",b);g.container.setAttribute("class","email_share");g.icon.setAttribute("class","email_icon");sharing.lib.apply_attrs(g.anchor,{"rel:gt_act":(f.gt_act?f.gt_act:"share/email"),"rel:gt_label":(f.gt_label?f.gt_label:null),"rel:actions":"click:share_email","rel:bf_bucket":"event_handler sticky_popup_button","rel:data":JSON.stringify({share_email:{buzz_id:f.buzzid}}),href:"javascript:;"})};this._email_mailto_link=function(c,b){c.container.setAttribute("class","email_share");c.icon.setAttribute("class","email_icon");sharing.lib.apply_attrs(c.anchor,{"rel:gt_act":(b.gt_act?b.gt_act:"share/email"),"rel:gt_label":(b.gt_label?b.gt_label:null),"rel:actions":"click:share_email",href:"mailto:?body="+(b.body?b.body:"")+"&subject="+(b.subject?b.subject:""),target:"_self"})};this.link=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._link_subbuzz(c,b)}else{a._link_default(c,b)}c.network="link";return c};this._link_default=function(c,b){c.container.setAttribute("class","link_share");c.icon.setAttribute("class","copy_icon");sharing.lib.apply_attrs(c.anchor,{"rel:gt_act":(b.gt_act?b.gt_act:"share/link"),"rel:gt_label":(b.gt_label?b.gt_label:null),href:"javascript:;","rel:bf_bucket":"share_link sticky_popup_button","rel:link":b.url,})};this._link_subbuzz=function(c,b){sharing.lib.apply_attrs(c.anchor,{href:"javascript:;","class":"share-icon bf_dom sub-buzz-link-share",id:"link"+b.subbuzz,"rel:bf_bucket_data":JSON.stringify({"link-share":{id:b.subbuzz}}),"rel:gt_act":(b.gt_act?b.gt_act:"share/link/list-item:"+b.subbuzz_no),"rel:gt_label":(b.gt_label?b.gt_label:b.image)})};this.pinterest=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._pinterest_subbuzz(c,b)}else{if(c.type()=="longform"){a._pinterest_longform(c,b)}else{a._pinterest_default(c,b)}}c.network="pinterest";return c};this._pinterest_default=function(c,b){c.container.setAttribute("class","pinterest_share");sharing.lib.apply_attrs(c.anchor,{"rel:gt_act":(b.gt_act?b.gt_act:"share/pinterest"),"rel:gt_label":(b.gt_label?b.gt_label:null),"rel:bf_bucket":"pinterest",href:"javascript:;"});c.icon.setAttribute("class","pi_icon");c.label.innerHTML="Pin it"};this._pinterest_longform=function(c,b){sharing.lib.apply_attrs(c.anchor,{"rel:gt_act":(b.gt_act?b.gt_act:"share/pinterest"),"rel:gt_label":(b.gt_label?b.gt_label:null),"rel:bf_bucket":"pinterest",href:"javascript:;","class":"bf_dom inlineShareBtn pi_icon"})};this._pinterest_subbuzz=function(c,b){sharing.lib.apply_attrs(c.anchor,{href:"javascript:;","class":"share-icon bf_dom sub-buzz-pinterest-share",id:"pinterest"+b.subbuzz,"rel:bf_bucket_data":JSON.stringify({"pin-share":{id:b.subbuzz}}),"rel:gt_act":(b.gt_act?b.gt_act:"share/pinterest/list-item:"+b.subbuzz_no),"rel:gt_label":(b.gt_label?b.gt_label:"row_image")})};this.reddit=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._reddit_subbuzz(c,b)}else{a._reddit_default(c,b)}c.network="reddit";return c};this._reddit_default=function(f,c){var b=function(h){var g="http://www.reddit.com/submit?";if(c.url){g+="url="+c.url}a._window({width:900,height:700,url:g,name:"redditWindow"});return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);f.container.setAttribute("class","reddit_share");f.icon.setAttribute("class","reddit_icon");sharing.lib.apply_attrs(f.anchor,{"rel:gt_act":(c.gt_act?c.gt_act:"share/reddit"),"rel:gt_label":(c.gt_label?c.gt_label:null),href:"javascript:;"})};this._reddit_subbuzz=function(c,b){throw Error("Share.js: Reddit subbuzz button not implemented.")};this.stumbleupon=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._stumbleupon_subbuzz(c,b)}else{a._stumbleupon_default(c,b)}c.network="stumbleupon";return c};this._stumbleupon_default=function(f,c){var b=function(h){var g="http://www.stumbleupon.com/submit?";if(c.url){g+="url="+c.url}a._window({width:750,height:450,name:"stumbleWindow",url:g});return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);f.container.setAttribute("class","stumbleupon_share");f.icon.setAttribute("class","su_icon");f.label.innerHTML="Stumble";sharing.lib.apply_attrs(f.anchor,{"rel:gt_act":(c.gt_act?c.gt_act:"share/su"),"rel:gt_label":(c.gt_label?c.gt_label:null),href:"javascript:;"})};this._stumbleupon_subbuzz=function(c,b){throw Error("Share.js: Stumbleupon subbuzz button is not implemented")};this.googleplus=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._googleplus_subbuzz(c,b)}else{a._googleplus_default(c,b)}c.network="googleplus";return c};this._googleplus_default=function(f,c){var b=function(h){var g="https://plus.google.com/share?";if(c.url){g+="url="+c.url}a._window({width:550,height:450,name:"gplusWindow",url:g});return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);f.container.setAttribute("class","gplus_share");f.icon.setAttribute("class","gplus_icon");sharing.lib.apply_attrs(f.anchor,{"rel:gt_act":(c.gt_act?c.gt_act:"share/googleplus/plus-one"),"rel:gt_label":(c.gt_label?c.gt_label:null),href:"javascript:;"})};this._googleplus_subbuzz=function(c,b){throw Error("Share.js: Google Plus subbuzz button not implemented.")};this.comment=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._comment_subbuzz(c,b)}else{a._comment_default(c,b)}c.network="comment";return c};this._comment_default=function(c,b){throw Error("Share.js: Comment default button not implemented.")};this._comment_subbuzz=function(c,b){sharing.lib.apply_attrs(c.anchor,{href:"javascript:;","class":"share-icon bf_dom sub-buzz-response-share response-button",id:"response"+b.subbuzz,"rel:bf_bucket_data":JSON.stringify({"response-share":{id:b.subbuzz}}),"rel:gt_act":(b.gt_act?b.gt_act:"share/contribute/list-item:"+b.subbuzz_no),"rel:gt_label":(b.gt_label?b.gt_label:null)})};this.linkedin=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._linked_in_subbuzz(c,b)}else{a._linkedin_default(c,b)}c.network="linkedin";return c};this._linkedin_default=function(f,c){var b=function(h){var g="http://www.linkedin.com/shareArticle?mini=true";if(c.url){g+="&url="+c.url}a._window({width:520,height:420,url:g,name:"linkedinWindow"});return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);f.container.setAttribute("class","linkedin_share");f.icon.setAttribute("class","li_icon");sharing.lib.apply_attrs(f.anchor,{"rel:gt_act":(c.gt_act?c.gt_act:"share/linkedin"),"rel:gt_label":(c.gt_label?c.gt_label:null),"rel:bf_bucket":"linkedin",href:"javascript:;"})};this._linked_in_subbuzz=function(c,b){throw Error("Share.js: LinkedIn subbuzz is not implemented.")};this.rebuzz=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._rebuzz_subbuzz(c,b)}else{a._rebuzz_default(c,b)}c.network="rebuzz";return c};this._rebuzz_default=function(g,f){var c=function(h){return sharing.lib.endEvent(h)};var b=function(h){if(tracker){tracker.add({type:tracker.types.SHARE_REBUZZ});tracker.run()}};sharing.lib.bind(g.anchor,"mousedown",b);sharing.lib.bind(g.anchor,"click",c);sharing.lib.apply_attrs(g.container,{"class":"rebuzz_share","rel:buzz_id":f.buzzid});g.label.innerHTML="Rebuzz";g.icon.setAttribute("class","rebuzz_icon");sharing.lib.apply_attrs(g.anchor,{"class":"add-pick bf_dom make_pick shareBtn big square","rel:gt_act":(f.gt_act?f.gt_act:"share/rebuzz"),"rel:gt_label":(f.gt_label?f.gt_label:null),id:f.buzzid+"-make_pick-add","rel:data":JSON.stringify({username:f.username})})};this._rebuzz_subbuzz=function(c,b){throw Error("Share.js: Rebuzz subbuzz buttons are not implemented.")};this.twitter=function(b){if(!b){b=new Object}var c=a._build(b);if(c.type()=="subbuzz"){a._twitter_subbuzz(c,b)}else{if(c.type()=="longform"){a._twitter_longform(c,b)}else{a._twitter_default(c,b)}}c.network="twitter";return c};this._twitter_default=function(f,c){var b=function(h){var g="http://twitter.com/share?";if(c.url){g+="&url="+c.url}if(c.blurb){g+="&text="+c.blurb}if(c.via){g+="&via="+c.via}if(c.hashtags){g+="&hashtags="+c.hashtags}a._window({width:550,height:450,url:g,name:"twitterWindow"});return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);f.container.setAttribute("class","tweet_share");f.icon.setAttribute("class","twitter_icon");f.label.innerHTML="Tweet";sharing.lib.apply_attrs(f.anchor,{"rel:gt_act":(c.gt_act?c.gt_act:"share/twitter/tweet"),"rel:gt_label":(c.gt_label?c.gt_label:null),href:"javascript:;",})};this._twitter_longform=function(f,c){var b=function(h){var g="http://twitter.com/share?";if(c.url){g+="&url="+c.url}if(c.blurb){g+="&text="+c.blurb}if(c.via){g+="&via="+c.via}if(c.hashtags){g+="&hashtags="+c.hashtags}a._window({width:550,height:450,url:g,name:"twitterWindow"});return sharing.lib.endEvent(h)};sharing.lib.bind(f.anchor,"click",b);sharing.lib.apply_attrs(f.anchor,{"rel:gt_act":"share/twitter/tweet",href:"javascript:;","class":"bf_dom twitter_icon inlineShareBtn"})};this._twitter_subbuzz=function(c,b){sharing.lib.apply_attrs(c.anchor,{href:"javascript:;","class":"share-icon bf_dom sub-buzz-twitter-share",id:"twitter"+b.subbuzz,"rel:via":(b.via?b.via:null),"rel:sub_title":(b.blurb?b.blurb:null),"rel:bf_bucket_data":JSON.stringify({"tw-share":{id:b.subbuzz}}),"rel:gt_act":(b.gt_act?b.gt_act:"share/twitter/list-item:"+b.subbuzz_no),"rel:gt_label":(b.gt_label?b.gt_label:b.image)})}})();var ScrollToTop=function(){var b=false;var c=function(){if(f()){var g=new Element("div");g.id="back_to_top";g.onclick=function(){$$(".unified_header")[0].scrollTo();gtrack.track_events("[ttp]","scrollTo/Top","")};$$("body")[0].insert(g);Event.observe(window,"scroll",function(h){a()})}};var f=function(){if($$(".HomePage").length){return true}if($$("#buzz_sub_buzz.suplist_list_show").length){return true}if(acl.user_can("general_admin")&&document.location.href.match("/_draft/")){return true}return false};var a=function(){try{if(document.viewport.getScrollOffsets()[1]>500&&!b){$("back_to_top").addClassName("show");new BF_Effect.FadeIn($("back_to_top"),1,20);b=true}else{if(document.viewport.getScrollOffsets()[1]<500&&b){var g=function(){$("back_to_top").removeClassName("show")};new BF_Effect.FadeOut($("back_to_top"),0,20,g);b=false}}}catch(h){if(BF_STATIC.bf_env!="live"){console.error(h)}}};return{init:function(){try{c()}catch(g){if(BF_STATIC.bf_env!="live"){console.error(g)}}}}}();BuzzLoader.register(ScrollToTop.init,5);var HideSplashPost=(function(){var g=null;var a="splash-container";var c="list-of-buzz";var f=function(h){return $(h).readAttribute("rel:buzz_id")};var b=function(h,k){$(h).select("li").each(function(l){if($(l).id=="post-"+k){$(l).remove()}})};return{init:function(){if($(a)==null||$(c)==null){return}g=f(a);if(g==null){return}b(c,g)}}}());if(BF_STATIC.tt_page!="Home"){BuzzLoader.register(HideSplashPost.init,1)}(function(){var c=new Date().getTime(),a=$$("ul.breaking-posts li.last")[0],b=function(){var h=$$(".breaking-tweets iframe")[0],f=new Date().getTime(),g=function(){if(!h){return false}var k=h.getStyle("height").match(/\d+/),l=k?+k[0]:125;return h.getHeight()>=l};if(!g()&&(f-c)<10000){setTimeout(b,500)}else{if(!g()){if(h){h.addClassName("hidden")}$$("ul.breaking-posts li.last")[0].removeClassName("hidden")}}};if(!a){return}setTimeout(b,500)})();if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.language!="undefined"&&typeof countryLangLookup!="undefined"){window.___gcfg={lang:countryLangLookup[BF_STATIC.language],}}if(!isIE8()){BF_UTIL.createScript({url:"https://apis.google.com/js/client:plusone.js?onload=GCallback"})}if(BF_STATIC.bf_test_mode&&BF_STATIC.bf_env=="dev"){(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://apis.google.com/js/client:plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}function GCallback(){EventManager.fire("gplus:api-loaded")}var BF_SignIn=function(){this.wrap;this.section;this.overlay;this.signin_page;this.social_register=false;this.email_updates=0;this.reg_name;this.email;this.fb_done=0;this.fb_edit;this.spin_el;this.modal_type;this.modal_mode;this.page_location;this.callbacks={onLogin:[],onRegister:[]};this.keydown_enabled=true;this.mousedown_enabled=true;this.close_enabled=true;this.mask_hidden=true;this.signup_test=false;this.opened=false;this.is_gplus=false;this.android_app_package="com.buzzfeed.android";this.html={section_wrapper:'<div class="signin_section" id="signin_modal" rel:gt_cat="'+BF_STATIC.tt_page+':Signin-Modal"><a href="javascript:;" onclick="signin.close()" class="signin_close" rel:gt_act="sign-in-close">&times;</a><div class="signin_content">#{content}</div></div>',section_content:{initial:'				<div class="signin_upper">					<div class="msg-text" id="initial-msg"></div>					<header id="initial_header">'+local.t("Sign in here!")+'</header>					<a href="javascript:;" onclick="signin.fb_login()" class="fb-button bf_dom" rel:gt_act="initial-fb-sign">						<div class="fb-icon">&nbsp;</div>						<div class="fb-label" id="initial_fb_text">'+local.t("Sign in with Facebook")+'</div>					</a>  					<a  class="bf-gplus-button bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin">  					<span id="g-signin-button"></span>  					<div class="gplus-icon">&nbsp;</div>					<div class="gplus-label" id="initial_gplus_text">'+local.t("Sign in with Google")+'</div>  					</a>				  </div>				<div class="signin_sep"></div>				<div class="signin_lower">					<span class="mid-text hide_for_non_english"> You can also:&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="email_signup" rel:gt_act="sign-up" id="signup-email">Sign up with email</a></span>					<span class="mid-text"> '+local.t("Have an account?")+'&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="signin" rel:gt_act="sign-in" id="signin-initial">'+local.t("Sign in")+'</a></span>				</div>				<div class="bottom-text">'+local.t("Sign up for BuzzFeed to react, comment, or publish your own ideas!")+"</div>			",signin:'				<div class="signin_upper">					<header>'+local.t("Sign In To BuzzFeed")+'</header>					<form id="login-form">						<input rel:gt_act="email-signin-input" id="login-username" class="bf_dom initial-field-state" type="text" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:clear_default_field blur:restore_default_field" defaultvalue="'+local.t("Username")+'" value="'+local.t("Username")+'">						<span id="reg_error_username" class="hidden"></span>						<input rel:gt_act="email-signin-input" id="login-password" class="bf_dom initial-field-state" type="password" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:clear_default_field blur:restore_default_field" rel:data="{clear_default_field:{set_type:\'password\'}}" 						       defaultvalue="'+local.t("Password")+'" value="'+local.t("Password")+'">						<button rel:gt_act="signin" onclick="signin.login(this)" id="login-submit" class="bf_dom button2 submit">'+local.t("Sign in")+'</button>					</form>					<a class="trouble_signin" rel:type_data="trouble_signin" onclick="signin.set_template(this)" rel:gt_act="trouble_signin" id="forgot-password-link">'+local.t("Trouble Signing In?")+'</a>				</div>				<div class="signin_sep"></div>				<div class="signin_lower">						<span class="mid-text hide_for_non_english"> You can also:&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="email_signup" rel:gt_act="also-signup">Sign Up With Email</a></span>						<a href="javascript:;" onclick="signin.fb_login()" class="fb-button-small" rel:gt_act="signin-fb"><div class="fb-icon">&nbsp;</div><div class="fb-label">'+local.t("Sign in with Facebook")+'</div></a>						<a  class="bf-gplus-button-small bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin" rel:gt_label="googleplus">	  					<span id="g-signin-button"></span>	  					<div class="gplus-icon">&nbsp;</div>						<div class="gplus-label" id="initial_gplus_text">'+local.t("Sign in with Google")+'</div>						</a>	  			</div>				<div class="bottom-text">'+local.t("Sign up for BuzzFeed to react, comment, or publish your own ideas!")+"</div>			",trouble_signin:'				<div class="signin_upper trouble_sign">					<header>'+local.t("Trouble Signing In?")+'</header>					<span class="mid-text">'+local.t("Enter the email address for your account and we'll send you your username and a link to reset your password.")+'</span>					<form id="forgot-password-form">						<input rel:gt_act="ignore" type="text" id="login-email" class="bf_dom initial-field-state" type="text" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:clear_default_field blur:restore_default_field" defaultvalue="'+local.t("Email address")+'" value="'+local.t("Email address")+'">						<span id="reg_error_email" class="hidden"></span>						<button onclick="signin.reset_password()" id="forgot-password-submit" type="submit" value="Reset Password" class="button2" >'+local.t("Reset Password")+'</button>					</form>					<a href="javascript:;" rel:type_data="signin" onclick="signin.set_template(this)" rel:gt_act="cancel-trouble-signin">'+local.t("Cancel")+'</a>				</div>				<div class="signin_lower"></div>			',trouble_signin_resp:'				<div class="signin_upper trouble_resp" id="request_pw_response">					<header>'+local.t("Trouble Signing In?")+'</header>					<div class="account_details">						<p id="password_text">'+local.t("OK, check your email - we've sent you a link to reset your password")+'</p>						<span class="green_check"></span>					</div>				</div>				<div class="signin_lower trouble_resp">					<a href="javascript:;" rel:type_data="signin" onclick="signin.set_template(this)" rel:gt_act="back-to-signin">'+local.t("Back to Sign in")+"</a>				</div>			",fb_signup:'				<div id="signup_form_wrap">					<div id="signup_complete">						<header id="custom-reg-message">'+local.t("Welcome to BuzzFeed!")+'</header>						<span class="mid-text">'+local.t("Here's your new BuzzFeed account:")+'</span>						<div class="account_details fb_account">							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="user-image_tooltip">								<p>'+local.t('You can change your profile picture on your <a href="/settings">settings page</a>')+'</p>								<span class="arrow_down">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_username_tooltip">								<p>'+local.t("Click the edit button to the right to modify your display name")+'</p>								<span class="arrow_down">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_url_tooltip">								<p>'+local.t("Click the edit button above to modify your custom buzzfeed URL")+'</p>								<span class="arrow_up">&nbsp;</span>							</div>							<a href="javascript:;" onclick="signin.fb_update(this)" class="edit_pencil" id="edit_update" rel:gt_act="edit-user-info">&nbsp;</a>							<a href="javascript:;" onclick="signin.cancel_fb_update(false, null, null)" class="edit_cancel hidden" id="cancel_update" rel:gt_act="cancel-edit-user-info">&nbsp;</a>							<span class="default_image"><img src="" id="user-image"/></span>							<span class="register_username" id="reg_username"></span>							<input rel:gt_act="ignore" type="text" id="update_display_name" class="hidden" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" 							       rel:actions="keyup:filter_chars focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" rel:gt_act="ignore">							<span id="reg_error_displayname" class="hidden"></span>							<div class="register_url" id="reg_url"><span style="float:left">http://buzzfeed.com/</span><span class="register_link" id="reg_link"></span><input rel:gt_act="ignore" type="text" id="update_user_name" class="hidden" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" rel:actions="keyup:filter_chars focus:clear_default_field change:map_into blur:restore_default_field" rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" rel:gt_act="ignore"></div>							<span id="reg_error_new_username" class="hidden new_user_error"></span>						</div>					</div>				</div>			',email_signup:'				<div id="signup_form_wrap">					<div class="signin_upper" >						<header>'+local.t("Sign up with email")+'</header>						<form id="registration-form">							<input id="register-username"  rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="text" value="'+local.t("Pick a Username")+'" 							       rel:actions="keyup:filter_chars focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" />							<span id="reg_error_username" class="hidden"></span>							<input id="register-password" rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="password" 							       value="'+local.t("Create a Password")+'" rel:actions="focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{clear_default_field:{set_type:\'password\'},map_into:{target:\'submit-button\',field:\'register.pw\'}}" autocomplete="off" />							<span id="reg_error_pw" class="hidden"></span>							<input id="register-email" rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="text" 							       value="'+local.t("Enter Your Email")+'" rel:actions="focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{map_into:{target:\'submit-button\',field:\'register.email\'}}" />							<span id="reg_error_email" class="hidden"></span>							<div class="bf_email_check">								<label for="email_signup"><input rel:gt_act="checkbox" type="checkbox" id="email_signup" checked="true"> '+local.t("Let me know when BuzzFeed launches cool stuff")+'</label>							</div>							<button id="register-button" class="bf_dom button2 submit" onclick="signin.register(this)" rel:gt_act="email-signup">'+local.t("Sign Up")+'</button>						</form>						<div class="signup_terms">'+local.t('By signing up for BuzzFeed, you agree to our <a href="http://www.buzzfeed.com/about/useragreement" target="_blank">Terms and Conditions</a>')+'</div>					</div>					<div class="signin_sep"></div>					<div class="signin_lower">						<span class="mid-text"> '+local.t("Have an account?")+'&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="signin" rel:gt_act="signin-screen">'+local.t("Sign in")+'</a></span>						<div class="signin_lower_social">							<a href="javascript:;" onclick="signin.fb_login()" class="fb-button-small" rel:gt_act="fb_signup"><div class="fb-icon">&nbsp;</div><div class="fb-label">'+local.t("Sign up with Facebook")+'</div></a>							<a  class="bf-gplus-button-small bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin" rel:gt_label="googleplus">		  					<span id="g-signin-button"></span>		  					<div class="gplus-icon">&nbsp;</div>							<div class="gplus-label" id="initial_gplus_text">'+local.t("Sign in with Google")+'</div>							</a>						</div>					</div>					<div class="bottom-text">'+local.t("Sign up for BuzzFeed to react, comment, or publish your own ideas!")+'</div>				</div>				<div class="hidden" id="signup_complete">					<header class="complete">'+local.t("Thanks!")+'</header>					<div class="message_wrapper">						<span class="mid-text email_confirm bold_signup">'+local.t("Go check your mail and click the confirmation link.")+'</span>						<span class="email_tooltip" id="show_tooltip">&nbsp;</span>					</div>					<div class="message_wrapper" id="msg_wrap">						<span class="mid-text email_confirm" id="action_msg"><span class="text">'+local.t("This will be your new BuzzFeed account:")+'</span></span>						<div class="hidden tooltip_content" id="tooltip_text">							<span class="arrow_up"></span>							<p>'+local.t("If you don't recieve the mail in a few minutes, please check your spam folder")+".</p>							<p>"+local.t('If the email doesn\'t arrive, go to the <a href="/signin"> sign in page</a> and click "forgot password" to resend the email.')+'</p>						</div>					</div>					<div class="account_details">						<div class="default_image" id="default_image_wrap">							<img src="" id="user-image"/>							<div class="tooltip_content fb_tooltip hidden" id="user-image_tooltip">								<p>'+local.t('You can change your profile picture on your <a href="/settings">settings page</a>')+'</p>								<span class="arrow_down">&nbsp;</span>							</div>						</div>						<span class="register_username" id="reg_username"></span>						<span class="register_link" id="reg_link"></span>					</div>				</div>			',ok_content:'			<div class="get_bf_email email_signup" id="reg_email_check">				<input type="checkbox" id="daily_email_signup" onchange="signin.test_email_signup(this)" rel:gt_act="newsletter-signup">				<div class="email_tag"><p id="email_msg">'+local.t("Get the")+'</p></div>				<div class="logo_text"><span class="bf_logo"></span> <span class="daily_text">'+local.t("DAILY EMAIL")+'</span></div>				<div class="email_signup_request hidden" id="email-request">Done!</div>			</div>			<div class="bf-buttons" id="bf-follow">				<a href="https://www.facebook.com/BuzzFeed"  alt="Like Us on Facebook" rel:gt_act="signup-bf-facebook"></a>				<a href="https://twitter.com/intent/user?screen_name=BuzzFeed" class="tw-follow" alt="Follow us on Twitter" rel:gt_act="signup-bf-twitter"></a>			</div>			<a href="javascript:;" onclick="signin.update_user_info(false)" class="button2 email ok_button" rel:gt_act="email-update-user-info">'+local.t("OK!")+"</a>			"}};this.init=function(){};this.keydown=function(ev){if(!signin.keydown_enabled){return false}if(ev.keyCode==Event.KEY_ESC){if(signin.modal_type=="initial"){signin.close()}}};this.mousedown=function(ev){if(!signin.mousedown_enabled){return false}if(ev.target.hasClassName("signin_overlay")&&signin.modal_type=="initial"){signin.close()}};this.open=function(e){try{if(signin.opened){return}if(typeof bf_rdio!="undefined"&&bf_rdio.hide){bf_rdio.hide()}signin.page_location=e.location;signin.modal_type=e.signin_type;if(e.reg_params){signin.reg_params=e.reg_params}if(e.mode){signin.modal_mode=e.mode}signin.signin_page=true;signin.overlay=new Element("div",{"class":"signin_overlay"});signin.wrap=new Element("div",{"class":"signin_wrapper"});if(isIE8()||isIE7()){signin.overlay.addClassName("signin_ie")}signin.overlay.setStyle({opacity:0});$$("body")[0].insert(signin.overlay);signin.overlay.insert(signin.wrap);signin.mask_hidden=false;BF_Effect.FadeIn(signin.overlay,1,0.1);signin.section=new Template(signin.html.section_wrapper);if(e.signin_type=="signin"){signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.initial}))}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content[e.signin_type]}))}setTimeout(function(){signin.set_input_events()},5);if(e.mode){signin.set_mode(e.mode,e.signin_type)}if(typeof e.keydown_enabled!="undefined"&&!e.keydown_enabled||e.keydown_disabled){signin.keydown_enabled=false}if(typeof e.mousedown_enabled!="undefined"&&!e.mousedown_enabled||e.mousedown_disabled){signin.mousedown_enabled=false}if(typeof e.close_enabled!="undefined"&&!e.close_enabled||e.close_disabled){signin.close_enabled=false}if(signin.signin_page){document.observe("click",signin.mousedown);document.observe("keydown",signin.keydown)}bf_login.loggedInCallbacks.push.apply(bf_login.loggedInCallbacks,signin.callbacks.onLogin);signin.opened=true;signin.append_gtrack();if(!isIE8()){$("gplus-signin-button").removeClassName("hidden");$("gplus-signin-button").observe("click",function(e){signin._gplus_render()})}gtrack.track_events(BF_STATIC.tt_page+":Signin-Modal","[nc]imp-signin-"+signin.page_location,gtrack.postEvents.toString(),"",true)}catch(e){console.error(e)}};this.set_signup_buttons=function(){$("signup_complete").insert(signin.html.section_content.ok_content);if(signin.social_register){$$(".ok_button")[0].setAttribute("onclick","signin.update_user_info(true)")}};this.test_email_signup=function(e,is_ie){if((e&&e.checked)||is_ie){signin.email_signup(signin.email,true)}};this.close=function(){document.stopObserving("keydown",signin.keydown);signin.mask_hidden=false;BF_Effect.FadeOut(signin.overlay,false,false,function(){signin.mask_hidden=true});setTimeout(function(){if(signin.callbacks.onLogin.length&&bf_login.loggedInCallbacks.length){var cbs=[];for(var i=0;i<bf_login.loggedInCallbacks.length;i++){var ifcb=false;for(var j=0;j<signin.callbacks.onLogin.length;j++){if(bf_login.loggedInCallbacks[i]==signin.callbacks.onLogin[j]){ifcb=true}}if(!ifcb){cbs.push(bf_login.loggedInCallbacks[i])}}bf_login.loggedInCallbacks=cbs}signin.callbacks.onLogin=[];signin.callbacks.onRegister=[];if(signin.wrap&&signin.wrap.parentNode){signin.wrap.remove()}if(signin.overlay&&signin.overlay.parentNode){signin.overlay.remove()}signin.opened=false},500)};this.set_template=function(e){setTimeout(function(){signin.set_input_events()},5);signin.modal_type=e.getAttribute("rel:type_data");signin.wrap.update(signin.section.evaluate({content:signin.html.section_content[signin.modal_type]}));if(signin.modal_type=="trouble_signin"){var forgot_password_form=$("forgot-password-form");if(forgot_password_form){if(!bf_login.initialized){forgot_password_form.observe("submit",function(event){event.stop()}.bind(this))}}}var reg_form=$("registration-form");if(reg_form){reg_form.observe("submit",function(event){event.stop()}.bind(this))}var login_form=signin.wrap.select("#login-form")[0];if(login_form){login_form.observe("submit",function(event){event.stop()}.bind(this))}var reset_form=signin.wrap.select("#forgot-password-form")[0];if(reset_form){reset_form.observe("submit",function(event){event.stop()}.bind(this))}signin.append_gtrack();if(signin.modal_type=="signin"||signin.modal_type=="email_signup"){if(!isIE8()){$("gplus-signin-button").removeClassName("hidden");$("gplus-signin-button").observe("click",function(e){signin._gplus_render()})}}};this.set_mode=function(mode,type){try{if(type=="initial"){if(mode=="signup"){$("initial_header").update(local.t("Sign up here!"));$("initial_fb_text").update(local.t("Sign up with Facebook"))}else{if(mode=="contribution"){try{$("reg_username_tooltip").hide();$("reg_url_tooltip").hide();$("edit_update").hide()}catch(e){}try{$("initial-msg").update(local.t("Thanks for your response."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your response was posted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}else{if(mode=="voting"){try{$("initial-msg").update(local.t("Thanks for your vote."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your vote was submitted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}else{if(mode=="badges"){try{$("initial-msg").update(local.t("Thanks for your reaction."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your reaction was posted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}else{if(mode=="submissions"){try{$("initial-msg").update(local.t("Thanks for your submission."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your photo was submitted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}}}}}}else{if(type=="email_signup"&&$$("#action_msg .text")[0]){if(mode=="contribution"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to post your comment.")}else{if(mode=="voting"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to submit your vote.")}else{if(mode=="badges"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to post your reaction.")}else{if(mode=="submissions"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to submit your photo.")}}}}}}}catch(e){console.error(e)}};this.login=function(e){signin.clear_errors();bf_login.login();signin.spinner();bf_login.loggedInCallbacks.push(function(){signin.close()})};this.fb_login=function(){facebook.FB_login();signin.spinner();bf_login.loggedInCallbacks.push(function(){if(!signin.social_register){signin.close()}})};this.reset_password=function(){signin.clear_errors();if($("forgot-password-submit")){$("forgot-password-submit").disabled=true}if(bf_login.already_sent){signin.register_errors("email",local.t("A request has already been sent for this email."))}else{signin.spinner();bf_login.reset_password()}};this.pw_response=function(resp){var obj=resp.responseText.evalJSON();if(obj.error){signin.register_errors("email",obj.error);bf_login.already_sent=false;$("forgot-password-submit").disabled=false}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.trouble_signin_resp}))}};this.register=function(e){try{if($("register-button")){$("register-button").disabled=true}signin.clear_errors();signin.spinner();var username=signin.wrap.select("#register-username")[0].value;if(username==local.t("Pick a Username")){username=""}var password=signin.wrap.select("#register-password")[0].value;if(password==local.t("Create a Password")){password=""}signin.email=signin.wrap.select("#register-email")[0].value;signin.email_updates=$F("email_signup")?1:0;var params={username:username,email:signin.email,pw:password,allow_email_updates:signin.email_updates,contribute:1,import_fb_profile:true};if(signin.reg_params){params.params=signin.reg_params}bf_register.new_register(params);bf_register.newRegisterCallbacks.push.apply(bf_register.newRegisterCallbacks,signin.callbacks.onRegister)}catch(err){console.log(err)}};this.register_settings=function(obj){try{if(obj){if(signin.social_register){var user_image=obj.image?BF_STATIC.image_root+obj.image:BF_STATIC.static_root+"/images/public/signin/default_pug.png";signin.fb_edit=0;signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.fb_signup}));signin.set_input_events();if($("reg_email_check")){$("reg_email_check").removeClassName("hidden")}if($("reg_username")){$("reg_username").update(obj.username)}if($("user-image")){$("user-image").src=user_image}if($("reg_link")){var link=obj.username;$("reg_link").update(link);signin.tooltip()}}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.email_signup}));$("signup_form_wrap").addClassName("hidden");if($("signup_complete")){$("signup_complete").removeClassName("hidden")}if($("reg_username")){$("reg_username").update(obj.username)}if($("reg_link")){var link="http://buzzfeed.com/"+obj.username;$("reg_link").update(link)}if($("user-image")){$("user-image").src=BF_STATIC.static_root+"/images/public/signin/default_pug.png"}signin.tooltip()}if(signin.modal_mode){signin.set_mode(signin.modal_mode,signin.modal_type)}}signin.set_signup_buttons()}catch(err){console.error(err)}};this.fb_update=function(e){signin.fb_edit=1;signin.reg_name=$("reg_username").innerHTML;$("reg_username").addClassName("hidden");$("reg_link").addClassName("hidden");$("update_display_name").value=signin.reg_name;if($("update_display_name")){$("update_display_name").removeClassName("hidden")}$("update_user_name").value=signin.reg_name;if($("update_user_name")){$("update_user_name").removeClassName("hidden")}$("edit_update").addClassName("hidden");if($("cancel_update")){$("cancel_update").removeClassName("hidden")}};this.update_user_info=function(is_fb){try{signin.clear_errors();signin.set_input_events();var new_errors=false;var email_signup=$("daily_email_signup").checked;if(is_fb){document.observe("do:reload",function(){this.mailready=false;this.updateready=false;return function(ev){this[ev.memo.what]=true;if(this.mailready&&this.updateready){window.location.reload()}}}())}if(email_signup){signin.email_signup(signin.email)}else{document.fire("do:reload",{what:"mailready"})}if(signin.social_register){var display=$F("update_display_name");var user=$F("update_user_name");if(signin.fb_done||!signin.fb_edit||(display==signin.reg_name&&user==signin.reg_name)){signin.close();document.fire("do:reload",{what:"updateready"})}else{var new_display=$F("update_display_name");var new_user=$F("update_user_name");if(!new_display){signin.register_errors("displayname",local.t("Your display name cannot be blank."));new_errors=true;$("update_display_name").addClassName("fb_errors")}if(new_user.length<3||new_user.length>30){signin.register_errors("new_username",local.t("please enter a username between 3 and 30 characters"));new_errors=true;$("update_user_name").addClassName("fb_errors")}if(!new_errors&&!signin.fb_done){var params={};params.action="update_username";if(new_display!=signin.reg_name){params.new_display_name=new_display}if(new_user!=signin.reg_name){params.new_username=new_user}new Ajax.Request("/buzzfeed/_edit_user",{method:"post",parameters:{action:"update_username",new_display_name:new_display,new_username:new_user},onSuccess:function(resp){var obj=eval("("+resp.responseText+")");if(!obj.success){signin.register_errors("new_username",obj.message);$("update_user_name").addClassName("fb_errors")}else{if(obj.success){if(obj.session_key){BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key})}bf_login.cookieLogin();signin.cancel_fb_update(true,new_user,new_display)}}},onFailure:function(resp){console.log(resp);document.fire("do:reload",{what:"updateready"})}})}}}else{if(!is_fb){signin.close();document.fire("do:reload",{what:"updateready"})}}}catch(e){console.log(e)}};this.cancel_fb_update=function(new_info,new_user,new_display){signin.clear_errors();if(new_info){if(new_user){$("reg_link").update(new_user)}if(new_display){$("reg_username").update(new_display)}if($("reg_username")){$("reg_username").removeClassName("hidden")}if($("reg_link")){$("reg_link").removeClassName("hidden")}$("cancel_update").remove();$("edit_update").remove();if($("update_display_name")){$("update_display_name").addClassName("hidden")}if($("update_user_name")){$("update_user_name").addClassName("hidden")}signin.fb_done=1;setTimeout(signin.close(),1000)}else{if($("reg_username")){$("reg_username").removeClassName("hidden")}if($("reg_link")){$("reg_link").removeClassName("hidden")}$("update_display_name").addClassName("hidden");if($("update_user_name")){$("update_user_name").addClassName("hidden")}if($("edit_update")){$("edit_update").removeClassName("hidden")}if($("cancel_update")){$("cancel_update").addClassName("hidden")}}};this.email_signup=function(email,from_test){if(email){new Ajax.Request("/buzzfeed/_email/",{method:"get",parameters:{email:email,category:"buzzfeed"},onSuccess:function(resp){document.fire("do:reload",{what:"mailready"});if(from_test){signin.email_signup_complete_ui()}},onFailure:function(resp){document.fire("do:reload",{what:"mailready"})}})}else{document.fire("do:reload",{what:"mailready"})}};this.email_signup_complete_ui=function(){if($("email-request")){$("email-request").removeClassName("hidden")}setTimeout(function(){BF_Effect.FadeOut($("reg_email_check"))},2000)};this.set_input_events=function(){$$("input").each(function(el){if(el.hasClassName("bf_dom")){var obj={bucket:"event_handler",element:$(el),data:{}};universal_dom.add_element_to_bucket(obj)}})};this.check_box_updates=function(e){if(!signin.signup_test){if(!e.checked){$("email_msg").update(local.t("Get BuzzFeed in your inbox!"))}else{if(e.checked){$("email_msg").update(local.t("You'll get your first email tomorrow!"))}}}};this.register_errors=function(type,msg){if(signin.modal_type=="email_signup"){if(type.match("duplicate")){type=type.split(" ")[1]}if(msg.match("URL")){msg=msg.replace("URL","username")}if(type=="pw"){signin.wrap.select("#register-password")[0].addClassName("errors")}else{signin.wrap.select("#register-"+type)[0].addClassName("errors")}}else{if(signin.modal_type=="signin"){signin.wrap.select("#login-username")[0].addClassName("errors");signin.wrap.select("#login-password")[0].addClassName("errors")}else{if(signin.modal_type=="trouble_signin"){signin.wrap.select("#login-email")[0].addClassName("errors");if(msg.match("No user found with email")){msg=msg.replace("No user found with email",local.t("No user found with email"))}}}}var err_el=$("reg_error_"+type);if(err_el){err_el.removeClassName("hidden");err_el.addClassName("errors");err_el.update(msg)}if($("register-button")){$("register-button").disabled=false}if(signin.spin_el){signin.spin_el.hide()}};this.clear_errors=function(){$$(".errors, .fb_errors").each(function(el){if(el.tagName=="INPUT"){if(el.hasClassName("errors")){el.removeClassName("errors")}else{if(el.hasClassName("fb_errors")){el.removeClassName("fb_errors")}}}else{if(el){el.addClassName("hidden");el.removeClassName("errors")}}})};this.spinner=function(){signin.spin_el=new Element("img",{"class":"signin_spinner"});signin.spin_el.src=BF_STATIC.static_root+"/images/public/spinners/big_on_eee.gif";signin.wrap.insert(signin.spin_el)};this.fb_dialog_cancel=function(){if(signin.spin_el){signin.spin_el.remove()}};this.tooltip=function(){if(local&&local.non_english){return false}if(!signin.social_register){if($("show_tooltip")){$("show_tooltip").observe("mouseenter",function(){if($("tooltip_text")){$("tooltip_text").removeClassName("hidden")}});$("msg_wrap").observe("mouseleave",function(){$("tooltip_text").addClassName("hidden")})}if($("default_image_wrap")){$("default_image_wrap").observe("mouseenter",function(){if($("user-image_tooltip")){$("user-image_tooltip").removeClassName("hidden")}});$("default_image_wrap").observe("mouseleave",function(){$("user-image_tooltip").addClassName("hidden")})}}else{if(signin.social_register){var tool_els=["user-image","reg_username","reg_url"];tool_els.each(function(el){if($(el)){$(el).observe("mouseenter",function(){if($(el+"_tooltip")){$(el+"_tooltip").removeClassName("hidden")}});$(el).observe("mouseleave",function(){if($(el+"_tooltip")){$(el+"_tooltip").addClassName("hidden")}})}})}}};this.append_gtrack=function(){signin.wrap.select("*").each(function(el){if(el.hasAttribute("rel:gt_act")){if(el.getAttribute("rel:gt_act").match("sign-in-close")&&signin.modal_type=="signin"){el.setAttribute("rel:gt_act","email-"+el.getAttribute("rel:gt_act")+"-"+signin.page_location)}else{if(el.getAttribute("rel:gt_act").match("sign-in-close")&&signin.modal_type=="email_signup"){el.setAttribute("rel:gt_act","sign-up-close-"+signin.page_location)}else{el.setAttribute("rel:gt_act",el.getAttribute("rel:gt_act")+"-"+signin.page_location)}}}})};this._gplus_render=function(){if(typeof(gapi)!=undefined&&typeof(gapi.auth)!=undefined){var additionalParams={clientid:BF_STATIC.google_plus_client_id,redirecturi:"postmessage",accesstype:"offline",cookiepolicy:"single_host_origin",callback:"gplusCallback",apppackagename:"com.buzzfeed.android"};gapi.auth.signIn(additionalParams)}}};var signin=new BF_SignIn();BuzzLoader.register(signin.init,1);var BFPinterestReferer=function(){this.COOKIE="bf_referer";this.PROMO_INDEX=5;this.pinit_ps={};this.init=function(){var b=readCookie(bf_pinterest_referer.COOKIE);if(b!=null||BF_STATIC.tt_page=="DIY"||BF_STATIC.tt_page=="Food"||BF_STATIC.tt_page=="Style"){bf_pinterest_referer._init()}else{if(BF_STATIC.tt_page=="Buzz"&&BF_STATIC.vertical&&(BF_STATIC.vertical.toLowerCase()=="diy"||BF_STATIC.vertical.toLowerCase()=="food")){bf_pinterest_referer._init()}else{if((document.referrer||"").match(/pinterest.com/)||(location.search||"").match(/\?referer=pinterest.com/)||(document.referrer||"").match(/blog.pinterest.com/)||(location.search||"").match(/\?referer=blog.pinterest.com/)){var a=1/24/2;createCookie(bf_pinterest_referer.COOKIE,"pinterest.com",a);bf_pinterest_referer._init()}}}};this._init=function(){if(typeof universal_dom=="undefined"){setTimeout(bf_pinterest_referer.init,250)}else{bf_pinterest_referer.setup_observers();bf_pinterest_referer.show_pinterest_embed();bf_pinterest_referer.show_more();universal_dom.get_bucket_elements("pinterest_plugin").each(function(c){c.removeClassName("hidden")});if(!bf_pinterest_referer.matchReferer&&$$(".pinterestunit").length){var a=$$(".pinterestunit").first();if(a.hasClassName("hotonpinterest")&&!this.matchReferer){var b=$("permalink_buzz_stats");b.parentNode.insertBefore(a,b)}else{a.addClassName("hidden")}}}};this.setup_observers=function(){universal_dom.assign_handler({bucket:"more-pinterest-promos",event:"click",handler:bf_pinterest_referer.show_more});universal_dom.assign_handler({bucket:"pinit_promo",event:"mouseover",handler:bf_pinterest_referer.show_pinit_link});universal_dom.assign_handler({bucket:"pinit_link",event:"mouseover",handler:bf_pinterest_referer.show_pinit_link});universal_dom.assign_handler({bucket:"pinit_promo",event:"mouseout",handler:bf_pinterest_referer.hide_pinit_link})};this.show_pinit_link=function(a){universal_dom.get_bucket_elements_with_data("pinit_link",{uri:a.uri}).each(function(b){b.removeClassName("hidden")})};this.hide_pinit_link=function(a){universal_dom.get_bucket_elements_with_data("pinit_link",{uri:a.uri}).each(function(b){b.addClassName("hidden")})};this.show_more=function(c){var b=typeof bf_pinterest_referer._revealed=="undefined"?0:bf_pinterest_referer._revealed;var a=(BF_STATIC.tt_page=="DIY"||BF_STATIC.tt_page=="Food")?4:3;if(b==3||b==4){a=12}if(b==12){a=21}bf_pinterest_referer.reveal_promos(a);if(a==21){universal_dom.get_bucket_elements("more-pinterest-promos").each(function(f){f.addClassName("hidden")})}};this.reveal_promos=function(b){bf_pinterest_referer._revealed=b;var f=[],a=bf_pinterest_referer._get_shuffled_promos(),c=function(k){for(var g in a){for(var h=0;h<b&&h<a[g].length;h++){k.call(null,a[g][h])}}};c(function(g){var h;if(g.tagName.toLowerCase()=="div"){g.removeClassName("hidden");return}h=g.select(".pin-button-link");if(h.length){g.removeClassName("hidden");h.first().setAttribute("data-pin-do","buttonPin")}else{g.select(".pin-button a").each(function(k){if(k.getAttribute("data-pin-log")=="button_pinit"){f.push(k)}k.remove()})}});bf_pinterest_referer._loadPinterestScript(function(){if(!f.length){return}c(function(h){var g=h.select(".pin-button");if(!g.length){return}g.first().insert(f.shift())})})};this._get_shuffled_promos=function(){if(typeof bf_pinterest_referer._shuffled_promos=="undefined"){bf_pinterest_referer._shuffled_promos={};var a=["pinterest_promo"];a.each(function(h){var g=universal_dom.get_bucket_elements(h);g=g.slice(0,g.length);for(var f=0;f<g.length;f++){var c=Math.floor(Math.random()*g.length);var b=g[c];g[c]=g[f];g[f]=b}universal_dom.get_bucket_elements_with_data(h,{widget:true}).each(function(k){g.splice(g.indexOf(k),1);g.splice(bf_pinterest_referer.PROMO_INDEX,0,k)});bf_pinterest_referer._shuffled_promos[h]=g;bf_pinterest_referer._reorder_promos_on_page(h)})}return bf_pinterest_referer._shuffled_promos};this._reorder_promos_on_page=function(b){var a=bf_pinterest_referer._get_shuffled_promos();var c=null;var f=function(g){c=g.parentNode;c.update("")};a[b].each(function(g){if(!c){f(g)}c.appendChild(g)});universal_dom.update(c)};this._loadPinterestScript=function(f){if(!BF_STATIC.bf_test_mode){var a,b,c=document;b=c.createElement("SCRIPT");b.type="text/javascript";b.async=true;if(f){$(b).on("load",f)}b.src="//assets.pinterest.com/js/pinit.js";a=c.getElementsByTagName("SCRIPT")[0];a.parentNode.insertBefore(b,a)}else{console.info("disable Dynamically load assets.pinterest.com/js/pinit.js for test mode")}},this.show_pinterest_embed=function(){(function(b){var a=function(h){if(h==16){console.warn("Nothing returned from pinterest")}else{var g=0;var c=bf_pinterest_referer._get_shuffled_promos();for(var f in c){universal_dom.get_bucket_elements_with_data(f,{widget:true}).each(function(k){if(k.getElementsByTagName("SPAN").length>0){g++;try{if(k.next().className.indexOf("hidden")!=-1){k.addClassName("hidden")}}catch(l){console.warn("Error in DOM")}k.removeClassName("hide-buzz_holder")}})}if(g<2){setTimeout(function(){a(++h)},250)}}};a(0)}(document))}};bf_pinterest_referer=new BFPinterestReferer();var BF_Vertical=function(){this.init=function(){if(BF_STATIC.tt_page=="Community"){vertical.community_notice_toggle()}if($$(".twitter-widget").length>0){vertical.track_tweets_title_sidebar_clicks()}universal_dom.assign_handler({bucket:"close_community_note",event:"click",handler:vertical.remove_community_notice});universal_dom.assign_handler({bucket:"community_signin_post",event:"click",handler:vertical.community_signin_post})};this.track_tweets_title_sidebar_clicks=function(){new PeriodicalExecuter(function(a){if($$(".twitter-widget iframe.twitter-timeline").length>0&&typeof gtrack!=="undefined"){var c=$$("iframe.twitter-timeline")[0].contentDocument||$$("iframe.twitter-timeline")[0].contentWindow.document;if(typeof c.getElementsByTagName("h1")[0]!=="undefined"&&typeof c.getElementsByTagName("h1")[0].getElementsByTagName("a")[0]!=="undefined"){var b=c.getElementsByTagName("h1")[0].getElementsByTagName("a")[0];var f=typeof(new BF_User()).getUserInfo().username!=="undefined"?(new BF_User()).getUserInfo().username:"not_logged_in";if(typeof b==="undefined"){return}Event.observe(b,"click",function(){gtrack.track_events(BF_STATIC.tt_page+":sidebar/tweets","link","twitter/"+f)});a.stop()}}},0.5)};this.community_notice_toggle=function(b){try{if($("community_all_note")){var a=localStorage.getItem("community_notice");if(a==null){$("community_all_note").removeClassName("hidden")}else{if(a){$("community_all_note").addClassName("hidden")}}}}catch(b){console.log(b)}};this.remove_community_notice=function(a){if($("community_all_note")){$("community_all_note").addClassName("hidden")}localStorage.setItem("community_notice",true)};this.community_signin_post=function(b){b.stop();var a=new BF_User();if(a.isLoggedIn()){document.location.href=BF_STATIC.web_root+"/post"}else{b.signin_type="initial";b.location="community";signin.callbacks.onLogin.push(function(){document.location.href=BF_STATIC.web_root+"/post"});signin.open(b)}}};var vertical=new BF_Vertical();BuzzLoader.register(vertical.init,1);if(!window.AJAX_TEST_STATUS){window.AJAX_TEST_STATUS={}}var qq=qq||{};qq.extend=function(b,a){for(var c in a){b[c]=a[c]}};qq.indexOf=function(b,c,f){if(b.indexOf){return b.indexOf(c,f)}f=f||0;var a=b.length;if(f<0){f+=a}for(;f<a;f++){if(f in b&&b[f]===c){return f}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.insertBefore=function(f,c){c.parentNode.insertBefore(f,c)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(b,a){if(b==a){return true}if(b.contains){return b.contains(a)}else{return !!(a.compareDocumentPosition(b)&8)}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.css=function(a,b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b)};qq.hasClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");return c.test(b.className)};qq.addClass=function(b,a){if(!qq.hasClass(b,a)){b.className+=" "+a}};qq.removeClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");b.className=b.className.replace(c," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,b){a.innerText=b;a.textContent=b};qq.children=function(b){var a=[],c=b.firstChild;while(c){if(c.nodeType==1){a.push(c)}c=c.nextSibling}return a};qq.getByClass=function(f,g){if(f.querySelectorAll){return f.querySelectorAll("."+g)}var b=[];var h=f.getElementsByTagName("*");var a=h.length;for(var c=0;c<a;c++){if(qq.hasClass(h[c],g)){b.push(h[c])}}return b};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.obj2url=function(h,b,l){var k=[],f="&",g=function(n,m){var o=b?(/\[\]$/.test(b))?b:b+"["+m+"]":m;if((o!="undefined")&&(m!="undefined")){k.push((typeof n==="object")?qq.obj2url(n,o,true):(Object.prototype.toString.call(n)==="[object Function]")?encodeURIComponent(o)+"="+encodeURIComponent(n()):encodeURIComponent(o)+"="+encodeURIComponent(n))}};if(!l&&b){f=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";k.push(b);k.push(qq.obj2url(h))}else{if((Object.prototype.toString.call(h)==="[object Array]")&&(typeof h!="undefined")){for(var c=0,a=h.length;c<a;++c){g(h[c],c)}}else{if((typeof h!="undefined")&&(h!==null)&&(typeof h==="object")){for(var c in h){g(h[c],c)}}else{k.push(encodeURIComponent(b)+"="+encodeURIComponent(h))}}}return k.join(f).replace(/^&/,"").replace(/%20/g,"+")};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.isFunction=function(a){return typeof(a)==="function"};qq.each=function(c,f){var a,b;if(c){for(a in c){if(Object.prototype.hasOwnProperty.call(c,a)){b=f(a,c[a]);if(b===false){break}}}}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(f,g){f=a?a+"["+f+"]":f;if(qq.isObject(g)){qq.obj2FormData(g,b,f)}else{if(qq.isFunction(g)){b.append(f,g())}else{b.append(f,g)}}});return b};qq.obj2Inputs=function(c,b){var a;if(!b){b=document.createElement("form")}qq.obj2FormData(c,{append:function(f,g){a=document.createElement("input");a.setAttribute("name",f);a.setAttribute("value",g);b.appendChild(a)}});return b};var qq=qq||{};qq.FileUploaderBasic=function(b){var a=this;this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,autoUpload:true,sendAsForm:false,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(f,c){},onProgress:function(h,g,c,f){},onComplete:function(g,f,c){},onCancel:function(f,c){},onValidate:function(c,f){},onError:function(g,f,c){},urlHandler:false,messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled.",noFiles:"Only files on your computer can be uploaded."},showMessage:function(c){alert(c)}};qq.extend(this._options,b);this._filesInProgress=0;this._storedFiles=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(var a=0;a<this._storedFiles.length;a++){var b=this._getItemByFileId(this._storedFiles[a]);this._find(b,"spinner").style.display="";this._filesInProgress++;this._handler.upload(this._storedFiles[a],this._options.params)}},clearStoredFiles:function(){this._storedFiles=[];this._options.listElement.innerHTML=""},_createUploadButton:function(b){var a=this;return new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(c){a._onInputChange(c);a._createUploadButton(b)}})},_createUploadHandler:function(){var a=this,c;if(qq.UploadHandlerXhr.isSupported()){c="UploadHandlerXhr"}else{c="UploadHandlerForm"}var b=new qq[c]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(k,h,f,g){a._onProgress(k,h,f,g);a._options.onProgress(k,h,f,g)},onComplete:function(h,g,f){a._onComplete(h,g,f);a._options.onComplete(h,g,f)},onCancel:function(g,f){a._onCancel(g,f);a._options.onCancel(g,f)}});return b},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){this._filesInProgress++},_onProgress:function(f,c,a,b){},_onComplete:function(c,b,a){this._filesInProgress--;if(a.error){this._options.showMessage(a.error)}},_onCancel:function(b,a){this._filesInProgress--},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_uploadFileList:function(f){var c,b;c=this._getValidationDescriptors(f);if(c.length>1){b=this._options.onValidate(c,true)===false}if(!b){if(typeof f=="undefined"||f.length<1){this._error("noFiles","empty");return false}for(var a=0;a<f.length;a++){if(!this._validateFile(f[a])){return}}for(var a=0;a<f.length;a++){this._uploadFile(f[a])}}},_uploadFile:function(a){var f=this._handler.add(a);var c=this._handler.getName(f);if(this._options.onSubmit(f,c,a)!==false){this._handler._options.action=this._options.action;this._handler._options.sendAsForm=this._options.sendAsForm;this._onSubmit(f,c);if(this._options.autoUpload){this._handler.upload(f,this._options.params)}else{this._filesInProgress--;var b=this._getItemByFileId(f);this._find(b,"spinner").style.display="none";this._storedFiles.push(f)}}},_validateFile:function(f){var a,b,c;a=this._getValidationDescriptor(f);if(this._options.onValidate(a,false)===false){return false}if(f.value){b=f.value.replace(/.*(\/|\\)/,"")}else{b=f.fileName!=null?f.fileName:f.name;c=f.fileSize!=null?f.fileSize:f.size}if(!this._isAllowedExtension(b)){this._error("typeError",b);return false}else{if(c===0){this._error("emptyError",b);return false}else{if(c&&this._options.sizeLimit&&c>this._options.sizeLimit){this._error("sizeError",b);return false}else{if(c&&c<this._options.minSizeLimit){this._error("minSizeError",b);return false}}}}return true},_error:function(c,f){var b=this._options.messages[c];function a(g,h){b=b.replace(g,h)}a("{file}",this._formatFileName(f));a("{extensions}",this._options.allowedExtensions.join(", "));a("{sizeLimit}",this._formatSize(this._options.sizeLimit));a("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.onError(null,f,b);this._options.showMessage(b);if(this._options.onError(b,f)!==false){this._options.onError(b,f)}},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(f){var b=(-1!==f.indexOf("."))?f.replace(/.*[.]/,"").toLowerCase():"";var c=this._options.allowedExtensions;if(!c.length){return true}for(var a=0;a<c.length;a++){if(c[a].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},_parseFileName:function(b){var a;if(b.value){a=b.value.replace(/.*(\/|\\)/,"")}else{a=(b.fileName!==null&&b.fileName!==undefined)?b.fileName:b.name}return a},_parseFileSize:function(b){var a;if(!b.value){a=(b.fileSize!==null&&b.fileSize!==undefined)?b.fileSize:b.size}return a},_getValidationDescriptor:function(f){var b,c,a;a={};b=this._parseFileName(f);c=this._parseFileSize(f);a.name=b;if(c){a.size=c}return a},_getValidationDescriptors:function(b){var a,c;c=[];for(a=0;a<b.length;a++){c.push(b[a])}return c}};qq.FileUploader=function(b){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,dropElement:null,listElement:null,skipDropElement:false,skipUploadElement:false,template:'<div class="qq-uploader"><div class="qq-upload-drop-area" style="display:none"><span>Drop files here to upload</span></div><div type="button" class="qq-upload-button button2 small">Upload Image</div><ul class="qq-upload-list" style="display:none;"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"},additionalUploadIds:false});qq.extend(this._options,b);this._element=this._options.element;if(!this._options.skipDropTemplate){this._dropElement=this._options.dropElement?this._options.dropElement:this._options.element}if(!this._options.skipUploadTemplate){this._element.innerHTML=this._options.template;this._button=this._createUploadButton(this._find(this._element,"button"));if(this._options.additionalUploadIds){for(var a=0;a<this._options.additionalUploadIds.length;a++){this._createUploadButton($(this._options.additionalUploadIds[a]))}}}this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._bindCancelEvent();if(!this._options.skipDropTemplate){this._setupDragDrop()}};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(c,b){var a=qq.getByClass(c,this._options.classes[b])[0];if(!a){throw new Error("element not found "+b)}return a},_setupDragDrop:function(){var b=this,c=this._find(this._dropElement,"drop");var a=new qq.UploadDropZone({element:c,onEnter:function(f){qq.addClass(c,b._classes.dropActive);f.stopPropagation()},onLeave:function(f){f.stopPropagation()},onLeaveNotDescendants:function(f){qq.removeClass(c,b._classes.dropActive)},onDrop:function(k){gtrack.track_events("[ttp]:sidebar/minisuper","drag-n-drop","");var h=qq.getByClass(document,b._options.classes.drop);for(var g=0;g<h.length;g++){if(h[g]){qq.removeClass(h[g],b._classes.dropActive);h[g].style.display="none";$$("body")[0].removeClassName("qq-dragging")}}if(b._options.urlHandler&&k.dataTransfer.files.length==0){if(k.dataTransfer.types.indexOf&&-1!=k.dataTransfer.types.indexOf("text/uri-list")||k.dataTransfer.types.contains&&-1!=k.dataTransfer.types.contains("text/uri-list")){var f=k.dataTransfer.getData("text/uri-list");return b._options.urlHandler(k,f)}}b._uploadFileList(k.dataTransfer.files)}});c.style.display="none";c.hide_fn=function(){this.style.display="none";$$("body")[0].removeClassName("qq-dragging")}.bind(c);qq.attach(document,"dragenter",function(f){$$("body")[0].addClassName("qq-dragging");if(!a._isValidFileDrag(f)||c.className.match(/disabled/)){return}c.style.display="block"});qq.attach(document,"dragleave",function(g){var f=document.elementFromPoint(g.clientX,g.clientY);if(!f||f.nodeName=="HTML"||f.nodeName=="BODY"){c.hide_fn()}})},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(a,c,f,h){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var l=this._getItemByFileId(a);if(!l){var g=a;var b=0;while(!l){g++;b++;if(b>50){break}l=this._getItemByFileId(g)}}var m=this._find(l,"size");m.style.display="inline";var k;if(f!=h){k=Math.round(f/h*100)+"% from "+this._formatSize(h)}else{k=this._formatSize(h)}qq.setText(m,k)},_onComplete:function(h,g,a){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this._getItemByFileId(h);if(!c){var b=h;var f=0;while(!c){b++;f++;if(f>50){break}c=this._getItemByFileId(b)}}qq.remove(this._find(c,"cancel"));qq.remove(this._find(c,"spinner"));if(a.success){qq.addClass(c,this._classes.success)}else{qq.addClass(c,this._classes.fail)}},_addToList:function(f,c){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=f;var b=this._find(a,"file");qq.setText(b,this._formatFileName(c));this._find(a,"size").style.display="none";this._listElement.appendChild(a)},_getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;if(b){qq.attach(b,"click",function(g){g=g||window.event;var f=g.target||g.srcElement;if(qq.hasClass(f,a._classes.cancel)){qq.preventDefault(g);var c=f.parentNode;a._handler.cancel(c.qqFileId);qq.remove(c)}})}}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(c){if(!a._isValidFileDrag(c)){return}var b=c.dataTransfer.effectAllowed;if(b=="move"||b=="linkMove"){c.dataTransfer.dropEffect="move"}else{c.dataTransfer.dropEffect="copy"}c.stopPropagation();c.preventDefault()});qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});qq.attach(a._element,"dragleave",function(c){if(!a._isValidFileDrag(c)){return}a._options.onLeave(c);var b=document.elementFromPoint(c.clientX,c.clientY);if(qq.contains(this,b)){return}a._options.onLeaveNotDescendants(c)});qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(c){if(qq.ie()&&!qq.ie10()){return false}var b=c.dataTransfer,a=navigator.userAgent.indexOf("AppleWebKit")>-1;return b&&b.effectAllowed!="none"&&(b.files||(!a&&b.types&&b.types.contains&&b.types.contains("Files")))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var c=$(this._element).down("input[type=file]");if(c){return c}var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}b.setAttribute("type","file");b.setAttribute("name",this._options.name);qq.css(b,{position:"absolute",right:0,top:0,fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0,width:"100%",height:"100%"});b.addClassName("file_mask");this._element.appendChild(b);var a=this;qq.attach(b,"change",function(){a._options.onChange(b)});qq.attach(b,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});qq.attach(b,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});qq.attach(b,"focus",function(){qq.addClass(a._element,a._options.focusClass)});qq.attach(b,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(g,f,b,c){},onComplete:function(f,c,b){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(f,b){var a=this._queue.push(f);var c={};qq.extend(c,b);this._params[f]=c;if(a<=this._options.maxConnections){this._upload(f,this._params[f])}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(f){var b=qq.indexOf(this._queue,f);this._queue.splice(b,1);var a=this._options.maxConnections;if(this._queue.length>=a&&b<a){var c=this._queue[a-1];this._upload(c,this._params[c])}}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","image");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a)}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(b){this._options.onCancel(b,this.getName(b));delete this._inputs[b];var a=document.getElementById(b);if(a){a.setAttribute("src","javascript:false;");qq.remove(a)}},_upload:function(k,g){var b=this._inputs[k];if(!b){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var h=this.getName(k);var c=this._createIframe(k);var f=this._createForm(c,g);f.appendChild(b);var a=this;this._attachLoadEvent(c,function(){a.log("iframe loaded");var l=a._getIframeContentJSON(c);a._options.onComplete(k,h,l);a._dequeue(k);delete a._inputs[k];setTimeout(function(){qq.remove(c)},1)});f.submit();qq.remove(f);return k},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){if(!a.parentNode){return}try{if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false"){return}}catch(c){}b()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}}catch(e){response={success:false}}return response},_createIframe:function(b){var a=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');a.setAttribute("id",b);a.style.display="none";document.body.appendChild(a);return a},_createForm:function(a,c){var b=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');qq.obj2Inputs(c,b);b.setAttribute("action",this._options.action);b.setAttribute("target",a.name);b.style.display="none";document.body.appendChild(b);return b}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){try{var a=document.createElement("input");a.type="file";var c=false;var b=navigator.userAgent.toLowerCase();if(b.indexOf("safari")!=-1){c=true;if(b.indexOf("chrome")>-1){c=false}}var g=(typeof FileReader!="undefined"&&typeof(new FileReader()).readAsBinaryString=="undefined");return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined"&&typeof FileReader!="undefined"&&typeof window.WebKitBlobBuilder=="undefined"&&!c&&!g)}catch(f){console.error(f);return false}};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(c,h){var g=this._files[c],b=this.getName(c),o=this.getSize(c);this._loaded[c]=0;var m=this._xhrs[c]=new XMLHttpRequest();var n=this;m.upload.onprogress=function(p){if(p.lengthComputable){n._loaded[c]=p.loaded;n._options.onProgress(c,b,p.loaded,p.total)}};m.onreadystatechange=function(){if(m.readyState==4){n._onComplete(c,m)}};h=h||{};var a=qq.obj2url(h,this._options.action);m.open("POST",a,true);if(this._options.sendAsForm){try{if(typeof XMLHttpRequest.prototype.sendAsBinary=="undefined"){XMLHttpRequest.prototype.sendAsBinary=function(s){var r=new ArrayBuffer(s.length);var p=new Uint8Array(r,0);for(var q=0;q<s.length;q++){p[q]=(s.charCodeAt(q)&255)}this.send(p)}}}catch(l){console.error(l)}var f="---------------------------";f+=Math.floor(Math.random()*32768);f+=Math.floor(Math.random()*32768);f+=Math.floor(Math.random()*32768);var k=new FileReader();k.readAsBinaryString(g);k.onload=function(q){h.Filedata=k.result;h.Filename=encodeURIComponent(g.name);var p="";$H(h).each(function(r){if(p!=""){p+="\r\n"}p+="--"+f+'\r\nContent-Disposition: form-data; charset: utf-8; accept-charset: utf-8; name="'+r.key+'"';if(r.key=="Filedata"){p+='; filename="'+encodeURIComponent(g.name)+'"\r\nContent-Type: application/octet-stream'}p+="\r\n\r\n"+r.value});p+="\r\n";p+="--"+f+"--\r\n";m.setRequestHeader("Content-Type","multipart/form-data; charset: utf-8; accept-charset: utf-8; boundary="+f);m.sendAsBinary(p)}}else{m.setRequestHeader("X-Requested-With","XMLHttpRequest");m.setRequestHeader("X-File-Name",encodeURIComponent(b));m.setRequestHeader("Content-Type","application/octet-stream");m.send(g)}},_onComplete:function(id,xhr){if(!this._files[id]){return}var xhr_request=this._xhrs[id];if(BF_STATIC.bf_env==="dev"){if(!window.AJAX_TEST_STATUS[this._options.action]){window.AJAX_TEST_STATUS[this._options.action]=new RequestStack()}var req={xhr_request:xhr_request};req.status=xhr.status;window.AJAX_TEST_STATUS[this._options.action].push(req)}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else{this._options.onComplete(id,name,{})}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});var CropDraggable=Class.create(Draggable,{initialize:function(b){try{this.options=Object.extend({drawMethod:function(){}},arguments[1]||{});this.element=$(b);this.handle=this.element;this.delta=this.currentDelta();this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)}catch(c){console.error(c)}},draw:function(g){var h=Element.cumulativeOffset(this.element),k=this.currentDelta();h[0]-=k[0];h[1]-=k[1];var f=[0,1].map(function(a){return(g[a]-h[a]-this.offset[a])}.bind(this));this.options.drawMethod(f)}});var Cropper={};Cropper.Img=Class.create({initialize:function(k,g){this.options=Object.extend({ratioDim:{x:0,y:0},minWidth:0,minHeight:0,displayOnInit:false,onEndCrop:Prototype.emptyFunction,captureKeys:true,onloadCoords:null,maxWidth:0,maxHeight:0,autoIncludeCSS:true},g||{});this.img=$(k);this.clickCoords={x:0,y:0};this.dragging=false;this.resizing=false;this.isWebKit=/Konqueror|Safari|KHTML/.test(navigator.userAgent);this.isIE=/MSIE/.test(navigator.userAgent);this.isOpera8=/Opera\s[1-8]/.test(navigator.userAgent);this.ratioX=0;this.ratioY=0;this.attached=false;this.fixedWidth=(this.options.maxWidth>0&&(this.options.minWidth>=this.options.maxWidth));this.fixedHeight=(this.options.maxHeight>0&&(this.options.minHeight>=this.options.maxHeight));if(typeof this.img=="undefined"){return}if(this.options.autoIncludeCSS){var h=document.createElement("link");h.rel="stylesheet";h.type="text/css";h.href=BF_STATIC.static_root+"/css/cropper.css";h.media="screen";document.getElementsByTagName("head")[0].appendChild(h)}if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){var f=this.getGCD(this.options.ratioDim.x,this.options.ratioDim.y);this.ratioX=this.options.ratioDim.x/f;this.ratioY=this.options.ratioDim.y/f}this.subInitialize();if(this.img.complete||this.isWebKit){this.onLoad()}else{Event.observe(this.img,"load",this.onLoad.bindAsEventListener(this))}},getGCD:function(a,b){if(b===0){return a}return this.getGCD(b,a%b)},onLoad:function(){var l="imgCrop_";var h=this.img.parentNode;var f="";if(this.isOpera8){f=" opera8"}this.imgWrap=new Element("div",{"class":l+"wrap"+f});this.north=new Element("div",{"class":l+"overlay "+l+"north"}).insert(new Element("span"));this.east=new Element("div",{"class":l+"overlay "+l+"east"}).insert(new Element("span"));this.south=new Element("div",{"class":l+"overlay "+l+"south"}).insert(new Element("span"));this.west=new Element("div",{"class":l+"overlay "+l+"west"}).insert(new Element("span"));var k=[this.north,this.east,this.south,this.west];this.dragArea=new Element("div",{"class":l+"dragArea"});k.each(function(a){this.dragArea.insert(a)},this);this.handleN=new Element("div",{"class":l+"handle "+l+"handleN"});this.handleNE=new Element("div",{"class":l+"handle "+l+"handleNE"});this.handleE=new Element("div",{"class":l+"handle "+l+"handleE"});this.handleSE=new Element("div",{"class":l+"handle "+l+"handleSE"});this.handleS=new Element("div",{"class":l+"handle "+l+"handleS"});this.handleSW=new Element("div",{"class":l+"handle "+l+"handleSW"});this.handleW=new Element("div",{"class":l+"handle "+l+"handleW"});this.handleNW=new Element("div",{"class":l+"handle "+l+"handleNW"});this.selArea=new Element("div",{"class":l+"selArea"});[new Element("div",{"class":l+"marqueeHoriz "+l+"marqueeNorth"}).insert(new Element("span")),new Element("div",{"class":l+"marqueeVert "+l+"marqueeEast"}).insert(new Element("span")),new Element("div",{"class":l+"marqueeHoriz "+l+"marqueeSouth"}).insert(new Element("span")),new Element("div",{"class":l+"marqueeVert "+l+"marqueeWest"}).insert(new Element("span")),this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW,new Element("div",{"class":l+"clickArea"})].each(function(a){this.selArea.insert(a)},this);this.imgWrap.appendChild(this.img);this.imgWrap.appendChild(this.dragArea);this.dragArea.appendChild(this.selArea);this.dragArea.appendChild(new Element("div",{"class":l+"clickArea"}));h.appendChild(this.imgWrap);this.startDragBind=this.startDrag.bindAsEventListener(this);Event.observe(this.dragArea,"mousedown",this.startDragBind);this.onDragBind=this.onDrag.bindAsEventListener(this);Event.observe(document,"mousemove",this.onDragBind);this.endCropBind=this.endCrop.bindAsEventListener(this);Event.observe(document,"mouseup",this.endCropBind);this.resizeBind=this.startResize.bindAsEventListener(this);this.handles=[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW];this.registerHandles(true);if(this.options.captureKeys){this.keysBind=this.handleKeys.bindAsEventListener(this);Event.observe(document,"keypress",this.keysBind)}var g=new CropDraggable(this.selArea,{drawMethod:this.moveArea.bindAsEventListener(this)});this.setParams()},registerHandles:function(h){for(var o=0;o<this.handles.length;o++){var l=$(this.handles[o]);if(h){var k=false;if(this.fixedWidth&&this.fixedHeight){k=true}else{if(this.fixedWidth||this.fixedHeight){var p=l.className.match(/([S|N][E|W])$/),m=l.className.match(/(E|W)$/),n=l.className.match(/(N|S)$/);if(p||(this.fixedWidth&&m)||(this.fixedHeight&&n)){k=true}}}if(k){l.hide()}else{Event.observe(l,"mousedown",this.resizeBind)}}else{l.show();Event.stopObserving(l,"mousedown",this.resizeBind)}}},setParams:function(){this.imgW=this.img.width;this.imgH=this.img.height;$(this.north).setStyle({height:0});$(this.east).setStyle({width:0,height:0});$(this.south).setStyle({height:0});$(this.west).setStyle({width:0,height:0});$(this.imgWrap).setStyle({width:this.imgW+"px",height:this.imgH+"px"});$(this.selArea).hide();var c={x1:0,y1:0,x2:0,y2:0},f=false;if(this.options.onloadCoords!==null){c=this.cloneCoords(this.options.onloadCoords);f=true}else{if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){c.x1=Math.ceil((this.imgW-this.options.ratioDim.x)/2);c.y1=Math.ceil((this.imgH-this.options.ratioDim.y)/2);c.x2=c.x1+this.options.ratioDim.x;c.y2=c.y1+this.options.ratioDim.y;f=true}}this.setAreaCoords(c,false,false,1);if(this.options.displayOnInit&&f){this.selArea.show();this.drawArea();this.endCrop()}this.attached=true},remove:function(){if(this.attached){this.attached=false;this.imgWrap.parentNode.insertBefore(this.img,this.imgWrap);this.imgWrap.parentNode.removeChild(this.imgWrap);Event.stopObserving(this.dragArea,"mousedown",this.startDragBind);Event.stopObserving(document,"mousemove",this.onDragBind);Event.stopObserving(document,"mouseup",this.endCropBind);this.registerHandles(false);if(this.options.captureKeys){Event.stopObserving(document,"keypress",this.keysBind)}}},reset:function(){if(!this.attached){this.onLoad()}else{this.setParams()}this.endCrop()},handleKeys:function(c){var f={x:0,y:0};if(!this.dragging){switch(c.keyCode){case (37):f.x=-1;break;case (38):f.y=-1;break;case (39):f.x=1;break;case (40):f.y=1;break}if(f.x!==0||f.y!==0){if(c.shiftKey){f.x*=10;f.y*=10}this.moveArea([this.areaCoords.x1+f.x,this.areaCoords.y1+f.y]);this.endCrop();Event.stop(c)}}},calcW:function(){return(this.areaCoords.x2-this.areaCoords.x1)},calcH:function(){return(this.areaCoords.y2-this.areaCoords.y1)},moveArea:function(b){this.setAreaCoords({x1:b[0],y1:b[1],x2:b[0]+this.calcW(),y2:b[1]+this.calcH()},true,false);this.drawArea()},cloneCoords:function(b){return{x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2}},setAreaCoords:function(r,D,n,s,p){if(D){var q=r.x2-r.x1,v=r.y2-r.y1;if(r.x1<0){r.x1=0;r.x2=q}if(r.y1<0){r.y1=0;r.y2=v}if(r.x2>this.imgW){r.x2=this.imgW;r.x1=this.imgW-q}if(r.y2>this.imgH){r.y2=this.imgH;r.y1=this.imgH-v}}else{if(r.x1<0){r.x1=0}if(r.y1<0){r.y1=0}if(r.x2>this.imgW){r.x2=this.imgW}if(r.y2>this.imgH){r.y2=this.imgH}if(s!==null){if(this.ratioX>0){this.applyRatio(r,{x:this.ratioX,y:this.ratioY},s,p)}else{if(n){this.applyRatio(r,{x:1,y:1},s,p)}}var B=[this.options.minWidth,this.options.minHeight],o=[this.options.maxWidth,this.options.maxHeight];if(B[0]>0||B[1]>0||o[0]>0||o[1]>0){var t={a1:r.x1,a2:r.x2},w={a1:r.y1,a2:r.y2},z={min:0,max:this.imgW},A={min:0,max:this.imgH};if((B[0]!==0||B[1]!==0)&&n){if(B[0]>0){B[1]=B[0]}else{if(B[1]>0){B[0]=B[1]}}}if((o[0]!==0||o[0]!==0)&&n){if(o[0]>0&&o[0]<=o[1]){o[1]=o[0]}else{if(o[1]>0&&o[1]<=o[0]){o[0]=o[1]}}}if(B[0]>0){this.applyDimRestriction(t,B[0],s.x,z,"min")}if(B[1]>1){this.applyDimRestriction(w,B[1],s.y,A,"min")}if(o[0]>0){this.applyDimRestriction(t,o[0],s.x,z,"max")}if(o[1]>1){this.applyDimRestriction(w,o[1],s.y,A,"max")}r={x1:t.a1,y1:w.a1,x2:t.a2,y2:w.a2}}}}this.areaCoords=r},applyDimRestriction:function(m,k,l,n,g){var h;if(g=="min"){h=((m.a2-m.a1)<k)}else{h=((m.a2-m.a1)>k)}if(h){if(l==1){m.a2=m.a1+k}else{m.a1=m.a2-k}if(m.a1<n.min){m.a1=n.min;m.a2=k}else{if(m.a2>n.max){m.a1=n.max-k;m.a2=n.max}}}},applyRatio:function(l,g,h,f){var k;if(f=="N"||f=="S"){k=this.applyRatioToAxis({a1:l.y1,b1:l.x1,a2:l.y2,b2:l.x2},{a:g.y,b:g.x},{a:h.y,b:h.x},{min:0,max:this.imgW});l.x1=k.b1;l.y1=k.a1;l.x2=k.b2;l.y2=k.a2}else{k=this.applyRatioToAxis({a1:l.x1,b1:l.y1,a2:l.x2,b2:l.y2},{a:g.x,b:g.y},{a:h.x,b:h.y},{min:0,max:this.imgH});l.x1=k.a1;l.y1=k.b1;l.x2=k.a2;l.y2=k.b2}},applyRatioToAxis:function(l,o,m,s){var k=Object.extend(l,{}),p=k.a2-k.a1,t=Math.floor(p*o.b/o.a),n=null,r=null,q=null;if(m.b==1){n=k.b1+t;if(n>s.max){n=s.max;q=n-k.b1}k.b2=n}else{n=k.b2-t;if(n<s.min){n=s.min;q=n+k.b2}k.b1=n}if(q!==null){r=Math.floor(q*o.a/o.b);if(m.a==1){k.a2=k.a1+r}else{k.a1=k.a1=k.a2-r}}return k},drawArea:function(){var m=this.calcW(),p=this.calcH();var n="px",r=[this.areaCoords.x1+n,this.areaCoords.y1+n,m+n,p+n,this.areaCoords.x2+n,this.areaCoords.y2+n,(this.img.width-this.areaCoords.x2)+n,(this.img.height-this.areaCoords.y2)+n];var o=this.selArea.style;o.left=r[0];o.top=r[1];o.width=r[2];o.height=r[3];var l=Math.ceil((m-6)/2)+n,q=Math.ceil((p-6)/2)+n;this.handleN.style.left=l;this.handleE.style.top=q;this.handleS.style.left=l;this.handleW.style.top=q;this.north.style.height=r[1];var t=this.east.style;t.top=r[1];t.height=r[3];t.left=r[4];t.width=r[6];var k=this.south.style;k.top=r[5];k.height=r[7];var s=this.west.style;s.top=r[1];s.height=r[3];s.width=r[0];this.subDrawArea();this.forceReRender()},forceReRender:function(){if(this.isIE||this.isWebKit){var l=document.createTextNode(" ");var n,h,m,k;if(this.isIE){fixEl=this.selArea}else{if(this.isWebKit){fixEl=document.getElementsByClassName("imgCrop_marqueeSouth",this.imgWrap)[0];n=new Element("div");n.style.visibility="hidden";var o=["SE","S","SW"];for(k=0;k<o.length;k++){h=document.getElementsByClassName("imgCrop_handle"+o[k],this.selArea)[0];if(h.childNodes.length){h.removeChild(h.childNodes[0])}h.appendChild(n)}}}fixEl.appendChild(l);fixEl.removeChild(l)}},startResize:function(b){this.startCoords=this.cloneCoords(this.areaCoords);this.resizing=true;this.resizeHandle=Event.element(b).classNames().toString().replace(/([^N|NE|E|SE|S|SW|W|NW])+/,"");Event.stop(b)},startDrag:function(b){this.selArea.show();this.clickCoords=this.getCurPos(b);this.setAreaCoords({x1:this.clickCoords.x,y1:this.clickCoords.y,x2:this.clickCoords.x,y2:this.clickCoords.y},false,false,null);this.dragging=true;this.onDrag(b);Event.stop(b)},getCurPos:function(f){var g=this.imgWrap,h=Element.cumulativeOffset(g);while(g.nodeName!="BODY"){h[1]-=g.scrollTop||0;h[0]-=g.scrollLeft||0;g=g.parentNode}return{x:Event.pointerX(f)-h[0],y:Event.pointerY(f)-h[1]}},onDrag:function(k){if(this.dragging||this.resizing){var g=null,h=this.getCurPos(k),l=this.cloneCoords(this.areaCoords),m={x:1,y:1};if(this.dragging){if(h.x<this.clickCoords.x){m.x=-1}if(h.y<this.clickCoords.y){m.y=-1}this.transformCoords(h.x,this.clickCoords.x,l,"x");this.transformCoords(h.y,this.clickCoords.y,l,"y")}else{if(this.resizing){g=this.resizeHandle;if(g.match(/E/)){this.transformCoords(h.x,this.startCoords.x1,l,"x");if(h.x<this.startCoords.x1){m.x=-1}}else{if(g.match(/W/)){this.transformCoords(h.x,this.startCoords.x2,l,"x");if(h.x<this.startCoords.x2){m.x=-1}}}if(g.match(/N/)){this.transformCoords(h.y,this.startCoords.y2,l,"y");if(h.y<this.startCoords.y2){m.y=-1}}else{if(g.match(/S/)){this.transformCoords(h.y,this.startCoords.y1,l,"y");if(h.y<this.startCoords.y1){m.y=-1}}}}}this.setAreaCoords(l,false,k.shiftKey,m,g);this.drawArea();Event.stop(k)}},transformCoords:function(f,g,h,k){var l=[f,g];if(f>g){l.reverse()}h[k+"1"]=l[0];h[k+"2"]=l[1]},endCrop:function(){this.dragging=false;this.resizing=false;this.options.onEndCrop(this.areaCoords,{width:this.calcW(),height:this.calcH()})},subInitialize:function(){},subDrawArea:function(){}});Cropper.ImgWithPreview=Class.create(Cropper.Img,{subInitialize:function(){this.hasPreviewImg=false;if(typeof(this.options.previewWrap)!="undefined"&&this.options.minWidth>0&&this.options.minHeight>0){this.previewWrap=$(this.options.previewWrap);this.previewImg=this.img.cloneNode(false);this.previewImg.id="imgCrop_"+this.previewImg.id;this.options.displayOnInit=true;this.hasPreviewImg=true;this.previewWrap.addClassName("imgCrop_previewWrap");this.previewWrap.setStyle({width:this.options.minWidth+"px",height:this.options.minHeight+"px"});this.previewWrap.appendChild(this.previewImg)}},subDrawArea:function(){if(this.hasPreviewImg){var m=this.calcW(),l=this.calcH();var k={x:this.imgW/m,y:this.imgH/l};var n={x:m/this.options.minWidth,y:l/this.options.minHeight};var h={w:Math.ceil(this.options.minWidth*k.x)+"px",h:Math.ceil(this.options.minHeight*k.y)+"px",x:"-"+Math.ceil(this.areaCoords.x1/n.x)+"px",y:"-"+Math.ceil(this.areaCoords.y1/n.y)+"px"};var g=this.previewImg.style;g.width=h.w;g.height=h.h;g.left=h.x;g.top=h.y}}});var BF_MAX_UPLOAD=1024*1024*2;var BF_MAX_UPLOAD_TEXT="2 megabytes";var BF_MAX_UPLOAD_PROFILE=1024*1024*1;var BF_MAX_UPLOAD_PROFILE_TEXT="1 megabyte";BF_IMAGE_CROPPER=Class.create({template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="#{static_root}/images/public/backgrounds/trans.gif" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden bf_button bf_submit">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="bf_button grey" value="Cancel" /></li>				</ul>			</div>		</div>',preview_template:'<div id="preview" class="preview hidden"></div>',uploader_template:'		<div id="uploader_container">			<p class="upload-desc">Select an image to use for your post. After uploading you\'ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<fieldset>				<div>Thumbnail</div>				<div id="result" class="results"><div class="scroller"><img id="result-image" rel:width="300" rel:height="45" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){},fitToScreen:function(){},initialize:function(b){try{var a=this;this.options={cropper_class:"",fitImageAndScreen:false,showThumbs:true,showPreview:true,showCropper:true,minHeight:null,minWidth:null,enforceMin:false,maxHeight:null,maxWidth:null,enforceMax:false,modalIsParent:false,controller:"/bfcgi/_edit_quickpost_image",session_key:BFW_Util.getCookie(BFW_COOKIE),action:"imageupload"};Object.extend(this.options,b);this.uploader_params={session_key:this.options.session_key,action:this.options.action};this.regions={"default":false};this.setDefaults();this.container=$(b.container);this.container.update((new Template(this.template)).evaluate({cropper_class:this.options.cropper_class,static_root:BF_STATIC.static_root,uploader_template:(new Template(this.uploader_template)).evaluate({static_root:BF_STATIC.static_root}),preview_template:(new Template(this.preview_template)).evaluate({static_root:BF_STATIC.static_root}),thumbs_template:(new Template(this.thumbs_template)).evaluate({static_root:BF_STATIC.static_root})}));if(this.options.modalIsParent){this.container=$(this.container.parentNode)}this.uploader_container=$$("#"+this.container.id+" #uploader_container")[0];this.cropper_container=$$("#"+this.container.id+" #cropper_container")[0];this.cropper_instance=null;this.preview_button=$$("#"+this.container.id+" #preview-thumbs")[0];this.approve_button=$$("#"+this.container.id+" #approve-thumbs")[0];this.save_button=$$("#"+this.container.id+" #save-image")[0];this.cancel_button=$$("#"+this.container.id+" #image-cancel")[0];this.uploader_element=$$("#"+this.container.id+" #uploader")[0];this.image_element=$$("#"+this.container.id+" #image")[0];this.preview_button.observe("click",this.preview_image.bind(this));this.approve_button.stopObserving("click");this.approve_button.observe("click",this.approve_image.bind(this));this.save_button.observe("click",this.save_image.bind(this));this.cancel_button.observe("click",this.cancel_image.bind(this));this.error_title="";this.error_message="";this.init_uploader();this.cropper_container.addClassName("hidden");this.uploader_container.select(".upload-error, upload-status").each(function(f){f.addClassName("hidden")});$("uploader").removeClassName("hidden");if(this.options.image_data){this.onComplete(0,b.image_data.image,b.image_data)}}catch(c){this.close();alert("Unknown error occured. Please try again later.");console.dir(c);console.trace()}},preview_image:function(){try{this.container.scrollTo();this.container.removeClassName("upload").removeClassName("crop").addClassName("thumbs");this.cropper_container.select(".container")[0].addClassName("hidden");$("thumbs").removeClassName("hidden");if(this.options.showThumbs){this.approve_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}this.preview_button.addClassName("hidden");this.show_thumbs()}catch(a){console.error(a)}},show_thumbs:function(){var a=this;var b=this.image_element;$("result-image").each(function(k){var l=a.regions["default"];k.up(".scroller").style.width=k.getAttribute("rel:width")+"px";k.up(".scroller").style.height=k.getAttribute("rel:height")+"px";var f=k.getAttribute("rel:width")*1;var m=k.getAttribute("rel:height")*1;var g=Math.round(a.image_data.width*f/l.width);var c=Math.round(l.left*f/l.width);var n=Math.round(m*l.top/l.height);k.src=b.src;k.style.margin="-"+n+"px 0 0 -"+c+"px";k.style.width=g+"px";var h=k.up("fieldset").select("button")[0];h.stopObserving("click");h.observe("click",function(){$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(a))})},approve_image:function(a){},save_image:function(a){},cancel_image:function(a){a.stop()},init_uploader:function(){try{this.uploader=new qq.FileUploader({sendAsForm:true,element:this.uploader_element,action:this.options.controller,allowedExtensions:["jpg","jpeg","png","gif"],sizeLimit:BF_MAX_UPLOAD,params:this.uploader_params,onValidate:this.onValidate.bind(this),onProgress:this.onProgress.bind(this),onError:this.onError.bind(this),onComplete:this.onComplete.bind(this)})}catch(a){console.error(a)}},check_image:function(a){try{if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="Small image";b.select(".cerror-message")[0].innerHTML=this.error_message="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;return false}return true}catch(c){console.error(c)}},init_cropper:function(){try{this.container.scrollTo();this.cropper_container.select(".container")[0].removeClassName("hidden");if(this.options.showThumbs){this.preview_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}if(this.cropper_instance){this.cropper_instance.remove();delete this.cropper_instance}var c={x1:0,y1:0,x2:this.options.minWidth,y2:this.options.minHeight};var b={autoIncludeCSS:true,displayOnInit:true,onloadCoords:c,ratioDim:{x:this.options.minWidth,y:this.options.minHeight},minWidth:this.options.minWidth,minHeight:this.options.minHeight,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight,onEndCrop:this.crop_done.bind(this),captureKeys:false};this.customize_cropper(b);this.cropper_instance=new Cropper.Img(this.image_element,b);if(this.options.fitImageAndScreen){this.fitToScreen()}if($(this.container).down("#image")!==this.cropper_instance.img){this.close();(new BF_Request()).alert("Error: Unknown error occurred.<br>Please save your work, reload page and try upload image again.")}}catch(a){console.dir(a);console.trace()}},customize_cropper:function(b){try{var c=b.onloadCoords;if(this.regions["default"]){c.x1=this.regions["default"].left;c.y1=this.regions["default"].top;c.x2=this.regions["default"].left+this.regions["default"].width;c.y2=this.regions["default"].top+this.regions["default"].height}b.onloadCoords=c}catch(a){console.error(a)}},crop_default_size:function(){},crop_done:function(b,a){try{this.regions["default"]={top:b.y1,left:b.x1,height:b.y2-b.y1,width:b.x2-b.x1,image:this.image_element.src}}catch(c){console.error(c)}},onValidate:function(a){try{var f=this.uploader_container.select(".upload-error")[0];if(a.size>BF_MAX_UPLOAD){f.removeClassName("hidden");f.select(".error-title")[0].innerHTML="Too big file";f.select(".cerror-message")[0].innerHTML="Max image upload size is "+BF_MAX_UPLOAD_TEXT}else{$("uploader").addClassName("hidden");f.addClassName("hidden");var c=this.container.select(".upload-status")[0];c.removeClassName("hidden");var c=this.uploader_container.select(".upload-status div.red")[0];c.style.width="0px"}}catch(b){console.error(b)}},onProgress:function(a,f,g,c){try{var h=g;var m=c;var l=Math.round((h/m)*100);var b=this.uploader_container.select(".upload-status div.red")[0];b.style.width=(this.uploader_container.select(".upload-status div.text")[0].getWidth()/100*l)+"px"}catch(k){}},onError:function(g,f,a){$("uploader").removeClassName("hidden");var c="A critical error occurred while trying to upload the picture. Please try again in a few minutes.";if(a){c=a}var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML="Error occured";b.select(".cerror-message")[0].innerHTML=c},onComplete:function(k,h,g){try{this.container.removeClassName("thumbs").removeClassName("upload").addClassName("crop");this.uploader_container.select(".upload-status")[0].addClassName("hidden");this.uploader_element.removeClassName("hidden");this.image_data=g;if(!this.check_image(this.image_data)){if(this.options.callbacks&&this.options.callbacks.image_error){this.options.callbacks.image_error(this.error_title,this.error_message)}return false}else{this.uploader_container.addClassName("hidden");this.cropper_container.removeClassName("hidden");var f=this.image_element;if(Prototype.Browser.IE){var a=this;f.onload=function(){setTimeout(function(){a.image_element.onload=null;a.image_element.src=a.image_element.src},500)}}f.src=bf_ir+this.image_data.image+"?"+(new Date).getTime();f.width=this.image_data.width;f.height=this.image_data.height;f.removeClassName("hidden");if(!this.options.showCropper){this.crop_default_size()}else{if(g.crop_data){for(var c in g.crop_data){this.regions[c]=g.crop_data[c];this["manual_"+c]=true}this.preview_image()}else{if(Prototype.Browser.IE){setTimeout(function(){this.init_cropper()}.bind(this),1000)}else{this.init_cropper()}}}}}catch(b){console.error(b)}},close:function(){BF_UI.closeDialog("user-image-edit");BF_UI.closeDialog("super-image-edit");BF_UI.closeDialog("modal-super-image-edit");if(this.preview_button){this.preview_button.addClassName("hidden")}if(this.save_button){this.save_button.addClassName("hidden")}if(this.approve_button){this.approve_button.addClassName("hidden")}}});BF_SETTINGS_CROPPER=Class.create(BF_IMAGE_CROPPER,{uploader_template:'		<div id="uploader_container">			<div class="upload-title">Upload an Image</div>			<p class="upload-desc">Select an image to use for your profile. After uploading you\'ll be able to crop and resize your image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',preview_template:'		<div id="preview" class="preview">			<div class="scroller"><img id="result-image" rel:width="83" rel:height="83" />&nbsp;</div>		</div>',setDefaults:function(){var a={cropper_class:"settings",showThumbs:false,showPreview:true,showCropper:true,minWidth:83,minHeight:83};if(this.options.origin=="custom_user_header"||this.options.origin=="custom_user_channel_header"||this.options.origin=="bgimage"){a.showCropper=false}Object.extend(this.options,a);this.uploader_params={session_key:this.options.session_key,action:this.options.action,origin:this.options.origin};BF_MAX_UPLOAD=BF_MAX_UPLOAD_PROFILE;BF_MAX_UPLOAD_TEXT=BF_MAX_UPLOAD_PROFILE_TEXT},cancel_image:function(a){this.close()},save_image:function(){var a=this.regions["default"];this.options.callbacks.save_image_callback(this.image_data.image,this.image_data.name,a,null,this.options.origin);this.close()},crop_done:function(k,a){try{this.regions["default"]={top:k.y1,left:k.x1,height:k.y2-k.y1,width:k.x2-k.x1,image:this.image_element.src};var h=this.regions["default"];var b=$("result-image");b.up(".scroller").style.width=b.getAttribute("rel:width")+"px";b.up(".scroller").style.height=b.getAttribute("rel:height")+"px";var n=b.getAttribute("rel:width")*1;var c=b.getAttribute("rel:height")*1;var m=Math.round(this.image_data.width*n/h.width);var l=Math.round(h.left*n/h.width);var g=Math.round(c*h.top/h.height);b.src=this.image_element.src;b.style.margin="-"+g+"px 0 0 -"+l+"px";b.style.width=m+"px"}catch(f){console.error("If in IE - deal with it. "+f)}},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(!a.uploaded||this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="Small image";var c="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;if(!a.uploaded){c=a.message}b.select(".cerror-message")[0].innerHTML=this.error_message=c;return false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,width:this.image_data.width,height:this.image_data.height};this.save_image()}});BF_SUPERPOST_CROPPER=Class.create(BF_IMAGE_CROPPER,{template:'		#{uploader_template}		<div id="cropper_container">			<div class="container"><img id="image" src="#{static_root}/images/public/backgrounds/trans.gif" class="hidden" /></div>			#{preview_template}			#{thumbs_template}		</div>',uploader_template:'		<div id="uploader_container">			<div class="upload-title hidden">Upload an Image</div>			<p class="upload-desc hidden">Select an image to use for your post. After uploading you&rsquo;ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div class="thumbs-left">				<fieldset class="normal-result">					<div class="result-header">Normal Thumbnails</div>					<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>					<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>					<button id="crop-thumb" class="bf_button">Re-crop</button>				</fieldset>				<fieldset class="wide-result">					<div class="result-header">Wide Thumbnail</div>					<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>					<button id="wide-crop-thumb" class="bf_button">Re-crop</button>				</fieldset>			</div>			<div class="thumbs-right">				<fieldset class="big-result">					<div class="result-header">Big Thumbnail</div>					<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>					<button id="big-crop-thumb" class="bf_button">Re-crop</button>				</fieldset>			</div>		</div>',setDefaults:function(){var a={cropper_class:"",fitImageAndScreen:true,modalIsParent:true,minWidth:625,minHeight:415};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;this.fitToScreenOuter=this.fitToScreen.bind(this);Event.stopObserving(window,"resize",this.fitToScreenOuter);Event.observe(window,"resize",this.fitToScreenOuter);Object.extend(this.options,a)},fitToScreen:function(){var o=$("modal-super-image-edit-container");if($$("#cropper_container .container")[0].hasClassName("hidden")){o.setStyle({width:""});o.setStyle({height:""});this.container.setStyle({width:""});this.container.setStyle({height:""})}else{var h=document.documentElement.clientWidth,a=document.documentElement.clientHeight,f=this.image_data.width,p=this.image_data.height,q=parseInt(this.container.getStyle("width")),k=parseInt(this.container.getStyle("height")),c=20,m=20,l=50,g=150;if(typeof this.ctw=="undefined"){this.ctw=q;this.cth=k}else{q=this.ctw;k=this.cth}var n=(a-m);if(n<500){n=500}if(n-g-m>p){n=p+g+m}var b=(h-c);if(b<400){b=400}if(k<n&&q<b){return}if(k>n){o.setStyle({height:(n-g)+"px"});this.container.setStyle({height:n+"px"})}if(q>b){o.setStyle({width:(b-l)>1064-l?1064-l:(b-l)+"px"});this.container.setStyle({width:b>1064?1064:b+"px"})}}},cancel_image:function(a){if(typeof superlist!="undefined"){superlist.redisplayPreviewIfNecessary()}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(b){b.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter);if(typeof superlist!="undefined"){top.superlist.redisplayPreviewIfNecessary()}},approve_image:function(g){var h=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;h.wide_height=a.height;h.wide_width=a.width;h.wide_top=a.top;h.wide_left=a.left}if(this.regions.big){var f=this.regions.big;h.big_height=f.height;h.big_width=f.width;h.big_top=f.top;h.big_left=f.left}bf_boost_manager.save_image(this.image_data.image,this.image_data.name,h,"/buzzfeed/_edit_quickpost_image");var c=$("buzz-type");var b=(c)?c.value:"text";if(typeof this.options.callbacks!="undefined"&&typeof this.options.callbacks.finish_save_image!="undefined"){this.options.callbacks.finish_save_image(b,this)}else{user_post.save_quickpost_image(b,this)}if(top.$("original_image_crop_data")){top.$("original_image_crop_data").value=Object.toJSON(this.regions)}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(k){k.remove()});Event.stopObserving(window,"resize",this.fitToScreenOuter)},customize_cropper:function(g){var h=g.onloadCoords;if(this.regions[this.current_cropping_region]){h.x1=this.regions[this.current_cropping_region].left;h.y1=this.regions[this.current_cropping_region].top;h.x2=this.regions[this.current_cropping_region].left+this.regions[this.current_cropping_region].width;h.y2=this.regions[this.current_cropping_region].top+this.regions[this.current_cropping_region].height;g.minWidth=this[this.current_cropping_region+"_width"];g.minHeight=this[this.current_cropping_region+"_height"];g.ratioDim={x:this[this.current_cropping_region+"_width"],y:this[this.current_cropping_region+"_height"]}}else{var a=this.image_data;var b=a.width/this.options.minWidth;var f=a.height/this.options.minHeight;var c=Math.min(b,f);h.x2=this.options.minWidth*c;h.y2=this.options.minHeight*c}g.onloadCoords=h},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";b.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 625 x 415 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions.thumb={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.auto_big();this.auto_wide();this.approve_image()},crop_done:function(b,a){this.regions[this.current_cropping_region]={top:b.y1,left:b.x1,height:parseInt(b.y2-b.y1),width:parseInt(b.x2-b.x1),image:this.image_element.src}},auto_big:function(){var b=this.regions.thumb;var a={top:b.top,left:b.left,height:b.height,width:b.width};if(b.width<this.big_width){a.width=this.big_width;a.height=this.big_height;a.top=(b.top-parseInt((a.height-b.height)/2));a.left=(b.left-parseInt((a.width-b.width)/2));if(a.top<0){a.top=0}if(a.left<0){a.left=0}if((a.top+a.height)>this.image_data.height){a.top=this.image_data.height-a.height}if((a.left+a.width)>this.image_data.width){a.left=this.image_data.width-a.width}}this.regions.big=a},auto_wide:function(){var a=this.regions.big;var b={top:a.top,left:a.left,height:a.height,width:a.width};b.top=a.top+parseInt(a.height/3);b.height=parseInt((this.wide_height*a.width)/this.wide_width);this.regions.wide=b},show_thumbs:function(){var b=this;var c=this.image_element;if(!this.manual_big){this.auto_big()}if(!this.manual_wide){this.auto_wide()}this.cropper_container.select("#big-result-image, #wide-result-image").each(function(l){var m;if(l.id=="wide-result-image"){m=b.regions.wide}else{if(l.id=="big-result-image"){m=b.regions.big}}l.up(".scroller").style.width=l.getAttribute("rel:width")+"px";l.up(".scroller").style.height=l.getAttribute("rel:height")+"px";var g=l.getAttribute("rel:width")*1;var n=l.getAttribute("rel:height")*1;var h=Math.round(b.image_data.width*g/m.width);var f=Math.round(m.left*g/m.width);var o=Math.round(n*m.top/m.height);l.src=c.src;l.style.margin="-"+o+"px 0 0 -"+f+"px";l.style.width=h+"px";var k=l.up("fieldset").select("button")[0];k.stopObserving("click");k.observe("click",function(p){if(p.target.id=="big-crop-thumb"){this.manual_big=true;this.current_cropping_region="big"}else{this.manual_wide=true;this.current_cropping_region="wide"}$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(b))});this.cropper_container.select("#normal-result-image, #small-result-image").each(function(k){var l=b.regions.thumb;k.up(".scroller").style.width=k.getAttribute("rel:width")+"px";k.up(".scroller").style.height=k.getAttribute("rel:height")+"px";var g=k.getAttribute("rel:width")*1;var m=k.getAttribute("rel:height")*1;var h=Math.round(b.image_data.width*g/l.width);var f=Math.round(l.left*g/l.width);var n=Math.round(m*l.top/l.height);k.src=c.src;k.style.margin="-"+n+"px 0 0 -"+f+"px";k.style.width=h+"px"});var a=$("crop-thumb");a.stopObserving("click");a.observe("click",function(){this.current_cropping_region="thumb";$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(b));if(this.options.fitImageAndScreen){this.fitToScreen()}}});BF_SUPERPOST_QUIZ_CROPPER=Class.create(BF_IMAGE_CROPPER,{setDefaults:function(){var a={cropper_class:"superpost_quiz",fitImageAndScreen:true,showThumbs:false,showPreview:false,showCropper:true,minWidth:this.options.image_data.crop_width,minHeight:this.options.image_data.crop_height};Object.extend(this.options,a)},fitToScreen:function(){var g=document.documentElement.clientWidth,o=document.documentElement.clientHeight,l=this.image_data.width,q=this.image_data.height,s=parseInt(this.container.getStyle("width")),a=parseInt(this.container.getStyle("height")),h=30+0,n=30+0,B=0,m=35;if(this.container.select("#cropper_container .container")[0].hasClassName("hidden")){var c=this.container.select("#cropper_container #thumbs")[0];l=parseInt(c.getStyle("width"));q=parseInt(c.getStyle("height"))}this.container.setStyle({width:l+"px"});this.container.setAttribute("width",l);this.container.setStyle({height:q+"px"});this.container.setAttribute("height",q);s=parseInt(this.container.getStyle("width"));a=parseInt(this.container.getStyle("height"));this.container.select(".cropperbody")[0].setStyle({width:s+"px"});this.container.select(".cropperbody")[0].setStyle({height:a+"px"});var z=this.container.up(".bf_dialog_content");z.setStyle({width:(s+B)+"px"});z.setStyle({height:(a+m)+"px"});var t=this.container.up(".bf_dialog");t.setStyle({width:(s+B)+"px"});t.setStyle({height:(a+m)+"px"});var k=document.documentElement.scrollLeft,b=document.body.scrollLeft,D=document.documentElement.scrollTop,A=document.body.scrollTop;t.setStyle({left:(((g-s)/2)>0?((g-s)/2):0)+(k>b?k:b)+"px"});t.setStyle({top:(((o-a)/2)>0?((o-a)/2):0)+(D>A?D:A)+"px"});t.setStyle({marginLeft:"0px"});var p=document.documentElement.clientWidth,w=document.documentElement.clientHeight,v=document.body.clientWidth,f=document.body.clientHeight;var r=this.container.up("#super-image-edit").select(".bf_overlay_mask")[0];r.setStyle({width:(p>v?p:v)+"px"});r.setStyle({height:(w>f?w:f)+"px"})},cancel_image:function(a){a.stop();this.close()},save_image:function(a){var b=this.regions["default"];quiz_admin.image_cropper_callback(this.image_data.image,this.image_data.name,this.image_data.format,b);this.close()},customize_cropper:function(g){var h=g.onloadCoords;var a=this.image_data;var b=a.width/this.options.minWidth;var f=a.height/this.options.minHeight;var c=Math.min(b,f);h.x2=this.options.minWidth*c;h.y2=this.options.minHeight*c;g.onloadCoords=h},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";b.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 170 x 170 pixels. Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.save_image()},crop_done:function(b,a){this.regions["default"]={top:b.y1,left:b.x1,height:b.y2-b.y1,width:b.x2-b.x1,image:this.image_element.src}}});BF_FLEXPRO_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="#{static_root}/images/public/backgrounds/trans.gif" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden bf_button bf_submit">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="bf_button" value="Cancel" /></li>				</ul>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div>Are These Thumbnails OK? <span class="help">Thumbnail images may be be used to promote your post so make sure they look good!</span></div>			<fieldset class="big-result">				<div>Big Thumbnail</div>				<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>				<button id="big-crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>			<fieldset class="normal-result">				<div>Normal Thumbnails</div>				<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>				<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>			<fieldset class="wide-result">				<div>Wide Thumbnail</div>				<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>				<button id="wide-crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;var a={cropper_class:"flexpro",fitImageAndScreen:false,minWidth:355,minHeight:236};if(this.options.image_data.crop_height!=this.thumb_height||this.options.image_data.crop_width!=this.thumb_width){a={cropper_class:"flexpro",fitImageAndScreen:false,showThumbs:false,showPreview:false,showCropper:true,minHeight:parseInt(this.options.image_data.crop_height),minWidth:parseInt(this.options.image_data.crop_width)}}Object.extend(this.options,a)},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";var c;if(this.options.showThumbs){c="We need an image at least 355 x 236 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again."}else{c="We need an image at least "+this.options.image_data.crop_width+" x "+this.options.image_data.crop_height+" pixels. Choose another one below, or hit cancel to try again."}b.select(".cerror-message")[0].innerHTML=this.error_message=c;return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},save_image:function(){var a=this.regions.thumb;this.options.callbacks.save_image(this.image_data.image,this.image_data.name,a,this.options.controller);this.close()},approve_image:function(){var g=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;g.wide_height=a.height;g.wide_width=a.width;g.wide_top=a.top;g.wide_left=a.left}if(this.regions.big){var f=this.regions.big;g.big_height=f.height;g.big_width=f.width;g.big_top=f.top;g.big_left=f.left}if(this.image_data&&this.image_data.original){g.original={image:this.image_data.original.image,image_width:this.image_data.original.width,height:this.image_data.original.height}}this.options.callbacks.save_image(this.image_data.image,this.image_data.name,g,parent.image_handling.controller);var c=$("buzz-type");var b=(c)?c.value:"text";this.options.callbacks.finish_save_image(b,this)},cancel_image:function(a){a.stop();$$("#parent-buzz-uploader .qq-upload-list > li").each(function(b){b.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter)},fitToScreen:function(){}});BF_OPTIMIZE_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{fitToScreen:function(){},approve_image:function(c){var f=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;f.wide_height=a.height;f.wide_width=a.width;f.wide_top=a.top;f.wide_left=a.left}if(this.regions.big){var b=this.regions.big;f.big_height=b.height;f.big_width=b.width;f.big_top=b.top;f.big_left=b.left}if(this.options.image_data.image){f.image=this.options.image_data.image;if(this.options.subid){f.subid=this.options.subid}if(this.options.promoid){f.promoid=this.options.promoid}}if(f.subid){optimize.update_cropping(f)}else{if(f.promoid){optimize.update_cropping_in_progress(f)}}this.cancel_image()}});var UI=(typeof BF_UI=="undefined")?(typeof MobileUI=="undefined"?new Object():MobileUI):BF_UI;UI.dateFormat={queue:new Array(),add:function(a){UI.dateFormat.queue.push(a)},process:function(){if(UI.dateFormat.queue.length){var c=setInterval(function(){if(typeof Date.prototype.format!="undefined"){bfjs.universal_each(UI.dateFormat.queue,function(g){var f=$(document.body)[bfjs.selector]("#"+g+" .convert-datetime.hidden");if($(f)){f=f[0];timestamp=$(f)[bfjs.read_attr](bfjs.datetime),dateformat=$(f)[bfjs.read_attr](bfjs.dateformat),datetime=new Date(timestamp),formatted_date=datetime.format(dateformat);(typeof $(f).text==="function")?$(f).text(formatted_date):$(f).innerHTML=formatted_date;$(f)[bfjs.remove_class]("hidden")}});clearInterval(c)}},1000);var a=document.createElement("script");a.src=BF_STATIC.static_root+"/js/public/date_format.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}}};var Carousel=function(){var b={id:"carousel",next:"cc-next",prev:"cc-prev",item:"thumbnail",items:"thumbnails",show:3};var c=function(f){for(var g=0;g<b.show;g++){f[g].removeClassName("hidden")}};var a=function(){return $$("#"+b.id+" ."+b.item+":not(.hidden)")};return{init:function(g){if(g){b=$H(b).merge(g);b=b._object}var h=this;var f=$$("#"+b.id+" ."+b.item);if(f.length>b.show){if($$("#"+b.id+" ."+b.next).length){$$("#"+b.id+" ."+b.next)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_next",event:"click",handler:h.next})}if($$("#"+b.id+" ."+b.prev).length){$$("#"+b.id+" ."+b.prev)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_prev",event:"click",handler:h.prev})}}c(f)},next:function(h){Event.stop(h);var l=a();l.each(function(m){m.addClassName("hidden")});for(var g=0;g<l.length;g++){var k=l[g];l[g].remove();$$("."+b.items)[0].insert(k)}var f=$$("#"+b.id+"  ."+b.item);for(var g=0;g<b.show&&f.length>g;g++){f[g].removeClassName("hidden")}},prev:function(k){Event.stop(k);var m=a();m.each(function(n){n.addClassName("hidden")});for(var h=m.length;h>0;h--){var l=m[h-1];m[h-1].remove();$$("."+b.items)[0].insert({top:l})}var f=$$("#"+b.id+"  ."+b.item);for(var h=f.length,g=0;g<b.show;g++,h--){f[h-1].removeClassName("hidden")}}}};var BFcarousel=Carousel();var bf_audio=function(){this.player=function(a){if(typeof a=="undefined"){return false}if(!document.getElementById("turntable")){this.createPlayer()}if(isIE7()||isIE8()){AudioPlayer.setup(BF_STATIC.static_root+"/flash/player.swf",{width:1,height:1,initialvolume:100});this.flashPlayer(this.getAudioPath(a))}else{this.html5Player(this.getAudioPath(a))}};this.createPlayer=function(){var a=document.createElement("div");a.setAttribute("id","turntable");document.body.appendChild(a)};this.flashPlayer=function(a){if(BF_STATIC.bf_env!="live"){console.log("Playing w/Flash: "+a)}var b=document.getElementById("turntable");b.insert('<p id="player_1"></p>');AudioPlayer.embed("player_1",{soundFile:a,autostart:"yes"})};this.html5Player=function(a){if(BF_STATIC.bf_env!="live"){console.log("Playing w/HTML5: "+a)}var c=document.getElementById("turntable");var b=document.createElement("audio");b.setAttribute("id","needle");b.setAttribute("src",a);c.appendChild(b);b.play()};this.getAudioPath=function(a){var c="";var f=a.split(".");for(var b=0;b<(f.length-1);b++){c+=f[b]+"."}c=BF_STATIC.static_root+c;if(Prototype.Browser.Gecko){a=c+"ogg"}else{a=c+"mp3"}return a}};var BFAudio=new bf_audio();
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var audioplayer_swfobject=function(){var L="undefined",w="object",aa="Shockwave Flash",ae="ShockwaveFlash.ShockwaveFlash",v="application/x-shockwave-flash",Z="SWFObjectExprInst",F="onreadystatechange",W=window,n=document,A=navigator,ab=false,ac=[l],s=[],V=[],Q=[],p,Y,M,J,R=false,a=false,r,O,q=true,U=function(){var ai=typeof n.getElementById!=L&&typeof n.getElementsByTagName!=L&&typeof n.createElement!=L,ap=A.userAgent.toLowerCase(),ag=A.platform.toLowerCase(),am=ag?/win/.test(ag):/win/.test(ap),ak=ag?/mac/.test(ag):/mac/.test(ap),an=/webkit/.test(ap)?parseFloat(ap.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,af=!+"\v1",ao=[0,0,0],aj=null;if(typeof A.plugins!=L&&typeof A.plugins[aa]==w){aj=A.plugins[aa].description;if(aj&&!(typeof A.mimeTypes!=L&&A.mimeTypes[v]&&!A.mimeTypes[v].enabledPlugin)){ab=true;af=false;aj=aj.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ao[0]=parseInt(aj.replace(/^(.*)\..*$/,"$1"),10);ao[1]=parseInt(aj.replace(/^.*\.(.*)\s.*$/,"$1"),10);ao[2]=/[a-zA-Z]/.test(aj)?parseInt(aj.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof W.ActiveXObject!=L){try{var al=new ActiveXObject(ae);if(al){aj=al.GetVariable("$version");if(aj){af=true;aj=aj.split(" ")[1].split(",");ao=[parseInt(aj[0],10),parseInt(aj[1],10),parseInt(aj[2],10)]}}}catch(ah){}}}return{w3:ai,pv:ao,wk:an,ie:af,win:am,mac:ak}}(),o=function(){if(!U.w3){return}if((typeof n.readyState!=L&&n.readyState=="complete")||(typeof n.readyState==L&&(n.getElementsByTagName("body")[0]||n.body))){h()}if(!R){if(typeof n.addEventListener!=L){n.addEventListener("DOMContentLoaded",h,false)}if(U.ie&&U.win){n.attachEvent(F,function(){if(n.readyState=="complete"){n.detachEvent(F,arguments.callee);h()}});if(W==top){(function(){if(R){return}try{n.documentElement.doScroll("left")}catch(af){setTimeout(arguments.callee,0);return}h()})()}}if(U.wk){(function(){if(R){return}if(!/loaded|complete/.test(n.readyState)){setTimeout(arguments.callee,0);return}h()})()}z(h)}}();function h(){if(R){return}try{var ah=n.getElementsByTagName("body")[0].appendChild(K("span"));ah.parentNode.removeChild(ah)}catch(ai){return}R=true;var af=ac.length;for(var ag=0;ag<af;ag++){ac[ag]()}}function S(af){if(R){af()}else{ac[ac.length]=af}}function z(ag){if(typeof W.addEventListener!=L){W.addEventListener("load",ag,false)}else{if(typeof n.addEventListener!=L){n.addEventListener("load",ag,false)}else{if(typeof W.attachEvent!=L){m(W,"onload",ag)}else{if(typeof W.onload=="function"){var af=W.onload;W.onload=function(){af();ag()}}else{W.onload=ag}}}}}function l(){if(ab){ad()}else{P()}}function ad(){var af=n.getElementsByTagName("body")[0];var ai=K(w);ai.setAttribute("type",v);var ah=af.appendChild(ai);if(ah){var ag=0;(function(){if(typeof ah.GetVariable!=L){var aj=ah.GetVariable("$version");if(aj){aj=aj.split(" ")[1].split(",");U.pv=[parseInt(aj[0],10),parseInt(aj[1],10),parseInt(aj[2],10)]}}else{if(ag<10){ag++;setTimeout(arguments.callee,10);return}}af.removeChild(ai);ah=null;P()})()}else{P()}}function P(){var ao=s.length;if(ao>0){for(var an=0;an<ao;an++){var ag=s[an].id;var aj=s[an].callbackFn;var ai={success:false,id:ag};if(U.pv[0]>0){var am=c(ag);if(am){if(N(s[an].swfVersion)&&!(U.wk&&U.wk<312)){E(ag,true);if(aj){ai.success=true;ai.ref=H(ag);aj(ai)}}else{if(s[an].expressInstall&&I()){var aq={};aq.data=s[an].expressInstall;aq.width=am.getAttribute("width")||"0";aq.height=am.getAttribute("height")||"0";if(am.getAttribute("class")){aq.styleclass=am.getAttribute("class")}if(am.getAttribute("align")){aq.align=am.getAttribute("align")}var ap={};var af=am.getElementsByTagName("param");var ak=af.length;for(var al=0;al<ak;al++){if(af[al].getAttribute("name").toLowerCase()!="movie"){ap[af[al].getAttribute("name")]=af[al].getAttribute("value")}}X(aq,ap,ag,aj)}else{t(am);if(aj){aj(ai)}}}}}else{E(ag,true);if(aj){var ah=H(ag);if(ah&&typeof ah.SetVariable!=L){ai.success=true;ai.ref=ah}aj(ai)}}}}}function H(ai){var af=null;var ag=c(ai);if(ag&&ag.nodeName=="OBJECT"){if(typeof ag.SetVariable!=L){af=ag}else{var ah=ag.getElementsByTagName(w)[0];if(ah){af=ah}}}return af}function I(){return !a&&N("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function X(ai,aj,af,ah){a=true;M=ah||null;J={success:false,id:af};var am=c(af);if(am){if(am.nodeName=="OBJECT"){p=k(am);Y=null}else{p=am;Y=af}ai.id=Z;if(typeof ai.width==L||(!/%$/.test(ai.width)&&parseInt(ai.width,10)<310)){ai.width="310"}if(typeof ai.height==L||(!/%$/.test(ai.height)&&parseInt(ai.height,10)<137)){ai.height="137"}n.title=n.title.slice(0,47)+" - Flash Player Installation";var al=U.ie&&U.win?"ActiveX":"PlugIn",ak="MMredirectURL="+W.location.toString().replace(/&/g,"%26")+"&MMplayerType="+al+"&MMdoctitle="+n.title;if(typeof aj.flashvars!=L){aj.flashvars+="&"+ak}else{aj.flashvars=ak}if(U.ie&&U.win&&am.readyState!=4){var ag=K("div");af+="SWFObjectNew";ag.setAttribute("id",af);am.parentNode.insertBefore(ag,am);am.style.display="none";(function(){if(am.readyState==4){am.parentNode.removeChild(am)}else{setTimeout(arguments.callee,10)}})()}B(ai,aj,af)}}function t(ag){if(U.ie&&U.win&&ag.readyState!=4){var af=K("div");ag.parentNode.insertBefore(af,ag);af.parentNode.replaceChild(k(ag),af);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}else{ag.parentNode.replaceChild(k(ag),ag)}}function k(aj){var ai=K("div");if(U.win&&U.ie){ai.innerHTML=aj.innerHTML}else{var ag=aj.getElementsByTagName(w)[0];if(ag){var ak=ag.childNodes;if(ak){var af=ak.length;for(var ah=0;ah<af;ah++){if(!(ak[ah].nodeType==1&&ak[ah].nodeName=="PARAM")&&!(ak[ah].nodeType==8)){ai.appendChild(ak[ah].cloneNode(true))}}}}}return ai}function B(aq,ao,ag){var af,ai=c(ag);if(U.wk&&U.wk<312){return af}if(ai){if(typeof aq.id==L){aq.id=ag}if(U.ie&&U.win){var ap="";for(var am in aq){if(aq[am]!=Object.prototype[am]){if(am.toLowerCase()=="data"){ao.movie=aq[am]}else{if(am.toLowerCase()=="styleclass"){ap+=' class="'+aq[am]+'"'}else{if(am.toLowerCase()!="classid"){ap+=" "+am+'="'+aq[am]+'"'}}}}}var an="";for(var al in ao){if(ao[al]!=Object.prototype[al]){an+='<param name="'+al+'" value="'+ao[al]+'" />'}}ai.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ap+">"+an+"</object>";V[V.length]=aq.id;af=c(aq.id)}else{var ah=K(w);ah.setAttribute("type",v);for(var ak in aq){if(aq[ak]!=Object.prototype[ak]){if(ak.toLowerCase()=="styleclass"){ah.setAttribute("class",aq[ak])}else{if(ak.toLowerCase()!="classid"){ah.setAttribute(ak,aq[ak])}}}}for(var aj in ao){if(ao[aj]!=Object.prototype[aj]&&aj.toLowerCase()!="movie"){g(ah,aj,ao[aj])}}ai.parentNode.replaceChild(ah,ai);af=ah}}return af}function g(ah,af,ag){var ai=K("param");ai.setAttribute("name",af);ai.setAttribute("value",ag);ah.appendChild(ai)}function G(ag){var af=c(ag);if(af&&af.nodeName=="OBJECT"){if(U.ie&&U.win){af.style.display="none";(function(){if(af.readyState==4){b(ag)}else{setTimeout(arguments.callee,10)}})()}else{af.parentNode.removeChild(af)}}}function b(ah){var ag=c(ah);if(ag){for(var af in ag){if(typeof ag[af]=="function"){ag[af]=null}}ag.parentNode.removeChild(ag)}}function c(ah){var af=null;try{af=n.getElementById(ah)}catch(ag){}return af}function K(af){return n.createElement(af)}function m(ah,af,ag){ah.attachEvent(af,ag);Q[Q.length]=[ah,af,ag]}function N(ah){var ag=U.pv,af=ah.split(".");af[0]=parseInt(af[0],10);af[1]=parseInt(af[1],10)||0;af[2]=parseInt(af[2],10)||0;return(ag[0]>af[0]||(ag[0]==af[0]&&ag[1]>af[1])||(ag[0]==af[0]&&ag[1]==af[1]&&ag[2]>=af[2]))?true:false}function D(ak,ag,al,aj){if(U.ie&&U.mac){return}var ai=n.getElementsByTagName("head")[0];if(!ai){return}var af=(al&&typeof al=="string")?al:"screen";if(aj){r=null;O=null}if(!r||O!=af){var ah=K("style");ah.setAttribute("type","text/css");ah.setAttribute("media",af);r=ai.appendChild(ah);if(U.ie&&U.win&&typeof n.styleSheets!=L&&n.styleSheets.length>0){r=n.styleSheets[n.styleSheets.length-1]}O=af}if(U.ie&&U.win){if(r&&typeof r.addRule==w){r.addRule(ak,ag)}}else{if(r&&typeof n.createTextNode!=L){r.appendChild(n.createTextNode(ak+" {"+ag+"}"))}}}function E(ah,af){if(!q){return}var ag=af?"visible":"hidden";if(R&&c(ah)){c(ah).style.visibility=ag}else{D("#"+ah,"visibility:"+ag)}}function T(ag){var ah=/[\\\"<>\.;]/;var af=ah.exec(ag)!=null;return af&&typeof encodeURIComponent!=L?encodeURIComponent(ag):ag}var f=function(){if(U.ie&&U.win){window.attachEvent("onunload",function(){var ak=Q.length;for(var aj=0;aj<ak;aj++){Q[aj][0].detachEvent(Q[aj][1],Q[aj][2])}var ah=V.length;for(var ai=0;ai<ah;ai++){G(V[ai])}for(var ag in U){U[ag]=null}U=null;for(var af in audioplayer_swfobject){audioplayer_swfobject[af]=null}audioplayer_swfobject=null})}}();return{registerObject:function(aj,af,ai,ah){if(U.w3&&aj&&af){var ag={};ag.id=aj;ag.swfVersion=af;ag.expressInstall=ai;ag.callbackFn=ah;s[s.length]=ag;E(aj,false)}else{if(ah){ah({success:false,id:aj})}}},getObjectById:function(af){if(U.w3){return H(af)}},embedSWF:function(aj,ap,am,ao,ag,ai,ah,al,an,ak){var af={success:false,id:ap};if(U.w3&&!(U.wk&&U.wk<312)&&aj&&ap&&am&&ao&&ag){E(ap,false);S(function(){am+="";ao+="";var ar={};if(an&&typeof an===w){for(var au in an){ar[au]=an[au]}}ar.data=aj;ar.width=am;ar.height=ao;var av={};if(al&&typeof al===w){for(var at in al){av[at]=al[at]}}if(ah&&typeof ah===w){for(var aq in ah){if(typeof av.flashvars!=L){av.flashvars+="&"+aq+"="+ah[aq]}else{av.flashvars=aq+"="+ah[aq]}}}if(N(ag)){var aw=B(ar,av,ap);if(ar.id==ap){E(ap,true)}af.success=true;af.ref=aw}else{if(ai&&I()){ar.data=ai;X(ar,av,ap,ak);return}else{E(ap,true)}}if(ak){ak(af)}})}else{if(ak){ak(af)}}},switchOffAutoHideShow:function(){q=false},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:N,createSWF:function(ah,ag,af){if(U.w3){return B(ah,ag,af)}else{return undefined}},showExpressInstall:function(ah,ai,af,ag){if(U.w3&&I()){X(ah,ai,af,ag)}},removeSWF:function(af){if(U.w3){G(af)}},createCSS:function(ai,ah,ag,af){if(U.w3){D(ai,ah,ag,af)}},addDomLoadEvent:S,addLoadEvent:z,getQueryParamValue:function(ai){var ah=n.location.search||n.location.hash;if(ah){if(/\?/.test(ah)){ah=ah.split("?")[1]}if(ai==null){return T(ah)}var ag=ah.split("&");for(var af=0;af<ag.length;af++){if(ag[af].substring(0,ag[af].indexOf("="))==ai){return T(ag[af].substring((ag[af].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var af=c(Z);if(af&&p){af.parentNode.replaceChild(p,af);if(Y){E(Y,true);if(U.ie&&U.win){p.style.display="block"}}if(M){M(J)}}a=false}}}}();var AudioPlayer=function(){var b=[];var h={};var g={};var c="";var k={};var f=-1;var m="9";function l(n){if(document.all&&!window[n]){for(var o=0;o<document.forms.length;o++){if(document.forms[o][n]){return document.forms[o][n];break}}}return document.all?window[n]:document[n]}function a(n,o,p){l(n).addListener(o,p)}return{setup:function(o,n){c=o;k=n;if(audioplayer_swfobject.hasFlashPlayerVersion(m)){audioplayer_swfobject.switchOffAutoHideShow();audioplayer_swfobject.createCSS("p.audioplayer_container span","visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;")}},getPlayer:function(n){return l(n)},addListener:function(n,o,p){a(n,o,p)},embed:function(n,p){var s={};var q;var o={};var t={};var r={};for(q in k){s[q]=k[q]}for(q in p){s[q]=p[q]}if(s.transparentpagebg=="yes"){o.bgcolor="#FFFFFF";o.wmode="transparent"}else{if(s.pagebg){o.bgcolor="#"+s.pagebg}o.wmode="opaque"}o.menu="false";for(q in s){if(q=="pagebg"||q=="width"||q=="transparentpagebg"){continue}t[q]=s[q]}r.name=n;r.style="outline: none";t.playerID=n;audioplayer_swfobject.embedSWF(c,n,s.width.toString(),"24",m,false,t,o,r);b.push(n);if(p.group){h[n]=p.group}},syncVolumes:function(n,p){if(h[n]){return}f=p;for(var o=0;o<b.length;o++){if(!h[b[o]]&&b[o]!=n){l(b[o]).setVolume(f)}}},activate:function(n,p){for(var o in g){if(o==n){continue}if(h[n]!=h[o]){this.close(o);continue}if(!(h[n]||h[o])){this.close(o)}}g[n]=1},load:function(p,n,q,o){l(p).load(n,q,o)},close:function(n){l(n).close();if(n in g){delete g[n]}},open:function(n,o){if(o==undefined){o=1}l(n).open(o==undefined?0:o-1)},getVolume:function(n){return f}}}();(function(){var A="0.4.8",n=window.jQuery||window.$||(window.$={}),h={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(N){return String(N).evalJSON()}||n.parseJSON||n.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||n.toJSON};if(!("parse" in h)||!("stringify" in h)){throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page")}var q={__jstorage_meta:{CRC32:{}}},c={jStorage:"{}"},G=null,s=0,m=false,o={},K=false,H=0,z={},F=+new Date(),I,J={isXML:function(O){var N=(O?O.ownerDocument||O:0).documentElement;return N?N.nodeName!=="HTML":false},encode:function(O){if(!this.isXML(O)){return false}try{return new XMLSerializer().serializeToString(O)}catch(N){try{return O.xml}catch(P){}}return false},decode:function(O){var N=("DOMParser" in window&&(new DOMParser()).parseFromString)||(window.ActiveXObject&&function(Q){var R=new ActiveXObject("Microsoft.XMLDOM");R.async="false";R.loadXML(Q);return R}),P;if(!N){return false}P=N.call("DOMParser" in window&&(new DOMParser())||window,O,"text/xml");return this.isXML(P)?P:false}};function v(){var N=false;if("localStorage" in window){try{window.localStorage.setItem("_tmptest","tmpval");N=true;window.localStorage.removeItem("_tmptest")}catch(O){}}if(N){try{if(window.localStorage){c=window.localStorage;m="localStorage";H=c.jStorage_update}}catch(U){}}else{if("globalStorage" in window){try{if(window.globalStorage){if(window.location.hostname=="localhost"){c=window.globalStorage["localhost.localdomain"]}else{c=window.globalStorage[window.location.hostname]}m="globalStorage";H=c.jStorage_update}}catch(T){}}else{G=document.createElement("link");if(G.addBehavior){G.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(G);try{G.load("jStorage")}catch(S){G.setAttribute("jStorage","{}");G.save("jStorage");G.load("jStorage")}var R="{}";try{R=G.getAttribute("jStorage")}catch(Q){}try{H=G.getAttribute("jStorage_update")}catch(P){}c.jStorage=R;m="userDataBehavior"}else{G=null;return}}}p();b();E();B();if("addEventListener" in window){window.addEventListener("pageshow",function(V){if(V.persisted){t()}},false)}}function g(){var P="{}";if(m=="userDataBehavior"){G.load("jStorage");try{P=G.getAttribute("jStorage")}catch(O){}try{H=G.getAttribute("jStorage_update")}catch(N){}c.jStorage=P}p();b();B()}function E(){if(m=="localStorage"||m=="globalStorage"){if("addEventListener" in window){window.addEventListener("storage",t,false)}else{document.attachEvent("onstorage",t)}}else{if(m=="userDataBehavior"){setInterval(t,1000)}}}function t(){var N;clearTimeout(K);K=setTimeout(function(){if(m=="localStorage"||m=="globalStorage"){N=c.jStorage_update}else{if(m=="userDataBehavior"){G.load("jStorage");try{N=G.getAttribute("jStorage_update")}catch(O){}}}if(N&&N!=H){H=N;l()}},25)}function l(){var N=h.parse(h.stringify(q.__jstorage_meta.CRC32)),R;g();R=h.parse(h.stringify(q.__jstorage_meta.CRC32));var P,O=[],Q=[];for(P in N){if(N.hasOwnProperty(P)){if(!R[P]){Q.push(P);continue}if(N[P]!=R[P]&&String(N[P]).substr(0,2)=="2."){O.push(P)}}}for(P in R){if(R.hasOwnProperty(P)){if(!N[P]){O.push(P)}}}M(O,"updated");M(Q,"deleted")}function M(S,T){S=[].concat(S||[]);if(T=="flushed"){S=[];for(var R in o){if(o.hasOwnProperty(R)){S.push(R)}}T="deleted"}for(var Q=0,N=S.length;Q<N;Q++){if(o[S[Q]]){for(var P=0,O=o[S[Q]].length;P<O;P++){o[S[Q]][P](S[Q],T)}}if(o["*"]){for(var P=0,O=o["*"].length;P<O;P++){o["*"][P](S[Q],T)}}}}function r(){var O=(+new Date()).toString();if(m=="localStorage"||m=="globalStorage"){try{c.jStorage_update=O}catch(N){m=false}}else{if(m=="userDataBehavior"){G.setAttribute("jStorage_update",O);G.save("jStorage")}}t()}function p(){if(c.jStorage){try{q=h.parse(String(c.jStorage))}catch(N){c.jStorage="{}"}}else{c.jStorage="{}"}s=c.jStorage?String(c.jStorage).length:0;if(!q.__jstorage_meta){q.__jstorage_meta={}}if(!q.__jstorage_meta.CRC32){q.__jstorage_meta.CRC32={}}}function w(){a();try{c.jStorage=h.stringify(q);if(G){G.setAttribute("jStorage",c.jStorage);G.save("jStorage")}s=c.jStorage?String(c.jStorage).length:0}catch(N){}}function D(N){if(typeof N!="string"&&typeof N!="number"){throw new TypeError("Key name must be string or numeric")}if(N=="__jstorage_meta"){throw new TypeError("Reserved key name")}return true}function b(){var T,O,R,P,Q=Infinity,S=false,N=[];clearTimeout(I);if(!q.__jstorage_meta||typeof q.__jstorage_meta.TTL!="object"){return}T=+new Date();R=q.__jstorage_meta.TTL;P=q.__jstorage_meta.CRC32;for(O in R){if(R.hasOwnProperty(O)){if(R[O]<=T){delete R[O];delete P[O];delete q[O];S=true;N.push(O)}else{if(R[O]<Q){Q=R[O]}}}}if(Q!=Infinity){I=setTimeout(b,Q-T)}if(S){w();r();M(N,"deleted")}}function B(){var Q,O;if(!q.__jstorage_meta.PubSub){return}var N,P=F;for(Q=O=q.__jstorage_meta.PubSub.length-1;Q>=0;Q--){N=q.__jstorage_meta.PubSub[Q];if(N[0]>F){P=N[0];f(N[1],N[2])}}F=P}function f(P,R){if(z[P]){for(var O=0,N=z[P].length;O<N;O++){try{z[P][O](P,h.parse(h.stringify(R)))}catch(Q){}}}}function a(){if(!q.__jstorage_meta.PubSub){return}var P=+new Date()-2000;for(var O=0,N=q.__jstorage_meta.PubSub.length;O<N;O++){if(q.__jstorage_meta.PubSub[O][0]<=P){q.__jstorage_meta.PubSub.splice(O,q.__jstorage_meta.PubSub.length-O);break}}if(!q.__jstorage_meta.PubSub.length){delete q.__jstorage_meta.PubSub}}function k(N,O){if(!q.__jstorage_meta){q.__jstorage_meta={}}if(!q.__jstorage_meta.PubSub){q.__jstorage_meta.PubSub=[]}q.__jstorage_meta.PubSub.unshift([+new Date,N,O]);w();r()}function L(S,O){var N=S.length,R=O^N,Q=0,P;while(N>=4){P=((S.charCodeAt(Q)&255))|((S.charCodeAt(++Q)&255)<<8)|((S.charCodeAt(++Q)&255)<<16)|((S.charCodeAt(++Q)&255)<<24);P=(((P&65535)*1540483477)+((((P>>>16)*1540483477)&65535)<<16));P^=P>>>24;P=(((P&65535)*1540483477)+((((P>>>16)*1540483477)&65535)<<16));R=(((R&65535)*1540483477)+((((R>>>16)*1540483477)&65535)<<16))^P;N-=4;++Q}switch(N){case 3:R^=(S.charCodeAt(Q+2)&255)<<16;case 2:R^=(S.charCodeAt(Q+1)&255)<<8;case 1:R^=(S.charCodeAt(Q)&255);R=(((R&65535)*1540483477)+((((R>>>16)*1540483477)&65535)<<16))}R^=R>>>13;R=(((R&65535)*1540483477)+((((R>>>16)*1540483477)&65535)<<16));R^=R>>>15;return R>>>0}n.jStorage={version:A,set:function(O,P,N){D(O);N=N||{};if(typeof P=="undefined"){this.deleteKey(O);return P}if(J.isXML(P)){P={_is_xml:true,xml:J.encode(P)}}else{if(typeof P=="function"){return undefined}else{if(P&&typeof P=="object"){P=h.parse(h.stringify(P))}}}q[O]=P;q.__jstorage_meta.CRC32[O]="2."+L(h.stringify(P),2538058380);this.setTTL(O,N.TTL||0);M(O,"updated");return P},get:function(N,O){D(N);if(N in q){if(q[N]&&typeof q[N]=="object"&&q[N]._is_xml){return J.decode(q[N].xml)}else{return q[N]}}return typeof(O)=="undefined"?null:O},deleteKey:function(N){D(N);if(N in q){delete q[N];if(typeof q.__jstorage_meta.TTL=="object"&&N in q.__jstorage_meta.TTL){delete q.__jstorage_meta.TTL[N]}delete q.__jstorage_meta.CRC32[N];w();r();M(N,"deleted");return true}return false},setTTL:function(O,N){var P=+new Date();D(O);N=Number(N)||0;if(O in q){if(!q.__jstorage_meta.TTL){q.__jstorage_meta.TTL={}}if(N>0){q.__jstorage_meta.TTL[O]=P+N}else{delete q.__jstorage_meta.TTL[O]}w();b();r();return true}return false},getTTL:function(O){var P=+new Date(),N;D(O);if(O in q&&q.__jstorage_meta.TTL&&q.__jstorage_meta.TTL[O]){N=q.__jstorage_meta.TTL[O]-P;return N||0}return 0},flush:function(){q={__jstorage_meta:{CRC32:{}}};w();r();M(null,"flushed");return true},storageObj:function(){function N(){}N.prototype=q;return new N()},index:function(){var N=[],O;for(O in q){if(q.hasOwnProperty(O)&&O!="__jstorage_meta"){N.push(O)}}return N},storageSize:function(){return s},currentBackend:function(){return m},storageAvailable:function(){return !!m},listenKeyChange:function(N,O){D(N);if(!o[N]){o[N]=[]}o[N].push(O)},stopListening:function(O,P){D(O);if(!o[O]){return}if(!P){delete o[O];return}for(var N=o[O].length-1;N>=0;N--){if(o[O][N]==P){o[O].splice(N,1)}}},subscribe:function(N,O){N=(N||"").toString();if(!N){throw new TypeError("Channel not defined")}if(!z[N]){z[N]=[]}z[N].push(O)},publish:function(N,O){N=(N||"").toString();if(!N){throw new TypeError("Channel not defined")}k(N,O)},reInit:function(){g()},noConflict:function(N){delete window.$.jStorage;if(N){window.jStorage=this}return this}};v()})();var BF_GplusSignin=function(){this.callback=function(authResult){signin.spinner();if(!authResult.status["signed_in"]){if(signin.spin_el){signin.spin_el.hide()}return}else{if(authResult.status["signed_in"]){new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:{googleplus:"1",otc:authResult.code},onSuccess:function(result){gplus._result(result)},onFailure:function(result){if(signin.spin_el){signin.spin_el.hide()}return}})}}};this._result=function(result){console.log(result);signin.is_gplus=true;var res=eval("("+result.responseText+")"),user=new BF_User,default_lang=BF_STATIC.language||"en",username,params;if(res.username.match("[^A-Za-z0-9]")){res.username=res.username.replace(res.username.match("[^A-Za-z0-9]")[0],"")}if(!user.isLoggedIn()&&res.login=="false"&&res.username&&res.password){params={name:res.username,username:res.username.replace(/\W/g,""),pw:res.password,email:res.email,contribute:"1",allow_email_updates:"1",googleplus_uid:res.googleplus_uid,import_fb_profile:"false",language:res.language||default_lang,googleplus_image:res.googleplus_image,display_name:res.display_name,};signin.social_register=true;bf_register.new_register(params)}else{if(res.login=="true"){gplus.login(res)}}};this.login=function(obj){if(obj.session_key){var user=new BF_User,user_info=user.getUserInfo();BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});BFW_Util.setInfoCookie({value:user_info});bf_login.cookieLogin()}}};var BF_Pixel=new (function(){var b=this;var a="http://pixel.buzzfeed.com/";this.save=function(h){if(typeof h!="object"){return false}if(!h.hasOwnProperty("dir")){return false}var c=new Image(),g=h.hasOwnProperty("params")?h.params:{},f=a+h.dir;g.z=Math.round((Math.random()*100000000));g="?"+b.encode_params(g);f+=g;c.setAttribute("height","1");c.setAttribute("width","1");if(BF_STATIC.env!="live"){console.log("BF Pixel: "+f)}else{c.setAttribute("src",f)}return f};this.encode_params=function(g){var c=[];for(var f in g){c.push(encodeURIComponent(f)+"="+encodeURIComponent(g[f]))}return c.join("&")}})();var trackVideo=function(f,b,g,h){if(!g){g=""}if(!h){h=""}var l=gtrack.findCatLabel(f);var m=l?l:gtrack.tt_page;var n=$(f);var a=n[bfjs.read_attr]("src");if(!a){a=h}var k=a?(a.split("?").length>=0?a.split("?")[0].replace(new RegExp(/^http:\/\//i),"").replace(new RegExp(/^www\./i),""):""):"";var c={ready:function(){gtrack.track_events(m,g+"[nc]video:load",k,null,true)},finish:function(){gtrack.track_events(m,g+"[nc]video:end",k,null,true)},play:function(){gtrack.track_events(m,g+"video-play",k)}};if(typeof c[b]!="undefined"){c[b]()}};var VimeoTrackVideo=function(){var b=this;var a={};this.init=function(){if((bfjs.isMobile()&&$(".video-embed.vimeo").length)||(!bfjs.isMobile()&&$$(".video_vimeo").length)){if(window.addEventListener){window.addEventListener("message",b.addVideoListener,false)}else{window.attachEvent("onmessage",b.addVideoListener,false)}}};this.addVideoListener=function(h){if(typeof h.origin=="undefined"||h.origin!="http://player.vimeo.com"){return}var f=null,c=null,k=null;if(bfjs.isMobile()){f=JSON.parse(h.data);k="#"+f.player_id}else{f=h.data.evalJSON();k=f.player_id}c=$(k);if(!f||!c){return}if(f.event=="ready"){a[k]={};var g=c[bfjs.read_attr]("src").split("?")[0];if(bfjs.isMobile()){c=$(k)[0]}b.addEvent("addEventListener","play",c,g);b.addEvent("addEventListener","finish",c,g)}if(a[k]&&!a[k][f.event]){trackVideo(k,f.event);a[k][f.event]=true}};this.addEvent=function(k,h,f,c){var g={method:k};if(h){g.value=h}f.contentWindow.postMessage(JSON.stringify(g),c)};this.init()};bfjs.onPageLoad(function(){new VimeoTrackVideo()});var YT_PLAYERS={};var YoutubeTrackVideo=function(){var b=this;var a={},c={};this.init=function(){if(isIE8()){document.observe("video:dfp",function(g){var f=$(g.target.id).select("object");if(!f.length||!f[0].getAttribute("id")){return}c[f[0].getAttribute("id")]={src:g.memo.src,dfp:g.memo.dfp}})}};this.addVideoListener=function(f){a[f]={};var g=$(f).readAttribute("src"),h="";if(g==null){g=c[f].src;if(c[f].dfp){h="dfp/"}}else{if(g){h=g.match(/dfp=true/)?"dfp/":""}}this.addEvent(f,h,g)};this.addEvent=function(f,k,h){var g="yt"+Math.floor(Math.random()*100000);YT_PLAYERS[g]={onStateChanged:function(m){if(!a[f][m]){var l=b.getEventType(m);if(l){trackVideo(f,l,k,h);if(l=="finish"){b.ad_tracking()}}a[f][m]=true}}};if($(f).addEventListener){$(f).addEventListener("onStateChange","YT_PLAYERS."+g+".onStateChanged",false)}else{$(f).attachEvent("onStateChange","YT_PLAYERS."+g+".onStateChanged",false)}};this.ad_tracking=function(){if(BF_STATIC.tt_page=="Buzz"&&BF_STATIC.campaignid=="3208472"){var f=document.createElement("script");f.src="http://mono.vizu.com/cdn/00/01/17/62/beacon_flyover.js?vzsid=buzzfeedproper&ord="+(Math.random()*100000000000000000);document.getElementsByTagName("head")[0].appendChild(f)}};this.getEventType=function(g){var f="";switch(g){case -1:f="ready";break;case 0:f="finish";break;case 1:f="play";break}return f};this.init()};var youtube_track_video=!bfjs.isMobile()?new YoutubeTrackVideo():"";function onYouTubePlayerReady(a){if(youtube_track_video){youtube_track_video.addVideoListener(a)}}var BF_EmbedVideo=function(){this.agent=navigator.userAgent.toLowerCase();this.is_mobile=agent.match(/iphone|ipod|android|ipad/);this.index=1;this.init=function(){universal_dom.assign_handler({bucket:"video",handler:embed_video.load_video})};this.load_video=function(e,scroll){var data,video,vd=new bf2_terminal_Video,src_link,video_element;try{data=JSON.parse(e.getAttribute("rel:bf_bucket_data"))}catch(err){console.error(err)}video=scroll!=true?data.video:data.progload_video;src_link=video.url;video_element=$("video_buzz_element_"+video.id);vd.detect_type(video.url);if(vd.type&&vd.type!=null){src_link=vd.src_link}var so=BF_initSwfObject(src_link,{width:video.width,height:video.height});if(so.flowplayer){if(size=="sidebar"||size=="tiny"){so.hide_controls=true}if(size=="big"){so.height=360}else{if(size=="sidebar"){so.height=189}else{if(size=="small"){so.height=183}else{if(size=="tiny"){so.height=141}}}}if(is_mobile()){so.use_html5=true}so.write(video_element)}else{if(is_mobile()&&vd.type=="buzzfeed"){if(is_mobile()){so.use_html5=true}so.write(video_element)}else{if((!is_mobile()&&so.installedVer&&so.installedVer.major<8)||(is_mobile()&&vd.type!="youtube")){$(video_element).addClassName("video-embed-noflash");$(video_element).style.height="340px"}else{if(vd.type=="youtube"){if(isIE8()||isIE7()){Event.observe(window,"beforeunload",function(){$$("object").each(function(vidPlayer){vidPlayer.remove()})},false);if(isIE8()){so.addParam("wmode","opaque");$(video_element).fire("video:dfp",{src:src_link})}so.addParam("wmode","opaque");so.write($(video_element))}else{var start_time=vd.start_time?"&start="+vd.start_time:"";var autoplay=0;if(typeof(window.autoplay)!="undefined"){autoplay=1}var you_tube_markup="";if(video.meta_overlay){you_tube_markup='<div style="position:relative;" id="video_wrapper_'+video.id+'"><iframe id="yt_'+video.id+'" type="text/html" allowscriptaccess="always" allowfullscreen="true" width="'+video.width+'" height="'+video.height+'" src="https://www.youtube.com/embed/'+embed_video.get_youtube_video_id(video.url)+"?version=3&hl=en&fs=1&enablejsapi=1&origin="+window.location.protocol+"//"+window.location.host+"&playerapiid=embed_"+video.id+"&autoplay="+autoplay+"&wmode=opaque"+start_time+'" bgcolor="#000" class="ytvideo"></iframe></div>';var vd_overlays=eval("("+video.meta_overlay+")");yt_player.init(video.id,vd_overlays)}else{var you_tube_tmpl=new Template('<embed id="embed_'+video.id+'" src="#{src}" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="#{width}" height="#{height}" bgcolor="#000" wmode="opaque" class="ytvideo"></embed>');var you_tube_markup=you_tube_tmpl.evaluate({src:src_link+"?version=3&hl=en&fs=1&enablejsapi=1&playerapiid=embed_"+video.id+"&autoplay="+autoplay+start_time,width:video.width,height:video.height});if(BF_STATIC.tt_page=="Video"){you_tube_markup+"&rel=0&showinfo=0"}}$(video_element).innerHTML=you_tube_markup}}else{if(vd.type=="vimeo"){var vimeo_tmpl=new Template('<iframe id="vimeoplayer_'+video.id+'" class="vimeo_video" src="#{src}" width="#{width}" height="#{height}" frameborder="0"></iframe>');var vimeo_markup=vimeo_tmpl.evaluate({src:src_link+'?color=ee3322&api=1&player_id=vimeoplayer_"'+video.id+'"',width:video.width,height:video.height});$(video_element).innerHTML=vimeo_markup}else{try{so.addParam("wmode","opaque")}catch(e){}so.write(video_element)}}}}}};this.get_youtube_video_id=function(url){if(!url){return null}var regExp=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var match=url.match(regExp);if(match&&match[7].length){return match[7]}else{return null}}};var embed_video=new BF_EmbedVideo();BuzzLoader.register(embed_video.init,1);